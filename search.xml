<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>2022年杂感</title>
    <url>/2023/01/18/2022%E5%B9%B4%E6%9D%82%E6%84%9F/</url>
    <content><![CDATA[<blockquote>
<p>2022年，看好好多人在写总结、感悟，我也趁热打铁记录下自己的感想。可能大部分都会讲到疫情，当然我也会，这一年的不平凡确实刻骨铭心，可能在很多年后回想起这一年发生的事都还会记忆犹新，在此也算是记录下历程，以后再来回味。</p>
</blockquote>
<h3 id="持续不断的疫情"><a href="#持续不断的疫情" class="headerlink" title="持续不断的疫情"></a>持续不断的疫情</h3><p>2022年是第三年的疫情，上半年来讲相对于其他时间都还比较轻松一些（重庆区域），大家该忙的忙，该玩的玩，也没太在意这事，直到11月份来临，大面积疫情的爆发，重庆市区开始了长达7天的静默，不能上班，不能上学，每天还要做核酸，时刻还得观察着健康码的情况；那段时间看到最为疯狂的就是大家抢菜，超市完全是一哄而空，所有人都在为抗争疫情做准备，也可以说都是在苟且。</p>
<p>再往后面到12月初，全国都大面积爆发，我们连续在家办公了2周多，政府开始出台解封政策，全面开始新型对抗疫情：所有场所不再看健康码、不再考体温、不再封闭区域，那段时间的人们可以说是诚惶诚恐；有的人提倡解封，天天关在家赚不了钱还不如感染了算了；还有的人希望不解封，毕竟目前都还不知道疫情的危害性和后遗症，不知道放开后是什么样的结果；</p>
<span id="more"></span>
<p>直到1月初，全国已经大面积感染了新冠，连我送回老家的小孩都是感染了的，到了这时，是全民疯狂抢药的时候，布洛芬、连花清瘟、抗原试纸、N95口罩等药物完全达到了买不到的情况，布洛芬混悬液都被黄牛炒到上千元，我简直不能理解国人的这些操作，自私自利，发国烂财；</p>
<p>直到现在2023年1月18日来看，前期大面积感染的高峰已经过去了，所有人几乎都回归到了正常的工作和生活，N95口罩、抗原、药物几乎已经平静，随处都能买，但愿不会因为毒株的变化或者并发症等情况再次大面积被感染，而现在也只有等，等待变化、或许变好。</p>
<h3 id="女儿上幼儿园"><a href="#女儿上幼儿园" class="headerlink" title="女儿上幼儿园"></a>女儿上幼儿园</h3><p>2022年9月小孩已经3岁多，上学前几周我自己的忧虑症都犯了，上学后的状态果不其然，第一周都不知道是怎么过来的，不愿去上学，对面陌生的环境恐怖、害怕，到了学校就哭不停，回到家话都变少了，教室里的视频看到都为她担忧，我还不停地找抖音一些相关的视频学习，尽可能的缩短这个焦虑时长，当然所有的办法几乎都没效果，还是坚持了一周后就好了很多，索性开始的过程没有对后面造成影响，后面天天唱着歌去上学了，回想我自己刚上学那会儿，哪有这么多人关心、送去上学，都是自己扛过来的，看到小孩在面对新的事物、新的挑战、新的改变其实还是很欣慰的。</p>
<h3 id="老爸阑尾炎"><a href="#老爸阑尾炎" class="headerlink" title="老爸阑尾炎"></a>老爸阑尾炎</h3><p>2022年11月19日，我老爸跟我奶奶都在老家，平时的交流几乎都是在手机上进行，前几天的时候听他说肚子很痛，并让他去街上的镇医院做检查，还好现在的镇医院医疗条件也还可以，做了CT后的结果跟医生所料一样–阑尾炎，开始的时候我觉得这事没那么要紧，让他住院持续检查，当天晚上输了消炎水，他觉得不怎么痛就回到了乡下的房子老家，我知道他的心思他觉得家里还有个老人，不是很放心；当晚回到家10点左右我跟他发了视频问下情况，当视频接通的时候，看到我老爸痛的在床上打滚，脸上的表情已经抽搐，看到那一画面的时候真的不是滋味，后面联系了县医院的120到了县医院直接进行了手术，手术后的几天也是煎熬，医院说他的情况很严重，需要几天后才能吃饭，那几天饿得做梦都在吃饭，因为该死的疫情的影响，医院只能留一人照料，我连夜把我妈送到医院，由她去照料；索性几天后伤口还是康复很快。</p>
<p>这件事之后，我猛的更加惊醒了，一年一年的过去，我们都长大了，而我们眼里曾经伟岸、年轻的父母逐渐老去了，很多时候觉得自己还是个小孩子，在他们身边可以什么都不需要懂；我爸妈今年60岁了，我希望他们健康长寿，我不知道如何护他们周全？如果给他们好的生活？未来会怎么样，我真的不知道，甚至有时候我感觉恐惧，因为我时常在想未来的一生估计也就这样了，至少目前来看我是没有看到可以导致生活质量发生好的质变的的希望…</p>
<h3 id="结尾"><a href="#结尾" class="headerlink" title="结尾"></a>结尾</h3><p>作为一名大龄普通程序员，时常也在赶到焦虑，特别在当下经济环境不大好的情况下，生存变得尤为重要，年龄的限制也让这群人时刻都在提醒自己以后去做什么？送外卖？开滴滴？这个时代机遇已经用得差不多了，未来何去何从真的不知道…</p>
<p>当然，我有时还是很乐观，车到山前必有路嘛，做好当下的自己，以后的事以后再说。</p>
]]></content>
      <categories>
        <category>生活</category>
      </categories>
      <tags>
        <tag>生活</tag>
      </tags>
  </entry>
  <entry>
    <title>2020春节的那些事</title>
    <url>/2020/03/17/2020%E6%98%A5%E8%8A%82%E7%9A%84%E9%82%A3%E4%BA%9B%E4%BA%8B/</url>
    <content><![CDATA[<h3 id="年会"><a href="#年会" class="headerlink" title="年会"></a>年会</h3><p>从事编程行业也已经有好多年，可能这家公司还是第一次有家庭的感觉的，今年的年会是第一次参加，因为一次大排档大胆的放声歌唱被大伙儿拍成了视频发到全员公司群里后被推荐为今年年会代表本部门参加，排练时间算是比较的仓促，在短短两周的时间大伙儿齐心协力完成初步的彩排，直到1月18日的中午，表演团队都还是熟练细节，生怕出现一点点的差错，节目被安排在最后一个，听说我们数字化中心每年的节目都很精彩，公司的安排人员也希望我们能成为本次年会的压轴节目，当然还算如愿，本在台下紧张得发抖的我上台的几分钟内就心情就平静下来，我记得站上舞台开唱几句歌词的时候，后排几乎所有的人全部都站了起来，欢呼声、呐喊声仿佛我都已经听不清楚伴奏的声音，更多的还是观众的欢呼给了我信心，让本紧张的心情平稳了很多。节目的后半段是我们部门新来的一个同事排练的擒敌拳的表演，他进入编程行业之前是在中国维和部队非洲服役的，听起来都很吊，自小都有军队情节的团队同事们都很赞同他提出的方案，当然在舞台上表现出来的东西，是在一个互联网公司很少看到的，现在回看当时的表演视频，还是觉得蛮激动的。节目的评审分为两部分，一部分是评委给分，一部分是观众投票，我们的节目是评委评分第一名，观众评分第二名，后来最终成绩是第二名，名次是次要，主要觉得本次年会不管是节目的准备到彩排，还是最后的表演，大家都全身心的投入去做这个事情，不管结果好与不好，至少都是大家尽力后的结果，还是觉得圆满、欣慰。</p>
<span id="more"></span>
<p>今年的年会拿到了2019年“鸿巨新星”的表彰奖，还是蛮高兴，也感谢公司领导的认可；2019年本就是不平凡的一年，上年公司跨境项目的研发，下半年采购一条线、订单一条线等等，经历过顺境也煎熬过逆境，更大的成就不在于结果怎么样，而是奔向结果“在路上”的体验，一次一次压力迎面，很多次都被压得好像没有了信心，但又多次爬起来继续前行，当跃过那道坎，好像也觉得事情本没有那么复杂，所以自我总结，不管在什么事情上，合理的看待压力。<br><img src="/../img/chunjie_01.jpg" alt="year"><br><img src="/../img/chunjie_02.jpg" alt="year"></p>
<h3 id="春节"><a href="#春节" class="headerlink" title="春节"></a>春节</h3><p>越长大越不想过年，这真的是痛彻的感悟，2020年的春节来的可以说非常的快，感觉都还没做好准备，都过年了；放假期间唯一觉得跟工作日不同的就是颈椎没有那么痛，腰也没有那么酸，放假回到老家镇上，大家都是匆匆忙忙的准备的年货，感觉这些人都是年复一年在做一样的事情，可能现在对过年没有太多的概念，觉得不就跟普通的节日一样的么，何必弄得大家子忙前忙后的；结婚后，春节的假期基本都是在镇上媳妇儿家店里帮忙，不像以前春节期间自己的脚印能飞到天上去，平时店里生意很差，到了过年又是排队的来买，老丈人是镇上做卤菜生意的，都说他们家味道不错，加之春节回乡的人又多，可能也是其中的原因。</p>
<p>老家的上坟是在大年30的中午，还必须是在午饭前，上坟回来才能吃过年饭。记得每年我爸都会把鞭炮、烧纸准备好，等待我跟我大哥一起去上坟，提上上坟用的东西，奶奶每年都要提醒我们不要把地方搞错了，奶奶86了，耳朵不好使，都要重复说几遍；上坟的地方在我家侧对面几百米的地方，每次走到对面回望都能看到奶奶站在屋前望着我们，我站在我爷爷的坟前，回想爷爷去年那年我才8岁，一转眼过去22年了，这么些年爸妈为了我们两兄弟上学、工作、娶媳妇儿等等也很是操心，爸爸往年都会把半白的头发染黑，但是今年没有染，看着花白花白的，说实话，我还是希望他染，哪怕从表面上觉得自己的老爸年轻一点，他那人，一辈子做着群众的基层工作，却没有想过要得到什么回报，省吃俭用，也仅仅是为了我们兄弟俩，我跟我老爸这些年没有太多的交流，更多的是心在交流，我懂他。奶奶等待着我们回来，然后一家人吃着这一年最后的午餐，迎接新的一年。</p>
<h3 id="疫情"><a href="#疫情" class="headerlink" title="疫情"></a>疫情</h3><p>在老家期间，频繁的收到关于疫情相关的推送新闻，一开始大家都没有太多的警觉，该干嘛干嘛，记得全国大小各地都在镇府的引导下禁止出入大家才真正的紧张起来，记得在大年初二的时候全镇所有门市都关闭了，街上看不到几个人，防控队伍用喇叭还在大声的喊戴口罩，街上的大喇叭循环的在播报疫情期间禁止出门、走亲戚访友、聚会，街上也挂上了一道道关于疫情的横幅，这还是有史以来第一次感觉到了全国进入了疫情备战状态，所有药店的口罩都是卖空了的，跟战争备战几乎差不多，当然在03年的非典期间还没有这种感念，那时候在上学天天关在学校；上班时间一次次的延迟调整，学生到校时间到现在都还没有确定，所有的道路进行了封锁，就连我们的乡村道路都进行了封锁，每天看到疫情数据播报一天天的增加确诊人数、死亡人数，可能每个人的心都是紧张到了喉咙，这样的场景让我联想到了僵尸电影场景，会不会严重到疯抢物质、全国感染、尸横遍野的画面。到二月初，全国的学生、上班族都在提倡远程学习和远程办公的方式，不管国家严重到什么程度，学习和生产还是得进行。此次疫情结束后，会在未来留下一段振奋人心的历史记录，人类也应该为此次的疫情做下深刻的反思和思考，病毒战争不亚于人类冲突战争，不管我们从事任何行业，什么岗位，什么角色，都应该规范自己的行为，为后人留下一片绿海蓝天。</p>
<h3 id="宝宝"><a href="#宝宝" class="headerlink" title="宝宝"></a>宝宝</h3><p>3月7号，宝宝八个月，从出生看着她慢慢的长大，出现了很多的变化，真的是一天一个样；宝宝的小名叫七七，出生于2019年7月7日，全家人都很喜欢她，不仅仅是全家的小宝贝，还更多的是因为小孩子给人萌萌的感觉吧，不管在什么情况下，跟她互动都能露出萌萌的笑容；最喜欢的就是洗澡，只要坐进澡盆，那懒洋洋的姿态和那闲散的样子真的是让人看着都好笑，不哭也不闹，反而会给你甜甜的笑容，很多时候她都成为了全家人释压的宝贝，看着小孩子那天真无邪的笑容仿佛觉得这世上没有过不去的坎；一天天的长大也表现得不同，就如网络游戏升级打怪一样，从青铜到王者，都是一点点技能慢慢掌握的，你能明显的感觉到她的变化，刚开始用东西触碰她的小手，她会被动的来拿，慢慢的就主动的抓取她的手能够得到的所有的东西，摔打、欢呼，有时候自己都能把自己逗笑，抱在怀里双脚狂蹬不停，吃奶的时候喜欢边抱着小脚丫边抱着奶瓶，一不留神小脚丫都已经踢到了被子上面，自己还睡得死沉死沉的；慢慢的她能感觉到你的表情变化，她知道你是在逗她笑还是在假装生气，有时候闲奶爸冲奶的时候太慢，疯狂的吼我，要吃奶的时候那是什么都不能阻挡的，吃了奶就能美美的睡上一觉；拉了粑粑自己也觉得不舒服，洗屁屁的时候也是觉得很享受的时刻，但奶爸是被臭晕了…最近不知道是不是因为长牙齿，七七晚上睡不好，妈妈也跟着睡不好，感觉每天晚上都只能睡2-3个小时，妈妈最近也想找工作了，也不知道晚上睡觉怎么办；妈妈、奶奶白天带七七，做辅食，带出去玩，全家都是围着她转，其实还是蛮辛苦，当然更多的是欢笑。<br><img src="/../img/chunjie_04.jpg" alt="year"></p>
]]></content>
      <categories>
        <category>生活</category>
      </categories>
      <tags>
        <tag>生活</tag>
      </tags>
  </entry>
  <entry>
    <title>2023年杂感</title>
    <url>/2024/02/06/2023%E5%B9%B4%E6%9D%82%E6%84%9F/</url>
    <content><![CDATA[<blockquote>
<p>2024年，你好！<br>新的一年到来，抽点时间回顾下昨天也展望下未来；随着年龄的增长越来越不想跨年，而且你会发觉一年的时间特别短，时间过得飞快，有的人还没好好陪伴、有的事还没做完、有的愿望还没实现、有的地方还没远去；时间只是一味的改变你的容颜、抹去你的黑发、退化你的身体、磨灭你的记忆，却从不提醒你落下了好多东西。趁着快放假前夕，写些无头绪的杂感。</p>
</blockquote>
<span id="more"></span>

<h4 id="老爸退休"><a href="#老爸退休" class="headerlink" title="老爸退休"></a>老爸退休</h4><p>小时候追星，心里的偶像一定是这个明星那个明星，长大了才知道心里的偶像一定是我老爸，做着基层的工作拿着最低的薪资，常年累月坚持了30多年，我知道他很热爱他的工作，也热衷于服务他热爱的老乡亲；生活上长年保持勤俭节约的习惯，爱干净、讲卫生、爱整洁，每天都是天亮起床做清洁、打扫院落，我老爸经常说：家里虽没有一块瓷砖，但要时刻保持干净；我老爸是个乡村演说家，不管在哪都能滔滔不绝，乡亲们的大小事都是由他去布置与安排，周边红白喜事的礼薄上几乎都是他的笔迹，大家都喜欢他的一手好字。2023年8月1日，我老爸正式退休了，给他办了一个隆重的家庭生日会，大家都在祝福他退休快乐，但我知道我老爸还不甘心，还不想退休，一来是觉得没收入了怕加重我们的负担（他们这代基层干部是没有退休金的）；二来怕闲，觉着没事做，他那人就怕闲下来，他就觉得很无趣；作为我来讲发自内心的希望他能慢下脚步，操劳了一辈子，好好享受下退休生活，去拾取自己的爱好，做自己想做的事情，最重要的就是健健康康，心情愉悦。</p>
<h4 id="七七"><a href="#七七" class="headerlink" title="七七"></a>七七</h4><p>七七到年底已经4岁半了，也长高了不少，这一年的进度可以说是非常大的，从开始不愿意上幼儿园每天哭哭啼啼到吃着零食唱着歌去上学，那种童年发自内心的开心是我能感受到的；这一年里已经是自己吃饭、自己刷牙、自己穿鞋、打扫卫生、独立思考等等已经是自己能力所能及做一些服务自己的事了（之前确实有些溺爱），每个人努力结果的后背一定是付出代价的，这一年时间内家里的成本对她的思维都在我们的劝说下发生一些变化，作为我们来讲，其实很多时候内心是痛苦的，看到她不愿去改变而哭哭啼啼的样子，但坚持下来确实是有效果的、对她的未来是有帮助的、是她们这个时代的人更需要去经历的，因为我知道她们这代人未来的挑战将更加残酷，没有技能没有能力难得有社会中的一席之地，这种教育理念我得一直坚持下去，改变之前的方式，确实作为我来讲第一次当父母，真的还没意识到小孩对很多东西已经开始感知了，不是每天陪她玩、陪她闹就是最好的陪伴，适当的加入规则、边线、积极鼓励等都是有必要的；</p>
<p>今年开始参加了重庆话剧院的表演课程的训练，她自己也很喜欢里面的老师和氛围，能在众人面前表演自己的演讲、朗诵作品，而且每周的作业都能出色的完成，我觉得还是蛮欣慰的，表演课可以说对她的提升还是很大，展现自己去找到自信，从胆怯到慢慢自信这个过程是需要时间的，而她在慢慢发现里面的奥秘。</p>
<h4 id="中年危机？"><a href="#中年危机？" class="headerlink" title="中年危机？"></a>中年危机？</h4><p>今年的生日就正式35岁了，好多人好多行业对于35岁来讲都是一个尴尬的年纪，目前还是继续做着开发的工作，还是希望能在这条路上一直长走，做了10多年了没办法也只会这个了，如果要在这个年纪换行这个代价将是巨大的啊，现在想想中学时代爸妈建议报考教师、医生其实还是真有道理的，他们始终都考虑在了我们的前面；以前我自己会焦虑，但是真正到了，我感觉焦虑少了很多，对这个事情我已经变得乐观了，有没有一种心理是越害怕就越不害怕了，我就想着时钟终究在走，时间终究在流逝，我们终将会变老，既来之则安之，一个人前行的动力我相信绝不仅仅只有赚钱，还有很多很多，也希望跟我同龄的大伙们能走出这个”阴霾”，你的动力始终能推着你前行。</p>
<p>零零碎碎讲了一些，苦笑文采不够，新的一年，身体是第一位的，新年快乐，万事胜意！</p>
<p>2024年，你好！</p>
]]></content>
      <categories>
        <category>生活</category>
      </categories>
      <tags>
        <tag>生活</tag>
      </tags>
  </entry>
  <entry>
    <title>Docker安装ElasticSearch</title>
    <url>/2024/06/24/Docker%E5%AE%89%E8%A3%85ElasticSearch/</url>
    <content><![CDATA[<h2 id="一、安装Docker"><a href="#一、安装Docker" class="headerlink" title="一、安装Docker"></a>一、安装Docker</h2><p>安装依赖包，执行命令</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install -y yum-utils device-mapper-persistent-data lvm2</span><br></pre></td></tr></table></figure>
<p>此时若直接执行安装docker命令就会发现是十分慢的，这个等待过程是漫长的。<br>配置国内的源就可以解决问题yum-config-manager –add-repo <a href="http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo%E8%BF%99%E9%87%8C%E4%BD%BF%E7%94%A8%E7%9A%84%E6%98%AF%E9%98%BF%E9%87%8C%E4%BA%91%E7%9A%84%E6%BA%90%E3%80%82">http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo这里使用的是阿里云的源。</a></p>
<p>接着再执行命令</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install docker-ce docker-ce-cli containerd.io    //安装docker即可。</span><br></pre></td></tr></table></figure>
<p>配置docker开机自启</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl enable docker</span><br></pre></td></tr></table></figure>

<p>执行命令启动docker  </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl start docker</span><br></pre></td></tr></table></figure>

<p>查看docker版本</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker -v</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<p>详细安装教程也可以移步：<a href="https://zhuanlan.zhihu.com/p/699515988">https://zhuanlan.zhihu.com/p/699515988</a></p>
<h2 id="二、安装ElasticSearch"><a href="#二、安装ElasticSearch" class="headerlink" title="二、安装ElasticSearch"></a>二、安装ElasticSearch</h2><p>使用docker直接获取es镜像，执行命令</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker pull elasticsearch:7.7.0</span><br></pre></td></tr></table></figure>

<p>创建容器</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run --name elasticsearch -d -e ES_JAVA_OPTS=&quot;-Xms512m -Xmx512m&quot; -e &quot;discovery.type=single-node&quot; -p 9200:9200 -p 9300:9300 elasticsearch:7.7.0</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">--name 表示容器名称  </span><br><span class="line">-d: 后台运行容器，并返回容器ID；</span><br><span class="line">-e: 指定容器内的环境变量</span><br><span class="line">-p: 指定端口映射，格式为：主机(宿主)端口:容器端口</span><br></pre></td></tr></table></figure>
<p>es默认端口为9200，只用ip地址+端口号直接访问，就会返回以下内容。能看到以下内容表示已经安装成功。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">// 20240624175208</span><br><span class="line">// http://120.46.74.101:9200/</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;a2a07f317da2&quot;,</span><br><span class="line">  &quot;cluster_name&quot;: &quot;docker-cluster&quot;,</span><br><span class="line">  &quot;cluster_uuid&quot;: &quot;N905CEz0RaWVe8AkWYioOA&quot;,</span><br><span class="line">  &quot;version&quot;: &#123;</span><br><span class="line">    &quot;number&quot;: &quot;7.7.0&quot;,  // 版本号</span><br><span class="line">    &quot;build_flavor&quot;: &quot;default&quot;,</span><br><span class="line">    &quot;build_type&quot;: &quot;docker&quot;,</span><br><span class="line">    &quot;build_hash&quot;: &quot;81a1e9eda8e6183f5237786246f6dced26a10eaf&quot;,</span><br><span class="line">    &quot;build_date&quot;: &quot;2020-05-12T02:01:37.602180Z&quot;,</span><br><span class="line">    &quot;build_snapshot&quot;: false,</span><br><span class="line">    &quot;lucene_version&quot;: &quot;8.5.1&quot;,</span><br><span class="line">    &quot;minimum_wire_compatibility_version&quot;: &quot;6.8.0&quot;,</span><br><span class="line">    &quot;minimum_index_compatibility_version&quot;: &quot;6.0.0-beta1&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;tagline&quot;: &quot;You Know, for Search&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="三、安装ElasticSearch-Head"><a href="#三、安装ElasticSearch-Head" class="headerlink" title="三、安装ElasticSearch-Head"></a>三、安装ElasticSearch-Head</h2><p>同样也采用Docker进行快速安装，跟上边一样同样先拉取镜像，执行命令</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker pull mobz/elasticsearch-head:5</span><br></pre></td></tr></table></figure>

<p>接着创建容器，执行</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker create --name elasticsearch-head -p 9100:9100 mobz/elasticsearch-head:5</span><br></pre></td></tr></table></figure>

<p>还需要一个操作，那就是启动容器docker start 容器id<br>安装完成直接使用域名加端口9100即可访问。</p>
<h4 id="处理跨域"><a href="#处理跨域" class="headerlink" title="处理跨域"></a>处理跨域</h4><p>在连接ElasticSearch会发现无法连接，由于时前后端分离开发，所以会存在跨域问题，需要在服务端做跨域处理。<br>执行命令</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker exec -it elasticsearch /bin/bash</span><br></pre></td></tr></table></figure>
<p> 进入到第一步创建的ElasticSearch容器中，修改配置文件 <strong>vi config&#x2F;elasticsearch.yml</strong> 即可。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">http.cors.enabled: true</span><br><span class="line">http.cors.allow-origin: &quot;*&quot;</span><br></pre></td></tr></table></figure>


<h2 id="四、安装IK分词器"><a href="#四、安装IK分词器" class="headerlink" title="四、安装IK分词器"></a>四、安装IK分词器</h2><p>IK提供了两个分词算法：ik_smart和ik_max_word，其中ik_smart为最少切分，ik_max_word为最细力度。</p>
<p><span style="color:red"><strong>特别注意</strong>：这里需要注意安装的版本需要跟ElasticSearch版本一致。</span></p>
<p>进入到ElasticSearch容器中docker exec -it 容器ID &#x2F;bin&#x2F;bash</p>
<p>使用wget来进行安装，执行</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.7.0/elasticsearch-analysis-ik-7.7.0.zip</span><br></pre></td></tr></table></figure>

<p>当你使用wget安装出现Unable to establish SSL connection时执行以下俩个命令即可。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install opensslls</span><br><span class="line">yum install openssl-devel</span><br></pre></td></tr></table></figure>

<p>如果没有wget工具通过以下命令安装：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install wget</span><br></pre></td></tr></table></figure>

<p>执行 <strong>cd &#x2F;usr&#x2F;share&#x2F;elasticsearch&#x2F;plugins</strong> 来到插件目录创建一个IK目录</p>
<p>将压缩包移动到IK目录中，执行解压指令</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">unzip elasticsearch-analysis-ik-7.7.0.zip</span><br></pre></td></tr></table></figure>

<p>接着删除压缩包即可，此时你可以看到一个config包和几个jar包</p>
<p>最后退出容器，重启重启容器即可。</p>
<h4 id="检验是否成功"><a href="#检验是否成功" class="headerlink" title="检验是否成功"></a>检验是否成功</h4><p>安装完后，就可以使用 _analyze 语法验证</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">GET /_analyze</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;text&quot;</span>: <span class="string">&quot;中华人民共和国国歌&quot;</span>,</span><br><span class="line">  <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;ik_smart&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>响应结果</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;tokens&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;token&quot;</span>: <span class="string">&quot;中华人民共和国&quot;</span>,</span><br><span class="line">      <span class="string">&quot;start_offset&quot;</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="string">&quot;end_offset&quot;</span>: <span class="number">7</span>,</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;CN_WORD&quot;</span>,</span><br><span class="line">      <span class="string">&quot;position&quot;</span>: <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;token&quot;</span>: <span class="string">&quot;国歌&quot;</span>,</span><br><span class="line">      <span class="string">&quot;start_offset&quot;</span>: <span class="number">7</span>,</span><br><span class="line">      <span class="string">&quot;end_offset&quot;</span>: <span class="number">9</span>,</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;CN_WORD&quot;</span>,</span><br><span class="line">      <span class="string">&quot;position&quot;</span>: <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>表示分词IK已生效。</p>
<br/>

<p>参考文献： <a href="https://developer.aliyun.com/article/929422#slide-4">https://developer.aliyun.com/article/929422#slide-4</a></p>
]]></content>
      <categories>
        <category>docker</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>ApiDoc开发文档使用简介</title>
    <url>/2020/07/15/ApiDoc%E5%BC%80%E5%8F%91%E6%96%87%E6%A1%A3%E4%BD%BF%E7%94%A8%E7%AE%80%E4%BB%8B/</url>
    <content><![CDATA[<blockquote>
<p>apidoc是一款比较好用的开发文档生成工具，操作简单易理解，可以使用在C#、Go、Java、JavaScript、PHP等开发语言中。</p>
</blockquote>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>1、安装node.js（<a href="https://nodejs.org/zh-cn/%EF%BC%89">https://nodejs.org/zh-cn/）</a><br>2、安装iapDoc</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">npm install apidoc -g</span><br></pre></td></tr></table></figure>
<span id="more"></span>

<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>在项目根目录下新建<code>apidoc.json</code>文件，该文件描述了项目对外提供接口的概要信息，比如名称、描述、版本、文档打开时浏览器显示标题和接口缺省访问地址。<br>apidoc.json</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;knight.s.hongju.cc&quot;</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;description&quot;</span>: <span class="string">&quot;knight公共服务api&quot;</span>,</span><br><span class="line">  <span class="string">&quot;title&quot;</span>: <span class="string">&quot;Custom apiDoc browser title&quot;</span>,</span><br><span class="line">  <span class="string">&quot;url&quot;</span> : <span class="string">&quot;&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用样例"><a href="#使用样例" class="headerlink" title="使用样例"></a>使用样例</h3><p>在每个方法体的前面加入apidoc的注释批注，主要是对api开放出去的接口的请求方式、请求地址、版本、分组、授权、头部、成功&#x2F;失败返回实例等的描述</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@api</span> &#123;get&#125;/ekuaibao/get_invoices_specifications 获取企业单据模板列表</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@apiVersion</span> 1.0.0</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@apiName</span> 获取企业单据模板列表</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@apiGroup</span> 易快报</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@apiSuccessExample</span> Success-Response:</span></span><br><span class="line"><span class="comment">           success: true,</span></span><br><span class="line"><span class="comment">           code: 200,</span></span><br><span class="line"><span class="comment">           msg: &quot;获取成功&quot;,</span></span><br><span class="line"><span class="comment">           data: [</span></span><br><span class="line"><span class="comment">               &#123;</span></span><br><span class="line"><span class="comment">                   id: &quot;0qE9XeZa9Ysw00&quot;,</span></span><br><span class="line"><span class="comment">                   name: &quot;申请单&quot;,</span></span><br><span class="line"><span class="comment">                   type: &quot;requisition&quot;</span></span><br><span class="line"><span class="comment">               &#125;,</span></span><br><span class="line"><span class="comment">               &#123;</span></span><br><span class="line"><span class="comment">                   id: &quot;25wa-UgKfohI00&quot;,</span></span><br><span class="line"><span class="comment">                   name: &quot;测试-平台刷单费用报销单&quot;,</span></span><br><span class="line"><span class="comment">                   type: &quot;expense&quot;</span></span><br><span class="line"><span class="comment">               &#125;,</span></span><br><span class="line"><span class="comment">               &#123;</span></span><br><span class="line"><span class="comment">                   id: &quot;2lEb159L9AoI00&quot;,</span></span><br><span class="line"><span class="comment">                   name: &quot;测试－赠送虚拟币收支申请&quot;,</span></span><br><span class="line"><span class="comment">                   type: &quot;custom&quot;</span></span><br><span class="line"><span class="comment">               &#125;,</span></span><br><span class="line"><span class="comment">               &#123;</span></span><br><span class="line"><span class="comment">                   id: &quot;59kau3TSLIfA00&quot;,</span></span><br><span class="line"><span class="comment">                   name: &quot;福利费用报销单&quot;,</span></span><br><span class="line"><span class="comment">                   type: &quot;expense&quot;</span></span><br><span class="line"><span class="comment">               &#125;,</span></span><br><span class="line"><span class="comment">               &#123;</span></span><br><span class="line"><span class="comment">                   id: &quot;6FQb457wMwdY00&quot;,</span></span><br><span class="line"><span class="comment">                   name: &quot;测试-平台费用红冲退回借款单&quot;,</span></span><br><span class="line"><span class="comment">                   type: &quot;loan&quot;</span></span><br><span class="line"><span class="comment">               &#125;</span></span><br><span class="line"><span class="comment">           ]</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * -  获取企业单据模板列表</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> Request $request</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> Response $response</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> Response</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInvoicesSpecifications</span>(<span class="params">Request <span class="variable">$request</span>, Response <span class="variable">$response</span></span>) : <span class="title">Response</span></span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">   	.....</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>


<h4 id="api"><a href="#api" class="headerlink" title="@api"></a>@api</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">@api &#123;method&#125; path [title]</span><br></pre></td></tr></table></figure>
<p>HTTP接口调用方法、路径及名称</p>
<h4 id="apiVersion"><a href="#apiVersion" class="headerlink" title="@apiVersion"></a>@apiVersion</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">@apiVersion version</span><br></pre></td></tr></table></figure>
<p>api 版本号</p>
<h4 id="apiName"><a href="#apiName" class="headerlink" title="@apiName"></a>@apiName</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">@apiName name</span><br></pre></td></tr></table></figure>
<p> api 名称</p>
<h4 id="apiGroup"><a href="#apiGroup" class="headerlink" title="@apiGroup"></a>@apiGroup</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">@apiGroup name</span><br></pre></td></tr></table></figure>
<p>api 分组</p>
<h4 id="apiHeader"><a href="#apiHeader" class="headerlink" title="@apiHeader"></a>@apiHeader</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">@apiHeader [(group)] [&#123;type&#125;] [field=defaultValue] [description]</span><br></pre></td></tr></table></figure>
<p>请求头参数</p>
<h4 id="apiParam"><a href="#apiParam" class="headerlink" title="@apiParam"></a>@apiParam</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">@apiParam [(group)] [&#123;type&#125;] [field=defaultValue] [description]</span><br></pre></td></tr></table></figure>
<p>请求参数</p>
<h4 id="apiSuccess"><a href="#apiSuccess" class="headerlink" title="@apiSuccess"></a>@apiSuccess</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">@apiSuccess [(group)] [&#123;type&#125;] field [description]</span><br></pre></td></tr></table></figure>
<p>返回数据描述</p>
<h4 id="apiSuccessExample"><a href="#apiSuccessExample" class="headerlink" title="@apiSuccessExample"></a>@apiSuccessExample</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">@apiSuccessExample [&#123;type&#125;] [title]</span><br><span class="line">                   example</span><br></pre></td></tr></table></figure>
<p>接口成功返回样例</p>
<h4 id="apiError"><a href="#apiError" class="headerlink" title="@apiError"></a>@apiError</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">@apiError [(group)] [&#123;type&#125;] field [description]</span><br></pre></td></tr></table></figure>
<p>接口失败描述</p>
<h4 id="apiErrorExample"><a href="#apiErrorExample" class="headerlink" title="@apiErrorExample"></a>@apiErrorExample</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">@apiErrorExample [&#123;type&#125;] [title]</span><br><span class="line">                 example</span><br></pre></td></tr></table></figure>

<p>接口失败返回样例</p>
<h4 id="apiDefine"><a href="#apiDefine" class="headerlink" title="@apiDefine"></a>@apiDefine</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">@apiDefine name [title]</span><br><span class="line">                     [description]</span><br></pre></td></tr></table></figure>
<p>类似于宏定义，可以被引用</p>
<h4 id="apiUse"><a href="#apiUse" class="headerlink" title="@apiUse"></a>@apiUse</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">@apiUse name</span><br></pre></td></tr></table></figure>

<p>使用@apiDefine定义的描述</p>
<p>更详细的说明请参考官方文档<a href="http://apidocjs.com/">http://apidocjs.com</a></p>
<h3 id="生成文档"><a href="#生成文档" class="headerlink" title="生成文档"></a>生成文档</h3><p>cd到apidoc.json所在路径（即项目根目录）执行如下命令即可</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">apidoc -i src/ -o apidoc/</span><br></pre></td></tr></table></figure>




]]></content>
      <categories>
        <category>html</category>
      </categories>
      <tags>
        <tag>html</tag>
      </tags>
  </entry>
  <entry>
    <title>Docker搭建Elasticsearch</title>
    <url>/2023/01/11/Docker%E6%90%AD%E5%BB%BAElasticsearch/</url>
    <content><![CDATA[<h2 id="ElasticSearch安装"><a href="#ElasticSearch安装" class="headerlink" title="ElasticSearch安装"></a>ElasticSearch安装</h2><h3 id="Docker镜像拉取"><a href="#Docker镜像拉取" class="headerlink" title="Docker镜像拉取"></a>Docker镜像拉取</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">docker search elasticsearch</span><br><span class="line"></span><br><span class="line">docker pull elasticsearch:<span class="number">7.7</span>.<span class="number">0</span></span><br></pre></td></tr></table></figure>

<h3 id="本地创建es挂载目录"><a href="#本地创建es挂载目录" class="headerlink" title="本地创建es挂载目录"></a>本地创建es挂载目录</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">mkdir /data/elasticsearch/data</span><br><span class="line"></span><br><span class="line">mkdir /data/elasticsearch/plugins</span><br><span class="line"></span><br><span class="line">mkdir /data/elasticsearch/config</span><br></pre></td></tr></table></figure>
<span id="more"></span>

<h3 id="赋予各目录777权限"><a href="#赋予各目录777权限" class="headerlink" title="赋予各目录777权限"></a>赋予各目录777权限</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">chmod <span class="number">777</span> /data/elasticsearch/data</span><br></pre></td></tr></table></figure>

<h3 id="进入config目录创建elasticsearch-yml"><a href="#进入config目录创建elasticsearch-yml" class="headerlink" title="进入config目录创建elasticsearch.yml"></a>进入config目录创建elasticsearch.yml</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&gt; cd /data/elasticsearch/config</span><br><span class="line">vim elasticsearch.yml</span><br><span class="line"></span><br><span class="line"><span class="comment">#集群名称</span></span><br><span class="line">cluster.name: <span class="string">&quot;elasticsearch&quot;</span></span><br><span class="line">network.host: <span class="number">0.0</span>.<span class="number">0.0</span></span><br><span class="line"><span class="comment">#跨域设置</span></span><br><span class="line">http.cors.enabled: <span class="literal">true</span></span><br><span class="line">http.cors.allow-origin: <span class="string">&quot;*&quot;</span></span><br><span class="line"><span class="comment">#http端口</span></span><br><span class="line">http.port: <span class="number">9200</span></span><br><span class="line"><span class="comment">#java端口</span></span><br><span class="line">transport.tcp.port: <span class="number">9300</span></span><br></pre></td></tr></table></figure>

<h3 id="运行镜像"><a href="#运行镜像" class="headerlink" title="运行镜像"></a>运行镜像</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">docker run --name elasticsearch -p <span class="number">9200</span>:<span class="number">9200</span> -p <span class="number">9300</span>:<span class="number">9300</span> -d --restart=always -e <span class="string">&quot;discovery.type=single-node&quot;</span> -e ES_JAVA_OPTS=<span class="string">&quot;-Xms512m -Xmx512m&quot;</span>  -v /data/elasticsearch/data:/usr/share/elasticsearch/data -v /data/elasticsearch/plugins:/usr/share/elasticsearch/plugins -v /data/elasticsearch/config/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml <span class="number">7</span>ec4f35ab452 (镜像id)</span><br></pre></td></tr></table></figure>

<ul>
<li>–name：表示镜像启动后的容器名称</li>
<li>-d: 后台运行容器，并返回容器ID；</li>
<li>-e: 指定容器内的环境变量</li>
<li>-p: 指定端口映射，格式为：主机(宿主)端口:容器端口</li>
<li>-v：标记 在容器中设置了一个挂载点&#x2F;data（就是容器中的一个目录），并将主机上的&#x2F;data&#x2F;test&#x2F;data 目录中的内容关联到&#x2F;data下</li>
</ul>
<h3 id="浏览器访问IP-9200"><a href="#浏览器访问IP-9200" class="headerlink" title="浏览器访问IP:9200"></a>浏览器访问IP:9200</h3><p>1、如果是在线上服务器搭建，可以先使用curl 127.0.0.1:9200是否可以访问，如果出现如下则表示安装成功</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;e640052ea9d2&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cluster_name&quot;</span>: <span class="string">&quot;elasticsearch&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cluster_uuid&quot;</span>: <span class="string">&quot;7_4uRzWoRRaWRtcaqithEA&quot;</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;number&quot;</span>: <span class="string">&quot;7.7.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_flavor&quot;</span>: <span class="string">&quot;default&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_type&quot;</span>: <span class="string">&quot;docker&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_hash&quot;</span>: <span class="string">&quot;81a1e9eda8e6183f5237786246f6dced26a10eaf&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_date&quot;</span>: <span class="string">&quot;2020-05-12T02:01:37.602180Z&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_snapshot&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;lucene_version&quot;</span>: <span class="string">&quot;8.5.1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;minimum_wire_compatibility_version&quot;</span>: <span class="string">&quot;6.8.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;minimum_index_compatibility_version&quot;</span>: <span class="string">&quot;6.0.0-beta1&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;tagline&quot;</span>: <span class="string">&quot;You Know, for Search&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2、如果需要访问线上服务器ip:9200，需要去服务器后台开启9200端口后再访问，如果出现上面内容，表示成功。</p>
<h2 id="安装Elasticsearch-head"><a href="#安装Elasticsearch-head" class="headerlink" title="安装Elasticsearch-head"></a>安装Elasticsearch-head</h2><h3 id="镜像拉取"><a href="#镜像拉取" class="headerlink" title="镜像拉取"></a>镜像拉取</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#拉取镜像</span></span><br><span class="line">docker pull mobz/elasticsearch-head:<span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#创建容器</span></span><br><span class="line">docker create --name elasticsearch-head -p <span class="number">9100</span>:<span class="number">9100</span> --restart=always mobz/elasticsearch-head:<span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#启动容器</span></span><br><span class="line">docker start elasticsearch-head</span><br></pre></td></tr></table></figure>

<h3 id="修改docker中elasticsearch的elasticsearch-yml文件"><a href="#修改docker中elasticsearch的elasticsearch-yml文件" class="headerlink" title="修改docker中elasticsearch的elasticsearch.yml文件"></a>修改docker中elasticsearch的elasticsearch.yml文件</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">docker exec -it elasticsearch /bin/bash （进不去使用容器id进入）</span><br><span class="line">vim config/elasticsearch.yml</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 最下方添加</span></span><br><span class="line">http.cors.enabled: <span class="literal">true</span> </span><br><span class="line">http.cors.allow-origin: <span class="string">&quot;*&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="vim修改文件报错-bash-vi-command-not-found"><a href="#vim修改文件报错-bash-vi-command-not-found" class="headerlink" title="vim修改文件报错 bash: vi: command not found"></a>vim修改文件报错 bash: vi: command not found</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">apt-get update</span><br><span class="line">apt-get install vim</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载vim</span></span><br><span class="line">yum -y install vim*</span><br></pre></td></tr></table></figure>

<h3 id="退出重启服务"><a href="#退出重启服务" class="headerlink" title="退出重启服务"></a>退出重启服务</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">exit</span></span><br><span class="line">docker restart 容器id</span><br></pre></td></tr></table></figure>

<h3 id="浏览器访问IP-9100"><a href="#浏览器访问IP-9100" class="headerlink" title="浏览器访问IP:9100"></a>浏览器访问IP:9100</h3><p>如果出现elasticsearch-head界面则成功，需要手动输入ip:9200连接</p>
<h3 id="修改Elasticsearch-head配置，解决406错误码-没有报错可以跳过"><a href="#修改Elasticsearch-head配置，解决406错误码-没有报错可以跳过" class="headerlink" title="修改Elasticsearch-head配置，解决406错误码(没有报错可以跳过)"></a>修改Elasticsearch-head配置，解决406错误码(没有报错可以跳过)</h3><p>在elasticsearch-head界面添加索引报错406，需要如下处理</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#复制vendor.js到外部</span></span><br><span class="line">docker cp <span class="number">7</span>ec4f35ab452:/usr/src/app/_site/vendor.js /data/elasticsearch/head/_site</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改vendor.js</span></span><br><span class="line">vim vendor.js</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">修改点</span><br><span class="line"><span class="number">1</span>. <span class="number">6886</span>行 contentType:<span class="string">&quot;application/x-www-form-urlencoded&quot;</span> </span><br><span class="line">改为 </span><br><span class="line">					contentType:<span class="string">&quot;application/json;charset=UTF-8&quot;</span></span><br><span class="line">					</span><br><span class="line"><span class="number">2</span>. <span class="number">7574</span>行 <span class="keyword">var</span> inspectData = s.contentType === <span class="string">&quot;application/x-www-form-urlencoded&quot;</span> &amp;&amp; </span><br><span class="line">改为</span><br><span class="line">					<span class="keyword">var</span> inspectData = s.contentType === <span class="string">&quot;application/json;charset=UTF-8&quot;</span> &amp;&amp;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>修改完成后复制回容器</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">docker cp /data/head/_site/vendor.js <span class="number">729683e0</span>e0f5:/usr/src/app/_site</span><br></pre></td></tr></table></figure>

<p>重启Elasticsearch-head</p>
<h2 id="安装IK分词器"><a href="#安装IK分词器" class="headerlink" title="安装IK分词器"></a>安装IK分词器</h2><p>下载ik6.7.0版本</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&gt; wget https:<span class="comment">//github.com/medcl/elasticsearch-analysis-ik/releases/download/v6.7.0/elasticsearch-analysis-ik-6.7.0.zip</span></span><br></pre></td></tr></table></figure>


<h2 id="elasticsearch-yml配置"><a href="#elasticsearch-yml配置" class="headerlink" title="elasticsearch.yml配置"></a>elasticsearch.yml配置</h2><h3 id="7-x的elasticsearch-yml"><a href="#7-x的elasticsearch-yml" class="headerlink" title="7.x的elasticsearch.yml"></a>7.x的elasticsearch.yml</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#集群名称</span></span><br><span class="line">cluster.name: zyj-es</span><br><span class="line"><span class="comment">#本节点名称</span></span><br><span class="line">node.name: node-<span class="number">1</span></span><br><span class="line"><span class="comment">#是否master节点</span></span><br><span class="line">node.master: <span class="literal">true</span></span><br><span class="line"><span class="comment">#是否存储数据</span></span><br><span class="line">node.data: <span class="literal">true</span></span><br><span class="line"><span class="comment">#跨域设置</span></span><br><span class="line">http.cors.enabled: <span class="literal">true</span></span><br><span class="line">http.cors.allow-origin: <span class="string">&quot;*&quot;</span></span><br><span class="line"><span class="comment">#http端口</span></span><br><span class="line">http.port: <span class="number">9200</span></span><br><span class="line"><span class="comment">#java端口</span></span><br><span class="line">transport.tcp.port: <span class="number">9300</span></span><br><span class="line"><span class="comment">#可以访问es集群的ip  0.0.0.0表示不绑定</span></span><br><span class="line">network.bind_host: <span class="number">0.0</span>.<span class="number">0.0</span></span><br><span class="line"><span class="comment">#es集群相互通信的ip  0.0.0.0默认本地网络搜索</span></span><br><span class="line">network.publish_host: <span class="number">0.0</span>.<span class="number">0.0</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#7.x配置</span></span><br><span class="line">discovery.seed_hosts: [<span class="string">&quot;127.0.0.1:9200&quot;</span>]</span><br><span class="line">cluster.initial_master_nodes: [<span class="string">&quot;node-1&quot;</span>]</span><br></pre></td></tr></table></figure>

<h3 id="6-x的elasticsearch-yml"><a href="#6-x的elasticsearch-yml" class="headerlink" title="6.x的elasticsearch.yml"></a>6.x的elasticsearch.yml</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#集群名称</span></span><br><span class="line">cluster.name: zyj-es</span><br><span class="line"><span class="comment">#本节点名称</span></span><br><span class="line">node.name: node-<span class="number">1</span></span><br><span class="line"><span class="comment">#是否master节点</span></span><br><span class="line">node.master: <span class="literal">true</span></span><br><span class="line"><span class="comment">#是否存储数据</span></span><br><span class="line">node.data: <span class="literal">true</span></span><br><span class="line"><span class="comment">#跨域设置</span></span><br><span class="line">http.cors.enabled: <span class="literal">true</span></span><br><span class="line">http.cors.allow-origin: <span class="string">&quot;*&quot;</span></span><br><span class="line"><span class="comment">#http端口</span></span><br><span class="line">http.port: <span class="number">9200</span></span><br><span class="line"><span class="comment">#java端口</span></span><br><span class="line">transport.tcp.port: <span class="number">9300</span></span><br><span class="line"><span class="comment">#可以访问es集群的ip  0.0.0.0表示不绑定</span></span><br><span class="line">network.bind_host: <span class="number">0.0</span>.<span class="number">0.0</span></span><br><span class="line"><span class="comment">#es集群相互通信的ip  0.0.0.0默认本地网络搜索</span></span><br><span class="line">network.publish_host: <span class="number">0.0</span>.<span class="number">0.0</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#6.x配置</span></span><br><span class="line">discovery.zen.minimum_master_nodes: <span class="number">1</span></span><br><span class="line">xpack.license.self_generated.type: basic</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>docker</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>Docker的基本操作</title>
    <url>/2018/01/31/Docker%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/</url>
    <content><![CDATA[<blockquote>
<p>今天是公司2018年的年会，地点定在渝中区大礼堂，下午1点30开始，上午几乎所有的小伙伴都按捺不住自己内心澎湃的心一心准备参加公司的年会，不知道是不是做程序员做久了，还是说早已习惯了公司的”套路”，不觉得年会有什么新鲜感和吸引我的地方，当然说句实话，年会对我吸引最大的肯定是抽奖环节，据说今年的终极大奖是现金10万；趁着这么还有点时间，更新下自己的博客吧<br>使用Docker还是蛮久的了，但对于我来时，基本都是针对于开发搭建环境使用，所以也就只会一些基本的使用，要想看深入讲解的，请绕道咯。</p>
</blockquote>
<h3 id="Docker简介"><a href="#Docker简介" class="headerlink" title="Docker简介"></a>Docker简介</h3><h4 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h4><p>Docker是一个开源平台，用于自动化部署应用，以通过快捷的途径在称之为容器的轻量级软件层下打包、发布和运行这些应用。它使得应用平台独立，因为它扮演了Linux上一个额外的操作系统级虚拟化的自动化抽象层。它通过其组件cgroups和命名空间利用Linux内核的资源分离特性，达到避免虚拟机开销的目的。它使得用于部署和扩展web应用、数据库和后端服务的大规模构建组件无需依赖于特定的堆栈或供应者。</p>
<span id="more"></span>
<h4 id="容器"><a href="#容器" class="headerlink" title="容器"></a>容器</h4><p>所谓的容器，就是那些创建自Docker镜像的软件层，它包含了独立的Linux文件系统和开箱即用的应用程序。如果我们有一个在机器中运行着的Docker容器，并且想要备份这些容器以便今后使用，或者想要迁移这些容器，那么，本教程将帮助你掌握在Linux操作系统中备份、恢复和迁移Docker容器的方法</p>
<h3 id="使用及介绍"><a href="#使用及介绍" class="headerlink" title="使用及介绍"></a>使用及介绍</h3><h4 id="操作命令"><a href="#操作命令" class="headerlink" title="操作命令"></a>操作命令</h4><p>显示docker系统信息</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker info</span><br></pre></td></tr></table></figure>

<p>镜像搜索</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker search  php</span><br></pre></td></tr></table></figure>
<p>获取镜像</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker pull richarvey/nginx-php-fpm (需要哪个就pull哪个)</span><br></pre></td></tr></table></figure>

<p>导入本地镜像</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker load &gt; ~/Users/xiexiang/Downloads/[镜像名]</span><br></pre></td></tr></table></figure>
<p>查看镜像</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure>
<p>显示镜像的历史</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker history</span><br></pre></td></tr></table></figure>
<p>删除镜像</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker rmi -f richarvey/nginx-php-fpm   (带f据说不会残留垃圾)</span><br></pre></td></tr></table></figure>
<p>创建容器</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker run -d -p 80:80 --name php-zzgg-un -v /Users/xiexiang/myproject/bajieke:/var/www/html registry.alauda.cn/neucloud/nginx-php-fpm:latest</span><br></pre></td></tr></table></figure>
<p>查看容器(全部)</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker ps -a</span><br></pre></td></tr></table></figure>
<p>查看已运行容器</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker ps</span><br></pre></td></tr></table></figure>
<p>删除容器</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker rm -f [容器id]</span><br></pre></td></tr></table></figure>
<p>进入到容器</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker exec -it [容器名] bash</span><br></pre></td></tr></table></figure>
<p>启动容器</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker start [容器名]</span><br></pre></td></tr></table></figure>
<p>停止容器</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker stop [容器名]</span><br></pre></td></tr></table></figure>
<p>重启容器</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker restart [容器名]</span><br></pre></td></tr></table></figure>

<h4 id="容器的导出导入功能"><a href="#容器的导出导入功能" class="headerlink" title="容器的导出导入功能"></a>容器的导出导入功能</h4><p>1、停止容器(也可以不停止，只要下一步commit成功即可)</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker stop [容器名]</span><br></pre></td></tr></table></figure>
<p>2、将容器commit为镜像</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker commit ec1f968cc0d0 php-zzgg-un   (容器id  自定义镜像名)</span><br></pre></td></tr></table></figure>
<p>3、查看生成的镜像</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure>
<p>4、save镜像为tar文件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker save -o /Users/xiexiang/Downloads/php-zzgg-un.tar  php-zzgg-un</span><br></pre></td></tr></table></figure>
<p>5、将tar文件scp到 目标docker主机</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">scp php-zzgg-un.tar root@10.45.7.197:/docker</span><br></pre></td></tr></table></figure>
<p>6、导入本地镜像</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker load /Users/xiexiang/Downloads/php-zzgg-un.tar</span><br></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>docker</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>Docker部署ShowDoc</title>
    <url>/2024/06/17/Docker%E9%83%A8%E7%BD%B2ShowDoc/</url>
    <content><![CDATA[<p>想使用ShowDoc作为内部一个知识共享仓库，以及文件在线协作的功能。于是内部使用Docker部署，简单方便，主要映射数据存储的文件夹。</p>
<p>下面介绍ShowDoc在服务器上通过Docker的方式部署步骤：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">先搜索对应的可以使用的镜像版本和仓库</span></span><br><span class="line">docker search showdoc</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">确认打星最多的那个使用 star7th/showdoc</span></span><br><span class="line">docker pull star7th/showdoc</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建文件夹，方便存储在服务器中，避免重要文件重启容器后丢失</span></span><br><span class="line">mkdir -p /showdoc_data/html</span><br><span class="line">chmod  -R 777 /showdoc_data</span><br><span class="line">docker run -d --name showdoc --user=root --privileged=true -p 4999:80 -v /showdoc_data/html:/var/www/html/ star7th/showdoc</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">异常网络状态下，可以直接在docker run的时候指定镜像仓库</span></span><br><span class="line">docker pull registry.cn-shenzhen.aliyuncs.com/star7th/showdoc</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装后记得执行docker tag命令以进行重命名</span></span><br><span class="line">docker tag registry.cn-shenzhen.aliyuncs.com/star7th/showdoc:latest star7th/showdoc:latest</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">后续继续进行创建文件夹赋权和指定映射的文件夹</span></span><br></pre></td></tr></table></figure>

<p>最后访问服务器的IP地址，端口4999即可。</p>
<p>提醒：</p>
<ol>
<li>服务器上需要安装Docker，如果没有安装，请查看详细文档 <a href="https://zhuanlan.zhihu.com/p/699515988">https://zhuanlan.zhihu.com/p/699515988</a></li>
<li>如果是阿里云服务器，需要进行安全组的端口映射，将4999端口开放。</li>
</ol>
]]></content>
      <categories>
        <category>docker</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>ElasticSearch基本操作</title>
    <url>/2022/06/14/ElasticSearch%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/</url>
    <content><![CDATA[<h2 id="安装篇"><a href="#安装篇" class="headerlink" title="安装篇"></a>安装篇</h2><h3 id="下载与配置"><a href="#下载与配置" class="headerlink" title="下载与配置"></a>下载与配置</h3><p>官网下载地址：<a href="https://www.elastic.co/cn/downloads/">https://www.elastic.co/cn/downloads/</a></p>
<p>找到自己系统对应的版本，本文以Linux系统为例，只阐述单机版安装</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 添加新用户</span></span><br><span class="line">useradd els </span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个soft目录，存放下载的软件</span></span><br><span class="line">mkdir /soft </span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入，然后通过xftp工具，将刚刚下载的文件拖动到该目录下</span></span><br><span class="line">cd /soft</span><br><span class="line">wget https:<span class="comment">//artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.9.1-linux-x86_64.tar.gz </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 解压缩</span></span><br><span class="line">tar -zxvf elasticsearch-<span class="number">7.9</span>.<span class="number">1</span>-linux-x86_64.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment">#重命名</span></span><br><span class="line">mv elasticsearch-<span class="number">7.9</span>.<span class="number">1</span>/ elsearch</span><br></pre></td></tr></table></figure>
<span id="more"></span>

<p>因为刚刚我们是使用root用户操作的，所以我们还需要更改一下&#x2F;soft文件夹的所属，改为els用户</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">chown -R els:els /soft/</span><br></pre></td></tr></table></figure>

<p>然后在切换成elsearch用户进行操作</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 切换用户</span></span><br><span class="line">su - els</span><br></pre></td></tr></table></figure>

<p>然后我们就可以对我们的配置文件进行修改了</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 进入到 elsearch下的config目录</span></span><br><span class="line">cd /soft/elsearch/config</span><br></pre></td></tr></table></figure>

<p>然后找到下面的配置</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#打开配置文件</span></span><br><span class="line">vim elasticsearch.yml </span><br><span class="line"></span><br><span class="line"><span class="comment">#设置ip地址，任意网络均可访问</span></span><br><span class="line">network.host: <span class="number">0.0</span>.<span class="number">0.0</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改jvm启动参数</span></span><br><span class="line">vim conf/jvm.options</span><br><span class="line"></span><br><span class="line"><span class="comment">#根据自己机器情况修改</span></span><br><span class="line">-Xms128m </span><br><span class="line">-Xmx128m</span><br></pre></td></tr></table></figure>

<p>然后在修改第二处的配置，这个配置要求我们到宿主机器上来进行配置</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 到宿主机上打开文件</span></span><br><span class="line">vim /etc/sysctl.conf</span><br><span class="line"><span class="comment"># 增加这样一条配置，一个进程在VMAs(虚拟内存区域)创建内存映射最大数量</span></span><br><span class="line">vm.max_map_count=<span class="number">655360</span></span><br><span class="line"><span class="comment"># 让配置生效</span></span><br><span class="line">sysctl -p</span><br></pre></td></tr></table></figure>

<h3 id="启动ElaticSearch"><a href="#启动ElaticSearch" class="headerlink" title="启动ElaticSearch"></a>启动ElaticSearch</h3><p>首先我们需要切换到 elsearch用户</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">su - els</span><br></pre></td></tr></table></figure>

<p>然后在到bin目录下，执行下面</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 进入bin目录</span></span><br><span class="line">cd /soft/elsearch/bin</span><br><span class="line"><span class="comment"># 后台启动</span></span><br><span class="line">./elasticsearch -d</span><br></pre></td></tr></table></figure>

<p>启动成功后，访问下面的URL</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">http:<span class="comment">//ip:9200/           注意：服务器上的9200端口必须得打开</span></span><br></pre></td></tr></table></figure>

<p>如果出现以下信息，表示已经安装成功</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;node-1&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cluster_name&quot;</span>: <span class="string">&quot;elasticsearch&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cluster_uuid&quot;</span>: <span class="string">&quot;HW4BNS6BTXCFjARA26PIvg&quot;</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;number&quot;</span>: <span class="string">&quot;7.9.1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_flavor&quot;</span>: <span class="string">&quot;default&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_type&quot;</span>: <span class="string">&quot;tar&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_hash&quot;</span>: <span class="string">&quot;083627f112ba94dffc1232e8b42b73492789ef91&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_date&quot;</span>: <span class="string">&quot;2020-09-01T21:22:21.964974Z&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_snapshot&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;lucene_version&quot;</span>: <span class="string">&quot;8.6.2&quot;</span>,</span><br><span class="line">    <span class="string">&quot;minimum_wire_compatibility_version&quot;</span>: <span class="string">&quot;6.8.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;minimum_index_compatibility_version&quot;</span>: <span class="string">&quot;6.0.0-beta1&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;tagline&quot;</span>: <span class="string">&quot;You Know, for Search&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果出现错误可以查看ElasticSearch日志查看对应错误，或者访问<a href="https://u19900101.github.io/2021-06-28-ElasticSearch/#%E9%94%99%E8%AF%AF%E5%88%86%E6%9E%90">https://u19900101.github.io/2021-06-28-ElasticSearch/#%E9%94%99%E8%AF%AF%E5%88%86%E6%9E%90</a> 查看对应错误的处理方法。</p>
<h3 id="可视化界面"><a href="#可视化界面" class="headerlink" title="可视化界面"></a>可视化界面</h3><p>打开chrome的应用商店，在里面搜索ElasticSearch head 安装插件后，配置访问地址 ip:9200就可以看到数据</p>
<h2 id="操作篇"><a href="#操作篇" class="headerlink" title="操作篇"></a>操作篇</h2><h3 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h3><h4 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h4><ul>
<li>索引（index）是ElasticSearch对逻辑数据的逻辑存储，所以它可以分为更小的部分。</li>
<li>可以把索引看成关系型数据库的表，索引的结构是为快速有效的全文索引准备的，特别是它不存储原始值。</li>
<li>ElasticSearch可以把索引存放在一台机器或者分散在多台服务器上，每个索引有一或多个分片（shard），每个分片可以有多个副本（replica）。</li>
</ul>
<h4 id="文档"><a href="#文档" class="headerlink" title="文档"></a>文档</h4><ul>
<li>存储在Elasticsearch中的主要实体叫文档（document）。用关系型数据库来类比的话，一个文档相当于数据库表中的一行记录。</li>
<li>ElasticSearch和MongoDB中的文档类似，都可以有不同的结构，但ElasticSearch的文档中，相同字段必须有相同类型。</li>
<li>文档由多个字段组成，每个字段可能多次出现在一个文档里，这样的字段叫多值字段（multivalued）。每个字段的类型，可以是文本、数值、日期等。字段类型也可以是复杂类型，一个字段包含其他子文档或者数组。</li>
</ul>
<h4 id="映射"><a href="#映射" class="headerlink" title="映射"></a>映射</h4><ul>
<li>所有文档写进索引之前都会先进行分析，如何将输入的文本分割为词条、哪些词条又会被过滤，这种行为叫做映射（mapping）。一般由用户自己定义规则。</li>
</ul>
<h4 id="文档类型"><a href="#文档类型" class="headerlink" title="文档类型"></a>文档类型</h4><ul>
<li>在ElasticSearch中，一个索引对象可以存储很多不同用途的对象。例如，一个博客应用程序可以保存文章和评论。</li>
<li>每个文档可以有不同的结构。</li>
<li>不同的文档类型不能为相同的属性设置不同的类型。例如，在同一索引中的所有文档类型中，一个叫title的字段必须具有相同的类型。</li>
</ul>
<h3 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h3><h4 id="创建空索引"><a href="#创建空索引" class="headerlink" title="创建空索引"></a>创建空索引</h4><p>这里只是空索引，后续加了分词器，需要指明分词器</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">PUT /haoke</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;settings&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;index&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;number_of_shards&quot;</span>: <span class="string">&quot;2&quot;</span>, <span class="comment">#分片数</span></span><br><span class="line">        <span class="string">&quot;number_of_replicas&quot;</span>: <span class="string">&quot;0&quot;</span> <span class="comment">#副本数</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="删除索引"><a href="#删除索引" class="headerlink" title="删除索引"></a>删除索引</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#删除索引</span></span><br><span class="line">DELETE /haoke</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;acknowledged&quot;</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="插入数据"><a href="#插入数据" class="headerlink" title="插入数据"></a>插入数据</h4><p>URL规则： POST &#x2F;{索引}&#x2F;{类型}&#x2F;{id}</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">POST /haoke/user/<span class="number">1001</span></span><br><span class="line"><span class="comment">#数据</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;id&quot;</span>:<span class="number">1001</span>,</span><br><span class="line"><span class="string">&quot;name&quot;</span>:<span class="string">&quot;张三&quot;</span>,</span><br><span class="line"><span class="string">&quot;age&quot;</span>:<span class="number">20</span>,</span><br><span class="line"><span class="string">&quot;sex</span></span><br></pre></td></tr></table></figure>

<h4 id="更新数据"><a href="#更新数据" class="headerlink" title="更新数据"></a>更新数据</h4><p><code>全局更新</code><br>在Elasticsearch中，文档数据是不为修改的，但是可以通过覆盖的方式进行更新。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">PUT /haoke/user/<span class="number">1001</span>          /索引/类型/id  PUT方法</span><br><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;id&quot;</span>:<span class="number">1001</span>,</span><br><span class="line"><span class="string">&quot;name&quot;</span>:<span class="string">&quot;张三&quot;</span>,</span><br><span class="line"><span class="string">&quot;age&quot;</span>:<span class="number">21</span>,</span><br><span class="line"><span class="string">&quot;sex&quot;</span>:<span class="string">&quot;女&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>更新后，对应的数据id不会变化，发生变化的只是字段和version</p>
<p><code>局部更新</code><br>可以看到数据已经被覆盖了。问题来了，可以局部更新吗？ – 可以的。前面不是说，文档数据不能更新吗？ 其实是这样的：在内部，依然会查询到这个文档数据，然后进行覆盖操作，步骤如下：</p>
<ul>
<li>1、从旧文档中检索JSON</li>
<li>2、修改它</li>
<li>3、删除旧文档</li>
<li>4、索引新文档</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#注意：这里多了_update标识</span></span><br><span class="line"></span><br><span class="line">POST /haoke/user/<span class="number">1001</span>/_update       ** 这里多个_update 标识</span><br><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;doc&quot;</span>:&#123;</span><br><span class="line"><span class="string">&quot;age&quot;</span>:<span class="number">23</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="删除文档"><a href="#删除文档" class="headerlink" title="删除文档"></a>删除文档</h4><p>在Elasticsearch中，删除文档数据，只需要发起DELETE请求即可，不用额外的参数</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">DELETE /haoke/user/<span class="number">1001</span></span><br></pre></td></tr></table></figure>

<p>需要注意的是，result表示已经删除，version也增加了。<br>如果删除一条不存在的数据，会响应404</p>
<h4 id="搜索数据"><a href="#搜索数据" class="headerlink" title="搜索数据"></a>搜索数据</h4><p><code>根据id搜索数据</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">GET /haoke/user/BbPe_WcB9cFOnF3uebvr</span><br><span class="line"><span class="comment">#返回的数据如下</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;_index&quot;</span>: <span class="string">&quot;haoke&quot;</span>,</span><br><span class="line">    <span class="string">&quot;_type&quot;</span>: <span class="string">&quot;user&quot;</span>,</span><br><span class="line">    <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;BbPe_WcB9cFOnF3uebvr&quot;</span>,</span><br><span class="line">    <span class="string">&quot;_version&quot;</span>: <span class="number">8</span>,</span><br><span class="line">    <span class="string">&quot;found&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;_source&quot;</span>: &#123; <span class="comment">#原始数据在这里</span></span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">1002</span>,</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;李四&quot;</span>,</span><br><span class="line">        <span class="string">&quot;age&quot;</span>: <span class="number">40</span>,</span><br><span class="line">        <span class="string">&quot;sex&quot;</span>: <span class="string">&quot;男&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>搜索全部数据</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">GET <span class="number">1</span> /haoke/user/_search          * 后面_search是固定标识</span><br></pre></td></tr></table></figure>
<p>注意，使用查询全部数据的时候，默认只会返回10条</p>
<p>返回结果：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;took&quot;</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">&quot;timed_out&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;_shards&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;total&quot;</span>: <span class="number">5</span>,   <span class="comment">// 分片总数</span></span><br><span class="line">        <span class="string">&quot;successful&quot;</span>: <span class="number">5</span>,</span><br><span class="line">        <span class="string">&quot;skipped&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;failed&quot;</span>: <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;hits&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;total&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;value&quot;</span>: <span class="number">3</span>,    <span class="comment">// 返回记录总条数</span></span><br><span class="line">            <span class="string">&quot;relation&quot;</span>: <span class="string">&quot;eq&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;max_score&quot;</span>: <span class="number">1.0</span>,</span><br><span class="line">        <span class="string">&quot;hits&quot;</span>: [          <span class="comment">// 结果集</span></span><br><span class="line">            &#123; </span><br><span class="line">                <span class="string">&quot;_index&quot;</span>: <span class="string">&quot;love_v5&quot;</span>,</span><br><span class="line">                <span class="string">&quot;_type&quot;</span>: <span class="string">&quot;_doc&quot;</span>,</span><br><span class="line">                <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;3&quot;</span>,</span><br><span class="line">                <span class="string">&quot;_score&quot;</span>: <span class="number">1.0</span>,</span><br><span class="line">                <span class="string">&quot;_source&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;id&quot;</span>: <span class="string">&quot;3&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;sex&quot;</span>: <span class="number">1</span>,</span><br><span class="line">                    <span class="string">&quot;gender&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;content&quot;</span>: <span class="string">&quot;随时练习说话，思路要清晰&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;heat&quot;</span>: <span class="string">&quot;1&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;_index&quot;</span>: <span class="string">&quot;love_v5&quot;</span>,</span><br><span class="line">                <span class="string">&quot;_type&quot;</span>: <span class="string">&quot;_doc&quot;</span>,</span><br><span class="line">                <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;2&quot;</span>,</span><br><span class="line">                <span class="string">&quot;_score&quot;</span>: <span class="number">1.0</span>,</span><br><span class="line">                <span class="string">&quot;_source&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;id&quot;</span>: <span class="string">&quot;2&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;sex&quot;</span>: <span class="number">1</span>,</span><br><span class="line">                    <span class="string">&quot;gender&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;content&quot;</span>: <span class="string">&quot;任何的时候脑子都要转起来&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;heat&quot;</span>: <span class="string">&quot;1&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;_index&quot;</span>: <span class="string">&quot;love_v5&quot;</span>,</span><br><span class="line">                <span class="string">&quot;_type&quot;</span>: <span class="string">&quot;_doc&quot;</span>,</span><br><span class="line">                <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">                <span class="string">&quot;_score&quot;</span>: <span class="number">1.0</span>,</span><br><span class="line">                <span class="string">&quot;_source&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;id&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;sex&quot;</span>: <span class="number">1</span>,</span><br><span class="line">                    <span class="string">&quot;gender&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;content&quot;</span>: <span class="string">&quot;命运只是我们事后的自我校准&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;heat&quot;</span>: <span class="string">&quot;1&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>关键字搜索数据</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#查询年龄等于20的用户</span></span><br><span class="line">GET /haoke/user/_search?q=age:<span class="number">20</span></span><br></pre></td></tr></table></figure>

<h4 id="DSL搜索"><a href="#DSL搜索" class="headerlink" title="DSL搜索"></a>DSL搜索</h4><p>Elasticsearch提供丰富且灵活的查询语言叫做DSL查询(Query DSL),它允许你构建更加复杂、强大的查询。 DSL(Domain Specific Language特定领域语言)以JSON请求体的形式出现。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">POST /haoke/user/_search </span><br><span class="line"><span class="comment"># 请求体</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;query&quot;</span> : &#123;</span><br><span class="line">		<span class="string">&quot;match&quot;</span> : &#123;             <span class="comment">#match 只是查询的一种</span></span><br><span class="line">			<span class="string">&quot;age&quot;</span>: <span class="number">20</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>实现：查询年龄大于30岁的男性用户。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">POST /haoke/user/_search</span><br><span class="line"><span class="comment"># 请求数据</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;query&quot;</span> : &#123;</span><br><span class="line">		<span class="string">&quot;bool&quot;</span> : &#123;</span><br><span class="line">			<span class="string">&quot;filter&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;range&quot;</span> : &#123;</span><br><span class="line">					<span class="string">&quot;age&quot;</span> : &#123;</span><br><span class="line">						<span class="string">&quot;gt&quot;</span> : <span class="number">30</span></span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;must&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;match&quot;</span> : &#123;</span><br><span class="line">					<span class="string">&quot;sex&quot;</span>: <span class="string">&quot;男&quot;</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="全文搜索"><a href="#全文搜索" class="headerlink" title="全文搜索"></a>全文搜索</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">POST /haoke/user/_search</span><br><span class="line"><span class="comment">#请求数据</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;match&quot;</span>: &#123;</span><br><span class="line">        	<span class="string">&quot;name&quot;</span>: <span class="string">&quot;张三 李四&quot;</span>   <span class="comment">#搜索名字为张三 李四的结果</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>高亮显示，只需要在添加一个 highlight即可</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">POST /haoke/user/_search</span><br><span class="line"><span class="comment"># 请求数据</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">		<span class="string">&quot;match&quot;</span> : &#123;</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;张三 李四&quot;</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="string">&quot;highlight&quot;</span>: &#123;</span><br><span class="line">		<span class="string">&quot;fields&quot;</span> : &#123;</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : &#123;&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="聚合"><a href="#聚合" class="headerlink" title="聚合"></a>聚合</h4><p>在Elasticsearch中，支持聚合操作，类似SQL中的group by操作。<br>将年龄进行聚合</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">POST /haoke/user/_search</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;aggs&quot;</span> : &#123;</span><br><span class="line">		<span class="string">&quot;all_interests&quot;</span> : &#123;</span><br><span class="line">			<span class="string">&quot;terms&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;field&quot;</span> : <span class="string">&quot;age&quot;</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ElasticSearch核心详解"><a href="#ElasticSearch核心详解" class="headerlink" title="ElasticSearch核心详解"></a>ElasticSearch核心详解</h2><p>在Elasticsearch中，文档以JSON格式进行存储，可以是复杂的结构，如：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;_index&quot;</span>: <span class="string">&quot;haoke&quot;</span>,</span><br><span class="line">    <span class="string">&quot;_type&quot;</span>: <span class="string">&quot;user&quot;</span>,</span><br><span class="line">    <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;1005&quot;</span>,</span><br><span class="line">    <span class="string">&quot;_version&quot;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">&quot;_score&quot;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">&quot;_source&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">1005</span>,</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;孙七&quot;</span>,</span><br><span class="line">        <span class="string">&quot;age&quot;</span>: <span class="number">37</span>,</span><br><span class="line">        <span class="string">&quot;sex&quot;</span>: <span class="string">&quot;女&quot;</span>,</span><br><span class="line">        <span class="string">&quot;card&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;card_number&quot;</span>: <span class="string">&quot;123456789&quot;</span></span><br><span class="line">         &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中，card是一个复杂对象，嵌套的Card对象</p>
<h3 id="元数据"><a href="#元数据" class="headerlink" title="元数据"></a>元数据</h3><p>一个文档不只有数据。它还包含了元数据(metadata)——关于文档的信息。三个必须的元数据节点是：</p>
<ul>
<li>_index : 文档存储的地方</li>
<li>_type : 文档代表的对象的类<br>_id : 文档的唯一标识</li>
</ul>
]]></content>
      <categories>
        <category>elasticsearch</category>
      </categories>
      <tags>
        <tag>elasticsearch</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo开启百度推送</title>
    <url>/2020/07/17/Hexo%E5%BC%80%E5%90%AF%E7%99%BE%E5%BA%A6%E6%8E%A8%E9%80%81/</url>
    <content><![CDATA[<p>每次更新博客时，主动向百度提交链接，利于 SEO</p>
<h3 id="1、安装-hexo-baidu-url-submit"><a href="#1、安装-hexo-baidu-url-submit" class="headerlink" title="1、安装 hexo-baidu-url-submit"></a>1、安装 hexo-baidu-url-submit</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">npm install hexo-baidu-url-submit --save</span><br></pre></td></tr></table></figure>

<p>使用淘宝cnpm可以加快速度</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">cnpm install hexo-baidu-url-submit --save</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<h3 id="2、根目录下的-config添加配置"><a href="#2、根目录下的-config添加配置" class="headerlink" title="2、根目录下的_config添加配置"></a>2、根目录下的_config添加配置</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 设置百度主动推送</span></span><br><span class="line">baidu_url_submit:</span><br><span class="line">  count: <span class="number">200</span>  <span class="comment"># 比如200，代表提交最新的200个链接</span></span><br><span class="line">  host: ashin.wang <span class="comment"># 在百度站长平台中注册的域名</span></span><br><span class="line">  token: your_token <span class="comment"># 百度站长密钥</span></span><br><span class="line">  path: baidu_urls.txt <span class="comment"># 文本文档的地址， 新链接会保存在此文本文档里，这个默认</span></span><br></pre></td></tr></table></figure>

<h3 id="3、根目录下的-config添加-Deploy"><a href="#3、根目录下的-config添加-Deploy" class="headerlink" title="3、根目录下的_config添加 Deploy"></a>3、根目录下的_config添加 Deploy</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">deploy:</span><br><span class="line">- type: git</span><br><span class="line">  repo: </span><br><span class="line">    github: </span><br><span class="line">  branch: master</span><br><span class="line">  </span><br><span class="line">- type: baidu_url_submitter</span><br></pre></td></tr></table></figure>

<h3 id="4、成功如下"><a href="#4、成功如下" class="headerlink" title="4、成功如下"></a>4、成功如下</h3><p><img src="/../img/hexo-baidu-01.jpeg" alt="hexo"></p>
]]></content>
      <categories>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Java学习-part.01（数据类型、变量、常量、数组、方法、方法的重载）</title>
    <url>/2018/05/23/Java%E5%AD%A6%E4%B9%A0-part-01%EF%BC%88%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E3%80%81%E5%8F%98%E9%87%8F%E3%80%81%E5%B8%B8%E9%87%8F%E3%80%81%E6%95%B0%E7%BB%84%E3%80%81%E6%96%B9%E6%B3%95%E3%80%81%E6%96%B9%E6%B3%95%E7%9A%84%E9%87%8D%E8%BD%BD%EF%BC%89/</url>
    <content><![CDATA[<h4 id="java中的数据类型"><a href="#java中的数据类型" class="headerlink" title="java中的数据类型"></a>java中的数据类型</h4><p>java语言是一种强类型语言。通俗点说就是，在 Java 中存储的数据都是有类型的，而且必须在编译时就确定其类型。 Java 中有两类数据类型：<br><img src="/../img/java-01.jpg" alt="java"></p>
<span id="more"></span>

<p>在 Java 的领域里，基本数据类型变量存的是数据本身，而引用类型变量存的是保存数据的空间地址。说白了，基本数据类型变量里存储的是直接放在抽屉里的东西，而引用数据类型变量里存储的是这个抽屉的钥匙，钥匙和抽屉一一对应。<br>常用的基本数据类型有：<br><img src="/../img/java-02.jpg" alt="java"></p>
<p>注意：String是一种常见的引用数据类型，用来表示字符串。在程序开发中，很多操作都要使用字符串来完成，例如系统中的用户名、密码、电子邮箱等。float类型在赋值的时候后天添加字母f，float height &#x3D; 175.2f。</p>
<h4 id="java变量的定义"><a href="#java变量的定义" class="headerlink" title="java变量的定义"></a>java变量的定义</h4><ul>
<li>1、变量名由多单词组成时，第一个单词的首字母小写，其后单词的首字母大写，俗称骆驼式命名法（也称驼峰命名法），如 myAge</li>
<li>2、变量命名时，尽量简短且能清楚的表达变量的作用，做到见名知意。如：定义变量名 stuName 保存“学生姓名”信息</li>
<li>PS： Java 变量名的长度没有限制，但 Java 语言是区分大小写的，所以 price 和 Price 是两个完全不同的变量哦！<br>语法：变量类型 变量名 &#x3D; 值;<br>eg：String name &#x3D; “xiexiang”;</li>
</ul>
<h4 id="java常量的应用"><a href="#java常量的应用" class="headerlink" title="java常量的应用"></a>java常量的应用</h4><p>所谓常量，我们可以理解为是一种特殊的变量，它的值被设定后，在程序运行过程中不允许改变。</p>
<p>语法： final 常量类型 常量名 &#x3D; 值； &#x2F;&#x2F;常量一般为大写字符</p>
<p>关键词：final;</p>
<p>eg：final String LOVE &#x3D; “forever”;</p>
<h4 id="java中的数组"><a href="#java中的数组" class="headerlink" title="java中的数组"></a>java中的数组</h4><p>语法：数据类型[] 数组名； 或者 数据类型 数组名[];</p>
<p>数组的几种定义方式：</p>
<ul>
<li><p>double height[] &#x3D; {175.2,168.4,232.4};</p>
</li>
<li><p>int[] scores &#x3D; {12,33,45,132};</p>
</li>
<li><p>int[] scores &#x3D; new int[5]; &#x2F;&#x2F;定义一个数组的长度为5 还有种方式在是特定场合用的：</p>
<p>再赋值：</p>
<p>scores[0] &#x3D; 89;<br>scores[1] &#x3D; 79;<br>…</p>
</li>
</ul>
<h4 id="java中数组的遍历"><a href="#java中数组的遍历" class="headerlink" title="java中数组的遍历"></a>java中数组的遍历</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//一维数组</span></span><br><span class="line">     String[] arrs = &#123;<span class="string">&quot;rerew&quot;</span>,<span class="string">&quot;ww4eqw&quot;</span>,<span class="string">&quot;222&quot;</span>&#125;;</span><br><span class="line">     <span class="comment">//for的方式</span></span><br><span class="line">     <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;arrs.length;i++) &#123;</span><br><span class="line">         System.out.<span class="title function_ invoke__">println</span>(arrs[i]);</span><br><span class="line">     &#125;</span><br><span class="line">     </span><br><span class="line">     <span class="comment">//foreach方式</span></span><br><span class="line">     <span class="keyword">for</span>(String arr:arrs) &#123;</span><br><span class="line">         System.out.<span class="title function_ invoke__">println</span>(arr);</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//二维数组遍历</span></span><br><span class="line">String[][] names = &#123;&#123;<span class="string">&quot;xiexiang&quot;</span>,<span class="string">&quot;xiangqian&quot;</span>&#125;,&#123;<span class="string">&quot;make&quot;</span>,<span class="string">&quot;diea&quot;</span>,<span class="string">&quot;hello&quot;</span>,<span class="string">&quot;23423&quot;</span>&#125;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用for进行二重循环</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;names.length;i++) &#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;names[i].length;j++) &#123;</span><br><span class="line">		System.out.<span class="title function_ invoke__">println</span>(names[i][j]);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="java中的方法"><a href="#java中的方法" class="headerlink" title="java中的方法"></a>java中的方法</h4><p>语法： 访问修饰符 返回值类型 方法名（参数列表）{ 方法体 }</p>
<p>其中：</p>
<ul>
<li>1、访问修饰符：方法允许被访问的权限范围， 可以是 public、protected、private 甚至可以省略 ，其中 public 表示该方法可以被其他任何代码调用。</li>
<li>2、返回值类型：方法返回值的类型，如果方法不返回任何值，则返回值类型指定为 void ；如果方法具有返回值，则需要指定返回值的类型，并且在方法体中使用 return 语句返回值。</li>
<li>3、方法名：定义的方法的名字，必须使用合法的标识符。</li>
<li>4、参数列表：传递给方法的参数列表，参数可以有多个，多个参数间以逗号隔开，每个参数由参数类型和参数名组成，以空格隔开。</li>
</ul>
<p>根据方法是否带参、是否带返回值，可将方法分为四类：</p>
<ul>
<li>Ø 无参无返回值方法</li>
<li>Ø 无参带返回值方法</li>
<li>Ø 带参无返回值方法</li>
<li>Ø 带参带返回值方法</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//定义了一个方法名为 print 的方法，实现输出信息功能</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="keyword">print</span>() &#123;</span><br><span class="line">		System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;Hello World&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="keyword">void</span> <span class="title function_ invoke__">main</span>(String[] args)&#123;</span><br><span class="line">        <span class="comment">//在 main 方法中调用 print 方法</span></span><br><span class="line">        HelloWorld test=<span class="keyword">new</span> <span class="title class_">HelloWorld</span>();</span><br><span class="line">        test.<span class="keyword">print</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="java中方法的重载"><a href="#java中方法的重载" class="headerlink" title="java中方法的重载"></a>java中方法的重载</h4><p>定义：如果同一个类中包含了两个或两个以上方法名相同、方法参数的个数、顺序或类型不同的方法，则称为方法的重载，也可称该方法被重载了。<br><img src="/../img/java-03.jpg" alt="java"></p>
<p>当调用被重载的方法时， Java 会根据参数的个数和类型来判断应该调用哪个重载方法，参数完全匹配的方法将被执行。</p>
<p>&amp;判断方法重载的依据：</p>
<ul>
<li>1、 必须是在同一个类中</li>
<li>2、 方法名相同</li>
<li>3、 方法参数的个数、顺序或类型不同</li>
<li>4、 与方法的修饰符或返回值没有关系</li>
</ul>
<h4 id="章节练习题"><a href="#章节练习题" class="headerlink" title="章节练习题"></a>章节练习题</h4><p>需求：输入3个班级各4个学生的成绩，并在每个班级之后输出每个班级的成绩之和和平均成绩。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">package imooc;</span><br><span class="line">import java.util.Scanner;   <span class="comment">//调用java的输入包</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">stu</span> </span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="built_in">static</span> <span class="keyword">void</span> <span class="title function_ invoke__">main</span>(String[] args) &#123;</span><br><span class="line">		<span class="keyword">int</span> classNum = <span class="number">3</span>; <span class="comment">//班级数量</span></span><br><span class="line">		<span class="keyword">int</span> stuNum   = <span class="number">4</span>; <span class="comment">//每个班级学生数量</span></span><br><span class="line">		<span class="keyword">double</span> sum = <span class="number">0</span>;   <span class="comment">//每个班级学生成绩之和</span></span><br><span class="line">		<span class="keyword">double</span> avg = <span class="number">0</span>;   <span class="comment">//每个班级的平均成绩</span></span><br><span class="line">		Scanner input = <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);   <span class="comment">//创建scanner对象</span></span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=classNum;i++) &#123;</span><br><span class="line">			sum = <span class="number">0</span>;</span><br><span class="line">			System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;*****请输入第&quot;</span>+i+<span class="string">&quot;个班级的成绩情况*****&quot;</span>);</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=stuNum;j++) &#123;</span><br><span class="line">				System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;请输入第&quot;</span>+j+<span class="string">&quot;个学生的成绩：&quot;</span>);</span><br><span class="line">				<span class="keyword">double</span> score = input.<span class="title function_ invoke__">nextDouble</span>();  <span class="comment">// 获取输入成绩</span></span><br><span class="line">				sum+=score;</span><br><span class="line">			&#125;</span><br><span class="line">			avg = sum/stuNum;</span><br><span class="line">			System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;第个班的总成绩之和为：&quot;</span>+sum+<span class="string">&quot;;平均成绩为：&quot;</span>+avg);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>Java学习-part.02（面向对象、构造方法、static）</title>
    <url>/2018/05/23/Java%E5%AD%A6%E4%B9%A0-part-02%EF%BC%88%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E3%80%81%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95%E3%80%81static%EF%BC%89/</url>
    <content><![CDATA[<h4 id="java的面向对象"><a href="#java的面向对象" class="headerlink" title="java的面向对象"></a>java的面向对象</h4><p>万物皆为对象，客观存在的事物皆为对象。</p>
<p>类是模子，确定对象将会拥有的特征（属性）和行为（方法）</p>
<p><strong>类</strong>的特点：</p>
<p>类是对象的类型</p>
<p>具有相同属性和方法的一组对象的集合</p>
<span id="more"></span>

<p><strong>属性</strong>–对象具有的各种特征</p>
<p>每个对象的每个属性都拥有特定值</p>
<p>eg:比如一个手机具有屏幕大小、手机尺寸、颜色、价格等特征（属性）</p>
<p><strong>方法</strong>–对象执行的操作</p>
<p>eg：比如一个手机具有打电话、发短信、安装软件等功能（方法）</p>
<p>下面以一个汽车为类做的例子：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">package imooc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">thisCar</span> </span>&#123;</span><br><span class="line">	<span class="keyword">float</span>  length;</span><br><span class="line">	<span class="keyword">float</span>  wide;</span><br><span class="line">	String color;</span><br><span class="line">	<span class="keyword">double</span> money;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取车身长度</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">float</span> <span class="title function_ invoke__">getLeangth</span>() &#123;</span><br><span class="line">		<span class="keyword">return</span> this.length;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取宽度</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">float</span> <span class="title function_ invoke__">getWide</span>() &#123;</span><br><span class="line">		<span class="keyword">return</span> this.wide;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取车身颜色</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_ invoke__">getColor</span>() &#123;</span><br><span class="line">		<span class="keyword">return</span> this.color;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="构造方法"><a href="#构造方法" class="headerlink" title="构造方法"></a>构造方法</h4><ul>
<li>使用new+构造方法，创建一个新的对象</li>
<li>构造方法是定义在java类中的一个用来初始化对象的方法，构造方法与类同名且没有返回值。</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> 构造方法名[与类名一致] （）&#123;      <span class="comment">//没有返回值的与当前类名一样，参数可有可无</span></span><br><span class="line">    <span class="comment">//初始化代码，在调用这个类时自动调用</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="java中的static使用"><a href="#java中的static使用" class="headerlink" title="java中的static使用"></a>java中的static使用</h4><p>大家都知道，我们可以基于一个类创建多个该类的对象，每个对象都拥有自己的成员，互相独立。然而在某些时候，我们更希望该类所有的对象共享同一个成员。此时就是 static 大显身手的时候了！</p>
<p>Java 中被 <strong>static</strong> 修饰的成员称为静态成员或类成员。它属于整个类所有，而不是某个对象所有，即被类的所有对象所共享。静态成员可以使用类名直接访问，也可以使用对象名进行访问。当然，鉴于他作用的特殊性更推荐用类名访问~~</p>
<p>使用 static 可以修饰变量、方法和代码块。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">package imooc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">staticTest</span> </span>&#123;</span><br><span class="line">	<span class="built_in">static</span> String name = <span class="string">&quot;xiexaing&quot;</span>;</span><br><span class="line">	<span class="built_in">static</span> <span class="keyword">int</span> scores[] = &#123;<span class="number">78</span>,<span class="number">56</span>,<span class="number">88</span>,<span class="number">66</span>,<span class="number">98</span>&#125;;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="built_in">static</span> <span class="keyword">void</span> <span class="title function_ invoke__">main</span>(String[] args) &#123;</span><br><span class="line">		<span class="keyword">int</span> max = staticTest.<span class="title function_ invoke__">getTheMaxScore</span>(scores);   <span class="comment">//调用静态属性和静态方法</span></span><br><span class="line">		System.out.<span class="title function_ invoke__">println</span>(name + <span class="string">&quot;的班级中分数最高的是：&quot;</span> + max);   <span class="comment">//调用静态属性</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 获取分数的最大值</span></span><br><span class="line">	<span class="built_in">static</span> <span class="keyword">public</span> <span class="keyword">int</span> <span class="title function_ invoke__">getTheMaxScore</span>(<span class="keyword">int</span> scores[]) &#123;</span><br><span class="line">		<span class="keyword">int</span> max = scores[<span class="number">0</span>];</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;scores.length;i++) &#123;</span><br><span class="line">			<span class="keyword">if</span>(scores[i] &gt; max) max = scores[i];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> max;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：静态成语属于整个类，当系统第一次使用该类时，就会为其分配内存空间直到该类被卸载才会进行资源回收。</p>
<p><strong>需要注意：</strong></p>
<ul>
<li><p>1、 静态方法中可以直接调用同类中的静态成员，但不能直接调用非静态成员。如：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">package imooc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">staticTest2</span> </span>&#123;</span><br><span class="line">	String name = <span class="string">&quot;xiexiang&quot;</span>;</span><br><span class="line">	<span class="built_in">static</span> <span class="keyword">int</span> age = <span class="number">18</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="built_in">static</span> <span class="keyword">void</span> <span class="title function_ invoke__">proint</span>() &#123;</span><br><span class="line">		System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;您的名字：&quot;</span> + name);  <span class="comment">//报错x，静态方法中不能直接调用非静态成员，可以通过创建类的对象再开访问非静态成员</span></span><br><span class="line">		System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;您的年龄：&quot;</span> + age);   <span class="comment">//可以直接调用</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>2、 在普通成员方法中，则可以直接访问同类的非静态变量和静态变量，如下所示：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">package imooc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">staticTest2</span> </span>&#123;</span><br><span class="line">	String name = <span class="string">&quot;xiexiang&quot;</span>;</span><br><span class="line">	<span class="built_in">static</span> <span class="keyword">int</span> age = <span class="number">18</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_ invoke__">proint</span>() &#123;</span><br><span class="line">		System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;您的名字：&quot;</span> + name);  <span class="comment">//可以直接调用</span></span><br><span class="line">		System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;您的年龄：&quot;</span> + age);   <span class="comment">//可以直接调用</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>3、静态方法中不能直接调用非静态方法，需要通过对象来访问非静态方法。如：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">package imooc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">staticTest2</span> </span>&#123;</span><br><span class="line">	String name = <span class="string">&quot;xiexiang&quot;</span>;</span><br><span class="line">	<span class="built_in">static</span> <span class="keyword">int</span> age = <span class="number">18</span>;</span><br><span class="line">	<span class="comment">//非静态方法</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="keyword">print</span>() &#123;</span><br><span class="line">		System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;您的名字：&quot;</span> + name);  </span><br><span class="line">		System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;您的年龄：&quot;</span> + age);   </span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//静态方法</span></span><br><span class="line">	<span class="keyword">public</span> <span class="built_in">static</span> <span class="keyword">void</span> <span class="title function_ invoke__">show</span>() &#123;</span><br><span class="line">		System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;这是静态方法可以直接调用&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//调用方++</span></span><br><span class="line">	<span class="keyword">public</span> <span class="built_in">static</span> <span class="keyword">void</span> <span class="title function_ invoke__">myTest</span>() &#123;</span><br><span class="line">		staticTest2 <span class="function"><span class="keyword">function</span> = <span class="title">new</span> <span class="title">staticTest2</span>(<span class="params"></span>)</span>;</span><br><span class="line">		function.<span class="keyword">print</span>();   <span class="comment">//print方法需要实例化后再调用</span></span><br><span class="line">		</span><br><span class="line">		<span class="title function_ invoke__">show</span>();             <span class="comment">//show方法就可以直接调用</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="java中的static的使用之静态初始化块"><a href="#java中的static的使用之静态初始化块" class="headerlink" title="java中的static的使用之静态初始化块"></a>java中的static的使用之静态初始化块</h4><p>java中可以通过初始化块进行数据赋值。如：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">package imooc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">staticPiece</span> </span>&#123;</span><br><span class="line">	String name;</span><br><span class="line">	&#123;</span><br><span class="line">		name = <span class="string">&quot;xiexiang&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在类的声明中，可以包含多个初始化块，当创建类的实例时，就会依次执行这些代码块。如果使用 static 修饰初始化块，就称为静态初始化块。</p>
<p>&amp;需要特别注意：静态初始化块只在类加载时执行，且只会执行一次，同时静态初始化块只能给静态变量赋值，不能初始化普通的成员变量。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">package imooc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">staticPiece</span> </span>&#123;</span><br><span class="line">	String name;</span><br><span class="line">	<span class="built_in">static</span> <span class="keyword">int</span> age;</span><br><span class="line">	&#123;</span><br><span class="line">		name = <span class="string">&quot;xiexiang&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">static</span> &#123;</span><br><span class="line">		age = <span class="number">18</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="built_in">static</span> <span class="keyword">void</span> <span class="title function_ invoke__">main</span>(String[] args) &#123;</span><br><span class="line">		staticPiece <span class="function"><span class="keyword">function</span> = <span class="title">new</span> <span class="title">staticPiece</span>(<span class="params"></span>)</span>;</span><br><span class="line">		System.out.<span class="title function_ invoke__">println</span>(function.name+<span class="string">&quot;的年龄为：&quot;</span>+ age +<span class="string">&quot;岁&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>Java学习-part.03（封装、访问修饰符、this、内部类、静态内部类、方法内部类）</title>
    <url>/2018/05/24/Java%E5%AD%A6%E4%B9%A0-part-03%EF%BC%88%E5%B0%81%E8%A3%85%E3%80%81%E8%AE%BF%E9%97%AE%E4%BF%AE%E9%A5%B0%E7%AC%A6%E3%80%81this%E3%80%81%E5%86%85%E9%83%A8%E7%B1%BB%E3%80%81%E9%9D%99%E6%80%81%E5%86%85%E9%83%A8%E7%B1%BB%E3%80%81%E6%96%B9%E6%B3%95%E5%86%85%E9%83%A8%E7%B1%BB%EF%BC%89/</url>
    <content><![CDATA[<h3 id="面向对象三大特性"><a href="#面向对象三大特性" class="headerlink" title="面向对象三大特性"></a>面向对象三大特性</h3><h4 id="封装、继承、多态"><a href="#封装、继承、多态" class="headerlink" title="封装、继承、多态"></a>封装、继承、多态</h4><h4 id="封装"><a href="#封装" class="headerlink" title="封装"></a>封装</h4><p>1、概念：将类的某些信息隐藏在类的内部，不允许外部程序直接访问，而是通过该类提供的方法来实现对隐藏信息的操作和访问。</p>
<p>2、好处：</p>
<ul>
<li>只能通过规定的方法访问数据</li>
<li>隐藏类的实例细节，方便修改和实现</li>
</ul>
<p>3、实现步骤：</p>
<ul>
<li>修改属性的可见性-设为private</li>
<li>创建setter&#x2F;getter方法-用户属性的读写</li>
<li>在setter&#x2F;getter方法中加入属性控制语句-对属性值的合法性进行判断</li>
</ul>
<span id="more"></span>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">package imooc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">thisMacbook</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">float</span> screen;   <span class="comment">//防止直接修改属性</span></span><br><span class="line">	<span class="keyword">private</span> String color;   </span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> cpu;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_ invoke__">setScrenn</span>(<span class="keyword">float</span> newScreen) &#123;  <span class="comment">//通过方法来修改属性</span></span><br><span class="line">		screen = newScreen;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">float</span> <span class="title function_ invoke__">getScreen</span>()&#123;   <span class="comment">//通过方法得到属性</span></span><br><span class="line">		<span class="keyword">return</span> screen;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//调用封装方法</span></span><br><span class="line">    thisMacbook macbook = <span class="keyword">new</span> <span class="title function_ invoke__">thisMacbook</span>();</span><br><span class="line">    macbook.<span class="title function_ invoke__">setScrenn</span>(<span class="number">4.5</span>f);</span><br><span class="line">    <span class="keyword">float</span> screen = macbook.<span class="title function_ invoke__">getScreen</span>();</span><br><span class="line">    </span><br><span class="line">    System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;macbook的屏幕大小为：&quot;</span> + screen);</span><br></pre></td></tr></table></figure>

<h4 id="java中的包"><a href="#java中的包" class="headerlink" title="java中的包"></a>java中的包</h4><p>1、包的作用</p>
<p>管理java文件</p>
<p>解决同名文件冲突</p>
<p>2、定义包：package包名</p>
<p>注：必须放在java源程序的第一行</p>
<p>包名间可以使用”.”号隔开</p>
<p>eg：com.zhubajie.MyClass</p>
<p>3、包的使用</p>
<p>可以用过import关键字，在某个文件使用其他文件中的类。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">import com.zhubajie.muisc.MyClass</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在同一个包下面的所有类都是默认自动加载了的，标准的做法是使用import引入需要的类，当然也可以使用import引入其他包中的类。</p>
<p>java中的访问修饰符</p>
<table>
<thead>
<tr>
<th>访问修饰符</th>
<th>本类</th>
<th>同包</th>
<th>子类</th>
<th>其他</th>
</tr>
</thead>
<tbody><tr>
<td>private</td>
<td>*</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>默认</td>
<td>*</td>
<td>*</td>
<td></td>
<td></td>
</tr>
<tr>
<td>protected</td>
<td>*</td>
<td>*</td>
<td>*</td>
<td></td>
</tr>
<tr>
<td>public</td>
<td>*</td>
<td>*</td>
<td>*</td>
<td>*</td>
</tr>
</tbody></table>
<h4 id="java中的this关键字"><a href="#java中的this关键字" class="headerlink" title="java中的this关键字"></a>java中的this关键字</h4><p>1、this关键字代表当前对象</p>
<ul>
<li>this.属性 操作当前对象的属性</li>
<li>this.方法 调用当前对象的方法</li>
</ul>
<p>2、封装对象的属性的时候，经常会使用this关键字</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">package com.zhubajie;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThisCar</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> String color;</span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_ invoke__">getName</span>() &#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_ invoke__">setName</span>(String name) &#123;</span><br><span class="line">		this.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_ invoke__">getColor</span>() &#123;</span><br><span class="line">		<span class="keyword">return</span> color;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_ invoke__">setColor</span>(String color) &#123;</span><br><span class="line">		this.color = color;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_ invoke__">printColor</span>() &#123;</span><br><span class="line">		System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;车子的颜色是：&quot;</span> + this.<span class="title function_ invoke__">getColor</span>());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="java中的内部类"><a href="#java中的内部类" class="headerlink" title="java中的内部类 **"></a>java中的内部类 **</h4><p>不得不说这里肯定是与php比较大的区别所在之处了，java支持在自己类里面再写一个类，具体来看一下：</p>
<p>内部类（ Inner Class ）就是定义在另外一个类里面的类。与之对应，包含内部类的类被称为外部类。</p>
<p>1、 内部类作用</p>
<ul>
<li>内部类提供了更好的封装，可以把内部类隐藏在外部类之内，不允许同一个包中的其他类访问该类</li>
<li>内部类的方法可以直接访问外部类的所有数据，包括私有的数据</li>
<li>内部类所实现的功能使用外部类同样可以实现，只是有时使用内部类更方便</li>
</ul>
<p>2、内部类种类</p>
<ul>
<li>成员内部类</li>
<li>静态内部类</li>
<li>方法内部类</li>
<li>匿名内部类</li>
</ul>
<p>内部类及调用示例：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">package com.imooc;</span><br><span class="line"></span><br><span class="line"><span class="comment">//内部类示例</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InnerClass</span> </span>&#123;</span><br><span class="line">	<span class="comment">//内部类 (在类的里面再创建一个类)</span></span><br><span class="line">	<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Inner</span></span>&#123;  </span><br><span class="line">		<span class="comment">//内部类中的方法体</span></span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">void</span> <span class="keyword">print</span>() &#123;</span><br><span class="line">			System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;内部类中的方法执行了!&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//怎么调用内部类中的方法 （这里需要多注意下）</span></span><br><span class="line">	<span class="keyword">public</span> <span class="built_in">static</span> <span class="keyword">void</span> <span class="title function_ invoke__">main</span>(String[] args) &#123;</span><br><span class="line">		<span class="comment">//先创建一个外部类对象</span></span><br><span class="line">		InnerClass innerClassObj = <span class="keyword">new</span> <span class="title class_">InnerClass</span>();</span><br><span class="line">		<span class="comment">//再创建内部类对象</span></span><br><span class="line">		Inner innerObj = innerClassObj.<span class="keyword">new</span> <span class="title class_">Inner</span>();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//再调用内部类的方法</span></span><br><span class="line">		innerObj.<span class="keyword">print</span>();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>||内部类中最常见的就是成员内部类，也称为普通内部类。我们来看如下代码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">package com.imooc;</span><br><span class="line"></span><br><span class="line"><span class="comment">//内部类示例</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">outer</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> a = <span class="number">99</span>; <span class="comment">//外部成员私有属性</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">//内部类 (在类的里面再创建一个类)</span></span><br><span class="line">	<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Inner</span></span>&#123;  </span><br><span class="line">		<span class="keyword">int</span> b = <span class="number">2</span>; <span class="comment">//内部类成员属性</span></span><br><span class="line">		<span class="comment">//内部类中的方法体</span></span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">void</span> <span class="keyword">print</span>() &#123;</span><br><span class="line">			System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;访问外部类中的a：&quot;</span> + a);   <span class="comment">//调用外部成员方法1</span></span><br><span class="line">			System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;访问外部类中的a：&quot;</span> + outer.this.a); <span class="comment">//调用外部成员方法2</span></span><br><span class="line">			System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;访问内部成员中的b：&quot;</span> + b);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//怎么调用内部类中的方法 （这里需要多注意下）</span></span><br><span class="line">	<span class="keyword">public</span> <span class="built_in">static</span> <span class="keyword">void</span> <span class="title function_ invoke__">main</span>(String[] args) &#123;</span><br><span class="line">		<span class="comment">//先创建一个外部类对象</span></span><br><span class="line">		outer auterObj = <span class="keyword">new</span> <span class="title function_ invoke__">outer</span>();</span><br><span class="line">		<span class="comment">//再创建内部类对象</span></span><br><span class="line">		Inner innerObj = auterObj.<span class="keyword">new</span> <span class="title class_">Inner</span>();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//再调用内部类的方法</span></span><br><span class="line">		innerObj.<span class="keyword">print</span>();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="从上面的代码中我们可以看到，成员内部类的使用方法："><a href="#从上面的代码中我们可以看到，成员内部类的使用方法：" class="headerlink" title="从上面的代码中我们可以看到，成员内部类的使用方法："></a>从上面的代码中我们可以看到，成员内部类的使用方法：</h4><p>1、 Inner 类定义在 Outer 类的内部，相当于 Outer 类的一个成员变量的位置，Inner 类可以使用任意访问控制符，如 public 、 protected 、 private 等；</p>
<p>2、 Inner 类中定义的 print() 方法可以直接访问 Outer 类中的数据，而不受访问控制符的影响，如直接访问 Outer 类中的私有属性a;</p>
<p>3、 定义了成员内部类后，必须使用外部类对象来创建内部类对象，而不能直接去 new 一个内部类对象，即：内部类 对象名 &#x3D; 外部类对象.new 内部类( );</p>
<p>4、 编译上面的程序后，会发现产生了两个 .class 文件(在项目下的bin目录下)<br>Outer$Inner.class<br>Outer.class</p>
<p>其中，第二个是外部类的 .class 文件，第一个是内部类的 .class 文件，即成员内部类的 .class 文件总是这样：外部类名$内部类名.class。</p>
<h4 id="重点提示："><a href="#重点提示：" class="headerlink" title="||重点提示："></a>||重点提示：</h4><p>1、外部类是不能直接使用内部类的成员和方法滴，可先创建内部类的对象，然后通过内部类的对象来访问其成员变量和方法。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Inner innerObj = <span class="keyword">new</span> <span class="title function_ invoke__">outer</span>().<span class="keyword">new</span> <span class="title class_">Inner</span>();</span><br><span class="line">innerObj.<span class="keyword">print</span>();</span><br></pre></td></tr></table></figure>


<p>2、如果外部类和内部类具有相同的成员变量或方法，内部类默认访问自己的成员变量或方法，如果要访问外部类的成员变量，可以使用 this 关键字。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;访问外部类中的a：&quot;</span> + outer.this.a); <span class="comment">//调用外部成员方法2</span></span><br></pre></td></tr></table></figure>

<h4 id="java中静态内部类"><a href="#java中静态内部类" class="headerlink" title="java中静态内部类"></a>java中静态内部类</h4><p>静态内部类是 static修饰的内部类，这种内部类的特点是：</p>
<p>1、 静态内部类不能直接访问外部类的非静态成员，但可以通过 new 外部类().成员 的方式访问；</p>
<p>2、 如果外部类的静态成员与内部类的成员名称相同，可通过类名.静态成员访问外部类的静态成员；如果外部类的静态成员与内部类的成员名称不相同，则可通过成员名直接调用外部类的静态成员；</p>
<p>3、 创建静态内部类的对象时，不需要外部类的对象，可以直接创建 内部类 对象名&#x3D; new 内部类();</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">package com.imooc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StaticInner</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String name = <span class="string">&quot;xiexiang&quot;</span>; <span class="comment">//外部类非静态成员</span></span><br><span class="line">	<span class="keyword">private</span> <span class="built_in">static</span> <span class="keyword">int</span> age = <span class="number">18</span>;      <span class="comment">//外部类静态成员</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="built_in">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Inner</span></span>&#123;</span><br><span class="line">		<span class="keyword">private</span> <span class="built_in">static</span> <span class="keyword">int</span> age = <span class="number">19</span>;  <span class="comment">//内部类成员 </span></span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">void</span> <span class="keyword">print</span>() &#123;</span><br><span class="line">			System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;访问外部的非静态成员：&quot;</span> + <span class="keyword">new</span> <span class="title class_">StaticInner</span>().name); <span class="comment">//new 外部类().成员</span></span><br><span class="line">			System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;外部静态成员age=&quot;</span> + StaticInner.age);   <span class="comment">//同名情况下访问外部类成员</span></span><br><span class="line">			System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;内部静态成员age=&quot;</span> + age);   <span class="comment">//内部成员的访问方式</span></span><br><span class="line">			Inner innerObj = <span class="keyword">new</span> <span class="title class_">Inner</span>();</span><br><span class="line">			System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;最大值为：&quot;</span> + innerObj.<span class="title function_ invoke__">getMax</span>() ); <span class="comment">//内部类间的非静态方法方法调用</span></span><br><span class="line">			System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;最小值为：&quot;</span> + <span class="title function_ invoke__">getMin</span>());   <span class="comment">//内部类间的静态方法方法调用</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 非静态方法</span></span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">int</span> <span class="title function_ invoke__">getMax</span>() &#123;</span><br><span class="line">			<span class="keyword">int</span> scores[] = &#123;<span class="number">33</span>,<span class="number">55</span>,<span class="number">56</span>,<span class="number">74</span>&#125;;</span><br><span class="line">			<span class="keyword">int</span> max = scores[<span class="number">0</span>];</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;scores.length;i++) &#123;</span><br><span class="line">				<span class="keyword">if</span>(scores[i] &gt; max) max = scores[i];</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> max;</span><br><span class="line"> 		&#125;</span><br><span class="line">		<span class="comment">//静态方法</span></span><br><span class="line">		<span class="keyword">public</span> <span class="built_in">static</span> <span class="keyword">int</span> <span class="title function_ invoke__">getMin</span>() &#123;</span><br><span class="line">			<span class="keyword">int</span> scores[] = &#123;<span class="number">12</span>,<span class="number">35</span>,<span class="number">66</span>,<span class="number">34</span>,<span class="number">33</span>&#125;;</span><br><span class="line">			<span class="keyword">int</span> min = scores[<span class="number">0</span>];</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;scores.length;i++) &#123;</span><br><span class="line">				<span class="keyword">if</span>(scores[i] &lt; min) min = scores[i];</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> min;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//主入口</span></span><br><span class="line">	<span class="keyword">public</span> <span class="built_in">static</span> <span class="keyword">void</span> <span class="title function_ invoke__">main</span>(String[] args) &#123;</span><br><span class="line">		Inner innerObj = <span class="keyword">new</span> <span class="title class_">Inner</span>();   <span class="comment">//实例化内部静态类可以直接new</span></span><br><span class="line">		innerObj.<span class="keyword">print</span>(); </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">访问外部的非静态成员：xiexiang</span><br><span class="line">外部静态成员age=<span class="number">18</span></span><br><span class="line">内部静态成员age=<span class="number">19</span></span><br><span class="line">最大值为：<span class="number">74</span></span><br><span class="line">最小值为：<span class="number">12</span></span><br></pre></td></tr></table></figure>

<h4 id="java中的方法内部类"><a href="#java中的方法内部类" class="headerlink" title="java中的方法内部类"></a>java中的方法内部类</h4><p>学到这里，我觉得java即严谨又灵活，上面讲到类中含有类就算了，居然方法中还会含有类，厉害！继续往下看。。</p>
<p>概念：方法内部类就是内部类定义在外部类的方法中，方法内部类只在该方法内部可见，即只在该方法内部可以使用。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">package com.imooc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">functionInnerClass</span> </span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_ invoke__">show</span>() &#123;</span><br><span class="line">		String name = <span class="string">&quot;xiexiang&quot;</span>;</span><br><span class="line">		<span class="keyword">int</span> age = <span class="number">18</span>;</span><br><span class="line">		<span class="class"><span class="keyword">class</span> <span class="title">NInner</span> </span>&#123;  <span class="comment">//方法内部类不能使用访问控制符和 static 修饰符 </span></span><br><span class="line">			<span class="keyword">int</span> sex = <span class="number">1</span>;</span><br><span class="line">			<span class="keyword">public</span> <span class="keyword">void</span> <span class="keyword">print</span>() &#123;</span><br><span class="line">				String xb = <span class="string">&quot;&quot;</span>;</span><br><span class="line">				<span class="keyword">if</span>(sex == <span class="number">1</span>) xb = <span class="string">&quot;男&quot;</span>;</span><br><span class="line">				System.out.<span class="title function_ invoke__">println</span>(name + <span class="string">&quot;的年龄为&quot;</span> + age+ <span class="string">&quot;,性别是：&quot;</span> + xb); <span class="comment">//方法内部类只在该方法的内部可见，也只能使用方法中的成员</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		NInner mi = <span class="keyword">new</span> <span class="title class_">NInner</span>(); <span class="comment">// 方法体中要实例化内部类，不然不会调用</span></span><br><span class="line">		mi.<span class="keyword">print</span>(); <span class="comment">//调用了方法内部类的方法</span></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="built_in">static</span> <span class="keyword">void</span> <span class="title function_ invoke__">main</span>(String[] args) &#123;</span><br><span class="line">		functionInnerClass io = <span class="keyword">new</span> <span class="title function_ invoke__">functionInnerClass</span>();</span><br><span class="line">		io.<span class="title function_ invoke__">show</span>();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>||特别注意</strong></p>
<p>由于方法内部类不能在外部类的方法以外的地方使用，因此方法内部类不能使用访问控制符和 static 修饰符。</p>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>Java学习-part.04（继承、重写、super、多态、多态的引用类型转换、抽象类、接口）</title>
    <url>/2018/05/25/Java%E5%AD%A6%E4%B9%A0-part-04%EF%BC%88%E7%BB%A7%E6%89%BF%E3%80%81%E9%87%8D%E5%86%99%E3%80%81super%E3%80%81%E5%A4%9A%E6%80%81%E3%80%81%E5%A4%9A%E6%80%81%E7%9A%84%E5%BC%95%E7%94%A8%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2%E3%80%81%E6%8A%BD%E8%B1%A1%E7%B1%BB%E3%80%81%E6%8E%A5%E5%8F%A3%EF%BC%89/</url>
    <content><![CDATA[<h4 id="java中的继承"><a href="#java中的继承" class="headerlink" title="java中的继承"></a>java中的继承</h4><p>1、继承的概念：</p>
<p>继承是类与类的一种关系，是一中 “is a”的关系。</p>
<p>注：java中的继承是单继承</p>
<p>2、继承的好处</p>
<p>子类拥有父类的所有的属性和方法，但是父类中的private修饰符无效</p>
<p>实现代码复用<br><img src="/../img/extends.jpg" alt="java"></p>
<p>eg：生活有要是有个好爹，就可以少奋斗几年;如果继承了父亲的权力，那就是官二代</p>
<span id="more"></span>
<p>3、语法</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span>  子类 <span class="keyword">extends</span> 父类 </span></span><br><span class="line"><span class="class">例：<span class="title">class</span> <span class="title">Dog</span> <span class="keyword">extends</span> <span class="title">Animal</span></span>&#123;</span><br><span class="line">    ....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//父类</span></span><br><span class="line">package com.imooc;</span><br><span class="line"></span><br><span class="line"><span class="comment">//重庆人</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChongQing</span> </span>&#123;</span><br><span class="line">	String area = <span class="string">&quot;西南地区&quot;</span>; <span class="comment">// 地区</span></span><br><span class="line">	String love = <span class="string">&quot;爱吃辣&quot;</span>;   <span class="comment">//喜好</span></span><br><span class="line">	String beatiWoman = <span class="string">&quot;美女多&quot;</span>; <span class="comment">//美女多</span></span><br><span class="line">	<span class="keyword">double</span> population = <span class="number">30000000</span>;<span class="comment">//人口</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_ invoke__">work</span>() &#123;</span><br><span class="line">		System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;工作使我快乐！&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_ invoke__">shoping</span>() &#123;</span><br><span class="line">		System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;重庆人是喜欢购物的&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//子类</span></span><br><span class="line">package com.imooc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Xiexiang</span> <span class="keyword">extends</span> <span class="title">ChongQing</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_ invoke__">getChongqing</span>() &#123;</span><br><span class="line">		System.out.<span class="keyword">print</span>(area + <span class="string">&quot;有个地方叫重庆，那里的人&quot;</span>+love+<span class="string">&quot;,而且&quot;</span> + beatiWoman + <span class="string">&quot;,他们是很喜欢工作的，时常都会说：&quot;</span> );</span><br><span class="line">		<span class="title function_ invoke__">work</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="built_in">static</span> <span class="keyword">void</span> <span class="title function_ invoke__">main</span>(String[] args) &#123;</span><br><span class="line">		<span class="keyword">new</span> <span class="title class_">Xiexiang</span>().<span class="title function_ invoke__">getChongqing</span>(); </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//运行结果</span></span><br><span class="line"></span><br><span class="line">西南地区有个地方叫重庆，那里的人爱吃辣,而且美女多,他们是很喜欢工作的，时常都会说：工作使我快乐！</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="方法的重写"><a href="#方法的重写" class="headerlink" title="方法的重写"></a>方法的重写</h4><p>1、概念：</p>
<p>如果子类对继承父类的方法不满意，是可以重写父类继承的方法的，当调用方法时会优先调用子类的方法。</p>
<p>2、语法规则</p>
<p>语法规则</p>
<p>返回值类型</p>
<p>参数类型及个数</p>
<p>都要与父类继承的方法相同，才叫方法的重写。</p>
<h4 id="final关键字"><a href="#final关键字" class="headerlink" title="final关键字"></a>final关键字</h4><p>概念：使用final关键字做标识有”最终的”含义。</p>
<p><strong>final可以修饰类、方法、属性和变量</strong></p>
<ul>
<li>final修饰类，则该类不允许被继承</li>
<li>final修饰方法，则该方法不允许被覆盖（重写）</li>
<li>final修饰属性，则该类的属性不会进行隐式的初始化（类的初始化属性必须有值）或是构造方法中赋值（但只能选其一）[就是属性只能赋值一次，不管是构造方法还是main方法都无法再次进行赋值]</li>
<li>final修饰变量，则该变量的值只能赋一次值，即为常量。</li>
</ul>
<h4 id="super关键字"><a href="#super关键字" class="headerlink" title="super关键字"></a>super关键字</h4><p>super关键字：在对象的内部使用，可以代表父类对象</p>
<ul>
<li>访问父类的属性： super.love</li>
<li>访问父类的方法： super.work()</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">package com.imooc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Xiexiang</span> <span class="keyword">extends</span> <span class="title">ChongQing</span> </span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_ invoke__">work</span>() &#123;</span><br><span class="line">		System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;被重构之后的输出&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_ invoke__">getChongqing</span>() &#123;</span><br><span class="line">		System.out.<span class="keyword">print</span>(super.area + <span class="string">&quot;有个地方叫重庆，那里的人&quot;</span>+super.love+<span class="string">&quot;,而且&quot;</span> + super.beatiWoman + <span class="string">&quot;,他们是很喜欢工作的，时常都会说：&quot;</span> );</span><br><span class="line">		super.<span class="title function_ invoke__">work</span>();  <span class="comment">//work方法被重写，使用super关键字后指向的是使用的是父类的work方法</span></span><br><span class="line">		<span class="title function_ invoke__">work</span>();  <span class="comment">//这种写法默认是重写后的方法</span></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="built_in">static</span> <span class="keyword">void</span> <span class="title function_ invoke__">main</span>(String[] args) &#123;</span><br><span class="line">		<span class="keyword">new</span> <span class="title class_">Xiexiang</span>().<span class="title function_ invoke__">getChongqing</span>(); </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>super的应用*</li>
<li>如果子类的构造方法中没有显示调用父类的构造方法，则系统默认调用父类无参的构造方法。</li>
<li>如果显示的调用构造方法，必须在子类的构造方法的第一行。</li>
<li>如果子类构造方法中既没有显示调用父类的构造方法，而父类又没有无参的构造方法，则会编译出错。</li>
</ul>
<h4 id="Object类"><a href="#Object类" class="headerlink" title="Object类"></a>Object类</h4><p>object类是所有类的父类，如果一个类没有使用extends关键字明确标识继承另外一个类，那么这个类默认继承Object类。</p>
<p>object类中的方法，适合所有的子类。</p>
<p>常用的方法：</p>
<ul>
<li><p>1、toString() 方法 返回值：字符串</p>
<p>直接输出对象只能是返回哈希码生成的一个对象的内存地址，重写toString()方法能够清晰展现对象的属性值。</p>
</li>
<li><p>2、equals()方法 返回值：bool</p>
<p>比较的是对象的引用是否指向同一块内存地址<br>一般情况下比较两个对象时比较他的值是否一致，所以要进行重写。<br><img src="/../img/java-equals.png" alt="java"></p>
</li>
</ul>
<h4 id="多态"><a href="#多态" class="headerlink" title="多态 **"></a>多态 **</h4><p>概念：对象的多种形态</p>
<p>1、引用的多态</p>
<p>父类的引用可以指向本类的对象</p>
<p>父类的引用可以指向子类的对象</p>
<p>eg:Dog类extends Animal类</p>
<p>Animal obj1 &#x3D; new Animal();</p>
<p>Animal obj2 &#x3D; new Dog(); &#x2F;&#x2F;父类的引用是可以指向子类对象的</p>
<p>&#x2F;&#x2F;Dog obj3 &#x3D; new Animal(); &#x2F;&#x2F;X 这种就是错误的</p>
<p>2、方法多态</p>
<p>创建本类对象时，调用的方法为本类的方法</p>
<p>创建子类对象时，调用的方法为子类重写的方法或者继承的方法。（__也就是说，子类里面非继承和重写的方法，是不能调用的__）</p>
<h4 id="多态中的引用类型转换"><a href="#多态中的引用类型转换" class="headerlink" title="多态中的引用类型转换"></a>多态中的引用类型转换</h4><ul>
<li>1、向上类型转换（隐式&#x2F;自动类型转换），是小类型到大类型的转换；</li>
<li>2、向下类型转换（强制类型转换），是大类型到小类型；</li>
<li>3、instanceof运算符，来解决引用对象的类型，避免类型转换的安全性问题。</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">package com.imooc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">convertType</span> </span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="built_in">static</span> <span class="keyword">void</span> <span class="title function_ invoke__">main</span>(String[] args) &#123;</span><br><span class="line">		Dog dog = <span class="keyword">new</span> <span class="title class_">Dog</span>();</span><br><span class="line">		Animal animal = dog;  <span class="comment">//自动类型提升，向上类型转换</span></span><br><span class="line">		Dog dog2 = (Dog)animal; <span class="comment">//强制类型转换  向下类型转换 [存在风险]</span></span><br><span class="line">		Cat cat = (Cat)animal;  <span class="comment">//风险点：编译器不会报错，但是运行时提示没有办法进行转换，Cat类型与Dog类型不一致</span></span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//上面的代码都不严谨，可以用到instanceof做检测</span></span><br><span class="line">		<span class="keyword">if</span>(animal <span class="keyword">instanceof</span> Cat) &#123;  <span class="comment">//避免类型转换的安全性问题</span></span><br><span class="line">			Cat cat = (Cat)animal;</span><br><span class="line">		&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">			System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;无法进行类型转换&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="抽象类"><a href="#抽象类" class="headerlink" title="抽象类 **"></a>抽象类 **</h4><p>1、语法定义：</p>
<p>抽象类前使用abstract关键字修饰，则该类为抽象类。</p>
<p>2、应用场景：</p>
<ul>
<li>在某些情况下，某个父类只是知道其子类应该包含怎样的方法，但无法准确知道这些子类如何实现这些方法；</li>
<li>从多个具有相同特征的类中抽象出一个抽象类，以这个抽象类作为子类的模板，从而避免了子类设计的随意性。</li>
</ul>
<p>3、作用 *</p>
<p>限制规定子类必须实现某些方法，但是不关注实现细节。</p>
<p>4、使用规则</p>
<ul>
<li>abstract定义抽象类</li>
<li>abstract定义抽象方法，只有声明，不需要实现</li>
<li>包含抽象方法的类是抽象类</li>
<li>抽象类中可以包含普通的方法，也可以没有抽象方法</li>
<li>抽象类不能直接创建，可以定义引用变量<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">package com.abstracttest;</span><br><span class="line"></span><br><span class="line"><span class="comment">//图形抽象类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Mould</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//面积的实现</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">double</span> <span class="title function_ invoke__">area</span>(<span class="keyword">double</span> chang,<span class="keyword">double</span> kuan);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//周长的实现</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">double</span> <span class="title function_ invoke__">girth</span>(<span class="keyword">double</span> chang,<span class="keyword">double</span> kuan);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">package com.abstracttest;</span><br><span class="line"></span><br><span class="line"><span class="comment">//矩形</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span> <span class="keyword">extends</span> <span class="title">Mould</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	@Override <span class="comment">//矩形面积的计算</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">double</span> <span class="title function_ invoke__">area</span>(<span class="keyword">double</span> chang, <span class="keyword">double</span> kuan) &#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		<span class="keyword">double</span> newArea = chang * kuan;  <span class="comment">//长*宽</span></span><br><span class="line">		<span class="keyword">return</span> newArea;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@Override <span class="comment">//矩形的周长</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">double</span> <span class="title function_ invoke__">girth</span>(<span class="keyword">double</span> chang, <span class="keyword">double</span> kuan) &#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		<span class="keyword">double</span> newGirth = <span class="number">2</span>*chang + <span class="number">2</span>*kuan; <span class="comment">//2*长+2*宽</span></span><br><span class="line">		<span class="keyword">return</span> newGirth;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">package com.abstracttest;</span><br><span class="line"><span class="comment">//调用方</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">init</span> </span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="built_in">static</span> <span class="keyword">void</span> <span class="title function_ invoke__">main</span>(String[] args) &#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		Mould mould = <span class="keyword">new</span> <span class="title class_">Rectangle</span>();  		 <span class="comment">//父类引用指向子类对象</span></span><br><span class="line">		<span class="keyword">double</span> newArea = mould.<span class="title function_ invoke__">area</span>(<span class="number">150</span>, <span class="number">145.55</span>);  <span class="comment">//求面积</span></span><br><span class="line">		<span class="keyword">double</span> newGirth = mould.<span class="title function_ invoke__">girth</span>(<span class="number">150</span>, <span class="number">145.55</span>); <span class="comment">//求周长</span></span><br><span class="line">		System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;面积为：&quot;</span> + newArea);</span><br><span class="line">		System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;周长为：&quot;</span> + newGirth);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="接口"><a href="#接口" class="headerlink" title="接口 **"></a>接口 **</h4><p>1、概述</p>
<p>类是一种具体实现体，而接口定义了某一批类所需要遵守的规范，接口不关心这些类的内部数据，也不关心这些类里方法的实现细节，它只规定这些类里必须提供某些方法。<br>具有相同的功能，却不是同一个类的情况下，就可以使用接口</p>
<p>2、接口的定义</p>
<p>和类定义不同，定义接口不再使用class关键字，而是使用interface关键字。</p>
<p>3、接口定义的基本语法</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> [<span class="title">abstract</span>] 接口名 [<span class="keyword">extends</span> 父接口1，父接口2 ...]   //可以多继承</span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">//零到多个常量定义 ...</span></span><br><span class="line">    <span class="comment">//零到多个抽象方法的定义 ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接口就是用来被继承、被实现的，修饰符一般建议用public</p>
<p>注意：不能使用private和protected修饰接口</p>
<p>4、接口的定义</p>
<p>常量</p>
<p>接口中的属性是常量，即使定义时不添加， public static final修饰符，系统也会自动加上。</p>
<p>方法</p>
<p>接口中的方法只能是抽象方法，总是使用，即使定义时不添加public abstract修饰符，系统也会自动加上。</p>
<p>5、使用接口</p>
<p>（1）、一个类可以实现一个或者多个接口，实现接口使用implements关键字。java中一个类只能继承一个父类，是不够灵活的，通过实现多个接口可以做补充。</p>
<p>继承父类实现接口的语法为：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">[修饰符] <span class="class"><span class="keyword">class</span> 类名 <span class="keyword">extends</span> 父类 <span class="keyword">implements</span> 接口1，接口2 ...</span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    类体部分 <span class="comment">//1、如果继承了抽象类，需要实现继承的抽象方法；</span></span><br><span class="line">            <span class="comment">//2、如果遵守了接口，要实现接口中的抽象方法。</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">//**继承的抽象类中的方法和接口中的抽象方法都必须先实现。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意：如果要继承父类，继承父类必须在实现接口之前。</p>
<p>根据下图实现接口实例：<br><img src="/../img/interface.png" alt="java"></p>
<p>实现如下：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">【Telphone.java】</span><br><span class="line">package com.phone;</span><br><span class="line"></span><br><span class="line"><span class="comment">//电话抽象类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">TelPhone</span> </span>&#123;</span><br><span class="line">	<span class="comment">//具有发短信功能</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_ invoke__">sendMessage</span>();</span><br><span class="line">	<span class="comment">//具有打电话功能</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_ invoke__">call</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">【IPlayGame.java】</span><br><span class="line">package com.phone;</span><br><span class="line"><span class="comment">//游戏机 接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">interface</span> <span class="title">IPlayGame</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//具有玩游戏的功能</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_ invoke__">playGame</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">【CellPhone.java】</span><br><span class="line">package com.phone;</span><br><span class="line"></span><br><span class="line"><span class="comment">//以前的手机</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CellPhone</span> <span class="keyword">extends</span> <span class="title">TelPhone</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	@Override   <span class="comment">//必须实现发短信功能</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_ invoke__">sendMessage</span>() &#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;老电话是具有发短信的功能&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@Override   <span class="comment">//必须实现打电话功能</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_ invoke__">call</span>() &#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;老电话是具有打电话的功能&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">【SmartPhone.java】</span><br><span class="line">package com.phone;</span><br><span class="line"></span><br><span class="line"><span class="comment">//现在的智能机</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SmartPhone</span> <span class="keyword">extends</span> <span class="title">TelPhone</span> <span class="keyword">implements</span> <span class="title">IPlayGame</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	@Override <span class="comment">//智能机具有发短信</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_ invoke__">sendMessage</span>() &#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;新电话是具有发短信的功能&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@Override <span class="comment">//智能机具有打电话</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_ invoke__">call</span>() &#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;新电话是具有打电话的功能&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	@Override  <span class="comment">//智能机还具有玩游戏</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_ invoke__">playGame</span>() &#123;</span><br><span class="line">		System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;新电话还具有游戏的功能&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">【init.java】 <span class="comment">//出口-运行的地方</span></span><br><span class="line">package com.phone;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">init</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="built_in">static</span> <span class="keyword">void</span> <span class="title function_ invoke__">main</span>(String[] args) &#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		TelPhone tel1 = <span class="keyword">new</span> <span class="title class_">CellPhone</span>();</span><br><span class="line">		tel1.<span class="title function_ invoke__">call</span>();</span><br><span class="line">		tel1.<span class="title function_ invoke__">sendMessage</span>();</span><br><span class="line">		</span><br><span class="line">		TelPhone tel2 = <span class="keyword">new</span> <span class="title class_">SmartPhone</span>();</span><br><span class="line">		tel2.<span class="title function_ invoke__">call</span>();</span><br><span class="line">		tel2.<span class="title function_ invoke__">sendMessage</span>();</span><br><span class="line">		</span><br><span class="line">		SmartPhone tel3 = <span class="keyword">new</span> <span class="title class_">SmartPhone</span>();</span><br><span class="line">		tel3.<span class="title function_ invoke__">playGame</span>();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（2）、接口在使用过程当中，还经常与匿名内部类配合使用</p>
<p>匿名内部类就是没有名字的内部类，多用于关注实现而不关注实现类的名称。</p>
<p>语法格式：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Interface i = <span class="keyword">new</span> <span class="title class_">Interface</span>()&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_ invoke__">method</span>()&#123;</span><br><span class="line">        System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;匿名内部类实现接口的方式&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实例：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">package com.phone;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">init</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="built_in">static</span> <span class="keyword">void</span> <span class="title function_ invoke__">main</span>(String[] args) &#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		TelPhone tel1 = <span class="keyword">new</span> <span class="title class_">CellPhone</span>();</span><br><span class="line">		tel1.<span class="title function_ invoke__">call</span>();</span><br><span class="line">		tel1.<span class="title function_ invoke__">sendMessage</span>();</span><br><span class="line">		</span><br><span class="line">		TelPhone tel2 = <span class="keyword">new</span> <span class="title class_">SmartPhone</span>();</span><br><span class="line">		tel2.<span class="title function_ invoke__">call</span>();</span><br><span class="line">		tel2.<span class="title function_ invoke__">sendMessage</span>();</span><br><span class="line">		</span><br><span class="line">		SmartPhone tel3 = <span class="keyword">new</span> <span class="title class_">SmartPhone</span>();</span><br><span class="line">		tel3.<span class="title function_ invoke__">playGame</span>();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//匿名内部类的使用 如下两种方式</span></span><br><span class="line">		<span class="comment">//语法第一种</span></span><br><span class="line">		IPlayGame pg = <span class="keyword">new</span> <span class="title class_">IPlayGame</span>() &#123;</span><br><span class="line">			@Override</span><br><span class="line">			<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_ invoke__">playGame</span>() &#123;</span><br><span class="line">				<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">				System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;这是匿名内部类的方式实现接口&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;;</span><br><span class="line">		pg.<span class="title function_ invoke__">playGame</span>();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//语法第二种</span></span><br><span class="line">		 <span class="keyword">new</span> <span class="title class_">IPlayGame</span>() &#123;</span><br><span class="line">			@Override</span><br><span class="line">			<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_ invoke__">playGame</span>() &#123;</span><br><span class="line">				<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">				System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;这是匿名内部类的方式实现接口2&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;.<span class="title function_ invoke__">playGame</span>();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>Java学习-part.05（异常、字符串、字符串处理及转换、包装类、时间处理、Math类操作）</title>
    <url>/2018/05/25/Java%E5%AD%A6%E4%B9%A0-part-05%EF%BC%88%E5%BC%82%E5%B8%B8%E3%80%81%E5%AD%97%E7%AC%A6%E4%B8%B2%E3%80%81%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%A4%84%E7%90%86%E5%8F%8A%E8%BD%AC%E6%8D%A2%E3%80%81%E5%8C%85%E8%A3%85%E7%B1%BB%E3%80%81%E6%97%B6%E9%97%B4%E5%A4%84%E7%90%86%E3%80%81Math%E7%B1%BB%E6%93%8D%E4%BD%9C%EF%BC%89/</url>
    <content><![CDATA[<h3 id="Java异常处理"><a href="#Java异常处理" class="headerlink" title="Java异常处理"></a>Java异常处理</h3><h4 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h4><p>语法格式：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">    <span class="comment">//代码块</span></span><br><span class="line">    ....</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//主动抛出异常</span></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">MismatchException</span>(<span class="string">&quot;这里是异常信息&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">catch</span>(MismatchException e)&#123;</span><br><span class="line">    <span class="comment">//除非try里面执行代码发生了异常，否则这里的代码不会执行 </span></span><br><span class="line">    <span class="comment">//出现异常的处理</span></span><br><span class="line">&#125;<span class="keyword">catch</span>(<span class="built_in">Exception</span> e)&#123;</span><br><span class="line">    <span class="comment">//除非try里面执行代码发生了异常，否则这里的代码不会执行 </span></span><br><span class="line">    <span class="comment">//出现异常的处理</span></span><br><span class="line">    e.<span class="title function_ invoke__">printStackTrace</span>();</span><br><span class="line">&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">    <span class="comment">//最终将执行的代码</span></span><br><span class="line">    <span class="comment">//***不管什么情况都会执行，包括try catch 里面用了return ,可以理解为只要执行了try或者catch，就一定会执行 finally </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<p>代码中可以有多个catch来捕获不同类型的Exception，从上至下必须是子到父的关系，也就是说越明显的异常最先捕获，最后的异常才有Exception来捕获；finally里面的代码是程序最后执行的地方。</p>
<p>高升对finally的解译: *</p>
<blockquote>
<p>finally的作用是上面的try代码块出现异常了，会中转执行跳转的catch块，这个时候如果有其他逻辑不管是否异常都要继续执行，就写到finally里面</p>
</blockquote>
<h4 id="自定义异常"><a href="#自定义异常" class="headerlink" title="自定义异常"></a>自定义异常</h4><p>在很多的情况下java内部定义的异常可能不满足目前场景，需要我们自己去定义一个异常类来处理，自定义的异常类必须是继承父类或者Exception的。</p>
<p>DrunkException.java</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">package com.exceptiontest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DrunkException</span> <span class="keyword">extends</span> <span class="title">Exception</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span>  <span class="title function_ invoke__">DrunkException</span>(String message) &#123;</span><br><span class="line">		<span class="title function_ invoke__">super</span>(message);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="title function_ invoke__">DrunkException</span>() &#123;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="异常链"><a href="#异常链" class="headerlink" title="异常链"></a>异常链</h4><p>在业务场景当中，我们可能会对某个服务进行处理，服务里面的异常和外部对服务的异常处理应该这样处理：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">package com.exceptiontest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTryCacth</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="built_in">static</span> <span class="keyword">void</span> <span class="title function_ invoke__">main</span> (String[] args) throws DrunkException &#123; <span class="comment">//自定义的异常必须要先声明</span></span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		MyTryCacth mc = <span class="keyword">new</span> <span class="title class_">MyTryCacth</span>();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">		    <span class="comment">//调用服务方的时候需要try-catch</span></span><br><span class="line">			mc.<span class="title function_ invoke__">test</span>();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (<span class="built_in">Exception</span> e) &#123;</span><br><span class="line">			e.<span class="title function_ invoke__">printStackTrace</span>(); <span class="comment">//打印出异常情况</span></span><br><span class="line">		&#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">			System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;来点骚东西&quot;</span>); <span class="comment">//这里是最后的执行</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_ invoke__">test</span>() throws DrunkException &#123;  <span class="comment">//自定义的异常必须要先声明</span></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">DrunkException</span>(<span class="string">&quot;我喝大了！&quot;</span>);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (<span class="built_in">Exception</span> e) &#123;</span><br><span class="line">		    <span class="comment">//这里看业务需要，这里是包装成了RuntimeException()</span></span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">RuntimeException</span>(e);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="前车之鉴"><a href="#前车之鉴" class="headerlink" title="前车之鉴"></a>前车之鉴</h4><ul>
<li>处理运行时异常时，采用逻辑去合理规避同时辅助try-catch处理</li>
<li>在多重catch块后面，可以加一个catch(Exception) 来处理可能会被遗漏的异常</li>
<li>对于不确定的代码，也可以加上try-catch，处理潜在的异常</li>
<li>尽量去处理异常，切忌只是简单的调用printStackTrace()去打印输出 （例如可以回滚）</li>
<li>具体如何处理异常，要根据不同的业务需求和异常类型去决定</li>
<li>尽量添加finally语块去释放占用的资源</li>
</ul>
<h3 id="Java中的字符串"><a href="#Java中的字符串" class="headerlink" title="Java中的字符串"></a>Java中的字符串</h3><h4 id="概述与语法"><a href="#概述与语法" class="headerlink" title="概述与语法"></a>概述与语法</h4><p>在Java中字符串属于引用类型，字符串被作为String类型的对象处理，String类位于java.lang包中。</p>
<p>创建String对象：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">String s1 = <span class="string">&quot;xiexiang&quot;</span>;</span><br><span class="line"></span><br><span class="line">String s2 = <span class="keyword">new</span> <span class="title class_">String</span>();</span><br><span class="line"></span><br><span class="line">String s3 = <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;xiexiang&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="字符串的不变性"><a href="#字符串的不变性" class="headerlink" title="字符串的不变性"></a>字符串的不变性</h4><p>String 对象创建后则不能被修改，是不可变的，所谓的修改其实是创建了新的对象，所指向的内存空间不同。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">String name1 = <span class="string">&quot;xiexiang&quot;</span>;</span><br><span class="line"></span><br><span class="line">String name2 = <span class="string">&quot;xiexiang&quot;</span>;</span><br><span class="line"></span><br><span class="line">String name3 = <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;xiexiang&quot;</span>);</span><br><span class="line"></span><br><span class="line">String name4 = <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;xiexiang&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//多次出现的字符常量，java编译程序只会创建一个，所以返回true</span></span><br><span class="line">System.out.<span class="title function_ invoke__">println</span>(name1 == name2);</span><br><span class="line"><span class="comment">//name1和name3是不同的对象，所以返回false</span></span><br><span class="line">System.out.<span class="title function_ invoke__">println</span>(name1 == name3);</span><br><span class="line"><span class="comment">//name3和name4是不同的对象，返回false</span></span><br><span class="line">System.out.<span class="title function_ invoke__">println</span>(name3 == name4);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">执行结果：</span><br><span class="line"></span><br><span class="line"><span class="literal">true</span></span><br><span class="line"><span class="literal">false</span></span><br><span class="line"><span class="literal">false</span></span><br></pre></td></tr></table></figure>

<p>每次 new 一个字符串就是产生一个新的对象，即便两个字符串的内容相同，使用 ”&#x3D;&#x3D;” 比较时也为 ”false” ,如果只需比较内容是否相同，应使用 ”equals()” 方法, System.out.println(name3.equals(name4));</p>
<p>字符串处理的常用方法<br><img src="/../img/string-f.png" alt="java"></p>
<h4 id="“-x3D-x3D-”-和-equals-的区别"><a href="#“-x3D-x3D-”-和-equals-的区别" class="headerlink" title="“&#x3D;&#x3D;” 和 equals() 的区别"></a>“&#x3D;&#x3D;” 和 equals() 的区别</h4><ul>
<li>&#x3D;&#x3D;: 判断两个字符串在内存中首地址是否相同，即判断是否是同一个字符串对象</li>
<li>equals(): 比较存储在两个字符串对象中的内容是否一致</li>
</ul>
<h4 id="Java中的StringBuilder类及常用方法"><a href="#Java中的StringBuilder类及常用方法" class="headerlink" title="Java中的StringBuilder类及常用方法"></a>Java中的StringBuilder类及常用方法</h4><p>概述：String是一个不可变的类，而StringBuilder是一个可变类。</p>
<p>StringBuilder对象用来储存字符串，并对其做了追加和插入的操作，这些操作只是修改了str对象的值，而没有创建新的对象，这就是StringBuilder和String最大的区别。</p>
<p>StringBuilder常用方法</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>StringBuilder append(参数)</td>
<td>追加内容到当前的StringBuilder对象的末尾</td>
</tr>
<tr>
<td>StringBuilder insert(位置，参数)</td>
<td>将内容插入到StringBuilder对象的指定位置</td>
</tr>
<tr>
<td>String toString()</td>
<td>将StringBuilder对象转换为String对象</td>
</tr>
<tr>
<td>int length()</td>
<td>获取字符串的长度</td>
</tr>
</tbody></table>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">package com.<span class="keyword">string</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringBuilderTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="built_in">static</span> <span class="keyword">void</span> <span class="title function_ invoke__">main</span>(String[] args) &#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		StringBuilder str = <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">		str.<span class="title function_ invoke__">append</span>(<span class="string">&quot; xiaochuhan&quot;</span>);</span><br><span class="line">		System.out.<span class="title function_ invoke__">println</span>(str);</span><br><span class="line">		</span><br><span class="line">		str.<span class="title function_ invoke__">insert</span>(<span class="number">5</span>, <span class="string">&quot;daye&quot;</span>);</span><br><span class="line">		System.out.<span class="title function_ invoke__">println</span>(str);</span><br><span class="line">		</span><br><span class="line">		str.<span class="title function_ invoke__">toString</span>();</span><br><span class="line">		System.out.<span class="title function_ invoke__">println</span>(str);</span><br><span class="line">		</span><br><span class="line">		System.out.<span class="title function_ invoke__">println</span>(str.<span class="title function_ invoke__">length</span>());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">执行结果：</span><br><span class="line">hello xiaochuhan</span><br><span class="line">hellodaye xiaochuhan</span><br><span class="line">hellodaye xiaochuhan</span><br><span class="line"><span class="number">20</span></span><br><span class="line">  <span class="comment">//都会在原值上进行修改，不会创建新的对象</span></span><br></pre></td></tr></table></figure>


<h3 id="Java中的包装类"><a href="#Java中的包装类" class="headerlink" title="Java中的包装类"></a>Java中的包装类</h3><p>概述：比如int、float、double、boolean、char等都属于基本数据类型是不具备对象的特性的，也不能条用方法、功能简单；为了让基本数据类型也具有对象的特性，java为每个基本数据类型都提供了一个包装类，这样就可以像操作对象那样操作基本数据类型。</p>
<table>
<thead>
<tr>
<th align="left">基本类型</th>
<th align="left">对应的包装类</th>
</tr>
</thead>
<tbody><tr>
<td align="left">byte</td>
<td align="left">Byte</td>
</tr>
<tr>
<td align="left">short</td>
<td align="left">Short</td>
</tr>
<tr>
<td align="left">int</td>
<td align="left">Integer</td>
</tr>
<tr>
<td align="left">long</td>
<td align="left">Long</td>
</tr>
<tr>
<td align="left">float</td>
<td align="left">Float</td>
</tr>
<tr>
<td align="left">double</td>
<td align="left">Double</td>
</tr>
<tr>
<td align="left">char</td>
<td align="left">Character</td>
</tr>
<tr>
<td align="left">boolean</td>
<td align="left">Boolean</td>
</tr>
</tbody></table>
<p>语法：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> age = <span class="number">19</span>;   <span class="comment">//定义一个int基本数据类型</span></span><br><span class="line"><span class="keyword">float</span> age1 = <span class="keyword">new</span> <span class="title class_">Integer</span>(age).<span class="title function_ invoke__">floatValue</span>();   <span class="comment">//转为为float类型</span></span><br></pre></td></tr></table></figure>

<p>我们以Integer为例看下包装类里面的常用方法：</p>
<table>
<thead>
<tr>
<th align="left">方法名</th>
<th align="left">说明</th>
<th align="left">返回值</th>
</tr>
</thead>
<tbody><tr>
<td align="left">byteValue()</td>
<td align="left">将该Integer转为byte类型</td>
<td align="left">byte</td>
</tr>
<tr>
<td align="left">doubleValue()</td>
<td align="left">转为double类型</td>
<td align="left">double</td>
</tr>
<tr>
<td align="left">floatValue()</td>
<td align="left">转为float类型</td>
<td align="left">float</td>
</tr>
<tr>
<td align="left">intValue()</td>
<td align="left">转为int类型</td>
<td align="left">int</td>
</tr>
<tr>
<td align="left">longValue()</td>
<td align="left">转为long类型</td>
<td align="left">long</td>
</tr>
<tr>
<td align="left">parseInt(String s)</td>
<td align="left">将字符串转换为int类型</td>
<td align="left">static int</td>
</tr>
<tr>
<td align="left">toString()</td>
<td align="left">转为字符串类型</td>
<td align="left">String</td>
</tr>
<tr>
<td align="left">valueOf(String s)</td>
<td align="left">将字符串传唤为Integer类型</td>
<td align="left">static Integer</td>
</tr>
</tbody></table>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> age = <span class="number">18</span>;</span><br><span class="line">Integer itr = <span class="keyword">new</span> <span class="title class_">Integer</span>(age);</span><br><span class="line">String age1 = itr.<span class="title function_ invoke__">toString</span>();</span><br><span class="line"><span class="keyword">float</span> age2 = itr.<span class="title function_ invoke__">floatValue</span>();</span><br><span class="line"><span class="keyword">double</span> age3 = itr.<span class="title function_ invoke__">doubleValue</span>();</span><br><span class="line">long age4 = itr.<span class="title function_ invoke__">longValue</span>();</span><br><span class="line"></span><br><span class="line">System.out.<span class="title function_ invoke__">println</span>(age1);</span><br><span class="line">System.out.<span class="title function_ invoke__">println</span>(age2);</span><br><span class="line">System.out.<span class="title function_ invoke__">println</span>(age3);</span><br><span class="line">System.out.<span class="title function_ invoke__">println</span>(age4);</span><br><span class="line">		</span><br><span class="line">输出结果：</span><br><span class="line"><span class="number">18</span></span><br><span class="line"><span class="number">18.0</span></span><br><span class="line"><span class="number">18.0</span></span><br><span class="line"><span class="number">18</span></span><br></pre></td></tr></table></figure>


<h3 id="基本数据类型与包装类的转换-（装箱与拆箱）"><a href="#基本数据类型与包装类的转换-（装箱与拆箱）" class="headerlink" title="基本数据类型与包装类的转换 （装箱与拆箱）"></a>基本数据类型与包装类的转换 （装箱与拆箱）</h3><p>在JDK1.5引入自动装箱和拆箱的机制后，包装类和基本类型之间的转换就轻松了。</p>
<p>装箱：把基本类型转换成包装类，使其具有对象的性质，又可分为手动装箱和自动装箱；</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> age = <span class="number">18</span>;    <span class="comment">//定义一个int的基本类型</span></span><br><span class="line">Integer ag = <span class="keyword">new</span> <span class="title class_">Integer</span>(age);  <span class="comment">//手动装箱</span></span><br><span class="line">Integer ag = age;       <span class="comment">//自动装箱</span></span><br></pre></td></tr></table></figure>

<p>拆箱：和装箱相反，把包装类对象转换成基本类型的值，又可分为手动拆箱和自动拆箱；</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Integer j = <span class="keyword">new</span> <span class="title class_">Integer</span>(<span class="number">90</span>); <span class="comment">//定义一个Integer包装类</span></span><br><span class="line"><span class="keyword">int</span> m = j.<span class="title function_ invoke__">intValue</span>();  <span class="comment">//手动拆箱为int类型</span></span><br><span class="line"><span class="keyword">int</span> n = j;             <span class="comment">//自动拆箱为int类型</span></span><br></pre></td></tr></table></figure>

<h3 id="基本数据类型与字符串之间的转换"><a href="#基本数据类型与字符串之间的转换" class="headerlink" title="基本数据类型与字符串之间的转换"></a>基本数据类型与字符串之间的转换</h3><h4 id="基本类型转字符串"><a href="#基本类型转字符串" class="headerlink" title="基本类型转字符串"></a>基本类型转字符串</h4><p>基本类型转换为字符串有三种方法：</p>
<p>1、使用基本类型的包装类的toString()方法；</p>
<p>2、使用String类的 valueOf()方法；</p>
<p>3、用一个空字符串加上基本类型，得到的就是基本类型数据对应的字符串；</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//将基本类型转换成字符串</span></span><br><span class="line"><span class="keyword">int</span> age = <span class="number">18</span>;</span><br><span class="line">String age1 = Integer.<span class="title function_ invoke__">toString</span>(age); <span class="comment">//方法一</span></span><br><span class="line">String age2 = String.<span class="title function_ invoke__">valueOf</span>(age);   <span class="comment">//方法二</span></span><br><span class="line">String age3 = age + <span class="string">&quot;&quot;</span>;              <span class="comment">//方法三</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">float</span> t =<span class="number">10</span>f;</span><br><span class="line">String t1 = Float.<span class="title function_ invoke__">toString</span>(t);</span><br><span class="line">String t2 = String.<span class="title function_ invoke__">valueOf</span>(t);</span><br></pre></td></tr></table></figure>

<h4 id="字符串转基本类型"><a href="#字符串转基本类型" class="headerlink" title="字符串转基本类型"></a>字符串转基本类型</h4><p>字符串转基本类型有两种方法：</p>
<p>1、调用包装类的parseXxx静态方法；</p>
<p>2、调用包装类的 valueOf()方法转换成基本类型</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//将字符串转换成基本类型</span></span><br><span class="line">String str= <span class="string">&quot;33&quot;</span>;</span><br><span class="line"><span class="keyword">int</span> str1 = Integer.<span class="title function_ invoke__">parseInt</span>(str);   <span class="comment">//方法一  转int</span></span><br><span class="line"><span class="keyword">int</span> str2 = Integer.<span class="title function_ invoke__">valueOf</span>(str);    <span class="comment">//方法二  转int</span></span><br><span class="line"></span><br><span class="line">flaot str3 = Float.<span class="title function_ invoke__">parseFloat</span>(str); </span><br><span class="line"><span class="keyword">float</span> str4 = Float.<span class="title function_ invoke__">valueOf</span>(str); </span><br><span class="line"></span><br><span class="line">** <span class="title function_ invoke__">valueOf</span>()方法会自动判断转换的类型</span><br></pre></td></tr></table></figure>

<h3 id="使用Date和SimpleDateFormat类表示时间"><a href="#使用Date和SimpleDateFormat类表示时间" class="headerlink" title="使用Date和SimpleDateFormat类表示时间"></a>使用Date和SimpleDateFormat类表示时间</h3><p>开发中我们可以用import java.util.Date这个类获取当前的时间。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Date time = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">system.out.<span class="title function_ invoke__">println</span>(time);</span><br><span class="line"></span><br><span class="line">执行输出：</span><br><span class="line">Fri Jun <span class="number">29</span> <span class="number">16</span>:<span class="number">39</span>:<span class="number">54</span> CST <span class="number">2018</span></span><br></pre></td></tr></table></figure>

<p>这种方式并不是我们想要的结果，这个时候就需要用到import java.text.SimpleDateFormat这个类来对日期时间进行格式化。</p>
<p>1、使用format()方法将日期转换为指定格式的文本</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Date time = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">SimpleDateFormat sdf = <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-mm-dd HH:mm:ss&quot;</span>);</span><br><span class="line">String nowTime = sdf.<span class="title function_ invoke__">format</span>(time);</span><br><span class="line">System.out.<span class="title function_ invoke__">println</span>(nowTime);</span><br><span class="line"></span><br><span class="line">执行结果：</span><br><span class="line"><span class="number">2018</span>-<span class="number">43</span>-<span class="number">29</span> <span class="number">16</span>:<span class="number">43</span>:<span class="number">51</span></span><br></pre></td></tr></table></figure>

<p>2、使用parse()方法将文本转换为日期</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">String date = <span class="string">&quot;4018年06月18日 12:34:45&quot;</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    SimpleDateFormat ss = <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy年mm月dd日 HH:mm:ss&quot;</span>);</span><br><span class="line">    Date timeNow  = ss.<span class="title function_ invoke__">parse</span>(date);</span><br><span class="line">    System.out.<span class="title function_ invoke__">println</span>(timeNow);</span><br><span class="line">&#125;<span class="keyword">catch</span>(ParseException e)&#123;</span><br><span class="line">    e.<span class="title function_ invoke__">printStackTrace</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">执行结果：</span><br><span class="line">Thu Jan <span class="number">18</span> <span class="number">12</span>:<span class="number">34</span>:<span class="number">45</span> CST <span class="number">4018</span></span><br></pre></td></tr></table></figure>

<p>代码中的”yyyy年MM月dd日 HH:mm:ss”指定了字符串的日期格式，调用parse()方法将文本转换为日期。</p>
<p>需要注意：</p>
<ul>
<li>1、调用SimpleDateFormat对象的parse()方法时可能会出现转换异常，即parseException，因此需要进行异常处理。</li>
<li>2、使用Date类时需要导入java.util.Date包，使用SimpleDateFormat时需要导入 java.text.SimpleDateFormat 包</li>
</ul>
<h3 id="Calendar-类的应用"><a href="#Calendar-类的应用" class="headerlink" title="Calendar 类的应用"></a>Calendar 类的应用</h3><p>java.util.Calendar类是一个抽象类，可以通过调用getInstance()静态方法获取一个Calendar对象，此对象已由当前日期时间初始化，即默认为当前时间，如 Calendar c &#x3D; Calendar.getInstance();</p>
<p>如何获取年月日时分秒？</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Calendar c = Calendar.<span class="title function_ invoke__">getInstance</span>();</span><br><span class="line"><span class="keyword">int</span> year = c.<span class="title function_ invoke__">get</span>(Calendar.YEAR);</span><br><span class="line"><span class="keyword">int</span> month = c.<span class="title function_ invoke__">get</span>(Calendar.MONTH);</span><br><span class="line"><span class="keyword">int</span> day = c.<span class="title function_ invoke__">get</span>(Calendar.DAY_OF_MONTH);</span><br><span class="line"><span class="keyword">int</span> hour = c.<span class="title function_ invoke__">get</span>(Calendar.HOUR_OF_DAY);</span><br><span class="line"><span class="keyword">int</span> min =  c.<span class="title function_ invoke__">get</span>(Calendar.MINUTE);</span><br><span class="line"><span class="keyword">int</span> second =  c.<span class="title function_ invoke__">get</span>(Calendar.SECOND);</span><br><span class="line">System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;当前时间为：&quot;</span> + year +<span class="string">&quot;-&quot;</span>+month+<span class="string">&quot;-&quot;</span>+day+<span class="string">&quot; &quot;</span>+ hour+<span class="string">&quot;:&quot;</span>+min+<span class="string">&quot;:&quot;</span>+second);</span><br><span class="line"></span><br><span class="line">执行结果：</span><br><span class="line">当前时间为：<span class="number">2018</span>-<span class="number">5</span>-<span class="number">29</span> <span class="number">17</span>:<span class="number">21</span>:<span class="number">20</span></span><br></pre></td></tr></table></figure>

<p>调用 Calendar 类的 getInstance() 方法获取一个实例，然后通过调用 get() 方法获取日期时间信息，参数为需要获得的字段的值， Calendar.YEAR 等为 Calendar 类中定义的静态常量。</p>
<p>Calendar类提供了getTime()方法，用来获取Date对象，完成Calendar和Date的转换，还可以通过getTimeInMillis()方法，获取此Calendar的时间值，以毫秒为单位。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 创建Calendar对象</span></span><br><span class="line">Calendar c = Calendar.<span class="title function_ invoke__">getInstance</span>();</span><br><span class="line"><span class="comment">// 将Calendar对象转换为Date对象</span></span><br><span class="line">Date date = c.<span class="title function_ invoke__">getTime</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建SimpleDateFormat对象，指定目标格式</span></span><br><span class="line">SimpleDateFormat sdf = <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将日期转换为指定格式的字符串</span></span><br><span class="line">String now = sdf.<span class="title function_ invoke__">format</span>(date);</span><br><span class="line"></span><br><span class="line">System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;当前时间：&quot;</span> + now);</span><br><span class="line"></span><br><span class="line">执行结果：</span><br><span class="line">当前时间：<span class="number">2018</span>-<span class="number">06</span>-<span class="number">29</span> <span class="number">17</span>:<span class="number">44</span>:<span class="number">41</span></span><br></pre></td></tr></table></figure>


<h3 id="Math类操作数据"><a href="#Math类操作数据" class="headerlink" title="Math类操作数据"></a>Math类操作数据</h3><p>Math类位于java.lang包中，包含用于执行基本数学运算的方法，Math类的所有的方法都是静态方法，所以使用该类中的方法时，可以直接使用类名.方法名。</p>
<p>常用的方法：</p>
<table>
<thead>
<tr>
<th align="left">方法名</th>
<th align="left">说明</th>
<th align="left">返回值</th>
</tr>
</thead>
<tbody><tr>
<td align="left">round</td>
<td align="left">返回四舍五入后的整数</td>
<td align="left">long</td>
</tr>
<tr>
<td align="left">floor</td>
<td align="left">返回小于参数的最大整数</td>
<td align="left">double</td>
</tr>
<tr>
<td align="left">ceil</td>
<td align="left">返回大于参数的最小整数</td>
<td align="left">double</td>
</tr>
<tr>
<td align="left">random</td>
<td align="left">返回[0，1）之前的随机数浮点数</td>
<td align="left">double</td>
</tr>
</tbody></table>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">package com.<span class="keyword">string</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MathTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="built_in">static</span> <span class="keyword">void</span> <span class="title function_ invoke__">main</span>(String[] args) &#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		MathTest test = <span class="keyword">new</span> <span class="title class_">MathTest</span>();</span><br><span class="line">		test.<span class="title function_ invoke__">MathRandomTest</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_ invoke__">MathRandomTest</span>() &#123;</span><br><span class="line">		<span class="keyword">int</span> nums[] = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">10</span>];</span><br><span class="line">		<span class="keyword">float</span> douStr = <span class="number">45.66</span>f;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;nums.length;i++) &#123;</span><br><span class="line">			nums[i] = (<span class="keyword">int</span>)(Math.<span class="title function_ invoke__">random</span>() * <span class="number">100</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> num:nums) &#123;</span><br><span class="line">			System.out.<span class="keyword">print</span>(num+<span class="string">&quot;-&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		System.out.<span class="title function_ invoke__">println</span>(Math.<span class="title function_ invoke__">ceil</span>(douStr));</span><br><span class="line">		System.out.<span class="title function_ invoke__">println</span>(Math.<span class="title function_ invoke__">floor</span>(douStr));</span><br><span class="line">		System.out.<span class="title function_ invoke__">println</span>(Math.<span class="title function_ invoke__">round</span>(douStr));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">执行结果：</span><br><span class="line">  <span class="number">44</span>-<span class="number">98</span>-<span class="number">49</span>-<span class="number">49</span>-<span class="number">94</span>-<span class="number">13</span>-<span class="number">64</span>-<span class="number">86</span>-<span class="number">72</span>-<span class="number">50</span>-</span><br><span class="line">  <span class="number">46.0</span></span><br><span class="line">  <span class="number">45.0</span></span><br><span class="line">  <span class="number">46</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>Java学习-part.07（集合框架Map-HashMap）</title>
    <url>/2018/05/25/Java%E5%AD%A6%E4%B9%A0-part-07%EF%BC%88%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6Map-HashMap%EF%BC%89/</url>
    <content><![CDATA[<h3 id="Map接口"><a href="#Map接口" class="headerlink" title="Map接口"></a>Map接口</h3><h4 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h4><ul>
<li>1、Map提供了一种映射的关系，其中的元素是以键值对（key-value）的形式存储的，能够实现根据key快速查找value。（类似于PHP中的关联数组）</li>
<li>2、Map中的键值对以Entry类型的对象实例形式存在</li>
<li>3、键（key值）不可重复，value值可以</li>
<li>4、每个键最多只能映射到一个值</li>
<li>5、Map接口提供了分别返回key值集合、value值集合以及Entry（键值对）集合的方法</li>
<li>6、Map支持泛型，形式如：Map&lt;K,V&gt;<span id="more"></span></li>
</ul>
<h4 id="HashMap"><a href="#HashMap" class="headerlink" title="HashMap"></a>HashMap</h4><ul>
<li>1、HashMap是Map的一个重要的实现类，也是最常用的，基于哈希表实现</li>
<li>2、HashMap中的Entry对象是无序排列的</li>
<li>3、Key值和value值都可以为null，但是一个HashMap只能有一个Key值为null的映射（key值不可重复）</li>
</ul>
<p>以下是HashMap使用的实例：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">package com.collection;</span><br><span class="line"></span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.Map;</span><br><span class="line">import java.util.Scanner;</span><br><span class="line">import java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Map的方式添加</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MapPutStudent</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> Map&lt;String,Student&gt; students;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="title function_ invoke__">MapPutStudent</span>() &#123;</span><br><span class="line">		this.students = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String,Student&gt;();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 通过输入得到的学生信息，添加到HashMap中</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_ invoke__">testPut</span>() &#123;</span><br><span class="line">		<span class="keyword">final</span> <span class="keyword">int</span> ADD_NUMS = <span class="number">3</span>;</span><br><span class="line">		<span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">while</span>(i&lt;ADD_NUMS) &#123;</span><br><span class="line">			System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;请输入学生ID：&quot;</span>);</span><br><span class="line">			Scanner input = <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">			String sid = input.<span class="title function_ invoke__">next</span>();</span><br><span class="line">			<span class="comment">//HashMap的key是不能重复的</span></span><br><span class="line">			<span class="keyword">if</span>(students.<span class="title function_ invoke__">get</span>(sid) == <span class="literal">null</span>) &#123;</span><br><span class="line">				System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;请输入学生姓名：&quot;</span>);</span><br><span class="line">				String name = input.<span class="title function_ invoke__">next</span>();</span><br><span class="line">				<span class="comment">//生成新的学生对象 (学生类：Student.java)</span></span><br><span class="line">				Student stuObj = <span class="keyword">new</span> <span class="title class_">Student</span>(sid,name);</span><br><span class="line">				<span class="comment">//添加到hashMap中</span></span><br><span class="line">				students.<span class="title function_ invoke__">put</span>(sid, stuObj);</span><br><span class="line">				i++;</span><br><span class="line">			&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">				System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;您输入的id已经存在了&quot;</span>);</span><br><span class="line">				<span class="keyword">continue</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 通过KeySet方法获取所有的key，然后通过key获得value的值</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_ invoke__">testKeySet</span>() &#123;</span><br><span class="line">		<span class="comment">//通过keySet方法返回key的集合</span></span><br><span class="line">		Set&lt;String&gt; keys = students.<span class="title function_ invoke__">keySet</span>();</span><br><span class="line">		System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;成功添加&quot;</span>+ keys.<span class="title function_ invoke__">size</span>() +<span class="string">&quot;个学生&quot;</span>);</span><br><span class="line">		<span class="comment">//遍历keys获得每一个key的值，然后通过key获取value值</span></span><br><span class="line">		<span class="keyword">for</span>(String key:keys) &#123;</span><br><span class="line">			Student st = this.students.<span class="title function_ invoke__">get</span>(key);</span><br><span class="line">			System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;学生：&quot;</span> + st.name);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="built_in">static</span> <span class="keyword">void</span> <span class="title function_ invoke__">main</span>(String[] args) &#123;</span><br><span class="line">		MapPutStudent mp = <span class="keyword">new</span> <span class="title class_">MapPutStudent</span>();</span><br><span class="line">		mp.<span class="title function_ invoke__">testPut</span>();</span><br><span class="line">		mp.<span class="title function_ invoke__">testKeySet</span>();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>删除HashMap操作实例：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 根据方法remove删除操作</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_ invoke__">testRemove</span>() &#123;</span><br><span class="line">		<span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">			System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;请输入需要删除的学生ID：&quot;</span>);</span><br><span class="line">			Scanner input = <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">			String id = input.<span class="title function_ invoke__">next</span>();</span><br><span class="line">			Student stu = students.<span class="title function_ invoke__">get</span>(id);</span><br><span class="line">			<span class="keyword">if</span>(stu == <span class="literal">null</span>) &#123;</span><br><span class="line">				System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;输入的id不存在&quot;</span>);</span><br><span class="line">				<span class="keyword">continue</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			students.<span class="title function_ invoke__">remove</span>(id);</span><br><span class="line">			System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;成功删除：&quot;</span> + stu.name);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>HashMap中的常用方法：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Map&lt;String,Student&gt; mp = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String,Student&gt;();</span><br><span class="line"></span><br><span class="line">mp.<span class="title function_ invoke__">put</span>(key,value);  <span class="comment">//添加值</span></span><br><span class="line">mp.<span class="title function_ invoke__">put</span>(key,value);  <span class="comment">//如果key存在，就是修改该值</span></span><br><span class="line">mp.<span class="title function_ invoke__">keySet</span>();       <span class="comment">//返回key集合</span></span><br><span class="line">mp.<span class="title function_ invoke__">entrySet</span>();     <span class="comment">//返回键值对集合</span></span><br><span class="line">mp.<span class="title function_ invoke__">remove</span>(key);    <span class="comment">//删除元素</span></span><br><span class="line">mp.<span class="title function_ invoke__">equals</span>();       <span class="comment">//等于</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>Java学习-part.06（集合框架collection-ArrayList、HashSet）</title>
    <url>/2018/05/25/Java%E5%AD%A6%E4%B9%A0-part-06%EF%BC%88%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6collection-ArrayList%E3%80%81HashSet%EF%BC%89/</url>
    <content><![CDATA[<h3 id="集合概述及作用"><a href="#集合概述及作用" class="headerlink" title="集合概述及作用"></a>集合概述及作用</h3><p>概念：</p>
<p>java中的集合类：是一种工具类，就像是容器，储存任意数量的具有共同属性的对象。</p>
<p>集合是重点。</p>
<p>集合的作用：</p>
<ul>
<li>在类的内部，对数据进行组织</li>
<li>简单而快速的搜索大数量的条数</li>
<li>有的集合接口，提供一系列排列有序的元素，并且可以在序列中间快速的插入或者删除有关元素</li>
<li>有的集合接口，提供了映射关系，可以通过关键字（key）去快速查找到对应的唯一对象，而这个关键字可以是任意类型<span id="more"></span></li>
</ul>
<h3 id="Java集合框架体系结构"><a href="#Java集合框架体系结构" class="headerlink" title="Java集合框架体系结构"></a>Java集合框架体系结构</h3><p><img src="/../img/collection.png" alt="java"></p>
<h3 id="Collection接口、子接口以及实现类"><a href="#Collection接口、子接口以及实现类" class="headerlink" title="Collection接口、子接口以及实现类"></a>Collection接口、子接口以及实现类</h3><h4 id="Collection接口"><a href="#Collection接口" class="headerlink" title="Collection接口"></a>Collection接口</h4><ul>
<li>是List、Set和Queue接口的父类接口</li>
<li>定义了可用于操作List、Set和Queue的方法–增删改查</li>
</ul>
<h4 id="List接口以及实现类-–-ArrayList-（有点类似PHP的索引数组）"><a href="#List接口以及实现类-–-ArrayList-（有点类似PHP的索引数组）" class="headerlink" title="List接口以及实现类 – ArrayList （有点类似PHP的索引数组）"></a>List接口以及实现类 – ArrayList （有点类似PHP的索引数组）</h4><ul>
<li>List是元素有序并且可以重复的集合，被称为序列</li>
<li>List可以精确的控制每个元素的插入的位置，或删除某个位置元素</li>
<li>ArrayList–数组序列，是List的一个重要实现类 ** (使用频率最高)</li>
<li>ArrayList底层是由数组实现的</li>
</ul>
<p>下面是一个课程类</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">package com.collection;</span><br><span class="line"></span><br><span class="line"><span class="comment">//课程类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Course</span> </span>&#123;</span><br><span class="line">	<span class="keyword">public</span> String id;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> String name;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="title function_ invoke__">Course</span>(String id, String name) &#123;</span><br><span class="line">		this.id = id;</span><br><span class="line">		this.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在List集合中加入课程类</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">package com.collection;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 往课程类里面添加课程</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ListCourse</span> </span>&#123;</span><br><span class="line">    <span class="comment">//添加课程</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_ invoke__">addCourse</span>() &#123;</span><br><span class="line">        List <span class="keyword">list</span>  = <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">        Course sc1 = <span class="keyword">new</span> <span class="title class_">Course</span>(<span class="string">&quot;1&quot;</span>,<span class="string">&quot;大学英语&quot;</span>);</span><br><span class="line">        <span class="keyword">list</span>.<span class="title function_ invoke__">add</span>(sc1);   <span class="comment">//添加在第一个位置，下标0处</span></span><br><span class="line">        Course tmp = (Course)<span class="keyword">list</span>.<span class="title function_ invoke__">get</span>(<span class="number">0</span>);</span><br><span class="line">        System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;加入的课程为：&quot;</span> + tmp.id + <span class="string">&quot;:&quot;</span> + tmp.name);</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        Course sc2 = <span class="keyword">new</span> <span class="title class_">Course</span>(<span class="string">&quot;2&quot;</span>,<span class="string">&quot;线性代数&quot;</span>);</span><br><span class="line">        <span class="keyword">list</span>.<span class="title function_ invoke__">add</span>(<span class="number">1</span>, sc2);    <span class="comment">//根据下标准确插入</span></span><br><span class="line">        Course tmp1 = (Course)<span class="keyword">list</span>.<span class="title function_ invoke__">get</span>(<span class="number">1</span>);</span><br><span class="line">        System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;加入的课程为：&quot;</span> + tmp1.id + <span class="string">&quot;:&quot;</span> + tmp1.name);</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">         <span class="comment">//这里会抛出数组下标越界的异常 ***</span></span><br><span class="line">        <span class="comment">//Course str3 = new Course(&quot;2&quot;,&quot;电子商务概论&quot;);</span></span><br><span class="line">        <span class="comment">//this.courseToSelect.add(5, str3);</span></span><br><span class="line">        </span><br><span class="line">         <span class="comment">//批量加入</span></span><br><span class="line">        Course[] courses = &#123;<span class="keyword">new</span> <span class="title class_">Course</span>(<span class="string">&quot;4&quot;</span>,<span class="string">&quot;毛概论&quot;</span>),<span class="keyword">new</span> <span class="title class_">Course</span>(<span class="string">&quot;5&quot;</span>,<span class="string">&quot;电子商务概论&quot;</span>)&#125;;</span><br><span class="line">        <span class="keyword">list</span>.<span class="title function_ invoke__">addAll</span>(Arrays.<span class="title function_ invoke__">asList</span>(courses)); <span class="comment">//批量加入，一定要用数组转成list</span></span><br><span class="line">        Course tmp3 = (Course)<span class="keyword">list</span>.<span class="title function_ invoke__">get</span>(<span class="number">2</span>);</span><br><span class="line">        Course tmp4 = (Course)<span class="keyword">list</span>.<span class="title function_ invoke__">get</span>(<span class="number">3</span>);<span class="number">900</span></span><br><span class="line">        </span><br><span class="line">        System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;加入的课程为：&quot;</span> + tmp3.id + <span class="string">&quot;:&quot;</span> + tmp3.name);</span><br><span class="line">        System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;加入的课程为：&quot;</span> + tmp4.id + <span class="string">&quot;:&quot;</span> + tmp4.name);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//执行结果 </span></span><br><span class="line"></span><br><span class="line">加入的课程为：<span class="number">1</span>:大学英语</span><br><span class="line">加入的课程为：<span class="number">2</span>:线性代数</span><br><span class="line">加入的课程为：<span class="number">4</span>:毛概论</span><br><span class="line">加入的课程为：<span class="number">5</span>:电子商务概论</span><br></pre></td></tr></table></figure>

<p>** list集合泛型的指定：（如果不指定类型，在取出数据的时候，需要按需进行类型强转）</p>
<p>List<Course> list &#x3D; new ArrayList<Course>(); &#x2F;&#x2F;放入的是课程对象<br>List<Object> list &#x3D; new ArrayList<Object>(); &#x2F;&#x2F;总类Object类，指定里面按只能放入对象<br>List<String> list &#x3D; new ArrayList<String>(); &#x2F;&#x2F;指定里面只能放入字符串</p>
<h4 id="常用的list方法："><a href="#常用的list方法：" class="headerlink" title="常用的list方法："></a>常用的list方法：</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">List <span class="keyword">list</span> = <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">list</span>.<span class="title function_ invoke__">add</span>(<span class="string">&quot;test&quot;</span>);   <span class="comment">//按序添加进集合</span></span><br><span class="line"><span class="keyword">list</span>.<span class="title function_ invoke__">add</span>(<span class="number">0</span>,<span class="string">&quot;test&quot;</span>); <span class="comment">//在指定位置添加进集合</span></span><br><span class="line"><span class="keyword">list</span>.<span class="title function_ invoke__">addAll</span>(<span class="keyword">list</span>);  <span class="comment">//向集合追加一个collection，只可追加collection，由于java不提供collection的实现，由它的下级list来实现接口</span></span><br><span class="line"><span class="keyword">list</span>.<span class="title function_ invoke__">addAll</span>(<span class="number">4</span>,<span class="keyword">list</span>); <span class="comment">//与上述含义相同， “4”意为追加元素所放的位置</span></span><br><span class="line"><span class="keyword">list</span>.<span class="title function_ invoke__">contains</span>(<span class="string">&quot;test&quot;</span>); <span class="comment">//判断集合里面是否包含某个元素，返回值boolean</span></span><br><span class="line"><span class="keyword">list</span>.<span class="title function_ invoke__">remove</span>(<span class="string">&quot;test&quot;</span>); <span class="comment">//删除集合中的某一个元素，参数可以是集合元素，也可以是元素下标</span></span><br><span class="line"><span class="keyword">list</span>.<span class="title function_ invoke__">set</span>(<span class="keyword">int</span> index,Object obj); <span class="comment">//将集合中指定的索引位置的对象修改为指定的对象</span></span><br><span class="line"><span class="keyword">list</span>.<span class="title function_ invoke__">get</span>(<span class="keyword">int</span> index); <span class="comment">//获得集合中指定位置的对象</span></span><br><span class="line"><span class="keyword">list</span>.<span class="title function_ invoke__">size</span>();         <span class="comment">//获得集合的长度</span></span><br><span class="line"><span class="keyword">list</span>.<span class="title function_ invoke__">isEmpty</span>();      <span class="comment">//判断集合是否为空，返回值boolean</span></span><br></pre></td></tr></table></figure>

<p>(更多方法参考java api文档)</p>
<h4 id="List集合的遍历方式"><a href="#List集合的遍历方式" class="headerlink" title="List集合的遍历方式"></a>List集合的遍历方式</h4><p>1、for循环遍历</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * for循环遍历</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> list</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_ invoke__">getListValue</span>(List&lt;Course&gt; <span class="keyword">list</span>) &#123;</span><br><span class="line">    		<span class="keyword">int</span> size = <span class="keyword">list</span>.<span class="title function_ invoke__">size</span>();</span><br><span class="line">    		System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;课程列表为&quot;</span>);</span><br><span class="line">    		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;size;i++) &#123;</span><br><span class="line">    			Course tmp = <span class="keyword">list</span>.<span class="title function_ invoke__">get</span>(i);</span><br><span class="line">    			System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;课程：&quot;</span> + <span class="string">&quot;下标为：&quot;</span> + i +<span class="string">&quot;-&gt;&quot;</span> + tmp.id + <span class="string">&quot;:&quot;</span> + tmp.name);</span><br><span class="line">    		&#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>2、迭代器方式遍历</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 迭代器的方式遍历</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> list</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_ invoke__">getList</span>(List&lt;Course&gt; <span class="keyword">list</span>) &#123;</span><br><span class="line">   		<span class="built_in">Iterator</span>&lt;Course&gt; it = <span class="keyword">list</span>.<span class="title function_ invoke__">iterator</span>();</span><br><span class="line">   		System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;迭代器的方式课程列表为&quot;</span>);</span><br><span class="line">   		<span class="keyword">while</span>(it.<span class="title function_ invoke__">hasNext</span>()) &#123;</span><br><span class="line">   			Course tmp = it.<span class="title function_ invoke__">next</span>();</span><br><span class="line">   			System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;课程：&quot;</span> + <span class="string">&quot;下标为：&quot;</span>  + tmp.id + <span class="string">&quot;:&quot;</span> + tmp.name);</span><br><span class="line">   		&#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>3、for each的方式遍历</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * for each的方式遍历</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> list</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_ invoke__">getForEach</span>(List&lt;Course&gt; <span class="keyword">list</span>) &#123;</span><br><span class="line">    		System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;for each的方式课程列表为&quot;</span>);</span><br><span class="line">    		<span class="keyword">for</span>(Course lt : <span class="keyword">list</span>) &#123;</span><br><span class="line">    			System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;课程：&quot;</span> + <span class="string">&quot;下标为：&quot;</span>  + lt.id + <span class="string">&quot;:&quot;</span> + lt.name);</span><br><span class="line">    		&#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>


<h4 id="泛型"><a href="#泛型" class="headerlink" title="泛型"></a>泛型</h4><p>集合中的元素，可以使任意类型的对象（对象的引用）</p>
<ul>
<li>如果把某个对象放入集合，则会忽略他的类型</li>
<li>而把他当做Object来处理</li>
</ul>
<p>泛型则是规定了某个集合只可以存放特定类型的对象</p>
<ul>
<li>会在编译期间进行类型检查</li>
<li>可以直接按指定类型获取集合元素</li>
<li>** 泛型集合中，不能添加泛型规定的类型及其子类型以外的对象，否则会报错！</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//只可以存放指定的类型</span></span><br><span class="line">List&lt;String&gt; <span class="keyword">list</span> = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();</span><br><span class="line"></span><br><span class="line">List&lt;Course&gt; courses = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Course&gt;();</span><br><span class="line"></span><br><span class="line">List&lt;Object&gt; obj = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Object&gt;();</span><br></pre></td></tr></table></figure>

<p>泛型不能使用基本类型，如果必须要用基本类型，请使用包装类</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">  <span class="comment">//泛型不能使用基本类型，如果必须要用基本类型，请使用`包装类`</span></span><br><span class="line">List&lt;Integer&gt; <span class="keyword">list</span> = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Integer&gt;();</span><br><span class="line"><span class="keyword">list</span>.<span class="title function_ invoke__">add</span>(<span class="number">12</span>);</span><br><span class="line"><span class="keyword">int</span> tmp = <span class="keyword">list</span>.<span class="title function_ invoke__">get</span>(<span class="number">0</span>);</span><br><span class="line">	</span><br><span class="line">System.out.<span class="title function_ invoke__">println</span>(tmp);</span><br></pre></td></tr></table></figure>


<h4 id="Set接口及其实现类-–-HashSet"><a href="#Set接口及其实现类-–-HashSet" class="headerlink" title="Set接口及其实现类 – HashSet"></a>Set接口及其实现类 – HashSet</h4><ul>
<li>Set是元素无序并且不可以重复的集合，被称为集</li>
<li>HashSet–哈希集，是Set的一个重要实现类</li>
</ul>
<p>下面展示的是一个学生选课的实例：</p>
<p>Course.java</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">package com.collection;</span><br><span class="line"></span><br><span class="line"><span class="comment">//课程类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Course</span> </span>&#123;</span><br><span class="line">	<span class="keyword">public</span> String id;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> String name;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="title function_ invoke__">Course</span>(String id, String name) &#123;</span><br><span class="line">		this.id = id;</span><br><span class="line">		this.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Student.java</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">package com.collection;</span><br><span class="line">import java.util.Set;</span><br><span class="line">import java.util.HashSet;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 学生类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> String id;   <span class="comment">//学生id</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> String name; <span class="comment">//学生name</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> Set&lt;Course&gt; courses; <span class="comment">//学生选课集合</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="title function_ invoke__">Student</span>(String id, String name) &#123;</span><br><span class="line">		this.id = id;</span><br><span class="line">		this.name = name;</span><br><span class="line">		this.courses = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;Course&gt;();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>StudentSelect.java</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">package com.collection;</span><br><span class="line"></span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.Arrays;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentSelect</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> List&lt;Course&gt; courseToSelect;    <span class="comment">//备选课程     </span></span><br><span class="line">	<span class="keyword">final</span> <span class="keyword">int</span> SELECT_NUM = <span class="number">3</span>;    	      <span class="comment">//选课门数</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * main</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> args</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">static</span> <span class="keyword">void</span> <span class="title function_ invoke__">main</span>(String[] args) &#123;</span><br><span class="line">    StudentSelect ss = <span class="keyword">new</span> <span class="title class_">StudentSelect</span>();</span><br><span class="line">    ss.<span class="title function_ invoke__">addCourse</span>();</span><br><span class="line">    Student st = <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;1&quot;</span>,<span class="string">&quot;小明&quot;</span>);</span><br><span class="line">    System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;欢迎学生&quot;</span> + st.name + <span class="string">&quot;选课！&quot;</span>);</span><br><span class="line">    <span class="comment">//每个学生选三门</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i&lt; ss.SELECT_NUM;i++) &#123;  </span><br><span class="line">        System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;请选择第&quot;</span>+ (i+<span class="number">1</span>) +<span class="string">&quot;门课程的ID：&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        Scanner input = <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        String inputNum = input.<span class="title function_ invoke__">next</span>();</span><br><span class="line">        <span class="keyword">for</span>(Course tmp : ss.courseToSelect) &#123;</span><br><span class="line">            <span class="comment">//备选课程的id与输入的id一致就加入到学生的课程里面</span></span><br><span class="line">            <span class="keyword">if</span>(tmp.id.<span class="title function_ invoke__">equals</span>(inputNum)) &#123;</span><br><span class="line">                st.courses.<span class="title function_ invoke__">add</span>(tmp);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//遍历已选课程列表</span></span><br><span class="line">    System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;已选课程为：&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span>(Course kc : st.courses) &#123;</span><br><span class="line">        System.out.<span class="title function_ invoke__">println</span>(kc.id + <span class="string">&quot;:&quot;</span> + kc.name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">	</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 添加课程并输出备选课程</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_ invoke__">addCourse</span>() &#123;</span><br><span class="line">        this.courseToSelect = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Course&gt;();</span><br><span class="line">    Course sc1 = <span class="keyword">new</span> <span class="title class_">Course</span>(<span class="string">&quot;1&quot;</span>,<span class="string">&quot;大学英语&quot;</span>);</span><br><span class="line">    courseToSelect.<span class="title function_ invoke__">add</span>(sc1);</span><br><span class="line">    Course sc2 = <span class="keyword">new</span> <span class="title class_">Course</span>(<span class="string">&quot;2&quot;</span>,<span class="string">&quot;线性代数&quot;</span>);</span><br><span class="line">    courseToSelect.<span class="title function_ invoke__">add</span>(<span class="number">1</span>, sc2);</span><br><span class="line">    <span class="comment">//批量加入</span></span><br><span class="line">    Course[] courses = &#123;<span class="keyword">new</span> <span class="title class_">Course</span>(<span class="string">&quot;4&quot;</span>,<span class="string">&quot;毛概论&quot;</span>),<span class="keyword">new</span> <span class="title class_">Course</span>(<span class="string">&quot;5&quot;</span>,<span class="string">&quot;电子商务概论&quot;</span>)&#125;;</span><br><span class="line">    courseToSelect.<span class="title function_ invoke__">addAll</span>(Arrays.<span class="title function_ invoke__">asList</span>(courses));  <span class="comment">//不指定下标的addAll</span></span><br><span class="line">    <span class="comment">//批量添加</span></span><br><span class="line">    Course[] tmps = &#123;<span class="keyword">new</span> <span class="title class_">Course</span>(<span class="string">&quot;6&quot;</span>,<span class="string">&quot;统计学&quot;</span>),<span class="keyword">new</span> <span class="title class_">Course</span>(<span class="string">&quot;7&quot;</span>,<span class="string">&quot;计算机科学与技术&quot;</span>),<span class="keyword">new</span> <span class="title class_">Course</span>(<span class="string">&quot;8&quot;</span>,<span class="string">&quot;C语言&quot;</span>)&#125;;</span><br><span class="line">    courseToSelect.<span class="title function_ invoke__">addAll</span>(Arrays.<span class="title function_ invoke__">asList</span>(tmps));</span><br><span class="line">   <span class="comment">//输出备选课程</span></span><br><span class="line">    System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;备选课程为：&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span>(Course cr : courseToSelect) &#123;</span><br><span class="line">            System.out.<span class="title function_ invoke__">println</span>(cr.id + <span class="string">&quot;:&quot;</span> + cr.name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">运行结果：</span><br><span class="line"></span><br><span class="line">备选课程为：</span><br><span class="line"><span class="number">1</span>:大学英语</span><br><span class="line"><span class="number">2</span>:线性代数</span><br><span class="line"><span class="number">4</span>:毛概论</span><br><span class="line"><span class="number">5</span>:电子商务概论</span><br><span class="line"><span class="number">6</span>:统计学</span><br><span class="line"><span class="number">7</span>:计算机科学与技术</span><br><span class="line"><span class="number">8</span>:C语言</span><br><span class="line">欢迎学生小明选课！</span><br><span class="line">请选择第<span class="number">1</span>门课程的ID：</span><br><span class="line"><span class="number">1</span></span><br><span class="line">请选择第<span class="number">2</span>门课程的ID：</span><br><span class="line"><span class="number">7</span></span><br><span class="line">请选择第<span class="number">3</span>门课程的ID：</span><br><span class="line"><span class="number">8</span></span><br><span class="line">已选课程为：</span><br><span class="line"><span class="number">1</span>:大学英语</span><br><span class="line"><span class="number">8</span>:C语言</span><br><span class="line"><span class="number">7</span>:计算机科学与技术</span><br></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>Jquery Ajax实例</title>
    <url>/2018/04/06/Jquery-Ajax%E5%AE%9E%E4%BE%8B/</url>
    <content><![CDATA[<blockquote>
<p>Jquery在异步提交方面封装的很好，直接用AJAX非常麻烦，Jquery大大简化了我们的操作，不用考虑浏览器的诧异了。<br>推荐一篇不错的jQuery Ajax 实例文章，忘记了可以去看看，地址为：<a href="http://www.cnblogs.com/yeer/archive/2009/07/23/1529460.html">http://www.cnblogs.com/yeer/archive/2009/07/23/1529460.html</a> 和 <a href="http://www.w3school.com.cn/jquery/">http://www.w3school.com.cn/jquery/</a></p>
</blockquote>
<p>我们常用的一些$.post、$.get只是一些简单的、便捷的使用方法，如果要处理复杂的逻辑，还是需要用到jQuery.ajax()。因为jQuery.ajax()有它自身的处理机制，对于数据类型、cache、请求方式、返回处理等有详细的处理方式。</p>
<span id="more"></span>
<h3 id="ajax的一般格式"><a href="#ajax的一般格式" class="headerlink" title="$.ajax的一般格式"></a>$.ajax的一般格式</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$.<span class="title function_ invoke__">ajax</span>(&#123;</span><br><span class="line">     <span class="attr">type</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">     <span class="attr">url</span>: url ,</span><br><span class="line">    <span class="attr">data</span>: data ,</span><br><span class="line">    <span class="attr">success</span>: success ,</span><br><span class="line">    <span class="attr">dataType</span>: dataType</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="ajax的参数描述"><a href="#ajax的参数描述" class="headerlink" title="$.ajax的参数描述:"></a>$.ajax的参数描述:</h4><ul>
<li>url 必需。规定把请求发送到哪个 URL。</li>
<li>data 可选。映射或字符串值。规定连同请求发送到服务器的数据。</li>
<li>success (data, textStatus, jqXHR) 可选。请求成功时执行的回调函数。</li>
<li>dataType 可选。规定预期的服务器响应的数据类型。 （xml、html、script、json、jsonp、text）</li>
<li>cache(cacheBoolean) 可选。jQuery 1.2 新功能，设置为 false 将不缓存此页面。</li>
<li>contents 配对的对象，用来确定jQuery将如何解析响应，给定其内容类型。</li>
</ul>
<h3 id="回调函数"><a href="#回调函数" class="headerlink" title="回调函数"></a>回调函数</h3><p>如果要处理$.ajax()得到的数据，则需要使用回调函数。beforeSend、error、dataFilter、success、complete。</p>
<ul>
<li>beforeSend 在发送请求之前调用，并且传入一个XMLHttpRequest作为参数。</li>
<li>error 在请求出错时调用。传入XMLHttpRequest对象，描述错误类型的字符串以及一个异常对象（如果有的话）</li>
<li>dataFilter 在请求成功之后调用。传入返回的数据以及”dataType”参数的值。并且必须返回新的数据（可能是处理过的）传递给success回调函数。</li>
<li>success 当请求之后调用。传入返回后的数据，以及包含成功代码的字符串。</li>
<li>complete 当请求完成之后调用这个函数，无论成功或失败。传入XMLHttpRequest对象，以及一个包含成功或错误代码的字符串。</li>
</ul>
<h3 id="ajax需要注意的一些地方"><a href="#ajax需要注意的一些地方" class="headerlink" title="$.ajax需要注意的一些地方"></a>$.ajax需要注意的一些地方</h3><ul>
<li>data主要方式有三种，html拼接的，json数组，form表单经serialize()序列化的；通过dataType指定，不指定智能判断</li>
<li>$.ajax只提交form以文本方式，如果异步提交包含上传是传过不过去,需要使用jquery.form.js的$.ajaxSubmit</li>
</ul>
<h3 id="ajax我的实际应用例子"><a href="#ajax我的实际应用例子" class="headerlink" title="$.ajax我的实际应用例子"></a>$.ajax我的实际应用例子</h3><h4 id="1、-ajax带json数据的异步请求"><a href="#1、-ajax带json数据的异步请求" class="headerlink" title="1、$.ajax带json数据的异步请求"></a>1、$.ajax带json数据的异步请求</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> aj = $.<span class="title function_ invoke__">ajax</span>( &#123;  </span><br><span class="line">      <span class="attr">url</span>:<span class="string">&#x27;productManager_reverseUpdate&#x27;</span>,// 跳转到 action  </span><br><span class="line">      <span class="attr">data</span>:&#123;  </span><br><span class="line">              selRollBack : selRollBack,  </span><br><span class="line">              selOperatorsCode : selOperatorsCode,  </span><br><span class="line">              PROVINCECODE : PROVINCECODE,  </span><br><span class="line">               pass2 : pass2  </span><br><span class="line">      &#125;,  </span><br><span class="line">     <span class="attr">type</span>:<span class="string">&#x27;post&#x27;</span>,  </span><br><span class="line">     <span class="attr">cache</span>:<span class="literal">false</span>,  </span><br><span class="line">     <span class="attr">dataType</span>:<span class="string">&#x27;json&#x27;</span>,  </span><br><span class="line">     <span class="attr">success</span>:function(data) &#123;  </span><br><span class="line">         <span class="keyword">if</span>(data.msg ==<span class="string">&quot;true&quot;</span> )&#123;  </span><br><span class="line">             <span class="comment">// view(&quot;修改成功！&quot;);  </span></span><br><span class="line">             <span class="title function_ invoke__">alert</span>(<span class="string">&quot;修改成功！&quot;</span>);  </span><br><span class="line">             window.location.<span class="title function_ invoke__">reload</span>();  </span><br><span class="line">         &#125;<span class="keyword">else</span>&#123;  </span><br><span class="line">             <span class="title function_ invoke__">view</span>(data.msg);  </span><br><span class="line">         &#125;  </span><br><span class="line">      &#125;,  </span><br><span class="line">      error : <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;  </span><br><span class="line">           <span class="comment">// view(&quot;异常！&quot;);  </span></span><br><span class="line">           <span class="title function_ invoke__">alert</span>(<span class="string">&quot;异常！&quot;</span>);  </span><br><span class="line">      &#125;  </span><br><span class="line"> &#125;);</span><br></pre></td></tr></table></figure>

<h4 id="2、-ajax序列化表格内容为字符串的异步请求"><a href="#2、-ajax序列化表格内容为字符串的异步请求" class="headerlink" title="2、$.ajax序列化表格内容为字符串的异步请求"></a>2、$.ajax序列化表格内容为字符串的异步请求</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">noTips</span>(<span class="params"></span>)</span>&#123;  </span><br><span class="line">     <span class="keyword">var</span> formParam = $(<span class="string">&quot;#form1&quot;</span>).<span class="title function_ invoke__">serialize</span>();<span class="comment">//序列化表格内容为字符串  </span></span><br><span class="line">     $.<span class="title function_ invoke__">ajax</span>(&#123;  </span><br><span class="line">         <span class="attr">type</span>:<span class="string">&#x27;post&#x27;</span>,      </span><br><span class="line">         <span class="attr">url</span>:<span class="string">&#x27;Notice_noTipsNotice&#x27;</span>,  </span><br><span class="line">         <span class="attr">data</span>:formParam,  </span><br><span class="line">         <span class="attr">cache</span>:<span class="literal">false</span>,  </span><br><span class="line">         <span class="attr">dataType</span>:<span class="string">&#x27;json&#x27;</span>,  </span><br><span class="line">         <span class="attr">success</span>:function(data)&#123;  </span><br><span class="line">         &#125;  </span><br><span class="line">     &#125;);  </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h4 id="3、-ajax拼接url的异步请求"><a href="#3、-ajax拼接url的异步请求" class="headerlink" title="3、$.ajax拼接url的异步请求"></a>3、$.ajax拼接url的异步请求</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> yz=$.<span class="title function_ invoke__">ajax</span>(&#123;  </span><br><span class="line">      <span class="attr">type</span>:<span class="string">&#x27;post&#x27;</span>,  </span><br><span class="line">      <span class="attr">url</span>:<span class="string">&#x27;validatePwd2_checkPwd2?password2=&#x27;</span>+password2,  </span><br><span class="line">      <span class="attr">data</span>:&#123;&#125;,  </span><br><span class="line">      <span class="attr">cache</span>:<span class="literal">false</span>,  </span><br><span class="line">      <span class="attr">dataType</span>:<span class="string">&#x27;json&#x27;</span>,  </span><br><span class="line">      <span class="attr">success</span>:function(data)&#123;  </span><br><span class="line">           <span class="keyword">if</span>( data.msg ==<span class="string">&quot;false&quot;</span> ) <span class="comment">//服务器返回false，就将validatePassword2的值改为pwd2Error，这是异步，需要考虑返回时间  </span></span><br><span class="line">           &#123;  </span><br><span class="line">                textPassword2.<span class="title function_ invoke__">html</span>(<span class="string">&quot;&lt;font color=&#x27;red&#x27;&gt;业务密码不正确！&lt;/font&gt;&quot;</span>);  </span><br><span class="line">                $(<span class="string">&quot;#validatePassword2&quot;</span>).<span class="title function_ invoke__">val</span>(<span class="string">&quot;pwd2Error&quot;</span>);  </span><br><span class="line">                checkPassword2 = <span class="literal">false</span>;  </span><br><span class="line">                <span class="keyword">return</span>;  </span><br><span class="line">            &#125;  </span><br><span class="line">       &#125;,  </span><br><span class="line">       error:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;  </span><br><span class="line"> &#125;);</span><br></pre></td></tr></table></figure>

<h4 id="ajax拼接data的异步请求"><a href="#ajax拼接data的异步请求" class="headerlink" title="$.ajax拼接data的异步请求"></a>$.ajax拼接data的异步请求</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$.<span class="title function_ invoke__">ajax</span>(&#123;   </span><br><span class="line">     <span class="attr">url</span>:<span class="string">&#x27;&lt;%=request.getContextPath()%&gt;/kc/kc_checkMerNameUnique.action&#x27;</span>,   </span><br><span class="line">     <span class="attr">type</span>:<span class="string">&#x27;post&#x27;</span>,   </span><br><span class="line">     <span class="attr">data</span>:<span class="string">&#x27;merName=&#x27;</span>+values,   </span><br><span class="line">     async : <span class="literal">false</span>, //默认为<span class="literal">true</span> 异步   </span><br><span class="line">     <span class="attr">error</span>:function()&#123;   </span><br><span class="line">        <span class="title function_ invoke__">alert</span>(<span class="string">&#x27;error&#x27;</span>);   </span><br><span class="line">     &#125;,   </span><br><span class="line">     success:<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;   </span><br><span class="line">        $(<span class="string">&quot;#&quot;</span>+divs).<span class="title function_ invoke__">html</span>(data);   </span><br><span class="line">     &#125;</span><br><span class="line"> &#125;);</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>javascript</category>
      </categories>
      <tags>
        <tag>javascript</tag>
      </tags>
  </entry>
  <entry>
    <title>Java框架项目互调案例</title>
    <url>/2018/10/17/Java%E6%A1%86%E6%9E%B6%E9%A1%B9%E7%9B%AE%E4%BA%92%E8%B0%83%E6%A1%88%E4%BE%8B/</url>
    <content><![CDATA[<blockquote>
<p>学习java有这么一段时间了，在这段时间明显的感觉到了PHP与java的区别所在，从直观的感受来说同一个功能点java的代码量大于PHP很多，而且全程都是面向对象、设计模式，层次感、逻辑感非常的清楚，规范性的东西很多而且非常严格，request和response都是对象的形式，不再像PHP有单属性的出入参</p>
</blockquote>
<blockquote>
<p>本篇文章主要记录的是java之间互相调用下的处理场景以及java在写api时的整个流程以及生命周期，本篇文章很可能不是一篇文章，更多是作为自己对学习java漫漫长路上的一次记录而已，欢迎指正！</p>
</blockquote>
<h3 id="业务需求"><a href="#业务需求" class="headerlink" title="业务需求"></a>业务需求</h3><p>现目前对所有项目中关于客户的隐私信息及其关注，因此我们需要对每次查看客户隐私信息的用户进行日志记录。</p>
<span id="more"></span>
<h3 id="业务方POM依赖"><a href="#业务方POM依赖" class="headerlink" title="业务方POM依赖"></a>业务方POM依赖</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;groupId&gt;com.xxx.monitor&lt;/groupId&gt;</span><br><span class="line"></span><br><span class="line">&lt;artifactId&gt;java-xxx-monitor-api&lt;/artifactId&gt;</span><br><span class="line"></span><br><span class="line">&lt;version&gt;<span class="number">1.0</span>.<span class="number">0</span>-SNAPSHOT&lt;/version&gt;</span><br><span class="line"></span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<h3 id="接口方法"><a href="#接口方法" class="headerlink" title="接口方法"></a>接口方法</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">ItemResult&lt;Boolean&gt; <span class="title function_ invoke__">addMonitorLog</span>(Request&lt;MonitorLogFormDTO&gt; request)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>接口 ：com.xxx.monitor.api.service.IMonitorService</p>
<h3 id="依赖配置"><a href="#依赖配置" class="headerlink" title="依赖配置"></a>依赖配置</h3><h4 id="dubbo中主pom的依赖配置-父pom"><a href="#dubbo中主pom的依赖配置-父pom" class="headerlink" title="dubbo中主pom的依赖配置 (父pom)"></a>dubbo中主pom的依赖配置 (父pom)</h4><p>地址：java-xxx-agent-dubbo&#x2F;pom.xml</p>
<p>properties标签下配置</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;java-xxx-monitor-api.version&gt;<span class="number">1.0</span>.<span class="number">0</span>-SNAPSHOT&lt;/java-xxx-monitor-api.version&gt;</span><br></pre></td></tr></table></figure>


<p>dependencies标签下配置</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;!-- xxx monitor --&gt;</span><br><span class="line">   &lt;dependency&gt;</span><br><span class="line">       &lt;groupId&gt;com.xxx.monitor&lt;/groupId&gt;</span><br><span class="line">       &lt;artifactId&gt;java-xxx-monitor-api&lt;/artifactId&gt;</span><br><span class="line">       &lt;version&gt;$&#123;java-xxx-monitor-api.version&#125;&lt;/version&gt;</span><br><span class="line">   &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>


<h4 id="dubbo-intergrate中pom的依赖配置"><a href="#dubbo-intergrate中pom的依赖配置" class="headerlink" title="dubbo-intergrate中pom的依赖配置"></a>dubbo-intergrate中pom的依赖配置</h4><p>地址：java-xxx-agent-dubbo&#x2F;xxx-agent-dubbo-intergrate&#x2F;pom.xml</p>
<p>dependencies标签下配置：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;!-- xxx monitor --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.xxx.monitor&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;java-xxx-monitor-api&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>


<h3 id="消费者配置"><a href="#消费者配置" class="headerlink" title="消费者配置"></a>消费者配置</h3><h4 id="dubbo-web中的消费者配置"><a href="#dubbo-web中的消费者配置" class="headerlink" title="dubbo-web中的消费者配置"></a>dubbo-web中的消费者配置</h4><p>在java-xxx-agent-dubbo&#x2F;xxx-agent-dubbo-web&#x2F;src&#x2F;main&#x2F;resources&#x2F;dubbo下的dubbo-consumer.xml文件中添加消费者信息。</p>
<p>id为定义的属性名称</p>
<p>interface为业务方jar包地址</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;dubbo:reference id=<span class="string">&quot;iMonitoLogService&quot;</span> <span class="class"><span class="keyword">interface</span>=&quot;<span class="title">com</span>.<span class="title">ipr</span>.<span class="title">monitor</span>.<span class="title">api</span>.<span class="title">service</span>.<span class="title">IMonitoLogService</span>&quot; <span class="title">check</span>=&quot;<span class="title">false</span>&quot;/&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="dubbo-test中的消费者配置"><a href="#dubbo-test中的消费者配置" class="headerlink" title="dubbo-test中的消费者配置"></a>dubbo-test中的消费者配置</h4><p>在java-xxx-agent-dubbo&#x2F;xxx-agent-dubbo-test&#x2F;src&#x2F;test&#x2F;resources&#x2F;dubbo下的dubbo-consumer-test.xml文件中添加消费者信息，该配置主要是用于单元测试中使用。</p>
<p>id为定义的属性名称</p>
<p>interface为业务方jar包地址</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;dubbo:reference id=<span class="string">&quot;iMonitoLogService&quot;</span> <span class="class"><span class="keyword">interface</span>=&quot;<span class="title">com</span>.<span class="title">ipr</span>.<span class="title">monitor</span>.<span class="title">api</span>.<span class="title">service</span>.<span class="title">IMonitoLogService</span>&quot; <span class="title">check</span>=&quot;<span class="title">false</span>&quot;/&gt;</span></span><br></pre></td></tr></table></figure>


<h3 id="层次逻辑"><a href="#层次逻辑" class="headerlink" title="层次逻辑"></a>层次逻辑</h3><p>层次逻辑以一张流程图来表述</p>
<p><img src="/../img/liucheng.png" alt="java"></p>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>Java spring实战迭代流程（本公司架构）</title>
    <url>/2018/10/30/Java%E5%AE%9E%E6%88%98%E8%BF%AD%E4%BB%A3%E6%B5%81%E7%A8%8B%EF%BC%88%E6%9C%AC%E5%85%AC%E5%8F%B8%E6%9E%B6%E6%9E%84%EF%BC%89/</url>
    <content><![CDATA[<p>Spring是目前java SE还是还是EE都是最主流的框架，强大的IOC（反转控制）和AOP（面向切面编程）成了Spring的核心板块，同时提供了展示层Spring MVC、持久层Spring JDBC以及业务层事务管理等众多的企业级应用技术;本篇文章介绍的流程不仅仅是基于Spring的基础架构，而是公司在Spring的基础架构上做了大量的封装和融入了大量的技术沉淀后优化的内部框架，前面讲到java比php更有层次感，本篇文章将体现得更加明显。</p>
<h3 id="结构介绍"><a href="#结构介绍" class="headerlink" title="结构介绍"></a>结构介绍</h3><p><img src="/../img/mulu_show.png" alt="java"></p>
<p>以上目录机构为分层之后的企业级内部架构，各个层级间的关系以及功能作用都是相辅相成的关系</p>
<ul>
<li><p>api：指向外部接口的接口层，主要功能在于为外部业务线提供功能接口，同时里面包含两大数据DTO，Request和Response，分别可以指定接口的入参和返回值。</p>
</li>
<li><p>dubbo：包含展示层Spring MVC、持久层Spring JDBC、逻辑处理以及业务事务管理。</p>
</li>
<li><p>-biz：逻辑处理层</p>
</li>
<li><p>-common：公共bean存放的地方，通常含有枚举bean以及公共处理方法等。</p>
</li>
<li><p>-dao：数据处理层，里面常常包含JDBC、Mybaitis等数据库处理。里面会与数据表对应生成对应的mapper处理器和数据返回DO数据包，mapper里面含有数据表基本的数据增删改查处理方法供使用。</p>
<span id="more"></span>
<p><img src="/../img/data-config.png" alt="java"></p>
</li>
<li><p>-intergrate：外部接口接入，在接入外部项目的时候需在以下pom.xml中和外部dubbo对应的pom.xml中配置依赖。</p>
</li>
<li><p>-service:服务处理层,本架构中里面包含有处理回调（callback）、service和定时任务（task）。</p>
</li>
<li><p>-test：单元测试层。</p>
</li>
<li><p>-web：项目配置层，里面包含applicationContext、servlet、dubbo-comsumer、dubbo-provider、data-source、mybatis-config等这些配置。</p>
</li>
</ul>
<h3 id="开发流程"><a href="#开发流程" class="headerlink" title="开发流程"></a>开发流程</h3><h4 id="mapper的生成"><a href="#mapper的生成" class="headerlink" title="mapper的生成"></a>mapper的生成</h4><p>数据表新建之后，必然要在mapper中生成对应的dao层处理器，数据库的操作体系是基于mybatis来的，生成后的mapper里面含有基础的数据库操作方法供使用，如若复杂的sql查询需自行添加mapper方法以及对应的mapper中xml配置的sql语句即可；类似于php中的Model，基于ORM提供了大量的数据库操作方法供使用。</p>
<p>mapper配置地址：</p>
<p>java-xxx-agent-dubbo-dao&#x2F;src&#x2F;test&#x2F;resources&#x2F;generator&#x2F;generatorConfig.xml</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> &lt;table tableName=<span class="string">&quot;bja_activity_chance&quot;</span> domainObjectName=<span class="string">&quot;ActivityChance&quot;</span>&gt;</span><br><span class="line">    &lt;!--生成createGuid时加此属性--&gt;</span><br><span class="line">    &lt;property name=<span class="string">&quot;generateGuid&quot;</span> value=<span class="string">&quot;false&quot;</span>/&gt;</span><br><span class="line">&lt;/table&gt;</span><br></pre></td></tr></table></figure>

<p>生成地址：</p>
<p>java-xxx-agent-dubbo&#x2F;xxx-agent-dubbo-dao&#x2F;src&#x2F;test&#x2F;java&#x2F;com&#x2F;xxx&#x2F;agent&#x2F;generator&#x2F;Generator.java</p>
<p>先配置参数，再执行生成。</p>
<h4 id="枚举编写"><a href="#枚举编写" class="headerlink" title="枚举编写"></a>枚举编写</h4><p>如若业务中需要涉及到枚举的地方，需要在common中添加对应的枚举。</p>
<h4 id="编写biz"><a href="#编写biz" class="headerlink" title="编写biz"></a>编写biz</h4><p>biz层是比较重要的一个层级，里面包含逻辑及业务处理，它的调用方通常是dao层和intergrate层，它的被调方通常是service层。</p>
<h4 id="编写intergrate"><a href="#编写intergrate" class="headerlink" title="编写intergrate"></a>编写intergrate</h4><p>如若有外部项目接口接入才需要涉及到这个层，上一篇博客已有详细说明。</p>
<h4 id="编写service"><a href="#编写service" class="headerlink" title="编写service"></a>编写service</h4><p>编写服务层，主要实现的是api中的interface，它的调用方通常是biz层。</p>
<h4 id="编写api"><a href="#编写api" class="headerlink" title="编写api"></a>编写api</h4><p>api里面将规划对外的接口，包含Request和Response，分别制定入参和返回值方案。</p>
<h4 id="单元测试"><a href="#单元测试" class="headerlink" title="单元测试"></a>单元测试</h4><p>写完接口需要在test中实现单元测试，以保证接口的畅通性。</p>
<h3 id="服务添加提供者"><a href="#服务添加提供者" class="headerlink" title="服务添加提供者"></a>服务添加提供者</h3><p>路径：</p>
<p>java-xxx-agent-dubbo&#x2F;xxx-agent-dubbo-web&#x2F;src&#x2F;main&#x2F;resources&#x2F;dubbo&#x2F;dubbo-provider.xml<br>编写的新服务需要添加到提供者配置文件中，已确保外部在调用接口的时候能正常使用。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;dubbo:service timeout=<span class="string">&quot;10000&quot;</span> cluster=<span class="string">&quot;failfast&quot;</span> ref=<span class="string">&quot;monitorService&quot;</span> <span class="class"><span class="keyword">interface</span>=&quot;<span class="title">com</span>.<span class="title">xxx</span>.<span class="title">agent</span>.<span class="title">service</span>.<span class="title">api</span>.<span class="title">IMonitorService</span>&quot; /&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="流程规划图"><a href="#流程规划图" class="headerlink" title="流程规划图"></a>流程规划图</h3><p><img src="/../img/liucheng-02.png" alt="java"></p>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>Jquery常用操作</title>
    <url>/2020/01/17/Jquery%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/</url>
    <content><![CDATA[<p>由于自身是后端开发，长期做的项目都基本在纯后端，对于js熟悉程度一直都是自己过不去的坎，近段时间接触了一个较为复杂的页面交互，恶补了下jquery的一些常用操作，在此整理一下，以下内容只属于部分记录，重点在于记录数据的处理版块。</p>
<h3 id="html属性操作"><a href="#html属性操作" class="headerlink" title="html属性操作"></a>html属性操作</h3><p><code>attr(name|properties|key,value|fn)</code> </p>
<p>设置或返回被选元素的属性值。<br>eg：返回文档中所有图像的src属性值。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">&quot;img&quot;</span>).<span class="title function_">attr</span>(<span class="string">&quot;src&quot;</span>);</span><br></pre></td></tr></table></figure>
<span id="more"></span>

<p>eg:为所有图像设置src和alt属性。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">&quot;img&quot;</span>).<span class="title function_">attr</span>(&#123; <span class="attr">src</span>: <span class="string">&quot;test.jpg&quot;</span>, <span class="attr">alt</span>: <span class="string">&quot;Test Image&quot;</span> &#125;);</span><br></pre></td></tr></table></figure>

<p><code>removeAttr(name)</code><br>从每一个匹配的元素中删除一个属性<br>eg:将文档中图像的src属性删除</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">&quot;img&quot;</span>).<span class="title function_">removeAttr</span>(<span class="string">&quot;src&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="CSS类"><a href="#CSS类" class="headerlink" title="CSS类"></a>CSS类</h3><p><code>addClass(class|fn)</code></p>
<p>为每个匹配的元素添加指定的类名。<br>eg:为匹配的元素加上 ‘selected’ 类</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">&quot;p&quot;</span>).<span class="title function_">addClass</span>(<span class="string">&quot;selected&quot;</span>);</span><br><span class="line">$(<span class="string">&quot;p&quot;</span>).<span class="title function_">addClass</span>(<span class="string">&quot;selected1 selected2&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><code>removeClass([class|fn])</code></p>
<p>从所有匹配的元素中删除全部或者指定的类。<br>eg:从匹配的元素中删除 ‘selected’ 类</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">&quot;p&quot;</span>).<span class="title function_">removeClass</span>(<span class="string">&quot;selected&quot;</span>);</span><br></pre></td></tr></table></figure>


<h3 id="选择器"><a href="#选择器" class="headerlink" title="选择器"></a>选择器</h3><p>#id</p>
<p>element</p>
<p>.class</p>
<p>**</p>
<p>selector1,selector2,selectorN</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">&quot;div,span,p.myClass&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="文档的处理"><a href="#文档的处理" class="headerlink" title="文档的处理"></a>文档的处理</h3><p><code>append(content|fn)</code></p>
<p>向每个匹配的元素内部追加内容。<br>eg:向所有段落中追加一些HTML标记。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">&quot;p&quot;</span>).<span class="title function_">append</span>(<span class="string">&quot;&lt;b&gt;Hello&lt;/b&gt;&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><code>appendTo(content)</code><br>把所有匹配的元素追加到另一个指定的元素元素集合中。<br>eg:把所有段落追加到ID值为foo的元素中。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">&quot;p&quot;</span>).<span class="title function_">appendTo</span>(<span class="string">&quot;div&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="事件"><a href="#事件" class="headerlink" title="事件"></a>事件</h3><p><code>blur([[data],fn])</code></p>
<p>当元素失去焦点时触发 blur 事件。<br>eg:任何段落失去焦点时弹出一个 “Hello World!”在每一个匹配元素的blur事件中绑定的处理函数。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">&quot;p&quot;</span>).<span class="title function_">blur</span>( <span class="keyword">function</span> (<span class="params"></span>) &#123; </span><br><span class="line">	<span class="title function_">alert</span>(<span class="string">&quot;Hello World!&quot;</span>); </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><code>change([[data],fn])</code></p>
<p>当元素的值发生改变时，会发生 change 事件。<br>eg:给所有的文本框增加输入验证</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">&quot;input[type=&#x27;text&#x27;]&quot;</span>).<span class="title function_">change</span>( <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 这里可以写些验证代码</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><code>click([[data],fn])</code><br>触发每一个匹配元素的click事件。<br>eg:将页面内所有段落点击后隐藏</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">&quot;p&quot;</span>).<span class="title function_">click</span>( <span class="keyword">function</span> (<span class="params"></span>) &#123; </span><br><span class="line">	$(<span class="variable language_">this</span>).<span class="title function_">hide</span>();</span><br><span class="line"> &#125;);</span><br></pre></td></tr></table></figure>

<p>事件还有很多，请参考手册，根据业务需求选用。</p>
<p>在实际操作过程中可能会遇到’未来‘的一些元素，或者在业务场景中由脚本新增的一些元素，如果在这个时候直接使用以上事件，就会有出发没有反应的情况这时候就需要借助下面这个来操作<br><code>delegate(selector,[type],[data],fn)</code><br>指定的元素（属于被选元素的子元素）添加一个或多个事件处理程序，并规定当这些事件发生时运行的函数。</p>
<p>eg:<br>html代码：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;div style=<span class="string">&quot;background-color:red&quot;</span>&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>这是一个段落。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">button</span>&gt;</span>请点击这里<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>jquery代码:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">&quot;div&quot;</span>).<span class="title function_">delegate</span>(<span class="string">&quot;button&quot;</span>,<span class="string">&quot;click&quot;</span>,<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  $(<span class="string">&quot;p&quot;</span>).<span class="title function_">slideToggle</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="对象和数组的操作"><a href="#对象和数组的操作" class="headerlink" title="对象和数组的操作"></a>对象和数组的操作</h3><h4 id="jQuery-each-object-callback"><a href="#jQuery-each-object-callback" class="headerlink" title="jQuery.each(object, [callback])"></a>jQuery.each(object, [callback])</h4><p>通用例遍方法，可用于例遍对象和数组。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$.<span class="title function_">each</span>( [<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>], <span class="keyword">function</span>(<span class="params">i, n</span>)&#123;</span><br><span class="line">  <span class="title function_">alert</span>( <span class="string">&quot;Item #&quot;</span> + i + <span class="string">&quot;: &quot;</span> + n );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>注意：$.each是就按照数组或对象中的顺序一个一个的跟他们做点什么，具体做什么，随便;$.map就是将原始数组中每一项克隆一份，一项一项的放到一个新的数组中，结束的时候，得到一个新的数组，原始数组不变，新数组中的顺序和原始数组中一样</p>
<h4 id="jQuery-map-arr-obj-callback"><a href="#jQuery-map-arr-obj-callback" class="headerlink" title="jQuery.map(arr|obj,callback)"></a>jQuery.map(arr|obj,callback)</h4><p>将一个数组中的元素转换到另一个数组中。<br>eg:将原数组中每个元素加 4 转换为一个新数组。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$.<span class="title function_">map</span>( [<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>], <span class="keyword">function</span>(<span class="params">n</span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> n + <span class="number">4</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">结果：[<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br></pre></td></tr></table></figure>

<h4 id="jQuery-inArray-value-array-fromIndex"><a href="#jQuery-inArray-value-array-fromIndex" class="headerlink" title="jQuery.inArray(value,array,[fromIndex])"></a>jQuery.inArray(value,array,[fromIndex])</h4><p>确定第一个参数在数组中的位置，从0开始计数(如果没有找到则返回 -1 )。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [ <span class="number">4</span>, <span class="string">&quot;Pete&quot;</span>, <span class="number">8</span>, <span class="string">&quot;John&quot;</span> ];</span><br><span class="line">jQuery.<span class="title function_">inArray</span>(<span class="string">&quot;John&quot;</span>, arr);  <span class="comment">//3</span></span><br><span class="line">jQuery.<span class="title function_">inArray</span>(<span class="number">4</span>, arr);  <span class="comment">//0</span></span><br><span class="line">jQuery.<span class="title function_">inArray</span>(<span class="string">&quot;David&quot;</span>, arr);  <span class="comment">//-1</span></span><br><span class="line">jQuery.<span class="title function_">inArray</span>(<span class="string">&quot;Pete&quot;</span>, arr, <span class="number">2</span>);  <span class="comment">//-1</span></span><br></pre></td></tr></table></figure>

<h4 id="jQuery-toArray"><a href="#jQuery-toArray" class="headerlink" title="jQuery.toArray()"></a>jQuery.toArray()</h4><p>把jQuery集合中所有DOM元素恢复成一个数组。<br>eg:得到所有li的元素数组</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title function_">alert</span>($(<span class="string">&#x27;li&#x27;</span>).<span class="title function_">toArray</span>());</span><br><span class="line">结果：[&lt;li id=&quot;foo&quot;&gt;, &lt;li id=&quot;bar&quot;&gt;]</span><br></pre></td></tr></table></figure>

<h4 id="jQuery-merge-first-second"><a href="#jQuery-merge-first-second" class="headerlink" title="jQuery.merge(first,second)"></a>jQuery.merge(first,second)</h4><p>合并两个数组<br>eg:合并两个数组到第一个数组上。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$.<span class="title function_">merge</span>( [<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>], [<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>] )</span><br><span class="line">结果：[<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]</span><br></pre></td></tr></table></figure>

<h4 id="数组-x2F-对象-叠加元素"><a href="#数组-x2F-对象-叠加元素" class="headerlink" title="数组&#x2F;对象 叠加元素"></a>数组&#x2F;对象 叠加元素</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [];</span><br><span class="line"><span class="keyword">var</span> a = <span class="number">2</span>;</span><br><span class="line">arr.<span class="title function_">push</span>(a);</span><br></pre></td></tr></table></figure>

<h4 id="数组-x2F-对象-删除元素"><a href="#数组-x2F-对象-删除元素" class="headerlink" title="数组&#x2F;对象 删除元素"></a>数组&#x2F;对象 删除元素</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> = [<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;2&#x27;</span>,<span class="string">&#x27;3&#x27;</span>];</span><br><span class="line"> selected_items_data.<span class="title function_">splice</span>(<span class="number">0</span>, <span class="number">1</span>);  <span class="comment">//删除数组中的第一个</span></span><br></pre></td></tr></table></figure>
<p>注意：0位数组的索引，1位长度</p>
<h4 id="jQuery-unique-array"><a href="#jQuery-unique-array" class="headerlink" title="jQuery.unique(array)"></a>jQuery.unique(array)</h4><p>删除数组中重复元素。只处理删除DOM元素数组，而不能处理字符串或者数字数组。</p>
<h4 id="jQuery-isNumeric-value"><a href="#jQuery-isNumeric-value" class="headerlink" title="jQuery.isNumeric(value)"></a>jQuery.isNumeric(value)</h4><p>确定它的参数是否是一个数字。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$.<span class="title function_">isNumeric</span>(<span class="string">&quot;-10&quot;</span>);  <span class="comment">// true</span></span><br><span class="line">$.<span class="title function_">isNumeric</span>(<span class="number">16</span>);     <span class="comment">// true</span></span><br><span class="line">$.<span class="title function_">isNumeric</span>(<span class="title class_">Infinity</span>); <span class="comment">// false</span></span><br><span class="line">$.<span class="title function_">isNumeric</span>(<span class="literal">undefined</span>); <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<h4 id="jQuery-param-obj-traditional"><a href="#jQuery-param-obj-traditional" class="headerlink" title="jQuery.param(obj,[traditional])"></a>jQuery.param(obj,[traditional])</h4><p>将表单元素数组或者对象序列化。是.serialize()的核心方法。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> params = &#123; <span class="attr">width</span>:<span class="number">1680</span>, <span class="attr">height</span>:<span class="number">1050</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> str = jQuery.<span class="title function_">param</span>(params);</span><br><span class="line">$(<span class="string">&quot;#results&quot;</span>).<span class="title function_">text</span>(str);</span><br><span class="line">结果：width=<span class="number">1680</span>&amp;height=<span class="number">1050</span></span><br></pre></td></tr></table></figure>

<h3 id="jQuery对数组操作"><a href="#jQuery对数组操作" class="headerlink" title="jQuery对数组操作"></a>jQuery对数组操作</h3><p>1、数组的创建</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arrayObj = <span class="keyword">new</span> <span class="title class_">Array</span>();　<span class="comment">//创建一个数组</span></span><br><span class="line"><span class="keyword">var</span> arrayObj = [];　<span class="comment">//创建一个数组</span></span><br></pre></td></tr></table></figure>

<p>2、数组的元素的访问</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> testGetArrValue=arrayObj[<span class="number">1</span>]; <span class="comment">//获取数组的元素值</span></span><br><span class="line">arrayObj[<span class="number">1</span>]= <span class="string">&quot;这是新值&quot;</span>; <span class="comment">//给数组元素赋予新的值</span></span><br></pre></td></tr></table></figure>

<p>3、数组元素的添加</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">arrayObj. <span class="title function_">push</span>([item1 [item2 [. . . [itemN ]]]]);<span class="comment">// 将一个或多个新元素添加到数组结尾，并返回数组新长度</span></span><br><span class="line">arrayObj.<span class="title function_">unshift</span>([item1 [item2 [. . . [itemN ]]]]);<span class="comment">// 将一个或多个新元素添加到数组开始，数组中的元素自动后移，返回数组新长度</span></span><br><span class="line">arrayObj.<span class="title function_">splice</span>(insertPos,<span class="number">0</span>,[item1[, item2[, . . . [,itemN]]]]);<span class="comment">//将一个或多个新元素插入到数组的指定位置，插入位置的元素自动后移，返回&quot;&quot;。</span></span><br></pre></td></tr></table></figure>

<p>4、数组元素的删除</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">arrayObj.<span class="title function_">pop</span>(); <span class="comment">//移除最后一个元素并返回该元素值</span></span><br><span class="line">arrayObj.<span class="title function_">shift</span>(); <span class="comment">//移除最前一个元素并返回该元素值，数组中元素自动前移</span></span><br><span class="line">arrayObj.<span class="title function_">splice</span>(deletePos,deleteCount); <span class="comment">//删除从指定位置deletePos开始的指定数量deleteCount的元素，数组形式返回所移除的元素</span></span><br></pre></td></tr></table></figure>

<p>5、数组的截取和合并</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">arrayObj.<span class="title function_">slice</span>(start, [end]); <span class="comment">//以数组的形式返回数组的一部分，注意不包括 end 对应的元素，如果省略 end 将复制 start 之后的所有元素</span></span><br><span class="line">arrayObj.<span class="title function_">concat</span>([item1[, item2[, . . . [,itemN]]]]); <span class="comment">//将多个数组（也可以是字符串，或者是数组和字符串的混合）连接为一个数组，返回连接好的新的数组</span></span><br></pre></td></tr></table></figure>

<p>6、数组元素的排序</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">arrayObj.<span class="title function_">reverse</span>(); <span class="comment">//反转元素（最前的排到最后、最后的排到最前），返回数组地址</span></span><br><span class="line">arrayObj.<span class="title function_">sort</span>(); <span class="comment">//对数组元素排序，返回数组地址</span></span><br></pre></td></tr></table></figure>

<p>7、数组元素的字符串化</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">arrayObj.<span class="title function_">join</span>(separator); <span class="comment">//返回字符串，这个字符串将数组的每一个元素值连接在一起，中间用 separator 隔开。</span></span><br></pre></td></tr></table></figure>


<h3 id="特别注意"><a href="#特别注意" class="headerlink" title="特别注意"></a>特别注意</h3><p>JavaScript 中对象或数组的赋值是默认引用赋值的，使得改变对象时，原对象跟着改变。<br>如果你想要复制赋值，则必须要重新分配对象，使用如下代码即可避免此问题</p>
<p>对象 Object.assign({}, object)</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">et a = &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;lily&#x27;</span>&#125;;</span><br><span class="line"><span class="keyword">var</span> b = <span class="title class_">Object</span>.<span class="title function_">assign</span>(&#123;&#125;, a);</span><br><span class="line">b.<span class="property">name</span> = <span class="string">&#x27;lisa&#x27;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a.<span class="property">name</span>);</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>jquery</category>
      </categories>
      <tags>
        <tag>jquery</tag>
      </tags>
  </entry>
  <entry>
    <title>Jquery判断是否是数字或者小数，并精确到小数点后两位</title>
    <url>/2020/06/11/Jquery%E5%88%A4%E6%96%AD%E6%98%AF%E5%90%A6%E6%98%AF%E6%95%B0%E5%AD%97%E6%88%96%E8%80%85%E5%B0%8F%E6%95%B0%EF%BC%8C%E5%B9%B6%E7%B2%BE%E7%A1%AE%E5%88%B0%E5%B0%8F%E6%95%B0%E7%82%B9%E5%90%8E%E4%B8%A4%E4%BD%8D/</url>
    <content><![CDATA[<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;html xmlns=<span class="string">&quot;http://www.w3.org/1999/xhtml&quot;</span> &gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Untitled Page&lt;/title&gt;</span><br><span class="line">    &lt;script src=<span class="string">&quot;http://code.jquery.com/jquery-1.11.1.min.js&quot;</span> type=<span class="string">&quot;text/javascript&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;input id=<span class="string">&quot;txt_num&quot;</span> type=<span class="string">&quot;text&quot;</span> /&gt;</span><br><span class="line">&lt;input id=<span class="string">&quot;btn_submit&quot;</span> type=<span class="string">&quot;button&quot;</span> value=<span class="string">&quot;提交&quot;</span> /&gt;</span><br><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">$(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    $(<span class="string">&quot;#btn_submit&quot;</span>).<span class="title function_ invoke__">click</span>(function()&#123;</span><br><span class="line">        <span class="keyword">var</span> num = $(<span class="string">&quot;#txt_num&quot;</span>).<span class="title function_ invoke__">val</span>();</span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">isNaN</span>(num))&#123;</span><br><span class="line">            <span class="keyword">var</span> dot = num.<span class="title function_ invoke__">indexOf</span>(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span>(dot != -<span class="number">1</span>)&#123;</span><br><span class="line">                <span class="keyword">var</span> dotCnt = num.<span class="title function_ invoke__">substring</span>(dot+<span class="number">1</span>,num.length);</span><br><span class="line">                <span class="keyword">if</span>(dotCnt.length &gt; <span class="number">2</span>)&#123;</span><br><span class="line">                    <span class="title function_ invoke__">alert</span>(<span class="string">&quot;小数位已超过2位！&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="title function_ invoke__">alert</span>(<span class="string">&quot;数字不合法！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<span id="more"></span>

<h3 id="indexOf"><a href="#indexOf" class="headerlink" title="indexOf()"></a>indexOf()</h3><p>indexOf() 方法可返回某个指定的字符串值在字符串中首次出现的位置。<br>没有找到返回 -1</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">stringObject.<span class="title function_ invoke__">indexOf</span>(searchvalue,fromindex)</span><br></pre></td></tr></table></figure>

<p>eg:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line"><span class="keyword">var</span> str=<span class="string">&quot;Hello world!&quot;</span></span><br><span class="line">document.<span class="title function_ invoke__">write</span>(str.<span class="title function_ invoke__">indexOf</span>(<span class="string">&quot;Hello&quot;</span>) + <span class="string">&quot;&lt;br /&gt;&quot;</span>)</span><br><span class="line">document.<span class="title function_ invoke__">write</span>(str.<span class="title function_ invoke__">indexOf</span>(<span class="string">&quot;test&quot;</span>) + <span class="string">&quot;&lt;br /&gt;&quot;</span>)</span><br><span class="line">document.<span class="title function_ invoke__">write</span>(str.<span class="title function_ invoke__">indexOf</span>(<span class="string">&quot;world&quot;</span>))</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">输出：</span><br><span class="line"><span class="number">0</span></span><br><span class="line">-<span class="number">1</span></span><br><span class="line"><span class="number">6</span></span><br></pre></td></tr></table></figure>

<h3 id="substring"><a href="#substring" class="headerlink" title="substring()"></a>substring()</h3><p>ubstring() 方法用于提取字符串中介于两个指定下标之间的字符，也叫截取。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">stringObject.<span class="title function_ invoke__">substring</span>(start,stop)</span><br></pre></td></tr></table></figure>

<p>eg:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> str=<span class="string">&quot;Hello world!&quot;</span></span><br><span class="line">document.<span class="title function_ invoke__">write</span>(str.<span class="title function_ invoke__">substring</span>(<span class="number">3</span>))</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">输出：</span><br><span class="line">lo world!</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>jquery</category>
      </categories>
      <tags>
        <tag>jquery</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux下编译安装多版本php详细教程</title>
    <url>/2021/12/01/Linux%E4%B8%8B%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85%E5%A4%9A%E7%89%88%E6%9C%ACphp%E8%AF%A6%E7%BB%86%E6%95%99%E7%A8%8B/</url>
    <content><![CDATA[<blockquote>
<p>本文章以php7.1.31和php7.3.9版本为例进行安装</p>
</blockquote>
<h2 id="php7-1-31安装"><a href="#php7-1-31安装" class="headerlink" title="php7.1.31安装"></a>php7.1.31安装</h2><h3 id="1-安装依赖包"><a href="#1-安装依赖包" class="headerlink" title="1.安装依赖包"></a>1.安装依赖包</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">yum install -y gcc gcc-c++  make zlib zlib-devel pcre pcre-devel  libjpeg libjpeg-devel libpng libpng-devel freetype freetype-devel libxml2 libxml2-devel glibc glibc-devel glib2 glib2-devel bzip2 bzip2-devel ncurses ncurses-devel curl curl-devel e2fsprogs e2fsprogs-devel krb5 krb5-devel openssl openssl-devel openldap openldap-devel nss_ldap openldap-clients openldap-servers</span><br></pre></td></tr></table></figure>

<h3 id="2-下载安装包"><a href="#2-下载安装包" class="headerlink" title="2.下载安装包"></a>2.下载安装包</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">cd /usr/local</span><br><span class="line">wget https:<span class="comment">//www.php.net/distributions/php-7.1.31.tar.gz</span></span><br></pre></td></tr></table></figure>

<h3 id="3-解压"><a href="#3-解压" class="headerlink" title="3.解压"></a>3.解压</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">tar -zxvf php-<span class="number">7.1</span>.<span class="number">31</span>.tar.gz</span><br><span class="line">cd php-<span class="number">7.1</span>.<span class="number">31</span></span><br></pre></td></tr></table></figure>

<span id="more"></span>

<h3 id="4-检查当前的环境是否满足要安装软件的依赖关系"><a href="#4-检查当前的环境是否满足要安装软件的依赖关系" class="headerlink" title="4.检查当前的环境是否满足要安装软件的依赖关系"></a>4.检查当前的环境是否满足要安装软件的依赖关系</h3><p>在php-7.1.31里面执行 预编译</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">./configure --prefix=/usr/local/php71 --with-config-file-path=/usr/local/php71/etc --with-config-file-scan-dir=/usr/local/php71/etc --enable-mbstring --enable-ftp --with-gd --with-jpeg-dir=/usr --with-png-dir=/usr --with-mysql=mysqlnd --with-mysqli=mysqlnd --with-pdo-mysql=mysqlnd --without-pear --enable-sockets --with-freetype-dir=/usr --with-zlib --with-libxml-dir=/usr --with-xmlrpc --enable-zip --enable-fpm --enable-xml --enable-sockets --with-gd --with-zlib --with-iconv --enable-zip --with-freetype-dir=/usr/lib/ --enable-soap --enable-pcntl --enable-cli --with-curl --with-openssl</span><br></pre></td></tr></table></figure>

<p><code>特别注意：</code></p>
<ul>
<li><p>–prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;php71是编译后的文件路径，如果需要安装多个php版本，最好是区分出来，如果不区分，后续安装其他版本的时候，会覆盖掉之前的版本，导致&#x2F;usr&#x2F;local&#x2F;下面的php文件夹冲突。</p>
</li>
<li><p>–with-config-file-path&#x3D;&#x2F;usr&#x2F;local&#x2F;php71&#x2F;etc预编译php配置文件php.ini位置，建议是放在该路径下，否则会出现加载不了php.ini的情况</p>
</li>
<li><p>–with-config-file-scan-dir&#x3D;&#x2F;usr&#x2F;local&#x2F;php71&#x2F;etc 预编译扫描php的配置文件路径</p>
</li>
</ul>
<h3 id="5-编译安装"><a href="#5-编译安装" class="headerlink" title="5.编译安装"></a>5.编译安装</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<p>注意编译完成后的错误提示，没有则编译完成。编译完成之后会在 &#x2F;usr&#x2F;local&#x2F;下生成一个php71的文件夹，里面就是php7.1.31的执行文件夹。</p>
<h3 id="6-在之前编译的源码包中，找到-php-ini-production，复制到-x2F-usr-x2F-local-x2F-php71下，并改名为php-ini："><a href="#6-在之前编译的源码包中，找到-php-ini-production，复制到-x2F-usr-x2F-local-x2F-php71下，并改名为php-ini：" class="headerlink" title="6.在之前编译的源码包中，找到 php.ini-production，复制到&#x2F;usr&#x2F;local&#x2F;php71下，并改名为php.ini："></a>6.在之前编译的源码包中，找到 php.ini-production，复制到&#x2F;usr&#x2F;local&#x2F;php71下，并改名为php.ini：</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">cd /usr/local/php7.<span class="number">1.31</span></span><br><span class="line"></span><br><span class="line">cp php.ini-production /usr/local/php71/etc/php.ini  这个路径要跟预编译时设定的配置文件路径一致</span><br></pre></td></tr></table></figure>

<p>将下载文件夹中的php配置文件拷贝到执行文件夹下面</p>
<h3 id="7-可选项-设置让PHP错误信息打印在页面上"><a href="#7-可选项-设置让PHP错误信息打印在页面上" class="headerlink" title="7.[可选项] 设置让PHP错误信息打印在页面上"></a>7.[可选项] 设置让PHP错误信息打印在页面上</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">vi /usr/local/php71/etc/php.ini</span><br></pre></td></tr></table></figure>
<p>编辑php配置文件php.ini，搜索并设置dislay_errors&#x3D;on。</p>
<h3 id="8-复制启动脚本"><a href="#8-复制启动脚本" class="headerlink" title="8.复制启动脚本"></a>8.复制启动脚本</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">cd /usr/local/php7.<span class="number">1.31</span></span><br><span class="line"></span><br><span class="line">cp ./sapi/fpm/init.d.php-fpm /etc/init.d/php-fpm71</span><br><span class="line"></span><br><span class="line">chmod +x /etc/init.d/php-fpm71</span><br></pre></td></tr></table></figure>

<p>将php7.1.31下的启动脚本拷贝到&#x2F;etc&#x2F;init.d下面，赋予可执行权限，注意区分版本</p>
<h3 id="9-修改php-fpm配置文件"><a href="#9-修改php-fpm配置文件" class="headerlink" title="9.修改php-fpm配置文件"></a>9.修改php-fpm配置文件</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">cd /usr/local/php71/etc</span><br><span class="line"></span><br><span class="line">cp php-fpm.conf.<span class="keyword">default</span> php-fpm.conf</span><br><span class="line"></span><br><span class="line">vi php-fpm.conf</span><br></pre></td></tr></table></figure>

<p>去掉pid&#x3D;run&#x2F;php-fpm.pid前面的分号</p>
<p><code>特别注意：</code><br>将pid&#x3D;改成pid&#x3D;&#x2F;usr&#x2F;local&#x2F;php71&#x2F;var&#x2F;run&#x2F;php-fpm.pid，不能直接去掉分号完事，后续在启动的时候会报错，同时搜索并修改error_log&#x3D;&#x2F;usr&#x2F;local&#x2F;php71&#x2F;var&#x2F;log&#x2F;php-fpm.log,同样不改后面启动会报错<br><img src="/../img/20211202-1.png" alt="php"></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">/usr/local/php71/etc/php-fpm.d</span><br><span class="line"></span><br><span class="line">cp www.conf.<span class="keyword">default</span> www.conf</span><br></pre></td></tr></table></figure>

<p>php-fpm 基本命令</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$ /etc/init.d/php-fpm start  <span class="comment">#php-fpm启动命令</span></span><br><span class="line">$ /etc/init.d/php-fpm stop  <span class="comment">#php-fpm停止命令</span></span><br><span class="line">$ /etc/init.d/php-fpm restart  <span class="comment">#php-fpm重启命令</span></span><br><span class="line">$ ps -ef | grep php 或者 ps -A | grep -i php  <span class="comment">#查看是否已经成功启动PHP</span></span><br></pre></td></tr></table></figure>

<h3 id="10-开机自启动"><a href="#10-开机自启动" class="headerlink" title="10.开机自启动"></a>10.开机自启动</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">vi /etc/rc.local</span><br><span class="line"></span><br><span class="line">将 /etc/init.d/php-fpm71 start 添加进去</span><br><span class="line"></span><br><span class="line">chmod +x /etc/rc.d/rc.local     <span class="comment">// 赋予执行权限</span></span><br></pre></td></tr></table></figure>

<h3 id="11-设置别名"><a href="#11-设置别名" class="headerlink" title="11.设置别名"></a>11.设置别名</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">vim  ~/.bashrc</span><br><span class="line"></span><br><span class="line">alias php71=<span class="string">&#x27;/usr/local/php71/bin/php&#x27;</span></span><br><span class="line"></span><br><span class="line">source ~/.bashrc</span><br></pre></td></tr></table></figure>

<h3 id="12-更改侦听端口-127-0-0-1-9000-为默认的"><a href="#12-更改侦听端口-127-0-0-1-9000-为默认的" class="headerlink" title="12.更改侦听端口(127.0.0.1:9000 为默认的)"></a>12.更改侦听端口(127.0.0.1:9000 为默认的)</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">cd /usr/local/php71/etc/php-fpm.d</span><br><span class="line"></span><br><span class="line">vim www.conf</span><br></pre></td></tr></table></figure>
<p>改成自己需要设置的端口即可<br><img src="/../img/20211202-2.png" alt="php"></p>
<h3 id="13-校验-amp-amp-检查"><a href="#13-校验-amp-amp-检查" class="headerlink" title="13.校验&amp;&amp;检查"></a>13.校验&amp;&amp;检查</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">ps -ef | grep php 或者 ps -A | grep -i php  <span class="comment">#查看是否已经成功启动PHP</span></span><br><span class="line"></span><br><span class="line">netstat -ntulp | grep [端口号]    <span class="comment">// 查看端口是否被占用</span></span><br></pre></td></tr></table></figure>


<h2 id="php7-3-9安装"><a href="#php7-3-9安装" class="headerlink" title="php7.3.9安装"></a>php7.3.9安装</h2><h3 id="1-下载安装包"><a href="#1-下载安装包" class="headerlink" title="1.下载安装包"></a>1.下载安装包</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">cd /usr/local</span><br><span class="line">wget https:<span class="comment">//www.php.net/distributions/php-7.3.9.tar.gz</span></span><br></pre></td></tr></table></figure>

<h3 id="2-解压"><a href="#2-解压" class="headerlink" title="2.解压"></a>2.解压</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">tar -zxvf php-<span class="number">7.3</span>.<span class="number">9</span>.tar.gz</span><br><span class="line">cd php-<span class="number">7.3</span>.<span class="number">9</span></span><br></pre></td></tr></table></figure>

<h3 id="3-检查当前的环境是否满足要安装软件的依赖关系"><a href="#3-检查当前的环境是否满足要安装软件的依赖关系" class="headerlink" title="3.检查当前的环境是否满足要安装软件的依赖关系"></a>3.检查当前的环境是否满足要安装软件的依赖关系</h3><p>在php-7.3.9里面执行</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">./configure --prefix=/usr/local/php73 --with-config-file-path=/usr/local/php73/etc --with-config-file-scan-dir=/usr/local/php73/etc --enable-mbstring --enable-ftp --with-gd --with-jpeg-dir=/usr --with-png-dir=/usr --with-mysql=mysqlnd --with-mysqli=mysqlnd --with-pdo-mysql=mysqlnd --without-pear --enable-sockets --with-freetype-dir=/usr --with-zlib --with-libxml-dir=/usr --with-xmlrpc --enable-zip --enable-fpm --enable-xml --enable-sockets --with-gd --with-zlib --with-iconv --enable-zip --with-freetype-dir=/usr/lib/ --enable-soap --enable-pcntl --enable-cli --with-curl --with-openssl</span><br></pre></td></tr></table></figure>
<p><code>特别注意：</code><br>上面需要改成–prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;php73 –with-config-file-path&#x3D;&#x2F;usr&#x2F;local&#x2F;php73&#x2F;etc这样在编译的时候才会执行编译到php73里面去，与之前的7.1.31独立开来</p>
<h3 id="4-编译安装"><a href="#4-编译安装" class="headerlink" title="4.编译安装"></a>4.编译安装</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<p>注意编译完成后的错误提示，没有则编译完成。编译完成之后会在 &#x2F;usr&#x2F;local&#x2F;下生成一个php73的文件夹，里面就是php7.3.9的执行文件夹。<br>然后重复上面安装7.1.31的第6个步骤持续进行</p>
<p><code>特别注意：</code><br>多个版本的php编译后的文件夹一定要注意区分，多个版本需要改不同的端口</p>
<p><code>特别注意：</code><br>最后检查php每个版本对应的php加载的配置文件是否生效<br><img src="/../img/20211206-1.png" alt="php"></p>
<p>如果你的结果与我上面一致，恭喜你！已经完全安装完成！</p>
<p>最后的目录结构为：<br><img src="/../img/20211202-3.png" alt="php"></p>
<p>启动状态：<br><img src="/../img/20211202-4.png" alt="php"></p>
<h2 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h2><p>查看php安装时的预编译</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">php71 -i | grep config</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux安装composer遇到的坑</title>
    <url>/2022/01/29/Linux%E5%AE%89%E8%A3%85composer%E9%81%87%E5%88%B0%E7%9A%84%E5%9D%91/</url>
    <content><![CDATA[<h3 id="正常操作"><a href="#正常操作" class="headerlink" title="正常操作"></a>正常操作</h3><h4 id="1、下载composer"><a href="#1、下载composer" class="headerlink" title="1、下载composer"></a>1、下载composer</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">curl -sS https:<span class="comment">//getcomposer.org/installer | php</span></span><br></pre></td></tr></table></figure>

<h4 id="2、将composer-phar文件移动到bin目录以便全局使用composer命令-重点"><a href="#2、将composer-phar文件移动到bin目录以便全局使用composer命令-重点" class="headerlink" title="2、将composer.phar文件移动到bin目录以便全局使用composer命令 (重点)"></a>2、将composer.phar文件移动到bin目录以便全局使用composer命令 (重点)</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">mv composer.phar /usr/local/php/bin/composer    <span class="comment">// 一定要找到对应的php版本的执行目录bin下面</span></span><br></pre></td></tr></table></figure>

<h4 id="3、切换国内源"><a href="#3、切换国内源" class="headerlink" title="3、切换国内源"></a>3、切换国内源</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">composer config -g repo.packagist composer https:<span class="comment">//packagist.phpcomposer.com</span></span><br></pre></td></tr></table></figure>

<span id="more"></span>

<h3 id="避坑"><a href="#避坑" class="headerlink" title="避坑"></a>避坑</h3><h4 id="1、执行命令：curl-sS-https-getcomposer-org-installer-php"><a href="#1、执行命令：curl-sS-https-getcomposer-org-installer-php" class="headerlink" title="1、执行命令：curl -sS https://getcomposer.org/installer | php"></a>1、执行命令：curl -sS <a href="https://getcomposer.org/installer">https://getcomposer.org/installer</a> | php</h4><p>报错如下：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Some settings on your machine make Composer unable to work properly.Make sure that you fix the issues listed below <span class="keyword">and</span> run this script again:</span><br><span class="line">The openssl extension is missing, which means that secure HTTPS transfers are impossible.If possible you should enable it <span class="keyword">or</span> recompile php with --with-openssl</span><br></pre></td></tr></table></figure>
<p>没有openssl扩展<br>cd php7.0&#x2F;ext&#x2F;openssl &#x2F;&#x2F; 进入到openssl文件，注意自己的php版本<br>phpize &#x2F;&#x2F; 运行phpize</p>
<h4 id="2、编译和安装"><a href="#2、编译和安装" class="headerlink" title="2、编译和安装"></a>2、编译和安装</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">./configure --with-openssl --with-php-config=/usr/local/php/bin/php-config    <span class="comment">// 编译和安装</span></span><br></pre></td></tr></table></figure>

<p>遇到报错：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">configure: error: Cannot find OpenSSL<span class="string">&#x27;s &lt;evp.h&gt;</span></span><br></pre></td></tr></table></figure>

<p>缺少openssl相关的库，直接安装即可</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">yum install openssl openssl-devel</span><br></pre></td></tr></table></figure>

<p>遇到报错：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">configure: error: mcrypt.h not found. Please reinstall libmcrypt</span><br></pre></td></tr></table></figure>

<p>提示比较明确，缺少libmcrypt，直接安装即可</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">yum install libmcrypt</span><br></pre></td></tr></table></figure>

<h4 id="3、最后执行-make-amp-amp-make-install"><a href="#3、最后执行-make-amp-amp-make-install" class="headerlink" title="3、最后执行 make &amp;&amp; make install"></a>3、最后执行 make &amp;&amp; make install</h4><p>进入最后提示的目录 cp openssl.so &#x2F;usr&#x2F;local&#x2F;php&#x2F;include&#x2F;php&#x2F;ext<br>找到php.ini，在最后面添加如下内容： extension&#x3D;openssl.so<br>重启 后查看扩展: php -m</p>
<h4 id="4、最后"><a href="#4、最后" class="headerlink" title="4、最后"></a>4、最后</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">mv composer.phar /usr/local/php/bin/composer   <span class="comment">//一定要找到对应的php版本的执行目录bin下面</span></span><br></pre></td></tr></table></figure>

<h4 id="5、设置别名"><a href="#5、设置别名" class="headerlink" title="5、设置别名"></a>5、设置别名</h4><p>为防止多个php版本的存在，有设置别名的必要</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">vim ~/.zshrc</span><br><span class="line"></span><br><span class="line">alias composer74=<span class="string">&quot;php /usr/local/Cellar/php@7.4/7.4.21_1/bin/composer.phar&quot;</span></span><br><span class="line"></span><br><span class="line">source ~/.zshrc</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux安装php7.4和nginx配置</title>
    <url>/2024/07/01/Linux%E5%AE%89%E8%A3%85php7-4%E5%92%8Cnginx%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<h2 id="模块说明"><a href="#模块说明" class="headerlink" title="模块说明"></a>模块说明</h2><p><strong>特别注意</strong>：php7.3开始要求系统libzip的version &gt;&#x3D; 0.11，但是目前通过 yum -y install libzip-devel 安装的是0.10的版本，官方版本从1.4.0开始要依赖cmake安装,对cmake的版本还有要求</p>
<p>报错如图：<br><img src="/../img/2024070101.jpg"></p>
<p>下面介绍三种安装方式：</p>
<h3 id="1、yum安装-不推荐，官方安装都是0-1版本的"><a href="#1、yum安装-不推荐，官方安装都是0-1版本的" class="headerlink" title="1、yum安装(不推荐，官方安装都是0.1版本的)"></a>1、yum安装(不推荐，官方安装都是0.1版本的)</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 卸载原有低版本的libzip包</span></span><br><span class="line">sudo yum -y remove libzip libzip-devel</span><br><span class="line"><span class="comment"># 重新安装看看版本是否符合要求</span></span><br><span class="line">sudo yum -y install libzip libzip-devel</span><br><span class="line"><span class="comment"># 否则添加wlnmp源</span></span><br><span class="line">sudo rpm -ivh https:<span class="comment">//mirrors.wlnmp.com/centos/wlnmp-release-centos.noarch.rpm</span></span><br><span class="line"><span class="comment"># 安装libzip包,当前wlnmp提供的libzip包版本1.8.0</span></span><br><span class="line">sudo yum install wlibzip</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<h3 id="2、不需要安装cmake（推荐）"><a href="#2、不需要安装cmake（推荐）" class="headerlink" title="2、不需要安装cmake（推荐）"></a>2、不需要安装cmake（推荐）</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 装1.3.2的版本,不需要安装cmake</span></span><br><span class="line">sudo yum -y remove libzip-devel libzip</span><br><span class="line">wget -c https:<span class="comment">//libzip.org/download/libzip-1.3.2.tar.gz</span></span><br><span class="line">tar -zxvf libzip-<span class="number">1.3</span>.<span class="number">2</span>.tar.gz</span><br><span class="line">cd libzip-<span class="number">1.3</span>.<span class="number">2</span></span><br><span class="line">./configure</span><br><span class="line">sudo make </span><br><span class="line">sudo make install</span><br><span class="line">export PKG_CONFIG_PATH=<span class="string">&quot;/usr/local/lib/pkgconfig/&quot;</span> </span><br><span class="line"></span><br><span class="line">参考文献：https:<span class="comment">//blog.csdn.net/robin_cai/article/details/118151747</span></span><br></pre></td></tr></table></figure>

<h3 id="3、编译安装"><a href="#3、编译安装" class="headerlink" title="3、编译安装"></a>3、编译安装</h3><h4 id="编译安装-CMake-3-16-2"><a href="#编译安装-CMake-3-16-2" class="headerlink" title="编译安装 CMake 3.16.2"></a>编译安装 CMake 3.16.2</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">cd /home/www/soft_download</span><br><span class="line">sudo yum -y remove libzip-devel libzip</span><br><span class="line">wget https:<span class="comment">//github.com/Kitware/CMake/releases/download/v3.16.2/cmake-3.16.2.tar.gz</span></span><br><span class="line">tar -zxvf cmake-<span class="number">3.16</span>.<span class="number">2</span>.tar.gz</span><br><span class="line">cd cmake-<span class="number">3.16</span>.<span class="number">2</span></span><br><span class="line">./bootstrap --prefix=/usr/local/cmake --datadir=/usr/local/cmake-data --docdir=/usr/local/cmake-doc</span><br><span class="line">sudo make</span><br><span class="line">sudo make install</span><br><span class="line">sudo ln -s /usr/local/cmake/bin/cmake /usr/bin/cmake</span><br><span class="line">cmake --version</span><br></pre></td></tr></table></figure>

<h4 id="编译安装-libzip-1-8-0"><a href="#编译安装-libzip-1-8-0" class="headerlink" title="编译安装 libzip 1.8.0"></a>编译安装 libzip 1.8.0</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">sudo yum install -y openssl-devel bzip2 bzip2-devel</span><br><span class="line">cd /home/www/soft_download</span><br><span class="line">wget --no-check-certificate https:<span class="comment">//libzip.org/download/libzip-1.8.0.tar.gz</span></span><br><span class="line">tar -zxvf libzip-<span class="number">1.8</span>.<span class="number">0</span>.tar.gz</span><br><span class="line">cd libzip-<span class="number">1.8</span>.<span class="number">0</span></span><br><span class="line">mkdir build</span><br><span class="line">cd build</span><br><span class="line">cmake .. -DCMAKE_INSTALL_PREFIX=/usr/local/cmake</span><br><span class="line">sudo make</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure>

<h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看系统当前环境变量(用于扩展pkg-config的搜索路径)</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$PKG_CONFIG_PATH</span></span><br><span class="line"><span class="comment"># 临时修改配置</span></span><br><span class="line">export PKG_CONFIG_PATH=<span class="string">&quot;/usr/local/cmake/lib64/pkgconfig&quot;</span>:<span class="variable">$PKG_CONFIG_PATH</span></span><br><span class="line"><span class="comment"># 永久修改配置</span></span><br><span class="line">vim /etc/profile <span class="comment"># 如果只修改当前用户的环境变量则是`vim ~/.bashrc`</span></span><br><span class="line">    export PKG_CONFIG_PATH=/usr/lib64/pkgconfig:/usr/local/lib/pkgconfig:/usr/local/cmake/lib64/pkgconfig</span><br><span class="line"><span class="comment"># 立刻生效</span></span><br><span class="line">source /etc/profile</span><br><span class="line"><span class="comment"># 检查</span></span><br><span class="line">pkg-config --<span class="keyword">list</span>-all|grep libzip</span><br></pre></td></tr></table></figure>

<h2 id="PHP安装"><a href="#PHP安装" class="headerlink" title="PHP安装"></a>PHP安装</h2><p>这里安装<strong>php7.4.30</strong></p>
<p>1、下载php7.4.30 这里安装<a href="https://www.php.net/releases/">php7.4.30</a></p>
<p>2、上传到&#x2F;usr&#x2F;local并解压  cd php-7.4.30</p>
<p>3、安装必备依赖</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">yum -y install libxml2 libxml2-devel openssl openssl-devel bzip2 bzip2-devel libcurl libcurl-devel libjpeg libjpeg-devel libpng libpng-devel freetype freetype-devel gmp gmp-devel libmcrypt libmcrypt-devel readline readline-devel libxslt libxslt-devel zlib zlib-devel glibc glibc-devel glib2 glib2-devel ncurses curl gdbm-devel db4-devel libXpm-devel libX11-devel gd-devel gmp-devel expat-devel xmlrpc-c xmlrpc-c-devel libicu-devel libmcrypt-devel libmemcached-devel libzip gcc-c++</span><br></pre></td></tr></table></figure>
<p>4、进行预编译<br>cd  &#x2F;usr&#x2F;local&#x2F;php-7.4.30</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">./configure  \</span><br><span class="line">--prefix=/usr/local/php \</span><br><span class="line">--with-config-file-path=/usr/local/php/lib \</span><br><span class="line">--with-fpm-user=nginx \</span><br><span class="line">--with-fpm-group=nginx \</span><br><span class="line">--enable-fpm \</span><br><span class="line">--enable-opcache \</span><br><span class="line">--enable-inline-optimization \</span><br><span class="line">--disable-debug \</span><br><span class="line">--disable-rpath \</span><br><span class="line">--enable-shared \</span><br><span class="line">--enable-mysqlnd \</span><br><span class="line">--with-mysqli=mysqlnd \</span><br><span class="line">--with-pdo-mysql=mysqlnd \</span><br><span class="line">--enable-mysqlnd-compression-support \</span><br><span class="line">--with-iconv-dir \</span><br><span class="line">--with-zlib \</span><br><span class="line">--enable-xml \</span><br><span class="line">--disable-rpath \</span><br><span class="line">--enable-bcmath \</span><br><span class="line">--enable-shmop \</span><br><span class="line">--enable-sysvsem \</span><br><span class="line">--enable-inline-optimization \</span><br><span class="line">--with-curl \</span><br><span class="line">--enable-mbregex \</span><br><span class="line">--enable-mbstring \</span><br><span class="line">--enable-intl \</span><br><span class="line">--enable-ftp \</span><br><span class="line">--enable-gd \</span><br><span class="line">--enable-gd-jis-conv \</span><br><span class="line">--with-jpeg   \</span><br><span class="line">--with-freetype  \</span><br><span class="line">--with-openssl \</span><br><span class="line">--with-mhash \</span><br><span class="line">--enable-pcntl \</span><br><span class="line">--enable-sockets \</span><br><span class="line">--with-xmlrpc \</span><br><span class="line">--with-zip \</span><br><span class="line">--enable-soap \</span><br><span class="line">--with-gettext \</span><br><span class="line">--disable-fileinfo \</span><br><span class="line">--with-pear \</span><br><span class="line">--enable-maintainer-zts \</span><br><span class="line">--with-ldap=shared \</span><br><span class="line">--without-gdbm </span><br></pre></td></tr></table></figure>

<p>5、编译&amp;&amp;安装</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<p>6、配置并启动</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /usr/local/php/  #先进入安装目录</span><br><span class="line">cp ./etc/php-fpm.conf.default ./etc/php-fpm.conf    #配置文件</span><br><span class="line">vim /usr/local/php/etc/php-fpm.conf</span><br><span class="line">将;pid = run/php-fpm.pid 前面的;分号删掉</span><br></pre></td></tr></table></figure>

<p>#配置文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cp /usr/local/php/etc/php-fpm.d/www.conf.default  /usr/local/php/etc/php-fpm.d/www.conf</span><br><span class="line">cp /usr/local/php-7.4.30/php.ini-production /usr/local/php/lib/php.ini</span><br></pre></td></tr></table></figure>

<p>7、修改php.ini配置文件</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">max_execution_time = <span class="number">300</span></span><br><span class="line">max_input_time = <span class="number">600</span></span><br><span class="line">post_max_size = <span class="number">80</span>M</span><br><span class="line">max_file_uploads = <span class="number">20</span></span><br><span class="line">date.timezone = Asia/Shanghai</span><br></pre></td></tr></table></figure>

<p>8、配置启动服务</p>
<p>方案一：</p>
<p>（1）、添加php-fpm服务启动脚本</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim  /lib/systemd/system/php-fpm.service</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=php-fpm</span><br><span class="line">After=network.target</span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">ExecStart=/usr/local/php/sbin/php-fpm ##需要注意修改自己的路径</span><br><span class="line">ExecStop=/bin/pkill -9 php-fpm</span><br><span class="line">PrivateTmp=true</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line">**服务字段说明**</span><br><span class="line"></span><br><span class="line">[Unit]:服务的说明</span><br><span class="line">Description:描述服务</span><br><span class="line">After:描述服务类别</span><br><span class="line">[Service]服务运行参数的设置</span><br><span class="line">Type=forking是后台运行的形式</span><br><span class="line">ExecStart为服务的具体运行命令</span><br><span class="line">ExecReload为重启命令</span><br><span class="line">ExecStop为停止命令</span><br><span class="line">PrivateTmp=True表示给服务分配独立的临时空间</span><br><span class="line">注意：[Service]的启动、重启、停止命令全部要求使用绝对路径</span><br><span class="line">[Install]运行级别下服务安装的相关设置，可设置为多用户，即系统运行级别为3</span><br></pre></td></tr></table></figure>

<p>（2）、 systemctl list-unit-files –type&#x3D;service查看有没有php-fpm.service<br>如果没有就是用systemctl daemon-reload重新加载，在使用以上命令查看</p>
<p>（3）、添加开机自启 systemctl enable php-fpm.service</p>
<p>方案二（常用）：</p>
<p>（1）、&#x2F;拷贝php-fpm脚本至&#x2F;etc&#x2F;init.d目录</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cp /usr/local/php-7.4.30/sapi/fpm/init.d.php-fpm  /etc/init.d/php-fpm</span><br></pre></td></tr></table></figure>
<p>（2）、设置权限并启动php-fpm</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">chmod 755 /etc/init.d/php-fpm</span><br><span class="line">/etc/init.d/php-fpm start</span><br></pre></td></tr></table></figure>

<p>php-fpm以服务的方式启动、停止和重启</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">service php-fpm start</span><br><span class="line">service php-fpm stop</span><br><span class="line">service php-fpm reload</span><br></pre></td></tr></table></figure>
<p>（3）、设置php-fpm开机自启</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cp /usr/local/php-7.4.22/sapi/fpm/php-fpm.service  /usr/lib/systemd/system</span><br><span class="line"></span><br><span class="line">systemctl enable php-fpm</span><br></pre></td></tr></table></figure>

<h2 id="Nginx解析PHP"><a href="#Nginx解析PHP" class="headerlink" title="Nginx解析PHP"></a>Nginx解析PHP</h2><p>进入到nginx安装目录 cd &#x2F;usr&#x2F;local&#x2F;nginx&#x2F; </p>
<p>修改配置文件 vim .&#x2F;conf&#x2F;nginx.conf  （或者添加vhost下的子配置）</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">        listen       8088;</span><br><span class="line">        server_name  localhost;</span><br><span class="line">        index index.html index.htm index.php default.html default.htm default.php;</span><br><span class="line">        root /xxx/xx; #项目路径</span><br><span class="line"></span><br><span class="line">        #charset koi8-r;</span><br><span class="line">        #access_log  logs/host.access.log  main;</span><br><span class="line">        </span><br><span class="line">        #tp框架伪静态</span><br><span class="line">        location / &#123;</span><br><span class="line">          if (!-e $request_filename) &#123;</span><br><span class="line">                rewrite  ^(.*)$  /index.php?s=$1  last;</span><br><span class="line">                break;</span><br><span class="line">         &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        location / &#123;</span><br><span class="line">            root   html;</span><br><span class="line">            index index.php  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line">         location ~ \.php$ &#123;</span><br><span class="line">            root           /xxx/xxx;  #项目路径</span><br><span class="line">            fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">            fastcgi_index  index.php;</span><br><span class="line">            fastcgi_split_path_info ^(.+\.php)(.*)$;</span><br><span class="line">            fastcgi_param   PATH_INFO $fastcgi_path_info;</span><br><span class="line">            fastcgi_param   SCRIPT_FILENAME  $document_root$fastcgi_script_name;</span><br><span class="line">            include         fastcgi_params;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>到项目地址新建info.php文件</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">phpinfo</span>();</span><br></pre></td></tr></table></figure>

<p>启动nginx服务 nginx -s reload</p>
<p>访问<a href="http://127.0.0.1:8088/info.php">http://127.0.0.1:8088/info.php</a> 查看php是否生效</p>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux下docker配置加速器</title>
    <url>/2018/06/20/Linux%E4%B8%8Bdocker%E9%85%8D%E7%BD%AE%E5%8A%A0%E9%80%9F%E5%99%A8/</url>
    <content><![CDATA[<p>直接下载Docker镜像时，由于种种原因，经常下载失败，即使连接成功也是很慢,目前我知道可以提升速度的办法：DaoCloud 提供Docker Hub Mirror服务,用户可以进入Docker Hub Mirror注册入口注册（<a href="https://account.daocloud.io/signin%EF%BC%89%E3%80%82">https://account.daocloud.io/signin）。</a></p>
<p>在进入控制台页面后直接点击 启动你的加速器后，您即可得到一个Mirror的地址，将该地址配置在Docker Daemon的启动脚本中，重启Docker Daemon即可使得Docker Hub Mirror配置生效。</p>
<span id="more"></span>
<p>注册登录之后，点击加速器：<br><img src="/../img/docker-config.png" alt="docker"></p>
<p>然后会得到一个Mirror的地址，将该地址配置在Docker Daemon的启动脚本中，重启Docker Daemon即可使得Docker Hub Mirror配置生效，换句话说，把这个获取的地址复制到要加速的服务器上执行一次，然后重启docker，就ok。</p>
<h4 id="docker加速"><a href="#docker加速" class="headerlink" title="docker加速"></a>docker加速</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># curl -sSL https://get.daocloud.io/daotools/set_mirror.sh | sh -s http://4e70ba5d.m.daocloud.io  </span></span><br><span class="line">root@ubuntu:~<span class="comment"># cat /etc/docker/daemon.json   </span></span><br><span class="line">&#123;<span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;http://4e70ba5d.m.daocloud.io&quot;</span>]&#125;  </span><br><span class="line">root@ubuntu:~<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<h4 id="重启docker服务"><a href="#重启docker服务" class="headerlink" title="重启docker服务"></a>重启docker服务</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># service docker restart</span></span><br></pre></td></tr></table></figure>

<h4 id="遇到的坑"><a href="#遇到的坑" class="headerlink" title="遇到的坑 *"></a>遇到的坑 *</h4><p>或许你会遇到这样的情况，在重启docker的时候发现因为配置的原因导致无法重启docker，这个时候执行cat &#x2F;etc&#x2F;docker&#x2F;daemon.json，你会看到这样的结果：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># cat /etc/docker/daemon.json   </span></span><br><span class="line">&#123;<span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;http://4e70ba5d.m.daocloud.io&quot;</span>],&#125;   <span class="comment">//这里的逗号有问题</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>去掉,后再次启动便成功！</p>
]]></content>
      <categories>
        <category>docker</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>Mac M1安装pyenv教程</title>
    <url>/2021/07/22/Mac-M1%E5%AE%89%E8%A3%85pyenv%E6%95%99%E7%A8%8B/</url>
    <content><![CDATA[<p>M1 芯片的特殊性，会导致pyenv安装的过程会大量的报错，在此特别说明下M1 安装python环境的详细说明</p>
<h3 id="Homebrew-的安装"><a href="#Homebrew-的安装" class="headerlink" title="Homebrew 的安装"></a>Homebrew 的安装</h3><h4 id="安装Homebrew"><a href="#安装Homebrew" class="headerlink" title="安装Homebrew"></a>安装Homebrew</h4><p>在安装Homebrew的时候不要通过Homebrew官网命令直接执行，由于M1 芯片的原因，在安装好Homebrew后通过brew安装的工具会报错，存在不兼容性</p>
<p>M1 安装Homebrew方式</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">arch -x86_64 /bin/bash -c <span class="string">&quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)&quot;</span></span><br></pre></td></tr></table></figure>
<span id="more"></span>

<p><code>arch -x86_64</code> 为万能命令，由于系统架构不一致，需要这个万能命令来安装</p>
<h4 id="环境变量写入"><a href="#环境变量写入" class="headerlink" title="环境变量写入"></a>环境变量写入</h4><p>写入环境配置到 ~&#x2F;.zshrc</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">export LDFLAGS=<span class="string">&quot;-L/opt/homebrew/opt/readline/lib&quot;</span></span><br><span class="line">export CPPFLAGS=<span class="string">&quot;-I/opt/homebrew/opt/readline/include&quot;</span></span><br><span class="line">export PKG_CONFIG_PATH=<span class="string">&quot;/opt/homebrew/opt/readline/lib/pkgconfig&quot;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">source ~/.zshrc</span><br></pre></td></tr></table></figure>

<h4 id="取别名"><a href="#取别名" class="headerlink" title="取别名"></a>取别名</h4><p>之后每次运行都需要通过 arch 命令执行 brew, 如果觉得麻烦. 在 .zshrc 添加:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">alias ibrew=<span class="string">&quot;arch -x86_64 brew&quot;</span></span><br></pre></td></tr></table></figure>

<p>在source ~&#x2F;.zshrc 之后，之后安装工具都需要通过ibrew 来安装</p>
<h3 id="安装pyenv"><a href="#安装pyenv" class="headerlink" title="安装pyenv"></a>安装pyenv</h3><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">ibrew install pyenv  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">xiexiang in ~/.pyenv/cache λ pyenv -v</span><br><span class="line">pyenv <span class="number">2.0</span>.<span class="number">3</span></span><br></pre></td></tr></table></figure>


<h4 id="取别名-1"><a href="#取别名-1" class="headerlink" title="取别名"></a>取别名</h4><p>pyenv 也需要通过 arch 运行, 同样我也在.zshrc 中添加了 alias</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">alias ipyenv=<span class="string">&quot;arch -x86_64 pyenv&quot;</span></span><br><span class="line">source ~/.zshrc</span><br></pre></td></tr></table></figure>

<p>ok，到此，在M1下安装pyenv就可以了，后续使用brew、pyenv的地方请换成ibrew、ipyenv，这样就在M1上完美使用了！请避坑！</p>
]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux安装redis扩展</title>
    <url>/2024/07/02/Liunx%E5%AE%89%E8%A3%85redis%E6%89%A9%E5%B1%95/</url>
    <content><![CDATA[<p>1、下载redis 并解压到当前目录</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">wget http:<span class="comment">//pecl.php.net/get/redis-3.1.2.tgz</span></span><br><span class="line">tar -zxvf redis-<span class="number">3.1</span>.<span class="number">2</span>.tgz</span><br></pre></td></tr></table></figure>

<p>2、进入解压的redis目录</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">cd redis-<span class="number">3.1</span>.<span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>3、用phpize生成configure配置文件（你自己的phpize在哪里可以查找一下！）</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">whereis phpize   <span class="comment"># 先找phpize在哪  </span></span><br><span class="line"></span><br><span class="line">/usr/local/php/bin/phpize   <span class="comment"># 执行</span></span><br></pre></td></tr></table></figure>

<p>4、配置</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">./configure --with-php-config=/usr/local/php/bin/php-config    <span class="comment"># php-config为php/bin下的执行文件</span></span><br></pre></td></tr></table></figure>

<span id="more"></span>

<p>5、编译安装</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<p>6、编辑php.ini</p>
<p>首先找到php.ini的位置</p>
<p>可通过php –ini查看位置，Loaded Configuration File:&#x2F;usr&#x2F;local&#x2F;php&#x2F;lib&#x2F;php.ini 为php配置地址</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">vim /usr/local/php/lib/php.ini</span><br></pre></td></tr></table></figure>

<p>在php.ini中添加 <strong>extension &#x3D; redis.so</strong>;</p>
<p>7、查看php扩展结果</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">php -m</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux定时自动备份数据库</title>
    <url>/2024/11/11/Linux%E5%AE%9A%E6%97%B6%E8%87%AA%E5%8A%A8%E5%A4%87%E4%BB%BD%E6%95%B0%E6%8D%AE%E5%BA%93/</url>
    <content><![CDATA[<blockquote>
<p>数据库的备份是运维中非常重要的一环，定期备份数据库可以有效的防止数据丢失。特别是线上数据的备份尤为重要，养成定期备份数据库信息能有效的减少不必要的损失和麻烦。</p>
</blockquote>
<h3 id="备份脚本准备"><a href="#备份脚本准备" class="headerlink" title="备份脚本准备"></a>备份脚本准备</h3><p>首先先准备一个备份脚本<strong>mysql_autobackup.sh</strong>，将以我这里的目录为例，脚本内容：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1、原生mysql方式</span></span><br><span class="line">/usr/local/mysql/bin/mysqldump -uroot -p123456 --databases database_name &gt; /data/dbbank/back_`date +%F`.sql</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2、docker的方式</span></span><br><span class="line"></span><br><span class="line">/usr/bin/docker exec -i mysql  /bin/bash -c &#x27;mysqldump -uroot -p123456 --databases database_name&#x27; &gt; /data/dbbank/back_`date +%F`.sql</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-uroot 数据库用户名</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-p123456 数据库的密码</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">database_name 要备份的数据库名</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">/data/dbbank/back_`<span class="built_in">date</span> +%F`.sql 要保存的备份地址，并以日期命名</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<span id="more"></span>

<h3 id="删除30天以上的备份文件"><a href="#删除30天以上的备份文件" class="headerlink" title="删除30天以上的备份文件"></a>删除30天以上的备份文件</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">find /data/dbbank/ -mtime +30 -type f | xargs rm -f</span><br></pre></td></tr></table></figure>
<p>可以将这个脚本放置在mysql_autobackup.sh文件内容的后面。</p>
<h3 id="添加可执行权限"><a href="#添加可执行权限" class="headerlink" title="添加可执行权限"></a>添加可执行权限</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">chmod u+x mysql_autobackup.sh</span><br></pre></td></tr></table></figure>

<p>添加可执行权限之后先执行一下，看看脚本有没有错误，能不能正常使用。</p>
<h3 id="添加计划任务"><a href="#添加计划任务" class="headerlink" title="添加计划任务"></a>添加计划任务</h3><p>确认crontab是否安装，如果没安装，请自行安装</p>
<p>crontab中的脚本内容如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">0 8 * * * sh /data/mysql_autobackup.sh &gt; mysql_autobackup.log</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Mac pyenv的安装使用以及虚拟环境的管理</title>
    <url>/2020/05/26/Mac-pyenv%E7%9A%84%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8%E4%BB%A5%E5%8F%8A%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83%E7%9A%84%E7%AE%A1%E7%90%86/</url>
    <content><![CDATA[<h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>多python版本下的多环境在Mac上的安装，此处推荐的是pyenv，利用Mac包管理工具brew安装pyenv，pyenv用来管理所有的python版本。</p>
<h3 id="安装pyenv"><a href="#安装pyenv" class="headerlink" title="安装pyenv"></a>安装pyenv</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">brew install pyenv</span><br><span class="line">pyenv -v </span><br><span class="line">pyenv <span class="number">1.2</span>.<span class="number">18</span></span><br></pre></td></tr></table></figure>
<span id="more"></span>

<h3 id="查看所有的python版本（pyenv管理的所有的版本）"><a href="#查看所有的python版本（pyenv管理的所有的版本）" class="headerlink" title="查看所有的python版本（pyenv管理的所有的版本）"></a>查看所有的python版本（pyenv管理的所有的版本）</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">pyenv versions</span><br><span class="line"></span><br><span class="line">  system</span><br><span class="line">* <span class="number">3.6</span>.<span class="number">8</span> (set by /Users/xiexiang/.pyenv/version)</span><br><span class="line">  <span class="number">3.6</span>.<span class="number">8</span>/envs/api.mer.<span class="number">36</span></span><br><span class="line">  api.mer.<span class="number">36</span></span><br></pre></td></tr></table></figure>
<p>(*)表示当前正在使用的版本，system标识用的是系统的python版本，如果初次安装pyenv，这里只会显示system这个版本</p>
<h3 id="查看可安装的python版本"><a href="#查看可安装的python版本" class="headerlink" title="查看可安装的python版本"></a>查看可安装的python版本</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">pyenv install --<span class="keyword">list</span></span><br><span class="line"></span><br><span class="line">  <span class="number">2.7</span>.<span class="number">14</span></span><br><span class="line">  <span class="number">2.7</span>.<span class="number">15</span></span><br><span class="line">  <span class="number">2.7</span>.<span class="number">16</span></span><br><span class="line">  <span class="number">2.7</span>.<span class="number">17</span></span><br><span class="line">  <span class="number">3.0</span>.<span class="number">1</span></span><br><span class="line">  <span class="number">3.1</span>.<span class="number">0</span></span><br><span class="line">  <span class="number">3.1</span>.<span class="number">1</span></span><br><span class="line">  <span class="number">3.1</span>.<span class="number">2</span></span><br><span class="line">  <span class="number">3.1</span>.<span class="number">3</span></span><br><span class="line">  <span class="number">3.1</span>.<span class="number">4</span></span><br><span class="line">  <span class="number">3.1</span>.<span class="number">5</span></span><br><span class="line">  <span class="number">3.2</span>.<span class="number">0</span></span><br><span class="line">  <span class="number">3.2</span>.<span class="number">1</span></span><br><span class="line">  ....</span><br></pre></td></tr></table></figure>

<p>会列出很多的版本，这里列举部分</p>
<h3 id="选择版本进行安装"><a href="#选择版本进行安装" class="headerlink" title="选择版本进行安装"></a>选择版本进行安装</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$ pyenv install <span class="number">3.5</span>.<span class="number">5</span></span><br><span class="line">python-build: <span class="keyword">use</span> <span class="title">openssl</span> <span class="title">from</span> <span class="title">homebrew</span></span><br><span class="line"><span class="title">python</span>-<span class="title">build</span>: <span class="title">use</span> <span class="title">readline</span> <span class="title">from</span> <span class="title">homebrew</span></span><br><span class="line"><span class="title">Downloading</span> <span class="title">Python</span>-3.5.5.<span class="title">tar</span>.<span class="title">xz</span>...</span><br><span class="line">-&gt; <span class="title">https</span>://<span class="title">www</span>.<span class="title">python</span>.<span class="title">org</span>/<span class="title">ftp</span>/<span class="title">python</span>/3.5.5/<span class="title">Python</span>-3.5.5.<span class="title">tar</span>.<span class="title">xz</span></span><br><span class="line"><span class="title">Installing</span> <span class="title">Python</span>-3.5.5...</span><br><span class="line"><span class="title">python</span>-<span class="title">build</span>: <span class="title">use</span> <span class="title">readline</span> <span class="title">from</span> <span class="title">homebrew</span></span><br><span class="line"><span class="title">Installed</span> <span class="title">Python</span>-3.5.5 <span class="title">to</span> /<span class="title">Users</span>/<span class="title">xxx</span>/.<span class="title">pyenv</span>/<span class="title">versions</span>/3.5.5</span><br></pre></td></tr></table></figure>

<p>ok,这里是墙内环境，初次安装会一直卡死在这里，以下推荐两种方式</p>
<h4 id="1、利用搜狐提供的镜像网站先下载-推荐方式"><a href="#1、利用搜狐提供的镜像网站先下载-推荐方式" class="headerlink" title="1、利用搜狐提供的镜像网站先下载 (推荐方式)"></a>1、利用搜狐提供的镜像网站先下载 (推荐方式)</h4><p>可以先从搜狐的镜像网站下载指定的python版本到~&#x2F;.pyenv&#x2F;cache目录下，然后用pyenv install命令安装，就可以很快完成</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">wget http:<span class="comment">//mirrors.sohu.com/python/3.5.2/Python-3.5.2.tar.xz  -P ~/.pyenv/cache</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">root@localhost ~]<span class="comment"># pyenv install 3.5.2</span></span><br><span class="line">Installing Python-<span class="number">3.5</span>.<span class="number">2</span>...</span><br><span class="line">patching file Lib/venv/scripts/posix/activate.fish</span><br><span class="line">Installed Python-<span class="number">3.5</span>.<span class="number">2</span> to /root/.pyenv/versions/<span class="number">3.5</span>.<span class="number">2</span></span><br></pre></td></tr></table></figure>

<h4 id="2、使用国内镜像"><a href="#2、使用国内镜像" class="headerlink" title="2、使用国内镜像"></a>2、使用国内镜像</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">v=<span class="number">3.5</span>.<span class="number">5</span>|wget http:<span class="comment">//mirrors.sohu.com/python/$v/Python-$v.tar.xz -P ~/.pyenv/cache/;pyenv install $v</span></span><br></pre></td></tr></table></figure>


<h3 id="查看所有安装的版本"><a href="#查看所有安装的版本" class="headerlink" title="查看所有安装的版本"></a>查看所有安装的版本</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">pyenv versions</span><br><span class="line">  system</span><br><span class="line">* <span class="number">3.6</span>.<span class="number">8</span> (set by /Users/xiexiang/.pyenv/version)</span><br><span class="line">  <span class="number">3.6</span>.<span class="number">8</span>/envs/api.mer.<span class="number">36</span></span><br><span class="line">  api.mer.<span class="number">36</span></span><br></pre></td></tr></table></figure>

<p>这里会列出所有的通过pyenv安装的python版本</p>
<h3 id="切换版本"><a href="#切换版本" class="headerlink" title="切换版本"></a>切换版本</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">pyenv <span class="keyword">global</span> system <span class="comment">#全局切换</span></span><br><span class="line">python -V <span class="comment"># 查看是否切换成功</span></span><br></pre></td></tr></table></figure>
<p>此处也可以用local，只对当前目录生效</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">yenv local <span class="number">3.6</span>.<span class="number">8</span> <span class="comment"># 当前目录及其目录切</span></span><br><span class="line">python -V <span class="comment"># 验证一下是否切换成功</span></span><br></pre></td></tr></table></figure>

<p>ok,这时候在操作的时候会发现并不能正常的切换成功，这时候需要设置环境变量，把以下内容加到~&#x2F;.bash_profile中去</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">export PYENV_ROOT=~/.pyenv</span><br><span class="line">export PATH=<span class="variable">$PYENV_ROOT</span>/shims:<span class="variable">$PATH</span></span><br></pre></td></tr></table></figure>
<p>执行source ~&#x2F;.bash_profile 生效，这时候就可以成功切换了。</p>
<h3 id="卸载python版本"><a href="#卸载python版本" class="headerlink" title="卸载python版本"></a>卸载python版本</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">pyenv uninstall <span class="number">3.5</span>.<span class="number">5</span></span><br></pre></td></tr></table></figure>

<h3 id="查看pyenv指令列表"><a href="#查看pyenv指令列表" class="headerlink" title="查看pyenv指令列表"></a>查看pyenv指令列表</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$ pyenv commands</span><br><span class="line">--version</span><br><span class="line">commands</span><br><span class="line">completions</span><br><span class="line">exec</span><br><span class="line"><span class="keyword">global</span></span><br><span class="line">help</span><br><span class="line">hooks</span><br><span class="line">init</span><br><span class="line">install</span><br><span class="line">local</span><br><span class="line">prefix</span><br><span class="line">realpath.dylib</span><br><span class="line">rehash</span><br><span class="line">root</span><br><span class="line">shell</span><br><span class="line">shims</span><br><span class="line">uninstall</span><br><span class="line">version</span><br><span class="line">version-file</span><br><span class="line">version-file-read</span><br><span class="line">version-file-write</span><br><span class="line">version-name</span><br><span class="line">version-origin</span><br><span class="line">versions</span><br><span class="line">whence</span><br><span class="line">which</span><br></pre></td></tr></table></figure>

<h3 id="使用pyenv-virtualenv插件管理不同项目"><a href="#使用pyenv-virtualenv插件管理不同项目" class="headerlink" title="使用pyenv-virtualenv插件管理不同项目"></a>使用pyenv-virtualenv插件管理不同项目</h3><p>virtualenv本身是一个独立的工具，用户可以不使用pyenv单独使用virtualenv。但是，如果你使用了pyenv，就需要安装pyenv-virtualenv插件而不是virtualenv软件来使用virtualenv的功能。</p>
<p>pyenv-virtualenv pyenv-virtualenv</p>
<p>安装和使用pyenv-virtualenv插件如下：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$ git <span class="keyword">clone</span> https:<span class="comment">//github.com/yyuu/pyenv-virtualenv.git $(pyenv root)/plugins/pyenv-virtualenv</span></span><br><span class="line">Cloning into <span class="string">&#x27;/home/lmx/.pyenv/plugins/pyenv-virtualenv&#x27;</span>...</span><br><span class="line">remote: Counting objects: <span class="number">1860</span>, done.</span><br><span class="line">remote: Total <span class="number">1860</span> (delta <span class="number">0</span>), reused <span class="number">0</span> (delta <span class="number">0</span>), pack-reused <span class="number">1860</span></span><br><span class="line">Receiving objects: <span class="number">100</span>% (<span class="number">1860</span>/<span class="number">1860</span>), <span class="number">530.62</span> KiB | <span class="number">213</span> KiB/s, done.</span><br><span class="line">Resolving deltas: <span class="number">100</span>% (<span class="number">1274</span>/<span class="number">1274</span>), done.</span><br><span class="line">$ <span class="keyword">echo</span> <span class="string">&#x27;eval &quot;$(pyenv virtualenv-init -)&quot;&#x27;</span> &gt;&gt; ~/.bash_profile  <span class="comment"># 写入环境变量</span></span><br></pre></td></tr></table></figure>

<p>同样需要执行source ~&#x2F;.bash_profile</p>
<h3 id="不同python解释器，创建多个不同的工作环境"><a href="#不同python解释器，创建多个不同的工作环境" class="headerlink" title="不同python解释器，创建多个不同的工作环境"></a>不同python解释器，创建多个不同的工作环境</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">pyenv virtualenv <span class="number">3.6</span>.<span class="number">8</span> api.mer.<span class="number">36</span>  <span class="comment">#通过3.6.8创建一个环境</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">pyenv virtualenv system erp.<span class="number">27</span> <span class="comment">#通过系统版本2.7创建一个环境</span></span><br><span class="line"></span><br><span class="line">DEPRECATION: Python <span class="number">2.7</span> will reach the end of its life on January <span class="number">1</span>st, <span class="number">2020</span>. Please upgrade your Python <span class="keyword">as</span> Python <span class="number">2.7</span> won<span class="string">&#x27;t be maintained after that date. A future version of pip will drop support for Python 2.7.</span></span><br><span class="line"><span class="string">Looking in indexes: https://pypi.tuna.tsinghua.edu.cn/simple/</span></span><br><span class="line"><span class="string">Requirement already satisfied: virtualenv in /Library/Python/2.7/site-packages (16.4.3)</span></span><br><span class="line"><span class="string">WARNING: You are using pip version 19.1.1, however version 20.1.1 is available.</span></span><br><span class="line"><span class="string">You should consider upgrading via the &#x27;</span>pip install --upgrade pip<span class="string">&#x27; command.</span></span><br><span class="line"><span class="string">New python executable in /Users/xiexiang/.pyenv/versions/erp.27/bin/python</span></span><br><span class="line"><span class="string">Installing setuptools, pip, wheel...</span></span><br><span class="line"><span class="string">done.</span></span><br><span class="line"><span class="string">Looking in links: /var/folders/g1/11wx0xn9003_cwy38pnp0qzc0000gn/T/tmp5N31aZ</span></span><br><span class="line"><span class="string">Requirement already satisfied: setuptools in /Users/xiexiang/.pyenv/versions/erp.27/lib/python2.7/site-packages (44.1.0)</span></span><br><span class="line"><span class="string">Requirement already satisfied: pip in /Users/xiexiang/.pyenv/versions/erp.27/lib/python2.7/site-packages (20.1.1)</span></span><br></pre></td></tr></table></figure>

<h3 id="查看工作虚拟环境"><a href="#查看工作虚拟环境" class="headerlink" title="查看工作虚拟环境"></a>查看工作虚拟环境</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">pyenv virtualenvs</span><br><span class="line"></span><br><span class="line">  <span class="number">3.6</span>.<span class="number">8</span>/envs/api.mer.<span class="number">36</span> (created <span class="keyword">from</span> /Users/xiexiang/.pyenv/versions/<span class="number">3.6</span>.<span class="number">8</span>)</span><br><span class="line">  api.mer.<span class="number">36</span> (created <span class="keyword">from</span> /Users/xiexiang/.pyenv/versions/<span class="number">3.6</span>.<span class="number">8</span>)</span><br><span class="line">  erp.<span class="number">27</span> (created <span class="keyword">from</span> /System/Library/Frameworks/Python.framework/Versions/<span class="number">2.7</span>)</span><br></pre></td></tr></table></figure>

<h3 id="激活工作虚拟环境"><a href="#激活工作虚拟环境" class="headerlink" title="激活工作虚拟环境"></a>激活工作虚拟环境</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">pyenv activate erp.<span class="number">27</span></span><br></pre></td></tr></table></figure>
<p>** 自测遇到的问题，会报出如下的错误，这时候我重启了命令器也没有作用<br><img src="/../img/pyenv-img.jpg" alt="python"></p>
<p>解决方式：需要在~&#x2F;.zshrc下加入以下内容</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># pyenv config</span></span><br><span class="line">export PYENV_ROOT=<span class="string">&quot;<span class="subst">$HOME</span>/.pyenv&quot;</span></span><br><span class="line">export PATH=<span class="string">&quot;<span class="subst">$PYENV_ROOT</span>/bin:<span class="subst">$PATH</span>&quot;</span></span><br><span class="line"><span class="keyword">eval</span> <span class="string">&quot;$(/usr/local/bin/pyenv init -)&quot;</span></span><br><span class="line"><span class="keyword">if</span> which pyenv &gt; /dev/<span class="literal">null</span>; then <span class="keyword">eval</span> <span class="string">&quot;$(pyenv init -)&quot;</span>; fi</span><br></pre></td></tr></table></figure>
<p>添加后执行source ~&#x2F;.zshrc生效，重新尝试激活</p>
<h3 id="退出工作虚拟环境"><a href="#退出工作虚拟环境" class="headerlink" title="退出工作虚拟环境"></a>退出工作虚拟环境</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">pyenv deactivate</span><br></pre></td></tr></table></figure>

<h3 id="在不同的工作虚拟环境安装不同的Flask版本"><a href="#在不同的工作虚拟环境安装不同的Flask版本" class="headerlink" title="在不同的工作虚拟环境安装不同的Flask版本"></a>在不同的工作虚拟环境安装不同的Flask版本</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">pyenv activate first_project</span><br><span class="line">pip install flask==<span class="number">0.8</span></span><br><span class="line">pyenv deactivate</span><br><span class="line"></span><br><span class="line">pyenv activate second_project</span><br><span class="line">pip install flask==<span class="number">0.9</span></span><br><span class="line">pyenv deactivate</span><br></pre></td></tr></table></figure>

<h3 id="删除虚拟环境"><a href="#删除虚拟环境" class="headerlink" title="删除虚拟环境"></a>删除虚拟环境</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">pyenv virtualenv-delete erp.<span class="number">27</span></span><br><span class="line"></span><br><span class="line">pyenv-virtualenv: remove /Users/xiexiang/.pyenv/versions/erp.<span class="number">27</span>?  <span class="comment">#后面输入y 回车</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux搭建Laravel环境</title>
    <url>/2018/06/25/Linux%E6%90%AD%E5%BB%BALaravel%E7%8E%AF%E5%A2%83/</url>
    <content><![CDATA[<h3 id="安装composer"><a href="#安装composer" class="headerlink" title="安装composer"></a>安装composer</h3><p>composer.json 声明PHP依赖的第三方扩展的文件</p>
<p>加载该文件需要安装composer, composer是PHP的一个类库依赖管理机制，运行composer需要 php 5.3以上版本, 并且确定PHP CURL 扩展可用。</p>
<span id="more"></span>
<h3 id="nginx的配置情况"><a href="#nginx的配置情况" class="headerlink" title="nginx的配置情况"></a>nginx的配置情况</h3><p>下面先附上nginx的配置供参考</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">        listen   <span class="number">80</span>;      <span class="comment"># 端口号</span></span><br><span class="line"></span><br><span class="line">        root /data/cms-message/<span class="keyword">public</span>;         <span class="comment"># 站点指向的入口地址</span></span><br><span class="line">        index index.php index.html index.htm;  <span class="comment"># 能识别的入口文件</span></span><br><span class="line"></span><br><span class="line">        server_name localhost;   <span class="comment"># 域名配置</span></span><br><span class="line"></span><br><span class="line">        sendfile on;</span><br><span class="line"></span><br><span class="line">        error_log /<span class="keyword">var</span>/log/nginx/aa.log debug;   <span class="comment"># 错误日志地址配置</span></span><br><span class="line">        <span class="comment">#access_log /dev/stdout;</span></span><br><span class="line">        <span class="comment">#include /var/www/html/php-zzgg-un-web/htanginx;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#根据laravel规则进行url重写 </span></span><br><span class="line">        <span class="keyword">if</span> (!-e <span class="variable">$request_filename</span>)</span><br><span class="line">        &#123;</span><br><span class="line">          rewrite ^/(.*)$ /index.php?/$<span class="number">1</span> last;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        error_page <span class="number">404</span> /<span class="number">404</span>.html;</span><br><span class="line"></span><br><span class="line">        error_page <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span> /<span class="number">50</span>x.html;</span><br><span class="line">        location = /<span class="number">50</span>x.html &#123;</span><br><span class="line">                root /usr/share/nginx/html;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span></span><br><span class="line">        location ~ \.php$ &#123;</span><br><span class="line">                try_files <span class="variable">$uri</span> =<span class="number">404</span>;</span><br><span class="line">                fastcgi_split_path_info ^(.+\.php)(/.+)$;</span><br><span class="line">                <span class="comment">#fastcgi_pass unix:/var/run/php-fpm/php-fpm.sock; #如果系统有这个目录就配这个目录，没有就配置下面这个</span></span><br><span class="line">                fastcgi_pass  <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">9000</span>;</span><br><span class="line">                fastcgi_param SCRIPT_FILENAME <span class="variable">$document</span>_root<span class="variable">$fastcgi_script_name</span>;</span><br><span class="line">                fastcgi_param PATH_INFO <span class="variable">$uri</span>;</span><br><span class="line">                fastcgi_param SCRIPT_NAME <span class="variable">$fastcgi_script_name</span>;</span><br><span class="line">                fastcgi_index index.php;</span><br><span class="line">                <span class="keyword">include</span> fastcgi_params;</span><br><span class="line">        &#125;</span><br><span class="line">       </span><br><span class="line">        location ~* \.(jpg|jpeg|gif|png|css|js|ico|xml)$ &#123;</span><br><span class="line">                        expires           <span class="number">5</span>d;</span><br><span class="line">                &#125;</span><br><span class="line">        </span><br><span class="line">                <span class="comment"># deny access to . files, for security</span></span><br><span class="line">                <span class="comment">#</span></span><br><span class="line">                location ~ /\. &#123;</span><br><span class="line">                        log_not_found off;</span><br><span class="line">                        deny all;</span><br><span class="line">                &#125;</span><br><span class="line">        </span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<h3 id="laravel的主目录配置"><a href="#laravel的主目录配置" class="headerlink" title="laravel的主目录配置"></a>laravel的主目录配置</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">root /data/cms-message/<span class="keyword">public</span>     <span class="comment"># 为项目根目录下的public目录</span></span><br></pre></td></tr></table></figure>

<h3 id="url重写"><a href="#url重写" class="headerlink" title="url重写"></a>url重写</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#根据laravel规则进行url重写 </span></span><br><span class="line"><span class="keyword">if</span> (!-e <span class="variable">$request_filename</span>)</span><br><span class="line">&#123;</span><br><span class="line">  rewrite ^/(.*)$ /index.php?/$<span class="number">1</span> last;</span><br><span class="line">  <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>laravel规则下的url重写</p>
<h3 id="数据库配置"><a href="#数据库配置" class="headerlink" title="数据库配置"></a>数据库配置</h3><p>根目录.env</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">DB_CONNECTION=mysql</span><br><span class="line">DB_HOST=<span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line">DB_DATABASE=cms_message</span><br><span class="line">DB_USERNAME=root</span><br><span class="line">DB_PASSWORD=</span><br><span class="line">DB_PREFIX=msg_</span><br></pre></td></tr></table></figure>

<p>为安全起见，将root权限设置为只能本地访问。</p>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Node.js快速安装指南</title>
    <url>/2020/01/16/Node-js%E5%BF%AB%E9%80%9F%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/</url>
    <content><![CDATA[<h3 id="Linux上安装Node-js"><a href="#Linux上安装Node-js" class="headerlink" title="Linux上安装Node.js"></a>Linux上安装Node.js</h3><p>Node 官网（<a href="http://nodejs.cn/download/%EF%BC%89%E5%B7%B2%E7%BB%8F%E6%8A%8A">http://nodejs.cn/download/）已经把</a> linux 下载版本更改为已编译好的版本了，我们可以直接下载解压后使用：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># wget https://nodejs.org/dist/v10.9.0/node-v10.9.0-linux-x64.tar.xz    // 下载</span></span><br><span class="line"><span class="comment"># tar xf  node-v10.9.0-linux-x64.tar.xz       // 解压</span></span><br><span class="line"><span class="comment"># cd node-v10.9.0-linux-x64/                  // 进入解压目录</span></span><br><span class="line"><span class="comment"># ./bin/node -v                               // 执行node命令 查看版本</span></span><br><span class="line">v10.<span class="number">9.0</span></span><br></pre></td></tr></table></figure>

<p>解压文件的 bin 目录底下包含了 node、npm 等命令，我们可以使用 ln 命令来设置软连接：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">ln -s /usr/software/nodejs/bin/npm   /usr/local/bin/ </span><br><span class="line">ln -s /usr/software/nodejs/bin/node   /usr/local/bin/</span><br></pre></td></tr></table></figure>

<span id="more"></span>
<h3 id="Ubuntu-源码安装Node-js"><a href="#Ubuntu-源码安装Node-js" class="headerlink" title="Ubuntu 源码安装Node.js"></a>Ubuntu 源码安装Node.js</h3><p>以下部分我们将介绍在 Ubuntu Linux 下使用源码安装 Node.js 。 其他的 Linux 系统，如 Centos 等类似如下安装步骤。</p>
<p>在 Github 上获取 Node.js 源码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$ sudo git <span class="keyword">clone</span> https:<span class="comment">//github.com/nodejs/node.git</span></span><br><span class="line">Cloning into <span class="string">&#x27;node&#x27;</span>...</span><br></pre></td></tr></table></figure>

<p>修改目录权限：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$ sudo chmod -R <span class="number">755</span> node</span><br></pre></td></tr></table></figure>

<p>使用 .&#x2F;configure 创建编译文件，并按照：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$ cd node</span><br><span class="line">$ sudo ./configure</span><br><span class="line">$ sudo make</span><br><span class="line">$ sudo make install</span><br></pre></td></tr></table></figure>

<p>查看 node 版本：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$ node --version</span><br><span class="line">v0.<span class="number">10.25</span></span><br></pre></td></tr></table></figure>

<p>Ubuntu apt-get命令安装</p>
<p>命令格式如下:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">sudo apt-get install nodejs</span><br><span class="line">sudo apt-get install npm</span><br></pre></td></tr></table></figure>

<h3 id="Mac-OS-上安装"><a href="#Mac-OS-上安装" class="headerlink" title="Mac OS 上安装"></a>Mac OS 上安装</h3><p>在官方下载网站下载 pkg 安装包，直接点击安装即可。</p>
<p>使用 brew 命令来安装：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">brew install node</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>nodejs</category>
      </categories>
      <tags>
        <tag>nodejs</tag>
      </tags>
  </entry>
  <entry>
    <title>Nginx配置反向代理</title>
    <url>/2023/11/29/Nginx%E9%85%8D%E7%BD%AE%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/</url>
    <content><![CDATA[<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">[root@proxy ~]<span class="comment"># vi /etc/nginx/conf.d/forward.conf</span></span><br><span class="line">server &#123;</span><br><span class="line">    listen  <span class="number">80</span>;</span><br><span class="line">    server_name  forward.linuxds.com;</span><br><span class="line">    access_log  /<span class="keyword">var</span>/log/nginx/forward.access.log  main;</span><br><span class="line">    error_log   /<span class="keyword">var</span>/log/nginx/forward.error.log  warn;</span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass https:<span class="comment">//www.landiannews.com/;   #代理地址</span></span><br><span class="line">        proxy_redirect     off;</span><br><span class="line"><span class="comment">#        proxy_set_header   Host             $host;</span></span><br><span class="line">        proxy_set_header   X-Real-IP        <span class="variable">$remote_addr</span>;</span><br><span class="line">        proxy_set_header   X-Forwarded-For  <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        client_max_body_size       <span class="number">10</span>m;     <span class="comment">#允许客户端请求的最大单文件字节数</span></span><br><span class="line">        client_body_buffer_size    <span class="number">128</span>k;    <span class="comment">#缓冲区代理缓冲用户端请求的最大字节数</span></span><br><span class="line">        proxy_connect_timeout      <span class="number">300</span>;     <span class="comment">#nginx跟后端服务器连接超时时间(代理连接超时)</span></span><br><span class="line">        proxy_send_timeout         <span class="number">300</span>;     <span class="comment">#后端服务器数据回传时间(代理发送超时)</span></span><br><span class="line">        proxy_read_timeout         <span class="number">300</span>;     <span class="comment">#连接成功后，后端服务器响应时间(代理接收超时)</span></span><br><span class="line">        proxy_buffer_size          <span class="number">4</span>k;      <span class="comment">#设置代理服务器（nginx）保存用户头信息的缓冲区大小</span></span><br><span class="line">        proxy_buffers              <span class="number">4</span> <span class="number">32</span>k;   <span class="comment">#proxy_buffers缓冲区，网页平均在32k以下的话，这样设置</span></span><br><span class="line">        proxy_busy_buffers_size    <span class="number">64</span>k;     <span class="comment">#高负荷下缓冲大小（proxy_buffers*2）</span></span><br><span class="line">        proxy_temp_file_write_size <span class="number">64</span>k;     <span class="comment">#设定缓存文件夹大小，大于这个值，将从upstream服务器传</span></span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br><span class="line">  <span class="number">1</span> [root@proxy ~]<span class="comment"># nginx -t -c /etc/nginx/nginx.conf        	#检查配置文件</span></span><br><span class="line">  <span class="number">2</span> [root@proxy ~]<span class="comment"># nginx -s reload				#重载配置文件</span></span><br></pre></td></tr></table></figure>


<h4 id="配置释义"><a href="#配置释义" class="headerlink" title="配置释义"></a>配置释义</h4><p>proxy_set_header X-Real-IP $remote_addr：把源IP【$remote_addr，建立HTTP连接header里面的信息】赋值给X-Real-IP，从而通过$X-Real-IP来获取源IP；<br>proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for：在nginx作为代理服务器时，设置的IP列表，会把经过的机器ip，代理机器ip都记录下来，用【，】隔开。</p>
<span id="more"></span>


<h4 id="配置案例"><a href="#配置案例" class="headerlink" title="配置案例"></a>配置案例</h4><p>说明：服务器A想请求苹果的接口，但不想直接通过服务器A去请求，想通过服务器B去代理请求，同时要求伪装ip，配置如下</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">server</span><br><span class="line">&#123;</span><br><span class="line">        listen <span class="number">80</span>;</span><br><span class="line">        server_name proxygrow.nineton.cn;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 归因地址</span></span><br><span class="line">        location /adservices &#123;</span><br><span class="line">                proxy_pass  https:<span class="comment">//api-adservices.apple.com/api/v1;   #苹果接口地址</span></span><br><span class="line">                proxy_redirect     off;</span><br><span class="line">        <span class="comment">#        proxy_set_header   Host             $host;</span></span><br><span class="line">                proxy_set_header   X-Real-IP        <span class="variable">$remote_addr</span>;</span><br><span class="line">                proxy_set_header   X-Forwarded-For  <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">#error_page 404 = /404.php;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>nginx</category>
      </categories>
      <tags>
        <tag>nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>PHP中静态方法(static)与非静态方法的使用及区别</title>
    <url>/2018/02/02/PHP%E4%B8%AD%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95-static-%E4%B8%8E%E9%9D%9E%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95%E7%9A%84%E4%BD%BF%E7%94%A8%E5%8F%8A%E5%8C%BA%E5%88%AB/</url>
    <content><![CDATA[<h3 id="表述"><a href="#表述" class="headerlink" title="表述"></a>表述</h3><ul>
<li>static方法是类中的一个成员方法,属于整个类,即使不用创建任何对象也可以直接调用!</li>
<li>静态方法效率上要比实例化高，静态方法的缺点是不自动进行销毁，而实例化的则可以做销毁</li>
<li>静态方法和静态变量创建后始终使用同一块内存，而使用实例的方式会创建多个内存。</li>
<li>C++中，若类的方法前加了static关键字，则该方法称为静态方法，反之为实例方法。静态方法为类所有，可以通过对象来使用，也可以通过类来使用。但一般提倡通过类名来使用，因为静态方法只要定义了类，不必建立类的实例就可使用。静态方法只能用类的静态成员</li>
<li>static关键字用来修饰属性、方法，称这些属性、方法为静态属性、静态方法。</li>
<li>static关键字声明一个属性或方法是和类相关的，而不是和类的某个特定的实例相关，因此，这类属性或方法也称为“类属性”或“类方法”</li>
<li>如果访问控制权限允许，可不必创建该类对象而直接使用类名加两个冒号“::”调用。</li>
<li>static关键字可以用来修饰变量、方法。</li>
<li>不经过实例化，就可以直接访问类中static的属性和static的方法。</li>
<li>static 的属性和方法，只能访问static的属性和方法，不能类访问非静态的属性和方法。因为静态属性和方法被创建时，可能还没有任何这个类的实例可以被调用.</li>
<li>static的属性，在内存中只有一份，为所有的实例共用</li>
<li>使用self:: 关键字访问当前类的静态成员.</li>
<li>一个类的所有实例，共用类中的静态属性<span id="more"></span></li>
</ul>
<h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><p>下面例子中的设置了一个计数器$count属性，设置private 和 static 修饰。<br>这样，外界并不能直接访问$count属性。而程序运行的结果我们也看到多个实例在使用同一个静态的$count 属性</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?</span>PHP     </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">user</span>   </span></span><br><span class="line"><span class="class"></span>&#123;     </span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">static</span> <span class="variable">$count</span> = <span class="number">0</span> ; <span class="comment">//记录所有用户的登录情况.     </span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;     </span><br><span class="line">        <span class="built_in">self</span>::<span class="variable">$count</span> = <span class="built_in">self</span>::<span class="variable">$count</span> + <span class="number">1</span>;     </span><br><span class="line">    &#125;     </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getCount</span>(<span class="params"></span>) </span>&#123;       </span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">self</span>::<span class="variable">$count</span>;     </span><br><span class="line">    &#125;     </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;     </span><br><span class="line">        <span class="built_in">self</span>::<span class="variable">$count</span> = <span class="built_in">self</span>::<span class="variable">$count</span> - <span class="number">1</span>;     </span><br><span class="line">    &#125;     </span><br><span class="line">&#125;     </span><br><span class="line"><span class="variable">$user1</span> = <span class="keyword">new</span> <span class="title function_ invoke__">user</span>();     </span><br><span class="line"><span class="variable">$user2</span> = <span class="keyword">new</span> <span class="title function_ invoke__">user</span>();     </span><br><span class="line"><span class="variable">$user3</span> = <span class="keyword">new</span> <span class="title function_ invoke__">user</span>();     </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;now here have &quot;</span> . <span class="variable">$user1</span>-&gt;<span class="title function_ invoke__">getCount</span>() . <span class="string">&quot; user&quot;</span>;     </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br /&gt;&quot;</span>;     </span><br><span class="line"><span class="keyword">unset</span>(<span class="variable">$user3</span>);     </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;now here have &quot;</span> . <span class="variable">$user1</span>-&gt;<span class="title function_ invoke__">getCount</span>() . <span class="string">&quot; user&quot;</span>;     </span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>静态属性直接调用,静态属性不需要实例化就可以直接使用，在类还没有创建时就可以直接使用</p>
<p>使用的方式是： 类名::静态属性名</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>     </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Math</span>   </span></span><br><span class="line"><span class="class"></span>&#123;     </span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="variable">$pi</span> = <span class="number">3.14</span>;     </span><br><span class="line">&#125;     </span><br><span class="line"><span class="comment">// 求一个半径3的园的面积。     </span></span><br><span class="line"><span class="variable">$r</span> = <span class="number">3</span>;     </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;半径是 <span class="subst">$r</span> 的面积是&lt;br /&gt;&quot;</span>;     </span><br><span class="line"><span class="keyword">echo</span> <span class="title class_">Math</span>::<span class="variable">$pi</span> * <span class="variable">$r</span> * <span class="variable">$r</span>;     </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br /&gt;&lt;br /&gt;&quot;</span>;     </span><br><span class="line"><span class="comment">//这里我觉得 3.14 不够精确，我把它设置的更精确。     </span></span><br><span class="line"><span class="title class_">Math</span>::<span class="variable">$pi</span> = <span class="number">3.141592653589793</span>;     </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;半径是 <span class="subst">$r</span> 的面积是&lt;br /&gt;&quot;</span>;     </span><br><span class="line"><span class="keyword">echo</span> <span class="title class_">Math</span>::<span class="variable">$pi</span> * <span class="variable">$r</span> * <span class="variable">$r</span>;      </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>类没有创建，静态属性就可以直接使用。那静态属性在什么时候在内存中被创建？ 在PHP中没有看到相关的资料。引用Java中的概念，来解释应该也具有通用性</p>
<p>静态方法<br>静态方法不需要所在类被实例化就可以直接使用。</p>
<p>使用的方式是类名：：静态方法名</p>
<p>下面我们继续写这个Math类，用来进行数学计算。我们设计一个方法用来算出其中的最大值。既然是数学运算，我们也没有必要去实例化这个类，如果这个方法</p>
<p>可以拿过来就用就方便多了。我们这只是为了演示static方法而设计的这个类。在PHP提供了 max() 函数比较数值。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>     </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Math</span>   </span></span><br><span class="line"><span class="class"></span>&#123;     </span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">Max</span>(<span class="params"><span class="variable">$num1</span>, <span class="variable">$num2</span></span>) </span>&#123;     </span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$num1</span> &gt; <span class="variable">$num2</span> ? <span class="variable">$num1</span> : <span class="variable">$num2</span>;     </span><br><span class="line">    &#125;          </span><br><span class="line">&#125;     </span><br><span class="line"><span class="variable">$a</span> = <span class="number">99</span>;     </span><br><span class="line"><span class="variable">$b</span> = <span class="number">88</span>;     </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;显示 <span class="subst">$a</span> 和 <span class="subst">$b</span> 中的最大值是&quot;</span>;     </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br /&gt;&quot;</span>;     </span><br><span class="line"><span class="keyword">echo</span> <span class="title class_">Math</span>::<span class="title function_ invoke__">Max</span>(<span class="variable">$a</span>, <span class="variable">$b</span>);     </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br /&gt;&quot;</span>;   </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br /&gt;&quot;</span>;   </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br /&gt;&quot;</span>;     </span><br><span class="line"><span class="variable">$a</span> = <span class="number">99</span>;     </span><br><span class="line"><span class="variable">$b</span> = <span class="number">100</span>;     </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;显示 <span class="subst">$a</span> 和 <span class="subst">$b</span> 中的最大值是&quot;</span>;     </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br /&gt;&quot;</span>;     </span><br><span class="line"><span class="keyword">echo</span> <span class="title class_">Math</span>::<span class="title function_ invoke__">Max</span>(<span class="variable">$a</span>,<span class="variable">$b</span>);     </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>静态方法如何调用静态方法<br>第一个例子，一个静态方法调用其它静态方法时，使用self::</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>     </span><br><span class="line"><span class="comment">// 实现最大值比较的Math类。     </span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Math</span>   </span></span><br><span class="line"><span class="class"></span>&#123;     </span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">Max</span>(<span class="params"><span class="variable">$num1</span>, <span class="variable">$num2</span></span>) </span>&#123;     </span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$num1</span> &gt; <span class="variable">$num2</span> ? <span class="variable">$num1</span> : <span class="variable">$num2</span>;     </span><br><span class="line">    &#125;     </span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">Max3</span>(<span class="params"><span class="variable">$num1</span>, <span class="variable">$num2</span>, <span class="variable">$num3</span></span>) </span>&#123;     </span><br><span class="line">        <span class="variable">$num1</span> = <span class="built_in">self</span>::<span class="title function_ invoke__">Max</span>(<span class="variable">$num1</span>, <span class="variable">$num2</span>);     </span><br><span class="line">        <span class="variable">$num2</span> = <span class="built_in">self</span>::<span class="title function_ invoke__">Max</span>(<span class="variable">$num2</span>, <span class="variable">$num3</span>);     </span><br><span class="line">        <span class="variable">$num1</span> = <span class="built_in">self</span>::<span class="title function_ invoke__">Max</span>(<span class="variable">$num1</span>, <span class="variable">$num2</span>);             </span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$num1</span>;     </span><br><span class="line">    &#125;     </span><br><span class="line">&#125;     </span><br><span class="line"><span class="variable">$a</span> = <span class="number">99</span>;     </span><br><span class="line"><span class="variable">$b</span> = <span class="number">77</span>;     </span><br><span class="line"><span class="variable">$c</span> = <span class="number">88</span>;     </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;显示 <span class="subst">$a</span> <span class="subst">$b</span> <span class="subst">$c</span> 中的最大值是&quot;</span>;     </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br /&gt;&quot;</span>;     </span><br><span class="line"><span class="keyword">echo</span> <span class="title class_">Math</span>::<span class="title function_ invoke__">Max3</span>(<span class="variable">$a</span>, <span class="variable">$b</span>, <span class="variable">$c</span>);     </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>静态方法调用静态属性<br>使用self:: 调用本类的静态属性。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>     </span><br><span class="line"><span class="comment">//      </span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Circle</span>   </span></span><br><span class="line"><span class="class"></span>&#123;     </span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="variable">$pi</span> = <span class="number">3.14</span>;     </span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">circleAcreage</span>(<span class="params"><span class="variable">$r</span></span>) </span>&#123;     </span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$r</span> * <span class="variable">$r</span> * <span class="built_in">self</span>::<span class="variable">$pi</span>;     </span><br><span class="line">    &#125;     </span><br><span class="line">&#125;     </span><br><span class="line"><span class="variable">$r</span> = <span class="number">3</span>;     </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot; 半径 <span class="subst">$r</span> 的圆的面积是 &quot;</span> . <span class="title class_">Circle</span>::<span class="title function_ invoke__">circleAcreage</span>(<span class="variable">$r</span>);     </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>静态方法不能调用非静态属性 。不能使用self::调用非静态属性。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>     </span><br><span class="line"><span class="comment">// 这个方式是错误的     </span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Circle</span>   </span></span><br><span class="line"><span class="class"></span>&#123;     </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$pi</span> = <span class="number">3.14</span>;     </span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">circleAcreage</span>(<span class="params"><span class="variable">$r</span></span>) </span>&#123;     </span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$r</span> * <span class="variable">$r</span> * <span class="built_in">self</span>::<span class="variable constant_">pi</span>;     </span><br><span class="line">    &#125;     </span><br><span class="line">&#125;     </span><br><span class="line"><span class="variable">$r</span> = <span class="number">3</span>;     </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot; 半径 <span class="subst">$r</span> 的圆的面积是 &quot;</span> . <span class="title class_">Circle</span>::<span class="title function_ invoke__">circleAcreage</span>(<span class="variable">$r</span>);     </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>也不能使用 $this 获取非静态属性的值。</p>
<p>静态方法调用非静态方法<br>PHP5中，在静态方法中不能使用 $this 标识调用非静态方法.</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>   </span><br><span class="line"><span class="comment">// 实现最大值比较的Math类。     </span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Math</span>   </span></span><br><span class="line"><span class="class"></span>&#123;         </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">Max</span>(<span class="params"><span class="variable">$num1</span>, <span class="variable">$num2</span></span>) </span>&#123;     </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;bad&lt;br /&gt;&quot;</span>;             </span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$num1</span> &gt; <span class="variable">$num2</span> ? <span class="variable">$num1</span> : <span class="variable">$num2</span>;     </span><br><span class="line">    &#125;     </span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">Max3</span>(<span class="params"><span class="variable">$num1</span>, <span class="variable">$num2</span>, <span class="variable">$num3</span></span>) </span>&#123;     </span><br><span class="line">        <span class="variable">$num1</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">Max</span>(<span class="variable">$num1</span>, <span class="variable">$num2</span>);     </span><br><span class="line">        <span class="variable">$num2</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">Max</span>(<span class="variable">$num2</span>, <span class="variable">$num3</span>);     </span><br><span class="line">        <span class="variable">$num1</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">Max</span>(<span class="variable">$num1</span>, <span class="variable">$num2</span>);             </span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$num1</span>;     </span><br><span class="line">    &#125;     </span><br><span class="line">&#125;     </span><br><span class="line"><span class="variable">$a</span> = <span class="number">99</span>;     </span><br><span class="line"><span class="variable">$b</span> = <span class="number">77</span>;     </span><br><span class="line"><span class="variable">$c</span> = <span class="number">188</span>;     </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;显示 <span class="subst">$a</span> <span class="subst">$b</span> <span class="subst">$c</span> 中的最大值是&quot;</span>;     </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br /&gt;&quot;</span>;     </span><br><span class="line"><span class="keyword">echo</span> <span class="title class_">Math</span>::<span class="title function_ invoke__">Max3</span>(<span class="variable">$a</span>, <span class="variable">$b</span>, <span class="variable">$c</span>);    <span class="comment">//同样的这个会报错    </span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>当一个类中有非静态方法被self:: 调用时，系统会自动将这个方法转换为静态方法。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>     </span><br><span class="line"><span class="comment">// 实现最大值比较的Math类。     </span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Math</span>   </span></span><br><span class="line"><span class="class"></span>&#123;         </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">Max</span>(<span class="params"><span class="variable">$num1</span>, <span class="variable">$num2</span></span>) </span>&#123;            </span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$num1</span> &gt; <span class="variable">$num2</span> ? <span class="variable">$num1</span> : <span class="variable">$num2</span>;     </span><br><span class="line">    &#125;     </span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">Max3</span>(<span class="params"><span class="variable">$num1</span>, <span class="variable">$num2</span>, <span class="variable">$num3</span></span>) </span>&#123;     </span><br><span class="line">        <span class="variable">$num1</span> = <span class="built_in">self</span>::<span class="title function_ invoke__">Max</span>(<span class="variable">$num1</span>, <span class="variable">$num2</span>);     </span><br><span class="line">        <span class="variable">$num2</span> = <span class="built_in">self</span>::<span class="title function_ invoke__">Max</span>(<span class="variable">$num2</span>, <span class="variable">$num3</span>);     </span><br><span class="line">        <span class="variable">$num1</span> = <span class="built_in">self</span>::<span class="title function_ invoke__">Max</span>(<span class="variable">$num1</span>, <span class="variable">$num2</span>);             </span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$num1</span>;     </span><br><span class="line">    &#125;     </span><br><span class="line">&#125;     </span><br><span class="line"><span class="variable">$a</span> = <span class="number">99</span>;     </span><br><span class="line"><span class="variable">$b</span> = <span class="number">77</span>;     </span><br><span class="line"><span class="variable">$c</span> = <span class="number">188</span>;     </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;显示 <span class="subst">$a</span> <span class="subst">$b</span> <span class="subst">$c</span> 中的最大值是&quot;</span>;     </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br /&gt;&quot;</span>;     </span><br><span class="line"><span class="keyword">echo</span> <span class="title class_">Math</span>::<span class="title function_ invoke__">Max3</span>(<span class="variable">$a</span>, <span class="variable">$b</span>, <span class="variable">$c</span>);     </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>php</category>
      </categories>
      <tags>
        <tag>php</tag>
      </tags>
  </entry>
  <entry>
    <title>PHP实现JWT处理逻辑</title>
    <url>/2023/08/15/PHP%E5%AE%9E%E7%8E%B0JWT%E5%A4%84%E7%90%86%E9%80%BB%E8%BE%91/</url>
    <content><![CDATA[<p>JWT由三个部分组成：header.payload.signature<br><img src="/../img/jwt.jpeg" alt="php"></p>
<h4 id="header部分："><a href="#header部分：" class="headerlink" title="header部分："></a>header部分：</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;alg&quot;</span>: <span class="string">&quot;HS256&quot;</span>,</span><br><span class="line">  <span class="string">&quot;typ&quot;</span>: <span class="string">&quot;JWT&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<p>对应base64UrlEncode编码为：eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9</p>
<p>说明：该字段为json格式。alg字段指定了生成signature的算法，默认值为 HS256，typ默认值为JWT</p>
<h4 id="payload部分："><a href="#payload部分：" class="headerlink" title="payload部分："></a>payload部分：</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;sub&quot;</span>: <span class="string">&quot;1234567890&quot;</span>,</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;John Doe&quot;</span>,</span><br><span class="line">  <span class="string">&quot;iat&quot;</span>: <span class="number">1516239022</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对应base64UrlEncode编码为：eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ</p>
<p>说明：该字段为json格式，表明用户身份的数据，可以自己自定义字段，很灵活。sub 面向的用户，name 姓名 ,iat 签发时间。例如可自定义示例如下：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;iss&quot;</span>: <span class="string">&quot;admin&quot;</span>,            <span class="comment">//该JWT的签发者</span></span><br><span class="line">    <span class="string">&quot;iat&quot;</span>: <span class="number">1535967430</span>,         <span class="comment">//签发时间</span></span><br><span class="line">    <span class="string">&quot;exp&quot;</span>: <span class="number">1535974630</span>,         <span class="comment">//过期时间</span></span><br><span class="line">    <span class="string">&quot;nbf&quot;</span>: <span class="number">1535967430</span>,         <span class="comment">//该时间之前不接收处理该Token</span></span><br><span class="line">    <span class="string">&quot;sub&quot;</span>: <span class="string">&quot;www.admin.com&quot;</span>,    <span class="comment">//面向的用户</span></span><br><span class="line">    <span class="string">&quot;jti&quot;</span>: <span class="string">&quot;9f10e796726e332cec401c569969e13e&quot;</span>   <span class="comment">//该Token唯一标识</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="signature部分："><a href="#signature部分：" class="headerlink" title="signature部分："></a>signature部分：</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">HMACSHA256</span>(</span><br><span class="line">  <span class="title function_ invoke__">base64UrlEncode</span>(header) + <span class="string">&quot;.&quot;</span> +</span><br><span class="line">  <span class="title function_ invoke__">base64UrlEncode</span>(payload),</span><br><span class="line">  <span class="number">123456</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>对应的签名为：keH6T3x1z7mmhKL1T3r9sQdAxxdzB6siemGMr_6ZOwU</p>
<p>最终得到的JWT的Token为(header.payload.signature)：eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.keH6T3x1z7mmhKL1T3r9sQdAxxdzB6siemGMr_6ZOwU</p>
<p>说明：对header和payload进行base64UrlEncode编码后进行拼接。通过key（这里是123456）进行HS256算法签名。</p>
<h4 id="JWT使用流程"><a href="#JWT使用流程" class="headerlink" title="JWT使用流程"></a>JWT使用流程</h4><ul>
<li>初次登录：用户初次登录，输入用户名密码 <br/></li>
<li>密码验证：服务器从数据库取出用户名和密码进行验证 <br/></li>
<li>生成JWT：服务器端验证通过，根据从数据库返回的信息，以及预设规则，生成JWT <br/></li>
<li>返还JWT：服务器的HTTP RESPONSE中将JWT返还 <br/></li>
<li>带JWT的请求：以后客户端发起请求，HTTP REQUEST <br/></li>
<li>HEADER中的Authorizatio字段都要有值，为JWT <br/></li>
<li>服务器验证JWT <br/></li>
</ul>
<h4 id="相比token而言"><a href="#相比token而言" class="headerlink" title="相比token而言"></a>相比token而言</h4><blockquote>
<p>相比token而言使用方式上和服务器的开销上有区别，原始的token在用户登录后（api同理）会给前端返回一个token同时服务器也需要存储这个token，前端在请求业务接口时会携带这个token，而服务器需要每次进行对token进行校验、数据库查询，检验是否合法；<br>而JWT的方式与token有一定区别，最大的区别在于前端每次请求后端携带的token服务端是不需要存储的，合法校验这一步换成通过JWT去校验，从而减少服务端的开销与资源浪费</p>
</blockquote>
<h4 id="JWT-php依赖的引入"><a href="#JWT-php依赖的引入" class="headerlink" title="JWT-php依赖的引入"></a>JWT-php依赖的引入</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">composer <span class="keyword">require</span> firebase/php-jwt</span><br></pre></td></tr></table></figure>

<h4 id="方法封装"><a href="#方法封装" class="headerlink" title="方法封装"></a>方法封装</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">app</span>\<span class="title class_">common</span>\<span class="title class_">service</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">DomainException</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Firebase</span>\<span class="title">JWT</span>\<span class="title">ExpiredException</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Firebase</span>\<span class="title">JWT</span>\<span class="title">JWT</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Firebase</span>\<span class="title">JWT</span>\<span class="title">Key</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Firebase</span>\<span class="title">JWT</span>\<span class="title">SignatureInvalidException</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">InvalidArgumentException</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">UnexpectedValueException</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">JWTService</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">// 服务端随机key</span></span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">PRIVATE_KEY</span> = <span class="string">&quot;KOWl3yJFuB5K3QG9Vae6wCiCgenirgWC&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * - jwt生成token</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $payload     // payload</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $expire_time // 过期时间戳</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $key         // 自身秘钥</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $alg         // 算法签名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">jwt_encode</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="keyword">array</span>  <span class="variable">$payload</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="keyword">int</span>    <span class="variable">$expire_time</span> = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="keyword">string</span> <span class="variable">$key</span> = <span class="built_in">self</span>::<span class="variable constant_">PRIVATE_KEY</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="keyword">string</span> <span class="variable">$alg</span> = <span class="string">&quot;HS256&quot;</span></span></span></span><br><span class="line"><span class="params"><span class="function">    </span>): <span class="title">string</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$expire_time</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="variable">$payload</span>[<span class="string">&#x27;exp&#x27;</span>] = <span class="variable">$expire_time</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> JWT::<span class="title function_ invoke__">encode</span>(<span class="variable">$payload</span>, <span class="variable">$key</span>, <span class="variable">$alg</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * - JWT  解析token</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $token   // token</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $key     // 自身秘钥</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $alg     // 算法签名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">jwt_decode</span>(<span class="params"><span class="variable">$token</span>, <span class="keyword">string</span> <span class="variable">$key</span> = <span class="built_in">self</span>::<span class="variable constant_">PRIVATE_KEY</span>, <span class="keyword">string</span> <span class="variable">$alg</span> = <span class="string">&quot;HS256&quot;</span></span>): <span class="title">array</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="variable">$decoded_arr</span> = JWT::<span class="title function_ invoke__">decode</span>(<span class="variable">$token</span>, <span class="keyword">new</span> <span class="title class_">Key</span>(<span class="variable">$key</span>, <span class="variable">$alg</span>));</span><br><span class="line">            <span class="keyword">return</span> [<span class="literal">true</span>, <span class="string">&quot;处理成功&quot;</span>, <span class="variable">$decoded_arr</span>];</span><br><span class="line">        <span class="comment">// 参数无效异常</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="built_in">InvalidArgumentException</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> [<span class="literal">false</span>, <span class="string">&quot;参数错误:&quot;</span>.<span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>()];</span><br><span class="line">        <span class="comment">// 算法不支持or提供的秘钥无效 等异常</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="built_in">DomainException</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> [<span class="literal">false</span>, <span class="string">&quot;算法错误:&quot;</span>.<span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>()];</span><br><span class="line">        <span class="comment">// 签名异常</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (SignatureInvalidException <span class="variable">$e</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> [<span class="literal">false</span>, <span class="string">&quot;签名错误:&quot;</span>.<span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>()];</span><br><span class="line">        <span class="comment">// 过期异常捕获</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (ExpiredException <span class="variable">$e</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> [<span class="literal">false</span>, <span class="string">&quot;签名已过期:&quot;</span>.<span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>()];</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="built_in">UnexpectedValueException</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> [<span class="literal">false</span>, <span class="string">&quot;异常:&quot;</span>.<span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>()];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$payload</span> = [</span><br><span class="line">    <span class="string">&#x27;user_name&#x27;</span> =&gt; <span class="string">&quot;xiexiang&quot;</span>,</span><br><span class="line">    <span class="string">&#x27;password&#x27;</span>  =&gt; <span class="string">&quot;123456&quot;</span>,</span><br><span class="line">    <span class="string">&#x27;sex&#x27;</span>       =&gt; <span class="number">1</span>,</span><br><span class="line">    <span class="string">&#x27;age&#x27;</span>       =&gt; <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;exp&#x27;</span>       =&gt; <span class="number">1692063675</span>   <span class="comment">// 设置过期时间戳</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="variable">$token</span> = (<span class="keyword">new</span> <span class="title class_">JWTService</span>())-&gt;<span class="title function_ invoke__">jwt_encode</span>(<span class="variable">$payload</span>);</span><br><span class="line">[<span class="variable">$status</span>, <span class="variable">$msg</span>, <span class="variable">$data</span>] = (<span class="keyword">new</span> <span class="title class_">JWTService</span>())-&gt;<span class="title function_ invoke__">jwt_decode</span>(<span class="variable">$token</span>);</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$status</span>, <span class="variable">$msg</span>, (<span class="keyword">array</span>)<span class="variable">$data</span>);<span class="keyword">die</span>;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>php</category>
      </categories>
      <tags>
        <tag>php</tag>
      </tags>
  </entry>
  <entry>
    <title>PHP实现的敏感词过滤方法</title>
    <url>/2023/03/21/PHP%E5%AE%9E%E7%8E%B0%E7%9A%84%E6%95%8F%E6%84%9F%E8%AF%8D%E8%BF%87%E6%BB%A4%E6%96%B9%E6%B3%95/</url>
    <content><![CDATA[<p>PHP实现的敏感词过滤方法,以下是一份过滤敏感词的编码。有需要可以参考参考。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@todo</span> 敏感词过滤，返回结果</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> array $list 定义敏感词一维数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string $string 要过滤的内容</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> string $log 处理结果</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sensitive</span>(<span class="params"><span class="variable">$list</span>, <span class="variable">$string</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$count</span> = <span class="number">0</span>; <span class="comment">//违规词的个数</span></span><br><span class="line">    <span class="variable">$sensitiveWord</span> = <span class="string">&#x27;&#x27;</span>; <span class="comment">//违规词</span></span><br><span class="line">    <span class="variable">$stringAfter</span> = <span class="variable">$string</span>; <span class="comment">//替换后的内容</span></span><br><span class="line">    <span class="variable">$pattern</span> = <span class="string">&quot;/&quot;</span>.<span class="title function_ invoke__">implode</span>(<span class="string">&quot;|&quot;</span>,<span class="variable">$list</span>).<span class="string">&quot;/i&quot;</span>; <span class="comment">//定义正则表达式</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match_all</span>(<span class="variable">$pattern</span>, <span class="variable">$string</span>, <span class="variable">$matches</span>))&#123; <span class="comment">//匹配到了结果</span></span><br><span class="line">        <span class="variable">$patternList</span> = <span class="variable">$matches</span>[<span class="number">0</span>]; <span class="comment">//匹配到的数组</span></span><br><span class="line">        <span class="variable">$count</span> = <span class="title function_ invoke__">count</span>(<span class="variable">$patternList</span>);</span><br><span class="line">        <span class="variable">$sensitiveWord</span> = <span class="title function_ invoke__">implode</span>(<span class="string">&#x27;,&#x27;</span>, <span class="variable">$patternList</span>); <span class="comment">//敏感词数组转字符串</span></span><br><span class="line">        <span class="variable">$replaceArray</span> = <span class="title function_ invoke__">array_combine</span>(<span class="variable">$patternList</span>,<span class="title function_ invoke__">array_fill</span>(<span class="number">0</span>,<span class="title function_ invoke__">count</span>(<span class="variable">$patternList</span>),<span class="string">&#x27;*&#x27;</span>)); <span class="comment">//把匹配到的数组进行合并，替换使用</span></span><br><span class="line">        <span class="variable">$stringAfter</span> = <span class="title function_ invoke__">strtr</span>(<span class="variable">$string</span>, <span class="variable">$replaceArray</span>); <span class="comment">//结果替换</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$log</span> = <span class="string">&quot;原句为 [ <span class="subst">&#123;$string&#125;</span> ]&lt;br/&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$count</span>==<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="variable">$log</span> .= <span class="string">&quot;暂未匹配到敏感词！&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$log</span> .= <span class="string">&quot;匹配到 [ <span class="subst">&#123;$count&#125;</span> ]个敏感词：[ <span class="subst">&#123;$sensitiveWord&#125;</span> ]&lt;br/&gt;&quot;</span>.</span><br><span class="line">            <span class="string">&quot;替换后为：[ <span class="subst">&#123;$stringAfter&#125;</span> ]&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$log</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<p>调用方法</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">testAction</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">     <span class="variable">$string</span> = <span class="string">&#x27;likeyou小白喜欢小黑爱着的大黄&#x27;</span>; <span class="comment">//要过滤的内容</span></span><br><span class="line">     <span class="variable">$list</span> = [<span class="string">&#x27;小明&#x27;</span>, <span class="string">&#x27;小红&#x27;</span>, <span class="string">&#x27;大白&#x27;</span>, <span class="string">&#x27;小白&#x27;</span>, <span class="string">&#x27;小黑&#x27;</span>, <span class="string">&#x27;me&#x27;</span>, <span class="string">&#x27;you&#x27;</span>]; <span class="comment">//定义敏感词数组</span></span><br><span class="line">     <span class="variable">$result</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">sensitive</span>(<span class="variable">$list</span>, <span class="variable">$string</span>);</span><br><span class="line">     <span class="keyword">echo</span> (<span class="variable">$result</span>);</span><br><span class="line">     <span class="keyword">die</span>;</span><br><span class="line">     <span class="comment">//打印结果：</span></span><br><span class="line">     <span class="comment">/*</span></span><br><span class="line"><span class="comment">        原句为 [ likeyou小白喜欢小黑爱着的大黄 ]</span></span><br><span class="line"><span class="comment">        匹配到 [ 3 ]个敏感词：[ you,小白,小黑 ]</span></span><br><span class="line"><span class="comment">        替换后为：[ like**喜欢*爱着的大黄 ]</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>php</category>
      </categories>
      <tags>
        <tag>php</tag>
      </tags>
  </entry>
  <entry>
    <title>Mac下清洗硬盘空间大小</title>
    <url>/2018/10/23/Mac%E4%B8%8B%E6%B8%85%E6%B4%97%E7%A1%AC%E7%9B%98%E7%A9%BA%E9%97%B4%E5%A4%A7%E5%B0%8F/</url>
    <content><![CDATA[<h3 id="方法一："><a href="#方法一：" class="headerlink" title="方法一："></a>方法一：</h3><p>地址：&#x2F;Users&#x2F;xiexiang&#x2F;Library&#x2F;Containers</p>
<p>资源库中的Containers文件夹：里面都是各软件对应的个人数据，能够从文件名上辨别出来，可以使用du -sh * 命令查看每个文件对应的大小，根据个人情况可以删除里面对应的文件，大约可以省出15G左右的空间。</p>
<span id="more"></span>
<h3 id="方法二："><a href="#方法二：" class="headerlink" title="方法二："></a>方法二：</h3><p>地址：&#x2F;Users&#x2F;xiexiang&#x2F;Library&#x2F;Caches</p>
<p>这个文件夹顾名思义为Mac上的缓存文件夹，里面放置着各种缓存，进到里面之后可以使用du -sh * 命令查看每个文件对应的大小，根据个人需要删除对应的文件夹。<br>ps：类似编程软件这些cache建议不要删除，因为里面含有大量的index（索引文件），删除之后再次启动工具，还是会自动整理索引，而且时间很长。</p>
<h3 id="方法三："><a href="#方法三：" class="headerlink" title="方法三："></a>方法三：</h3><p>地址：&#x2F;System&#x2F;Library&#x2F;Speech&#x2F;</p>
<p>如果不使用文字转语音功能，那么肯定就不会用到OS X内置的嗓音文件，可以删除之后重新获得硬盘空间，执行</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">sudo rm -rf Voices<span class="comment">/*</span></span><br></pre></td></tr></table></figure>

<p>删除，大约可省出5G-10G空间</p>
<h3 id="方法四："><a href="#方法四：" class="headerlink" title="方法四："></a>方法四：</h3><p>地址：&#x2F;private&#x2F;var&#x2F;log</p>
<p>随着你的Mac使用的时间越来越长，系统产生的日志文件也越来越多，根据电脑的用量、错误和服务，这些文件也会越来越多，如果你感觉没有用可是使用</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">sudo rm -rf /<span class="keyword">private</span>/<span class="keyword">var</span>/log<span class="comment">/*</span></span><br></pre></td></tr></table></figure>

<p>删除，大约可省出100-300M空间。</p>
<p>以上的方法均可以清除部分硬盘空间，而且有些方法存在一定的风险，请谨慎操作！<br>电子产品硬盘受限确实是个硬伤，还有一些其他的办法自己慢慢琢磨吧~~</p>
]]></content>
      <categories>
        <category>mac</category>
      </categories>
      <tags>
        <tag>mac</tag>
      </tags>
  </entry>
  <entry>
    <title>PHP常见六大设计模式及举例</title>
    <url>/2022/09/08/PHP%E5%B8%B8%E8%A7%81%E5%85%AD%E5%A4%A7%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%8F%8A%E4%B8%BE%E4%BE%8B/</url>
    <content><![CDATA[<blockquote>
<p>设计模式在php开发中用途还是非常多，能够使用设计模式并准确选择设计模式将事半功倍的提高开发效率，而且也能提高代码可读性和提升代码解耦度，非常方便以后我们在迭代功能的时候的扩展与重构，不至于看到自己以前写的代码无所适从。</p>
</blockquote>
<h3 id="1、单例模式"><a href="#1、单例模式" class="headerlink" title="1、单例模式"></a>1、单例模式</h3><p>单例模式：即一个类只被实例化一次，当其他人对其再次实例化时，返回第一次实例化的对象，可以避免大量的new<br>操作，减少资源的消耗，典型应用于数据库类的实例化。<br>特点：三私一公 （私有静态属性instance,私有构造方法,私有克隆方法,公有化静态方法getInstance）</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">  <span class="comment">//私有静态属性</span></span><br><span class="line">  <span class="keyword">private</span> <span class="built_in">static</span> <span class="variable">$instance</span>;</span><br><span class="line">  <span class="comment">//私有构造方法，禁止使用new创建对象</span></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">  <span class="comment">//该实例的出口</span></span><br><span class="line">  <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">getInstance</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="built_in">self</span>::<span class="variable">$instance</span>)) &#123;</span><br><span class="line">          <span class="built_in">self</span>::<span class="variable">$instance</span> = <span class="keyword">new</span> <span class="built_in">self</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">self</span>::<span class="variable">$instance</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//将克隆方法设为私有，禁止克隆对象</span></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">__clone</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">say</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&quot;这是用单例模式创建对象实例 &lt;br&gt;&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">operation</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&quot;这里可以添加其他方法和操作 &lt;br&gt;&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// $shiyanlou = new Singleton();</span></span><br><span class="line"><span class="variable">$shiyanlou</span> = <span class="title class_">Singleton</span>::<span class="title function_ invoke__">getInstance</span>();</span><br><span class="line"><span class="variable">$shiyanlou</span>-&gt;<span class="title function_ invoke__">say</span>();</span><br><span class="line"><span class="variable">$shiyanlou</span>-&gt;<span class="title function_ invoke__">operation</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$newShiyanlou</span> = <span class="title class_">Singleton</span>::<span class="title function_ invoke__">getInstance</span>();</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$shiyanlou</span> === <span class="variable">$newShiyanlou</span>);</span><br></pre></td></tr></table></figure>
<span id="more"></span>

<h3 id="2、工厂模式"><a href="#2、工厂模式" class="headerlink" title="2、工厂模式"></a>2、工厂模式</h3><p>工厂模式解决的是如何不通过new建立实例对象的方法。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">// 电视接口</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">TV</span> </span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">open</span>(<span class="params"></span>)</span>;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">close</span>(<span class="params"></span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">XiaomiTv</span> <span class="keyword">implements</span> <span class="title">TV</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">open</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;open 小米 TV &lt;br&gt;&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">close</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;close 小米 TV &lt;br&gt;&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 电脑接口</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">PC</span> </span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">work</span>(<span class="params"></span>)</span>;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">paly</span>(<span class="params"></span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LenovoPc</span> <span class="keyword">implements</span> <span class="title">PC</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">work</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;I‘m working on lenovo computer &lt;br&gt;&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">paly</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;Lenovo computer can be use to paly games &lt;br&gt;&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 工厂抽象类</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Factory</span> </span>&#123;</span><br><span class="line">	<span class="keyword">abstract</span> <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">createPc</span>(<span class="params"></span>)</span>;</span><br><span class="line">	<span class="keyword">abstract</span> <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">createTv</span>(<span class="params"></span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProductFactory</span> <span class="keyword">extends</span> <span class="title">Factory</span> </span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">createTv</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HaierTv</span>();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">createPc</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">LenovoPc</span>();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$newTv</span> = <span class="title class_">ProductFactory</span>::<span class="title function_ invoke__">createTv</span>();</span><br><span class="line"><span class="variable">$newTv</span>-&gt;<span class="title function_ invoke__">open</span>();</span><br><span class="line"><span class="variable">$newTv</span>-&gt;<span class="title function_ invoke__">close</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$newPc</span> = <span class="title class_">ProductFactory</span>::<span class="title function_ invoke__">createPc</span>();</span><br><span class="line"><span class="variable">$newPc</span>-&gt;<span class="title function_ invoke__">work</span>();</span><br><span class="line"><span class="variable">$newPc</span>-&gt;<span class="title function_ invoke__">paly</span>();</span><br></pre></td></tr></table></figure>

<h3 id="3、策略模式"><a href="#3、策略模式" class="headerlink" title="3、策略模式"></a>3、策略模式</h3><p>针对一组算法，将每一个算法封装到具有共同接口的独立的类中，例如进入个人主页时，根据浏览者的不同，给予不同的显示与操作</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 声明策略文件的接口，约定策略包含的行为。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">UserStrategy</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">showAd</span>(<span class="params"></span>)</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">showCategory</span>(<span class="params"></span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FemaleUser</span> <span class="keyword">implements</span> <span class="title">UserStrategy</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">showAd</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;2016冬季女装&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">showCategory</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;女装&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MaleUser</span> <span class="keyword">implements</span> <span class="title">UserStrategy</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">showAd</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;IPhone6s&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">showCategory</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;电子产品&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4、适配器模式"><a href="#4、适配器模式" class="headerlink" title="4、适配器模式"></a>4、适配器模式</h3><p>将各种截然不同的函数接口封装成统一的API。<br>PHP中的数据库操作有MySQL,MySQLi,PDO三种，可以用适配器模式统一成一致，使不同的数据库操作，统一成一样的API。<br>类似的场景还有cache适配器，可以将memcache,redis,file,apc等不同的缓存函数，统一成一致。<br>首先定义一个接口(有几个方法，以及相应的参数)。然后，有几种不同的情况，就写几个类实现该接口。将完成相似功能的函数，统一成一致的方法。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">IDatabase</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">connect</span>(<span class="params"><span class="variable">$host</span>, <span class="variable">$user</span>, <span class="variable">$passwd</span>, <span class="variable">$dbname</span></span>)</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">query</span>(<span class="params"><span class="variable">$sql</span></span>)</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">close</span>(<span class="params"></span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#MYSQL</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MySQL</span> <span class="keyword">implements</span> <span class="title">IDatabase</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$conn</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">connect</span>(<span class="params"><span class="variable">$host</span>, <span class="variable">$user</span>, <span class="variable">$passwd</span>, <span class="variable">$dbname</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$conn</span> = <span class="title function_ invoke__">mysql_connect</span>(<span class="variable">$host</span>, <span class="variable">$user</span>, <span class="variable">$passwd</span>);</span><br><span class="line">        <span class="title function_ invoke__">mysql_select_db</span>(<span class="variable">$dbname</span>, <span class="variable">$conn</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;conn = <span class="variable">$conn</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">query</span>(<span class="params"><span class="variable">$sql</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$res</span> = <span class="title function_ invoke__">mysql_query</span>(<span class="variable">$sql</span>, <span class="variable">$this</span>-&gt;conn);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$res</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">close</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">mysql_close</span>(<span class="variable">$this</span>-&gt;conn);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#MySQLi</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MySQLi</span> <span class="keyword">implements</span> <span class="title">IDatabase</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$conn</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">connect</span>(<span class="params"><span class="variable">$host</span>, <span class="variable">$user</span>, <span class="variable">$passwd</span>, <span class="variable">$dbname</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$conn</span> = <span class="title function_ invoke__">mysqli_connect</span>(<span class="variable">$host</span>, <span class="variable">$user</span>, <span class="variable">$passwd</span>, <span class="variable">$dbname</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;conn = <span class="variable">$conn</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">query</span>(<span class="params"><span class="variable">$sql</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">mysqli_query</span>(<span class="variable">$this</span>-&gt;conn, <span class="variable">$sql</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">close</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">mysqli_close</span>(<span class="variable">$this</span>-&gt;conn);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#PDO</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PDO</span> <span class="keyword">implements</span> <span class="title">IDatabase</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$conn</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">connect</span>(<span class="params"><span class="variable">$host</span>, <span class="variable">$user</span>, <span class="variable">$passwd</span>, <span class="variable">$dbname</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$conn</span> = <span class="keyword">new</span> \<span class="title function_ invoke__">PDO</span>(<span class="string">&quot;mysql:host=<span class="subst">$host</span>;dbname=<span class="subst">$dbname</span>&quot;</span>, <span class="variable">$user</span>, <span class="variable">$passwd</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;conn = <span class="variable">$conn</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">query</span>(<span class="params"><span class="variable">$sql</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;conn-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">close</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">unset</span>(<span class="variable language_">$this</span>-&gt;conn);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5、注册模式"><a href="#5、注册模式" class="headerlink" title="5、注册模式"></a>5、注册模式</h3><p>注册模式，解决全局共享和交换对象。已经创建好的对象，挂在到某个全局可以使用的数组上，在需要使用的时候，直接从该数组上获取即可。将对象注册到全局的树上。任何地方直接去访问。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Register</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="built_in">static</span> <span class="variable">$objects</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">set</span>(<span class="params"><span class="variable">$alias</span>,<span class="variable">$object</span></span>)//将对象注册到全局的树上</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">self</span>::<span class="variable">$objects</span>[<span class="variable">$alias</span>]=<span class="variable">$object</span>;<span class="comment">//将对象放到树上</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params"><span class="variable">$name</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">self</span>::<span class="variable">$objects</span>[<span class="variable">$name</span>];<span class="comment">//获取某个注册到树上的对象</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">_unset</span>(<span class="params"><span class="variable">$alias</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">unset</span>(<span class="built_in">self</span>::<span class="variable">$objects</span>[<span class="variable">$alias</span>]);<span class="comment">//移除某个注册到树上的对象。</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6、观察者模式"><a href="#6、观察者模式" class="headerlink" title="6、观察者模式"></a>6、观察者模式</h3><p>1：观察者模式(Observer)，当一个对象状态发生变化时，依赖它的对象全部会收到通知，并自动更新。<br>2：场景:一个事件发生后，要执行一连串更新操作。传统的编程方式，就是在事件的代码之后直接加入处理的逻辑。当更新的逻辑增多之后，代码会变得难以维护。这种方式是耦合的，侵入式的，增加新的逻辑需要修改事件的主体代码。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Observer</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params"><span class="variable">$obj</span></span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Message</span> <span class="keyword">implements</span> <span class="title">Observer</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">//....</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params"><span class="variable">$obj</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;发送新订单短信(&#x27;</span> . <span class="variable">$obj</span>-&gt;mobile . <span class="string">&#x27;)通知给商家！&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//....</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Goods</span> <span class="keyword">implements</span> <span class="title">Observer</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">//....</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params"><span class="variable">$obj</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;修改商品&#x27;</span> . <span class="variable">$obj</span>-&gt;goodsId . <span class="string">&#x27;的库存！&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//....</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Order</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$observers</span> = [];</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">attach</span>(<span class="params"><span class="variable">$ob</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;observers[] = <span class="variable">$ob</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">detach</span>(<span class="params"><span class="variable">$ob</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$position</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;observers <span class="keyword">as</span> <span class="variable">$ob</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$ob</span> == <span class="variable">$observer</span>) &#123;</span><br><span class="line">                <span class="title function_ invoke__">array_splice</span>(<span class="variable">$this</span>-&gt;observers, (<span class="variable">$position</span>), <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            ++<span class="variable">$position</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">notify</span>(<span class="params"><span class="variable">$obj</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;observers <span class="keyword">as</span> <span class="variable">$ob</span>) &#123;</span><br><span class="line">            <span class="variable">$ob</span>-&gt;<span class="title function_ invoke__">update</span>(<span class="variable">$obj</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">sale</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 商品卖掉了</span></span><br><span class="line">        <span class="comment">// ....</span></span><br><span class="line">        <span class="variable">$obj</span> = <span class="keyword">new</span> <span class="built_in">stdClass</span>();</span><br><span class="line">        <span class="variable">$obj</span>-&gt;mobile = <span class="string">&#x27;13888888888&#x27;</span>;</span><br><span class="line">        <span class="variable">$obj</span>-&gt;goodsId = <span class="string">&#x27;Order11111111&#x27;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">notify</span>(<span class="variable">$obj</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$message</span> = <span class="keyword">new</span> <span class="title class_">Message</span>();</span><br><span class="line"><span class="variable">$goods</span> = <span class="keyword">new</span> <span class="title class_">Goods</span>();</span><br><span class="line"><span class="variable">$order</span> = <span class="keyword">new</span> <span class="title class_">Order</span>();</span><br><span class="line"><span class="variable">$order</span>-&gt;<span class="title function_ invoke__">attach</span>(<span class="variable">$message</span>);</span><br><span class="line"><span class="variable">$order</span>-&gt;<span class="title function_ invoke__">attach</span>(<span class="variable">$goods</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 订单卖出了！！</span></span><br><span class="line"><span class="variable">$order</span>-&gt;<span class="title function_ invoke__">sale</span>();</span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>php</category>
      </categories>
      <tags>
        <tag>php</tag>
      </tags>
  </entry>
  <entry>
    <title>PHP给源代码加密的几种方法</title>
    <url>/2018/02/02/PHP%E7%BB%99%E6%BA%90%E4%BB%A3%E7%A0%81%E5%8A%A0%E5%AF%86%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E6%B3%95/</url>
    <content><![CDATA[<blockquote>
<p>虽说分享是传统的美德，但我们有时候辛辛苦苦写一些程序只是为了卖点小钱，挣点辛苦费，也防止有些没有道德的人倒卖，所以我们不得不对我们的程序进行加密，以下我们来介绍一下如何通过PHP的自定义函数来加密我们的PHP源代码.</p>
</blockquote>
<h4 id="方法一："><a href="#方法一：" class="headerlink" title="方法一："></a>方法一：</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">encode_file_contents</span>(<span class="params"><span class="variable">$filename</span></span>) </span>&#123;  </span><br><span class="line">     <span class="variable">$type</span>=<span class="title function_ invoke__">strtolower</span>(<span class="title function_ invoke__">substr</span>(<span class="title function_ invoke__">strrchr</span>(<span class="variable">$filename</span>,<span class="string">&#x27;.&#x27;</span>),<span class="number">1</span>));  </span><br><span class="line">     <span class="keyword">if</span> (<span class="string">&#x27;php&#x27;</span> == <span class="variable">$type</span> &amp;&amp; <span class="title function_ invoke__">is_file</span>(<span class="variable">$filename</span>) &amp;&amp; <span class="title function_ invoke__">is_writable</span>(<span class="variable">$filename</span>)) &#123; <span class="comment">// 如果是PHP文件 并且可写 则进行压缩编码  </span></span><br><span class="line">         <span class="variable">$contents</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$filename</span>); <span class="comment">// 判断文件是否已经被编码处理  </span></span><br><span class="line">         <span class="variable">$contents</span> = <span class="title function_ invoke__">php_strip_whitespace</span>(<span class="variable">$filename</span>);   </span><br><span class="line"> </span><br><span class="line">         <span class="comment">// 去除PHP头部和尾部标识  </span></span><br><span class="line">         <span class="variable">$headerPos</span> = <span class="title function_ invoke__">strpos</span>(<span class="variable">$contents</span>,<span class="string">&#x27;&lt;?php&#x27;</span>);  </span><br><span class="line">         <span class="variable">$footerPos</span> = <span class="title function_ invoke__">strrpos</span>(<span class="variable">$contents</span>,<span class="string">&#x27;?&gt;&#x27;</span>);  </span><br><span class="line">         <span class="variable">$contents</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$contents</span>, <span class="variable">$headerPos</span> + <span class="number">5</span>, <span class="variable">$footerPos</span> - <span class="variable">$headerPos</span>);  </span><br><span class="line">         <span class="variable">$encode</span> = <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">gzdeflate</span>(<span class="variable">$contents</span>)); <span class="comment">// 开始编码  </span></span><br><span class="line">         <span class="variable">$encode</span> = <span class="string">&#x27;&lt;?php&#x27;</span>.<span class="string">&quot;\n eval(gzinflate(base64_decode(&quot;</span>.<span class="string">&quot;&#x27;&quot;</span>.<span class="variable">$encode</span>.<span class="string">&quot;&#x27;&quot;</span>.<span class="string">&quot;)));\n\n?&gt;&quot;</span>;   </span><br><span class="line"> </span><br><span class="line">         <span class="keyword">return</span> <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$filename</span>, <span class="variable">$encode</span>);  </span><br><span class="line">     &#125;  </span><br><span class="line">     <span class="keyword">return</span> <span class="literal">false</span>;  </span><br><span class="line"> &#125;   </span><br><span class="line"> </span><br><span class="line"> <span class="comment">//调用函数  </span></span><br><span class="line"> <span class="variable">$filename</span> = <span class="string">&#x27;dam.php&#x27;</span>;  </span><br><span class="line"> <span class="title function_ invoke__">encode_file_contents</span>(<span class="variable">$filename</span>);  </span><br><span class="line"> <span class="keyword">echo</span> <span class="string">&quot;OK,加密完成！&quot;</span> </span><br><span class="line"> <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<span id="more"></span>

<h4 id="方法二："><a href="#方法二：" class="headerlink" title="方法二："></a>方法二：</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"> </span><br><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">RandAbc</span>(<span class="params"><span class="variable">$length</span> = <span class="string">&quot;&quot;</span></span>) </span>&#123; <span class="comment">// 返回随机字符串  </span></span><br><span class="line">     <span class="variable">$str</span> = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz&quot;</span>;  </span><br><span class="line">     <span class="keyword">return</span> <span class="title function_ invoke__">str_shuffle</span>(<span class="variable">$str</span>);  </span><br><span class="line"> &#125;   </span><br><span class="line"> </span><br><span class="line"> <span class="variable">$filename</span> = <span class="string">&#x27;index.php&#x27;</span>; <span class="comment">//要加密的文件  </span></span><br><span class="line"> <span class="variable">$T_k1</span> = <span class="title function_ invoke__">RandAbc</span>(); <span class="comment">//随机密匙1  </span></span><br><span class="line"> <span class="variable">$T_k2</span> = <span class="title function_ invoke__">RandAbc</span>(); <span class="comment">//随机密匙2  </span></span><br><span class="line"> <span class="variable">$vstr</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$filename</span>);  </span><br><span class="line"> <span class="variable">$v1</span> = <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$vstr</span>);  </span><br><span class="line"> <span class="variable">$c</span> = <span class="title function_ invoke__">strtr</span>(<span class="variable">$v1</span>, <span class="variable">$T_k1</span>, <span class="variable">$T_k2</span>); <span class="comment">//根据密匙替换对应字符。  </span></span><br><span class="line"> <span class="variable">$c</span> = <span class="variable">$T_k1</span>.<span class="variable">$T_k2</span>.<span class="variable">$c</span>;  </span><br><span class="line"> <span class="variable">$q1</span> = <span class="string">&quot;O00O0O&quot;</span>;  </span><br><span class="line"> <span class="variable">$q2</span> = <span class="string">&quot;O0O000&quot;</span>;  </span><br><span class="line"> <span class="variable">$q3</span> = <span class="string">&quot;O0OO00&quot;</span>;  </span><br><span class="line"> <span class="variable">$q4</span> = <span class="string">&quot;OO0O00&quot;</span>;  </span><br><span class="line"> <span class="variable">$q5</span> = <span class="string">&quot;OO0000&quot;</span>;  </span><br><span class="line"> <span class="variable">$q6</span> = <span class="string">&quot;O00OO0&quot;</span>;  </span><br><span class="line"> <span class="variable">$s</span> = <span class="string">&#x27;$&#x27;</span>.<span class="variable">$q6</span>.<span class="string">&#x27;=urldecode(&quot;%6E1%7A%62%2F%6D%615%5C%76%740%6928%2D%70%78%75%71%79%2A6%6C%72%6B%64%679%5F%65%68%63%73%77%6F4%2B%6637%6A&quot;);$&#x27;</span>.<span class="variable">$q1</span>.<span class="string">&#x27;=$&#x27;</span>.<span class="variable">$q6</span>.<span class="string">&#x27;&#123;3&#125;.$&#x27;</span>.<span class="variable">$q6</span>.<span class="string">&#x27;&#123;6&#125;.$&#x27;</span>.<span class="variable">$q6</span>.<span class="string">&#x27;&#123;33&#125;.$&#x27;</span>.<span class="variable">$q6</span>.<span class="string">&#x27;&#123;30&#125;;$&#x27;</span>.<span class="variable">$q3</span>.<span class="string">&#x27;=$&#x27;</span>.<span class="variable">$q6</span>.<span class="string">&#x27;&#123;33&#125;.$&#x27;</span>.<span class="variable">$q6</span>.<span class="string">&#x27;&#123;10&#125;.$&#x27;</span>.<span class="variable">$q6</span>.<span class="string">&#x27;&#123;24&#125;.$&#x27;</span>.<span class="variable">$q6</span>.<span class="string">&#x27;&#123;10&#125;.$&#x27;</span>.<span class="variable">$q6</span>.<span class="string">&#x27;&#123;24&#125;;$&#x27;</span>.<span class="variable">$q4</span>.<span class="string">&#x27;=$&#x27;</span>.<span class="variable">$q3</span>.<span class="string">&#x27;&#123;0&#125;.$&#x27;</span>.<span class="variable">$q6</span>.<span class="string">&#x27;&#123;18&#125;.$&#x27;</span>.<span class="variable">$q6</span>.<span class="string">&#x27;&#123;3&#125;.$&#x27;</span>.<span class="variable">$q3</span>.<span class="string">&#x27;&#123;0&#125;.$&#x27;</span>.<span class="variable">$q3</span>.<span class="string">&#x27;&#123;1&#125;.$&#x27;</span>.<span class="variable">$q6</span>.<span class="string">&#x27;&#123;24&#125;;$&#x27;</span>.<span class="variable">$q5</span>.<span class="string">&#x27;=$&#x27;</span>.<span class="variable">$q6</span>.<span class="string">&#x27;&#123;7&#125;.$&#x27;</span>.<span class="variable">$q6</span>.<span class="string">&#x27;&#123;13&#125;;$&#x27;</span>.<span class="variable">$q1</span>.<span class="string">&#x27;.=$&#x27;</span>.<span class="variable">$q6</span>.<span class="string">&#x27;&#123;22&#125;.$&#x27;</span>.<span class="variable">$q6</span>.<span class="string">&#x27;&#123;36&#125;.$&#x27;</span>.<span class="variable">$q6</span>.<span class="string">&#x27;&#123;29&#125;.$&#x27;</span>.<span class="variable">$q6</span>.<span class="string">&#x27;&#123;26&#125;.$&#x27;</span>.<span class="variable">$q6</span>.<span class="string">&#x27;&#123;30&#125;.$&#x27;</span>.<span class="variable">$q6</span>.<span class="string">&#x27;&#123;32&#125;.$&#x27;</span>.<span class="variable">$q6</span>.<span class="string">&#x27;&#123;35&#125;.$&#x27;</span>.<span class="variable">$q6</span>.<span class="string">&#x27;&#123;26&#125;.$&#x27;</span>.<span class="variable">$q6</span>.<span class="string">&#x27;&#123;30&#125;;eval($&#x27;</span>.<span class="variable">$q1</span>.<span class="string">&#x27;(&quot;&#x27;</span>.<span class="title function_ invoke__">base64_encode</span>(<span class="string">&#x27;$&#x27;</span>.<span class="variable">$q2</span>.<span class="string">&#x27;=&quot;&#x27;</span>.<span class="variable">$c</span>.<span class="string">&#x27;&quot;;eval(\&#x27;?&gt;\&#x27;.$&#x27;</span>.<span class="variable">$q1</span>.<span class="string">&#x27;($&#x27;</span>.<span class="variable">$q3</span>.<span class="string">&#x27;($&#x27;</span>.<span class="variable">$q4</span>.<span class="string">&#x27;($&#x27;</span>.<span class="variable">$q2</span>.<span class="string">&#x27;,$&#x27;</span>.<span class="variable">$q5</span>.<span class="string">&#x27;*2),$&#x27;</span>.<span class="variable">$q4</span>.<span class="string">&#x27;($&#x27;</span>.<span class="variable">$q2</span>.<span class="string">&#x27;,$&#x27;</span>.<span class="variable">$q5</span>.<span class="string">&#x27;,$&#x27;</span>.<span class="variable">$q5</span>.<span class="string">&#x27;),$&#x27;</span>.<span class="variable">$q4</span>.<span class="string">&#x27;($&#x27;</span>.<span class="variable">$q2</span>.<span class="string">&#x27;,0,$&#x27;</span>.<span class="variable">$q5</span>.<span class="string">&#x27;))));&#x27;</span>).<span class="string">&#x27;&quot;));&#x27;</span>;  </span><br><span class="line"> </span><br><span class="line"> <span class="variable">$s</span> = <span class="string">&#x27;&lt;?php &#x27;</span>.<span class="string">&quot;\n&quot;</span>.<span class="variable">$s</span>.<span class="string">&quot;\n&quot;</span>.<span class="string">&#x27; ?&gt;&#x27;</span>;  </span><br><span class="line"> <span class="comment">//echo $s;  </span></span><br><span class="line"> <span class="comment">// 生成 加密后的PHP文件  </span></span><br><span class="line"> <span class="variable">$fpp1</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&#x27;temp_&#x27;</span>.<span class="variable">$filename</span>, <span class="string">&#x27;w&#x27;</span>);  </span><br><span class="line"> <span class="title function_ invoke__">fwrite</span>(<span class="variable">$fpp1</span>, <span class="variable">$s</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&#x27;写文件错误&#x27;</span>);  </span><br><span class="line"> </span><br><span class="line"> <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="方法三："><a href="#方法三：" class="headerlink" title="方法三："></a>方法三：</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"> </span><br><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">text_auth</span>  </span></span><br><span class="line"><span class="class"> </span>&#123;  </span><br><span class="line">     <span class="keyword">var</span> <span class="variable">$n_iter</span>;  </span><br><span class="line"> </span><br><span class="line">     <span class="function"><span class="keyword">function</span> <span class="title">text_auth</span>(<span class="params"></span>)  </span></span><br><span class="line"><span class="function">     </span>&#123;  </span><br><span class="line">         <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">setIter</span>(<span class="number">32</span>);  </span><br><span class="line">     &#125;  </span><br><span class="line"> </span><br><span class="line">     <span class="function"><span class="keyword">function</span> <span class="title">setIter</span>(<span class="params"><span class="variable">$n_iter</span></span>)  </span></span><br><span class="line"><span class="function">     </span>&#123;  </span><br><span class="line">         <span class="variable language_">$this</span>-&gt;n_iter = <span class="variable">$n_iter</span>;  </span><br><span class="line">     &#125;  </span><br><span class="line"> </span><br><span class="line">     <span class="function"><span class="keyword">function</span> <span class="title">getIter</span>(<span class="params"></span>)  </span></span><br><span class="line"><span class="function">     </span>&#123;  </span><br><span class="line">         <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;n_iter;  </span><br><span class="line">     &#125;  </span><br><span class="line"> </span><br><span class="line">     <span class="function"><span class="keyword">function</span> <span class="title">encrypt</span>(<span class="params"><span class="variable">$data</span>, <span class="variable">$key</span></span>)  </span></span><br><span class="line"><span class="function">     </span>&#123;  </span><br><span class="line">         <span class="variable">$n</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">_resize</span>(<span class="variable">$data</span>, <span class="number">4</span>);  </span><br><span class="line"> </span><br><span class="line">         <span class="variable">$data_long</span>[<span class="number">0</span>]   = <span class="variable">$n</span>;  </span><br><span class="line">         <span class="variable">$n_data_long</span>    = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">_str2long</span>(<span class="number">1</span>, <span class="variable">$data</span>, <span class="variable">$data_long</span>);  </span><br><span class="line"> </span><br><span class="line">         <span class="variable">$n</span> = <span class="title function_ invoke__">count</span>(<span class="variable">$data_long</span>);  </span><br><span class="line">         <span class="keyword">if</span> ((<span class="variable">$n</span> &amp; <span class="number">1</span>) == <span class="number">1</span>) &#123;  </span><br><span class="line">             <span class="variable">$data_long</span>[<span class="variable">$n</span>] = <span class="title function_ invoke__">chr</span>(<span class="number">0</span>);  </span><br><span class="line">             <span class="variable">$n_data_long</span>++;  </span><br><span class="line">         &#125;  </span><br><span class="line"> </span><br><span class="line">         <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">_resize</span>(<span class="variable">$key</span>, <span class="number">16</span>, <span class="literal">true</span>);  </span><br><span class="line">         <span class="keyword">if</span> ( <span class="string">&#x27;&#x27;</span> == <span class="variable">$key</span> )  </span><br><span class="line">             <span class="variable">$key</span> = <span class="string">&#x27;0000000000000000&#x27;</span>;  </span><br><span class="line"> </span><br><span class="line">         <span class="variable">$n_key_long</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">_str2long</span>(<span class="number">0</span>, <span class="variable">$key</span>, <span class="variable">$key_long</span>);  </span><br><span class="line"> </span><br><span class="line">         <span class="variable">$enc_data</span>   = <span class="string">&#x27;&#x27;</span>;  </span><br><span class="line">         <span class="variable">$w</span>          = <span class="keyword">array</span>(<span class="number">0</span>, <span class="number">0</span>);  </span><br><span class="line">         <span class="variable">$j</span>          = <span class="number">0</span>;  </span><br><span class="line">         <span class="variable">$k</span>          = <span class="keyword">array</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);  </span><br><span class="line">         <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$n_data_long</span>; ++<span class="variable">$i</span>) &#123;  </span><br><span class="line">             <span class="keyword">if</span> (<span class="variable">$j</span> + <span class="number">4</span> &lt;= <span class="variable">$n_key_long</span>) &#123;  </span><br><span class="line">                 <span class="variable">$k</span>[<span class="number">0</span>] = <span class="variable">$key_long</span>[<span class="variable">$j</span>];  </span><br><span class="line">                 <span class="variable">$k</span>[<span class="number">1</span>] = <span class="variable">$key_long</span>[<span class="variable">$j</span> + <span class="number">1</span>];  </span><br><span class="line">                 <span class="variable">$k</span>[<span class="number">2</span>] = <span class="variable">$key_long</span>[<span class="variable">$j</span> + <span class="number">2</span>];  </span><br><span class="line">                 <span class="variable">$k</span>[<span class="number">3</span>] = <span class="variable">$key_long</span>[<span class="variable">$j</span> + <span class="number">3</span>];  </span><br><span class="line">             &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">                 <span class="variable">$k</span>[<span class="number">0</span>] = <span class="variable">$key_long</span>[<span class="variable">$j</span> % <span class="variable">$n_key_long</span>];  </span><br><span class="line">                 <span class="variable">$k</span>[<span class="number">1</span>] = <span class="variable">$key_long</span>[(<span class="variable">$j</span> + <span class="number">1</span>) % <span class="variable">$n_key_long</span>];  </span><br><span class="line">                 <span class="variable">$k</span>[<span class="number">2</span>] = <span class="variable">$key_long</span>[(<span class="variable">$j</span> + <span class="number">2</span>) % <span class="variable">$n_key_long</span>];  </span><br><span class="line">                 <span class="variable">$k</span>[<span class="number">3</span>] = <span class="variable">$key_long</span>[(<span class="variable">$j</span> + <span class="number">3</span>) % <span class="variable">$n_key_long</span>];  </span><br><span class="line">             &#125;  </span><br><span class="line">             <span class="variable">$j</span> = (<span class="variable">$j</span> + <span class="number">4</span>) % <span class="variable">$n_key_long</span>;  </span><br><span class="line"> </span><br><span class="line">             <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">_encipherLong</span>(<span class="variable">$data_long</span>[<span class="variable">$i</span>], <span class="variable">$data_long</span>[++<span class="variable">$i</span>], <span class="variable">$w</span>, <span class="variable">$k</span>);  </span><br><span class="line"> </span><br><span class="line">             <span class="variable">$enc_data</span> .= <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">_long2str</span>(<span class="variable">$w</span>[<span class="number">0</span>]);  </span><br><span class="line">             <span class="variable">$enc_data</span> .= <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">_long2str</span>(<span class="variable">$w</span>[<span class="number">1</span>]);  </span><br><span class="line">         &#125;  </span><br><span class="line"> </span><br><span class="line">         <span class="keyword">return</span> <span class="variable">$enc_data</span>;  </span><br><span class="line">     &#125;  </span><br><span class="line"> </span><br><span class="line">     <span class="function"><span class="keyword">function</span> <span class="title">decrypt</span>(<span class="params"><span class="variable">$enc_data</span>, <span class="variable">$key</span></span>)  </span></span><br><span class="line"><span class="function">     </span>&#123;  </span><br><span class="line">         <span class="variable">$n_enc_data_long</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">_str2long</span>(<span class="number">0</span>, <span class="variable">$enc_data</span>, <span class="variable">$enc_data_long</span>);  </span><br><span class="line"> </span><br><span class="line">         <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">_resize</span>(<span class="variable">$key</span>, <span class="number">16</span>, <span class="literal">true</span>);  </span><br><span class="line">         <span class="keyword">if</span> ( <span class="string">&#x27;&#x27;</span> == <span class="variable">$key</span> )  </span><br><span class="line">             <span class="variable">$key</span> = <span class="string">&#x27;0000000000000000&#x27;</span>;  </span><br><span class="line"> </span><br><span class="line">         <span class="variable">$n_key_long</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">_str2long</span>(<span class="number">0</span>, <span class="variable">$key</span>, <span class="variable">$key_long</span>);  </span><br><span class="line"> </span><br><span class="line">         <span class="variable">$data</span>   = <span class="string">&#x27;&#x27;</span>;  </span><br><span class="line">         <span class="variable">$w</span>      = <span class="keyword">array</span>(<span class="number">0</span>, <span class="number">0</span>);  </span><br><span class="line">         <span class="variable">$j</span>      = <span class="number">0</span>;  </span><br><span class="line">         <span class="variable">$len</span>    = <span class="number">0</span>;  </span><br><span class="line">         <span class="variable">$k</span>      = <span class="keyword">array</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);  </span><br><span class="line">         <span class="variable">$pos</span>    = <span class="number">0</span>;  </span><br><span class="line"> </span><br><span class="line">         <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$n_enc_data_long</span>; <span class="variable">$i</span> += <span class="number">2</span>) &#123;  </span><br><span class="line">             <span class="keyword">if</span> (<span class="variable">$j</span> + <span class="number">4</span> &lt;= <span class="variable">$n_key_long</span>) &#123;  </span><br><span class="line">                 <span class="variable">$k</span>[<span class="number">0</span>] = <span class="variable">$key_long</span>[<span class="variable">$j</span>];  </span><br><span class="line">                 <span class="variable">$k</span>[<span class="number">1</span>] = <span class="variable">$key_long</span>[<span class="variable">$j</span> + <span class="number">1</span>];  </span><br><span class="line">                 <span class="variable">$k</span>[<span class="number">2</span>] = <span class="variable">$key_long</span>[<span class="variable">$j</span> + <span class="number">2</span>];  </span><br><span class="line">                 <span class="variable">$k</span>[<span class="number">3</span>] = <span class="variable">$key_long</span>[<span class="variable">$j</span> + <span class="number">3</span>];  </span><br><span class="line">             &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">                 <span class="variable">$k</span>[<span class="number">0</span>] = <span class="variable">$key_long</span>[<span class="variable">$j</span> % <span class="variable">$n_key_long</span>];  </span><br><span class="line">                 <span class="variable">$k</span>[<span class="number">1</span>] = <span class="variable">$key_long</span>[(<span class="variable">$j</span> + <span class="number">1</span>) % <span class="variable">$n_key_long</span>];  </span><br><span class="line">                 <span class="variable">$k</span>[<span class="number">2</span>] = <span class="variable">$key_long</span>[(<span class="variable">$j</span> + <span class="number">2</span>) % <span class="variable">$n_key_long</span>];  </span><br><span class="line">                 <span class="variable">$k</span>[<span class="number">3</span>] = <span class="variable">$key_long</span>[(<span class="variable">$j</span> + <span class="number">3</span>) % <span class="variable">$n_key_long</span>];  </span><br><span class="line">             &#125;  </span><br><span class="line">             <span class="variable">$j</span> = (<span class="variable">$j</span> + <span class="number">4</span>) % <span class="variable">$n_key_long</span>;  </span><br><span class="line"> </span><br><span class="line">             <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">_decipherLong</span>(<span class="variable">$enc_data_long</span>[<span class="variable">$i</span>], <span class="variable">$enc_data_long</span>[<span class="variable">$i</span> + <span class="number">1</span>], <span class="variable">$w</span>, <span class="variable">$k</span>);  </span><br><span class="line"> </span><br><span class="line">             <span class="keyword">if</span> (<span class="number">0</span> == <span class="variable">$i</span>) &#123;  </span><br><span class="line">                 <span class="variable">$len</span> = <span class="variable">$w</span>[<span class="number">0</span>];  </span><br><span class="line">                 <span class="keyword">if</span> (<span class="number">4</span> &lt;= <span class="variable">$len</span>) &#123;  </span><br><span class="line">                     <span class="variable">$data</span> .= <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">_long2str</span>(<span class="variable">$w</span>[<span class="number">1</span>]);  </span><br><span class="line">                 &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">                     <span class="variable">$data</span> .= <span class="title function_ invoke__">substr</span>(<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">_long2str</span>(<span class="variable">$w</span>[<span class="number">1</span>]), <span class="number">0</span>, <span class="variable">$len</span> % <span class="number">4</span>);  </span><br><span class="line">                 &#125;  </span><br><span class="line">             &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">                 <span class="variable">$pos</span> = (<span class="variable">$i</span> - <span class="number">1</span>) * <span class="number">4</span>;  </span><br><span class="line">                 <span class="keyword">if</span> (<span class="variable">$pos</span> + <span class="number">4</span> &lt;= <span class="variable">$len</span>) &#123;  </span><br><span class="line">                     <span class="variable">$data</span> .= <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">_long2str</span>(<span class="variable">$w</span>[<span class="number">0</span>]);  </span><br><span class="line"> </span><br><span class="line">                     <span class="keyword">if</span> (<span class="variable">$pos</span> + <span class="number">8</span> &lt;= <span class="variable">$len</span>) &#123;  </span><br><span class="line">                         <span class="variable">$data</span> .= <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">_long2str</span>(<span class="variable">$w</span>[<span class="number">1</span>]);  </span><br><span class="line">                     &#125; <span class="keyword">elseif</span> (<span class="variable">$pos</span> + <span class="number">4</span> &lt; <span class="variable">$len</span>) &#123;  </span><br><span class="line">                         <span class="variable">$data</span> .= <span class="title function_ invoke__">substr</span>(<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">_long2str</span>(<span class="variable">$w</span>[<span class="number">1</span>]), <span class="number">0</span>, <span class="variable">$len</span> % <span class="number">4</span>);  </span><br><span class="line">                     &#125;  </span><br><span class="line">                 &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">                     <span class="variable">$data</span> .= <span class="title function_ invoke__">substr</span>(<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">_long2str</span>(<span class="variable">$w</span>[<span class="number">0</span>]), <span class="number">0</span>, <span class="variable">$len</span> % <span class="number">4</span>);  </span><br><span class="line">                 &#125;  </span><br><span class="line">             &#125;  </span><br><span class="line">         &#125;  </span><br><span class="line">         <span class="keyword">return</span> <span class="variable">$data</span>;  </span><br><span class="line">     &#125;  </span><br><span class="line"> </span><br><span class="line">     <span class="function"><span class="keyword">function</span> <span class="title">_encipherLong</span>(<span class="params"><span class="variable">$y</span>, <span class="variable">$z</span>, &amp;<span class="variable">$w</span>, &amp;<span class="variable">$k</span></span>)  </span></span><br><span class="line"><span class="function">     </span>&#123;  </span><br><span class="line">         <span class="variable">$sum</span>    = (<span class="keyword">integer</span>) <span class="number">0</span>;  </span><br><span class="line">         <span class="variable">$delta</span>  = <span class="number">0x9E3779B9</span>;  </span><br><span class="line">         <span class="variable">$n</span>      = (<span class="keyword">integer</span>) <span class="variable language_">$this</span>-&gt;n_iter;  </span><br><span class="line"> </span><br><span class="line">         <span class="keyword">while</span> (<span class="variable">$n</span>-- &gt; <span class="number">0</span>) &#123;  </span><br><span class="line">             <span class="variable">$y</span>      = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">_add</span>(<span class="variable">$y</span>,  </span><br><span class="line">                                   <span class="variable">$this</span>-&gt;<span class="title function_ invoke__">_add</span>(<span class="variable">$z</span> &lt;&lt; <span class="number">4</span> ^ <span class="variable">$this</span>-&gt;<span class="title function_ invoke__">_rshift</span>(<span class="variable">$z</span>, <span class="number">5</span>), <span class="variable">$z</span>) ^  </span><br><span class="line">                                     <span class="variable">$this</span>-&gt;<span class="title function_ invoke__">_add</span>(<span class="variable">$sum</span>, <span class="variable">$k</span>[<span class="variable">$sum</span> &amp; <span class="number">3</span>]));  </span><br><span class="line">             <span class="variable">$sum</span>    = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">_add</span>(<span class="variable">$sum</span>, <span class="variable">$delta</span>);  </span><br><span class="line">             <span class="variable">$z</span>      = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">_add</span>(<span class="variable">$z</span>,  </span><br><span class="line">                                   <span class="variable">$this</span>-&gt;<span class="title function_ invoke__">_add</span>(<span class="variable">$y</span> &lt;&lt; <span class="number">4</span> ^ <span class="variable">$this</span>-&gt;<span class="title function_ invoke__">_rshift</span>(<span class="variable">$y</span>, <span class="number">5</span>), <span class="variable">$y</span>) ^  </span><br><span class="line">                                     <span class="variable">$this</span>-&gt;<span class="title function_ invoke__">_add</span>(<span class="variable">$sum</span>, <span class="variable">$k</span>[<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">_rshift</span>(<span class="variable">$sum</span>, <span class="number">11</span>) &amp; <span class="number">3</span>]));  </span><br><span class="line">         &#125;  </span><br><span class="line"> </span><br><span class="line">         <span class="variable">$w</span>[<span class="number">0</span>] = <span class="variable">$y</span>;  </span><br><span class="line">         <span class="variable">$w</span>[<span class="number">1</span>] = <span class="variable">$z</span>;  </span><br><span class="line">     &#125;  </span><br><span class="line"> </span><br><span class="line">     <span class="function"><span class="keyword">function</span> <span class="title">_decipherLong</span>(<span class="params"><span class="variable">$y</span>, <span class="variable">$z</span>, &amp;<span class="variable">$w</span>, &amp;<span class="variable">$k</span></span>)  </span></span><br><span class="line"><span class="function">     </span>&#123;  </span><br><span class="line">         <span class="variable">$sum</span>    = <span class="number">0xC6EF3720</span>;  </span><br><span class="line">         <span class="variable">$delta</span>  = <span class="number">0x9E3779B9</span>;  </span><br><span class="line">         <span class="variable">$n</span>      = (<span class="keyword">integer</span>) <span class="variable language_">$this</span>-&gt;n_iter;  </span><br><span class="line"> </span><br><span class="line">         <span class="keyword">while</span> (<span class="variable">$n</span>-- &gt; <span class="number">0</span>) &#123;  </span><br><span class="line">             <span class="variable">$z</span>      = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">_add</span>(<span class="variable">$z</span>,  </span><br><span class="line">                                   -(<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">_add</span>(<span class="variable">$y</span> &lt;&lt; <span class="number">4</span> ^ <span class="variable">$this</span>-&gt;<span class="title function_ invoke__">_rshift</span>(<span class="variable">$y</span>, <span class="number">5</span>), <span class="variable">$y</span>) ^  </span><br><span class="line">                                         <span class="variable">$this</span>-&gt;<span class="title function_ invoke__">_add</span>(<span class="variable">$sum</span>, <span class="variable">$k</span>[<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">_rshift</span>(<span class="variable">$sum</span>, <span class="number">11</span>) &amp; <span class="number">3</span>])));  </span><br><span class="line">             <span class="variable">$sum</span>    = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">_add</span>(<span class="variable">$sum</span>, -<span class="variable">$delta</span>);  </span><br><span class="line">             <span class="variable">$y</span>      = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">_add</span>(<span class="variable">$y</span>,  </span><br><span class="line">                                   -(<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">_add</span>(<span class="variable">$z</span> &lt;&lt; <span class="number">4</span> ^ <span class="variable">$this</span>-&gt;<span class="title function_ invoke__">_rshift</span>(<span class="variable">$z</span>, <span class="number">5</span>), <span class="variable">$z</span>) ^  </span><br><span class="line">                                         <span class="variable">$this</span>-&gt;<span class="title function_ invoke__">_add</span>(<span class="variable">$sum</span>, <span class="variable">$k</span>[<span class="variable">$sum</span> &amp; <span class="number">3</span>])));  </span><br><span class="line">         &#125;  </span><br><span class="line"> </span><br><span class="line">         <span class="variable">$w</span>[<span class="number">0</span>] = <span class="variable">$y</span>;  </span><br><span class="line">         <span class="variable">$w</span>[<span class="number">1</span>] = <span class="variable">$z</span>;  </span><br><span class="line">     &#125;  </span><br><span class="line"> </span><br><span class="line">     <span class="function"><span class="keyword">function</span> <span class="title">_resize</span>(<span class="params">&amp;<span class="variable">$data</span>, <span class="variable">$size</span>, <span class="variable">$nonull</span> = <span class="literal">false</span></span>)  </span></span><br><span class="line"><span class="function">     </span>&#123;  </span><br><span class="line">         <span class="variable">$n</span>      = <span class="title function_ invoke__">strlen</span>(<span class="variable">$data</span>);  </span><br><span class="line">         <span class="variable">$nmod</span>   = <span class="variable">$n</span> % <span class="variable">$size</span>;  </span><br><span class="line">         <span class="keyword">if</span> ( <span class="number">0</span> == <span class="variable">$nmod</span> )  </span><br><span class="line">             <span class="variable">$nmod</span> = <span class="variable">$size</span>;  </span><br><span class="line"> </span><br><span class="line">         <span class="keyword">if</span> (<span class="variable">$nmod</span> &gt; <span class="number">0</span>) &#123;  </span><br><span class="line">             <span class="keyword">if</span> (<span class="variable">$nonull</span>) &#123;  </span><br><span class="line">                 <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="variable">$n</span>; <span class="variable">$i</span> &lt; <span class="variable">$n</span> - <span class="variable">$nmod</span> + <span class="variable">$size</span>; ++<span class="variable">$i</span>) &#123;  </span><br><span class="line">                     <span class="variable">$data</span>[<span class="variable">$i</span>] = <span class="variable">$data</span>[<span class="variable">$i</span> % <span class="variable">$n</span>];  </span><br><span class="line">                 &#125;  </span><br><span class="line">             &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">                 <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="variable">$n</span>; <span class="variable">$i</span> &lt; <span class="variable">$n</span> - <span class="variable">$nmod</span> + <span class="variable">$size</span>; ++<span class="variable">$i</span>) &#123;  </span><br><span class="line">                     <span class="variable">$data</span>[<span class="variable">$i</span>] = <span class="title function_ invoke__">chr</span>(<span class="number">0</span>);  </span><br><span class="line">                 &#125;  </span><br><span class="line">             &#125;  </span><br><span class="line">         &#125;  </span><br><span class="line">         <span class="keyword">return</span> <span class="variable">$n</span>;  </span><br><span class="line">     &#125;  </span><br><span class="line"> </span><br><span class="line">     <span class="function"><span class="keyword">function</span> <span class="title">_hex2bin</span>(<span class="params"><span class="variable">$str</span></span>)  </span></span><br><span class="line"><span class="function">     </span>&#123;  </span><br><span class="line">         <span class="variable">$len</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$str</span>);  </span><br><span class="line">         <span class="keyword">return</span> <span class="title function_ invoke__">pack</span>(<span class="string">&#x27;H&#x27;</span> . <span class="variable">$len</span>, <span class="variable">$str</span>);  </span><br><span class="line">     &#125;  </span><br><span class="line"> </span><br><span class="line">     <span class="function"><span class="keyword">function</span> <span class="title">_str2long</span>(<span class="params"><span class="variable">$start</span>, &amp;<span class="variable">$data</span>, &amp;<span class="variable">$data_long</span></span>)  </span></span><br><span class="line"><span class="function">     </span>&#123;  </span><br><span class="line">         <span class="variable">$n</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$data</span>);  </span><br><span class="line"> </span><br><span class="line">         <span class="variable">$tmp</span>    = <span class="title function_ invoke__">unpack</span>(<span class="string">&#x27;N*&#x27;</span>, <span class="variable">$data</span>);  </span><br><span class="line">         <span class="variable">$j</span>      = <span class="variable">$start</span>;  </span><br><span class="line"> </span><br><span class="line">         <span class="keyword">foreach</span> (<span class="variable">$tmp</span> <span class="keyword">as</span> <span class="variable">$value</span>)  </span><br><span class="line">             <span class="variable">$data_long</span>[<span class="variable">$j</span>++] = <span class="variable">$value</span>;  </span><br><span class="line"> </span><br><span class="line">         <span class="keyword">return</span> <span class="variable">$j</span>;  </span><br><span class="line">     &#125;  </span><br><span class="line"> </span><br><span class="line">     <span class="function"><span class="keyword">function</span> <span class="title">_long2str</span>(<span class="params"><span class="variable">$l</span></span>)  </span></span><br><span class="line"><span class="function">     </span>&#123;  </span><br><span class="line">         <span class="keyword">return</span> <span class="title function_ invoke__">pack</span>(<span class="string">&#x27;N&#x27;</span>, <span class="variable">$l</span>);  </span><br><span class="line">     &#125;  </span><br><span class="line"> </span><br><span class="line">     <span class="function"><span class="keyword">function</span> <span class="title">_rshift</span>(<span class="params"><span class="variable">$integer</span>, <span class="variable">$n</span></span>)  </span></span><br><span class="line"><span class="function">     </span>&#123;  </span><br><span class="line">         <span class="keyword">if</span> (<span class="number">0xffffffff</span> &lt; <span class="variable">$integer</span> || -<span class="number">0xffffffff</span> &gt; <span class="variable">$integer</span>) &#123;  </span><br><span class="line">             <span class="variable">$integer</span> = <span class="title function_ invoke__">fmod</span>(<span class="variable">$integer</span>, <span class="number">0xffffffff</span> + <span class="number">1</span>);  </span><br><span class="line">         &#125;  </span><br><span class="line"> </span><br><span class="line">         <span class="keyword">if</span> (<span class="number">0x7fffffff</span> &lt; <span class="variable">$integer</span>) &#123;  </span><br><span class="line">             <span class="variable">$integer</span> -= <span class="number">0xffffffff</span> + <span class="number">1.0</span>;  </span><br><span class="line">         &#125; <span class="keyword">elseif</span> (-<span class="number">0x80000000</span> &gt; <span class="variable">$integer</span>) &#123;  </span><br><span class="line">             <span class="variable">$integer</span> += <span class="number">0xffffffff</span> + <span class="number">1.0</span>;  </span><br><span class="line">         &#125;  </span><br><span class="line"> </span><br><span class="line">         <span class="keyword">if</span> (<span class="number">0</span> &gt; <span class="variable">$integer</span>) &#123;  </span><br><span class="line">             <span class="variable">$integer</span> &amp;= <span class="number">0x7fffffff</span>;  </span><br><span class="line">             <span class="variable">$integer</span> &gt;&gt;= <span class="variable">$n</span>;  </span><br><span class="line">             <span class="variable">$integer</span> |= <span class="number">1</span> &lt;&lt; (<span class="number">31</span> - <span class="variable">$n</span>);  </span><br><span class="line">         &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">             <span class="variable">$integer</span> &gt;&gt;= <span class="variable">$n</span>;  </span><br><span class="line">         &#125;  </span><br><span class="line"> </span><br><span class="line">         <span class="keyword">return</span> <span class="variable">$integer</span>;  </span><br><span class="line">     &#125;  </span><br><span class="line"> </span><br><span class="line">     <span class="function"><span class="keyword">function</span> <span class="title">_add</span>(<span class="params"><span class="variable">$i1</span>, <span class="variable">$i2</span></span>)  </span></span><br><span class="line"><span class="function">     </span>&#123;  </span><br><span class="line">         <span class="variable">$result</span> = <span class="number">0.0</span>;  </span><br><span class="line"> </span><br><span class="line">         <span class="keyword">foreach</span> (<span class="title function_ invoke__">func_get_args</span>() <span class="keyword">as</span> <span class="variable">$value</span>) &#123;  </span><br><span class="line">             <span class="keyword">if</span> (<span class="number">0.0</span> &gt; <span class="variable">$value</span>) &#123;  </span><br><span class="line">                 <span class="variable">$value</span> -= <span class="number">1.0</span> + <span class="number">0xffffffff</span>;  </span><br><span class="line">             &#125;  </span><br><span class="line"> </span><br><span class="line">             <span class="variable">$result</span> += <span class="variable">$value</span>;  </span><br><span class="line">         &#125;  </span><br><span class="line"> </span><br><span class="line">         <span class="keyword">if</span> (<span class="number">0xffffffff</span> &lt; <span class="variable">$result</span> || -<span class="number">0xffffffff</span> &gt; <span class="variable">$result</span>) &#123;  </span><br><span class="line">             <span class="variable">$result</span> = <span class="title function_ invoke__">fmod</span>(<span class="variable">$result</span>, <span class="number">0xffffffff</span> + <span class="number">1</span>);  </span><br><span class="line">         &#125;  </span><br><span class="line"> </span><br><span class="line">         <span class="keyword">if</span> (<span class="number">0x7fffffff</span> &lt; <span class="variable">$result</span>) &#123;  </span><br><span class="line">             <span class="variable">$result</span> -= <span class="number">0xffffffff</span> + <span class="number">1.0</span>;  </span><br><span class="line">         &#125; <span class="keyword">elseif</span> (-<span class="number">0x80000000</span> &gt; <span class="variable">$result</span>) &#123;  </span><br><span class="line">             <span class="variable">$result</span> += <span class="number">0xffffffff</span> + <span class="number">1.0</span>;  </span><br><span class="line">         &#125;  </span><br><span class="line">         <span class="keyword">return</span> <span class="variable">$result</span>;  </span><br><span class="line">     &#125;  </span><br><span class="line"> &#125;  </span><br><span class="line"> <span class="meta">?&gt;</span> </span><br><span class="line">使用方法参考如下：</span><br><span class="line"><span class="comment">// 加密过程</span></span><br><span class="line">view sourceprint?</span><br><span class="line"> <span class="variable">$text_file</span> = S_ROOT . <span class="string">&#x27;./456.php&#x27;</span>;  </span><br><span class="line"> <span class="variable">$str</span> = @<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$text_file</span>);  </span><br><span class="line"> </span><br><span class="line"> <span class="keyword">require_once</span> S_ROOT . <span class="string">&quot;./text_auth.php&quot;</span>;  </span><br><span class="line"> <span class="variable">$text_auth</span> = <span class="keyword">new</span> <span class="title function_ invoke__">text_auth</span>(<span class="number">64</span>);  </span><br><span class="line"> </span><br><span class="line"> <span class="variable">$str</span> = <span class="variable">$text_auth</span>-&gt;<span class="title function_ invoke__">encrypt</span>(<span class="variable">$str</span>, <span class="string">&quot;qianyunlai.com&quot;</span>);  </span><br><span class="line"> </span><br><span class="line"> <span class="variable">$filename</span> = S_ROOT . <span class="string">&#x27;./789.php&#x27;</span>; <span class="comment">// 加密后的文本为二进制，普通的文本编辑器无法正常查看  </span></span><br><span class="line"> <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$filename</span>, <span class="variable">$str</span>); </span><br><span class="line"><span class="comment">// 解密过程</span></span><br><span class="line">view sourceprint</span><br><span class="line">?<span class="number">01</span> <span class="variable">$text_file</span> = S_ROOT . <span class="string">&#x27;./789.php&#x27;</span>;  </span><br><span class="line"> <span class="variable">$str</span> = @<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$text_file</span>);  </span><br><span class="line"> </span><br><span class="line"> <span class="keyword">require_once</span> S_ROOT . <span class="string">&quot;./text_auth.php&quot;</span>;  </span><br><span class="line"> <span class="variable">$text_auth</span> = <span class="keyword">new</span> <span class="title function_ invoke__">text_auth</span>(<span class="number">64</span>);  </span><br><span class="line"> </span><br><span class="line"> <span class="variable">$str</span> = <span class="variable">$text_auth</span>-&gt;<span class="title function_ invoke__">decrypt</span>(<span class="variable">$str</span>, <span class="string">&quot;qianyunlai.com&quot;</span>);  </span><br><span class="line"> </span><br><span class="line"> <span class="variable">$filename</span> = S_ROOT . <span class="string">&#x27;./456.php&#x27;</span>;  </span><br><span class="line"> <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$filename</span>, <span class="variable">$str</span>);</span><br></pre></td></tr></table></figure>

<p>该方法可以对文本的内容进行 二进制加密 与 解密。</p>
<p>以上几种方法各有各的优点和用处，大家也选择使用</p>
]]></content>
      <categories>
        <category>php</category>
      </categories>
      <tags>
        <tag>php</tag>
      </tags>
  </entry>
  <entry>
    <title>PHP实现公历与农历间的互转换方法介绍</title>
    <url>/2023/11/24/PHP%E5%AE%9E%E7%8E%B0%E5%85%AC%E5%8E%86%E4%B8%8E%E5%86%9C%E5%8E%86%E9%97%B4%E7%9A%84%E4%BA%92%E8%BD%AC%E6%8D%A2%E6%96%B9%E6%B3%95%E4%BB%8B%E7%BB%8D/</url>
    <content><![CDATA[<blockquote>
<p>很多时候我们有公历和农历之间的互转需求，农历的计算是按照中国传统中总结出来的，与公历有一定的偏差，但很多时候也有必要用到农历，所以这里推出公历与农历的互转，希望帮助到你提升代码速度。</p>
<p>以下代码可以直接copy使用，细节地方根据php版本不同稍作调整即可。</p>
</blockquote>
<span id="more"></span>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">app</span>\<span class="title class_">help</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 农历、公历 互转类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Lunar</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$_SMDay</span> = <span class="keyword">array</span>(<span class="number">1</span> =&gt; <span class="number">31</span>, <span class="number">28</span>, <span class="number">31</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">31</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">30</span>, <span class="number">31</span>);<span class="comment">//定义公历月分天数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$_LStart</span> = <span class="number">1950</span>;<span class="comment">//农历从1950年开始</span></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$_LMDay</span> = <span class="keyword">array</span>(</span><br><span class="line">        <span class="comment">//差：该年的农历正月初一到该年公历1月1日的天数；1~12：农历月份天数；闰：如有闰月，记录该月平月天数</span></span><br><span class="line">        <span class="comment">//  差 1 2 3 4 5 6 7 8 9 10 11 12 闰</span></span><br><span class="line">        <span class="keyword">array</span>(<span class="number">47</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">36</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">6</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">59</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>),  <span class="comment">//五月29 闰五月30</span></span><br><span class="line">        <span class="keyword">array</span>(<span class="number">44</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">33</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">23</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">59</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>),  <span class="comment">//三月29 闰三月30</span></span><br><span class="line">        <span class="keyword">array</span>(<span class="number">42</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">59</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>),  <span class="comment">//八月30 闰八月29</span></span><br><span class="line">        <span class="keyword">array</span>(<span class="number">48</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">38</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">27</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">59</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>),  <span class="comment">//六月30 闰六月29</span></span><br><span class="line">        <span class="keyword">array</span>(<span class="number">45</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">35</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">24</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">58</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>),  <span class="comment">//四月29 闰四月29</span></span><br><span class="line">        <span class="keyword">array</span>(<span class="number">43</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">30</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">32</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">20</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">59</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>),  <span class="comment">//三月30 闰三月29</span></span><br><span class="line">        <span class="keyword">array</span>(<span class="number">39</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">59</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>),  <span class="comment">//七月30 闰七月29</span></span><br><span class="line">        <span class="keyword">array</span>(<span class="number">47</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">36</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">26</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">59</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>),  <span class="comment">//五月30 闰五月29</span></span><br><span class="line">        <span class="keyword">array</span>(<span class="number">45</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">33</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">22</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">59</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>),  <span class="comment">//四月30 闰四月29</span></span><br><span class="line">        <span class="keyword">array</span>(<span class="number">41</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">30</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">59</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>),  <span class="comment">//八月30 闰八月29</span></span><br><span class="line">        <span class="keyword">array</span>(<span class="number">48</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">37</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">27</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">60</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>),  <span class="comment">//六月30 闰六月30</span></span><br><span class="line">        <span class="keyword">array</span>(<span class="number">46</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">35</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">24</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">58</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>),  <span class="comment">//四月29 闰四月29</span></span><br><span class="line">        <span class="keyword">array</span>(<span class="number">43</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">32</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">59</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">30</span>),  <span class="comment">//十月30 闰十月29</span></span><br><span class="line">        <span class="keyword">array</span>(<span class="number">50</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">39</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">28</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">59</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>),  <span class="comment">//六月30 闰六月29</span></span><br><span class="line">        <span class="keyword">array</span>(<span class="number">47</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">36</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">30</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">26</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">59</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">30</span>),  <span class="comment">//五月30 闰五月29</span></span><br><span class="line">        <span class="keyword">array</span>(<span class="number">45</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">30</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">34</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">22</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">59</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>),  <span class="comment">//三月30 闰三月29</span></span><br><span class="line">        <span class="keyword">array</span>(<span class="number">40</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">59</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>),  <span class="comment">//八月30 闰八月29</span></span><br><span class="line">        <span class="keyword">array</span>(<span class="number">49</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">37</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">27</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">58</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>),  <span class="comment">//五月29 闰五月29</span></span><br><span class="line">        <span class="keyword">array</span>(<span class="number">46</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">35</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">23</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">59</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>),  <span class="comment">//四月30 闰四月29</span></span><br><span class="line">        <span class="keyword">array</span>(<span class="number">42</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">31</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">21</span>, <span class="number">29</span>, <span class="number">59</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>),  <span class="comment">//二月30 闰二月29</span></span><br><span class="line">        <span class="keyword">array</span>(<span class="number">39</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">28</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">59</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">30</span>),  <span class="comment">//七月30 闰七月29</span></span><br><span class="line">        <span class="keyword">array</span>(<span class="number">48</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">37</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">25</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">59</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">30</span>),  <span class="comment">//五月30 闰五月29</span></span><br><span class="line">        <span class="keyword">array</span>(<span class="number">44</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">33</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">22</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">59</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>),  <span class="comment">//四月30 闰四月29</span></span><br><span class="line">        <span class="keyword">array</span>(<span class="number">40</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">59</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>),  <span class="comment">//九月30 闰九月29</span></span><br><span class="line">        <span class="keyword">array</span>(<span class="number">49</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">38</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">27</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">59</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>),  <span class="comment">//六月29 闰六月30</span></span><br><span class="line">        <span class="keyword">array</span>(<span class="number">46</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">35</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">24</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">59</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>),  <span class="comment">//四月30 闰四月29</span></span><br><span class="line">        <span class="keyword">array</span>(<span class="number">42</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">31</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">21</span>, <span class="number">29</span>, <span class="number">59</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>),  <span class="comment">//二月30 闰二月29</span></span><br><span class="line">        <span class="keyword">array</span>(<span class="number">40</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">28</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">59</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>),  <span class="comment">//六月30 闰六月29</span></span><br><span class="line">        <span class="keyword">array</span>(<span class="number">47</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">36</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">25</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">59</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>),  <span class="comment">//五月30 闰五月29</span></span><br><span class="line">        <span class="keyword">array</span>(<span class="number">43</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">33</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">22</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">59</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>),  <span class="comment">//三月30 闰三月29</span></span><br><span class="line">        <span class="keyword">array</span>(<span class="number">41</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">59</span>, <span class="number">30</span>, <span class="number">30</span>),  <span class="comment">//十一月30 闰十一月29</span></span><br><span class="line">        <span class="keyword">array</span>(<span class="number">49</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">38</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">27</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">59</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>),  <span class="comment">//六月29 闰六月30</span></span><br><span class="line">        <span class="keyword">array</span>(<span class="number">45</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">34</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">23</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">59</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>),  <span class="comment">//五月30 闰五月29</span></span><br><span class="line">        <span class="keyword">array</span>(<span class="number">42</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">31</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">21</span>, <span class="number">29</span>, <span class="number">59</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">30</span>),  <span class="comment">//二月30 闰二月29</span></span><br><span class="line">        <span class="keyword">array</span>(<span class="number">40</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">58</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>),  <span class="comment">//七月29 闰七月29</span></span><br><span class="line">        <span class="keyword">array</span>(<span class="number">47</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">36</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">25</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">59</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>),  <span class="comment">//五月29 闰五月30</span></span><br><span class="line">        <span class="keyword">array</span>(<span class="number">44</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">32</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>),</span><br><span class="line">        <span class="keyword">array</span>(<span class="number">22</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">59</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">29</span>),  <span class="comment">//三月29 闰三月30</span></span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">//是否闰年</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">IsLeapYear</span>(<span class="params"><span class="variable">$AYear</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="variable">$AYear</span> % <span class="number">4</span> == <span class="number">0</span>) &amp;&amp; ((<span class="variable">$AYear</span> % <span class="number">100</span> != <span class="number">0</span>) || (<span class="variable">$AYear</span> % <span class="number">400</span> == <span class="number">0</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//公历该月的天数(year：年份； month：月份)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">GetSMon</span>(<span class="params"><span class="variable">$year</span>, <span class="variable">$month</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">IsLeapYear</span>(<span class="variable">$year</span>) &amp;&amp; <span class="variable">$month</span> == <span class="number">2</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">29</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;_SMDay[<span class="variable">$month</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//农历名称转换</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">LYearName</span>(<span class="params"><span class="variable">$year</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$Name</span> = <span class="keyword">array</span>(<span class="string">&quot;零&quot;</span>, <span class="string">&quot;一&quot;</span>, <span class="string">&quot;二&quot;</span>, <span class="string">&quot;三&quot;</span>, <span class="string">&quot;四&quot;</span>, <span class="string">&quot;五&quot;</span>, <span class="string">&quot;六&quot;</span>, <span class="string">&quot;七&quot;</span>, <span class="string">&quot;八&quot;</span>, <span class="string">&quot;九&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">4</span>; <span class="variable">$i</span>++)</span><br><span class="line">            <span class="keyword">for</span> (<span class="variable">$k</span> = <span class="number">0</span>; <span class="variable">$k</span> &lt; <span class="number">10</span>; <span class="variable">$k</span>++)</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable">$year</span>[<span class="variable">$i</span>] == <span class="variable">$k</span>)</span><br><span class="line">                    <span class="variable">$tmp</span> .= <span class="variable">$Name</span>[<span class="variable">$k</span>];</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$tmp</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">LMonName</span>(<span class="params"><span class="variable">$month</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$month</span> &gt;= <span class="number">1</span> &amp;&amp; <span class="variable">$month</span> &lt;= <span class="number">12</span>) &#123;</span><br><span class="line">            <span class="variable">$Name</span> = <span class="keyword">array</span>(<span class="number">1</span> =&gt; <span class="string">&quot;正&quot;</span>, <span class="string">&quot;二&quot;</span>, <span class="string">&quot;三&quot;</span>, <span class="string">&quot;四&quot;</span>, <span class="string">&quot;五&quot;</span>, <span class="string">&quot;六&quot;</span>, <span class="string">&quot;七&quot;</span>, <span class="string">&quot;八&quot;</span>, <span class="string">&quot;九&quot;</span>, <span class="string">&quot;十&quot;</span>, <span class="string">&quot;十一&quot;</span>, <span class="string">&quot;十二&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$Name</span>[<span class="variable">$month</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$month</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">LDayName</span>(<span class="params"><span class="variable">$day</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$day</span> &gt;= <span class="number">1</span> &amp;&amp; <span class="variable">$day</span> &lt;= <span class="number">30</span>) &#123;</span><br><span class="line">            <span class="variable">$Name</span> = <span class="keyword">array</span>(<span class="number">1</span> =&gt;</span><br><span class="line">                              <span class="string">&quot;初一&quot;</span>, <span class="string">&quot;初二&quot;</span>, <span class="string">&quot;初三&quot;</span>, <span class="string">&quot;初四&quot;</span>, <span class="string">&quot;初五&quot;</span>, <span class="string">&quot;初六&quot;</span>, <span class="string">&quot;初七&quot;</span>, <span class="string">&quot;初八&quot;</span>, <span class="string">&quot;初九&quot;</span>, <span class="string">&quot;初十&quot;</span>,</span><br><span class="line">                <span class="string">&quot;十一&quot;</span>, <span class="string">&quot;十二&quot;</span>, <span class="string">&quot;十三&quot;</span>, <span class="string">&quot;十四&quot;</span>, <span class="string">&quot;十五&quot;</span>, <span class="string">&quot;十六&quot;</span>, <span class="string">&quot;十七&quot;</span>, <span class="string">&quot;十八&quot;</span>, <span class="string">&quot;十九&quot;</span>, <span class="string">&quot;二十&quot;</span>,</span><br><span class="line">                <span class="string">&quot;廿一&quot;</span>, <span class="string">&quot;廿二&quot;</span>, <span class="string">&quot;廿三&quot;</span>, <span class="string">&quot;廿四&quot;</span>, <span class="string">&quot;廿五&quot;</span>, <span class="string">&quot;廿六&quot;</span>, <span class="string">&quot;廿七&quot;</span>, <span class="string">&quot;廿八&quot;</span>, <span class="string">&quot;廿九&quot;</span>, <span class="string">&quot;三十&quot;</span></span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$Name</span>[<span class="variable">$day</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$day</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//公历转农历(Sdate：公历日期)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">S2L</span>(<span class="params"><span class="variable">$date</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">list</span>(<span class="variable">$year</span>, <span class="variable">$month</span>, <span class="variable">$day</span>) = <span class="title function_ invoke__">explode</span>(<span class="string">&quot;-&quot;</span>, <span class="variable">$date</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$year</span> &lt;= <span class="number">1951</span> || <span class="variable">$month</span> &lt;= <span class="number">0</span> || <span class="variable">$day</span> &lt;= <span class="number">0</span> || <span class="variable">$year</span> &gt;= <span class="number">2051</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="comment">//获取查询日期到当年1月1日的天数</span></span><br><span class="line">        <span class="variable">$date1</span> = <span class="title function_ invoke__">strtotime</span>(<span class="variable">$year</span> . <span class="string">&quot;-01-01&quot;</span>);<span class="comment">//当年1月1日</span></span><br><span class="line">        <span class="variable">$date2</span> = <span class="title function_ invoke__">strtotime</span>(<span class="variable">$year</span> . <span class="string">&quot;-&quot;</span> . <span class="variable">$month</span> . <span class="string">&quot;-&quot;</span> . <span class="variable">$day</span>);</span><br><span class="line">        <span class="variable">$days</span>  = <span class="title function_ invoke__">round</span>((<span class="variable">$date2</span> - <span class="variable">$date1</span>) / <span class="number">3600</span> / <span class="number">24</span>);</span><br><span class="line">        <span class="variable">$days</span>  += <span class="number">1</span>;</span><br><span class="line">        <span class="comment">//获取相应年度农历数据，化成数组Larray</span></span><br><span class="line">        <span class="variable">$Larray</span> = <span class="variable language_">$this</span>-&gt;_LMDay[<span class="variable">$year</span> - <span class="variable language_">$this</span>-&gt;_LStart];</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$days</span> &lt;= <span class="variable">$Larray</span>[<span class="number">0</span>]) &#123;</span><br><span class="line">            <span class="variable">$Lyear</span>  = <span class="variable">$year</span> - <span class="number">1</span>;</span><br><span class="line">            <span class="variable">$days</span>   = <span class="variable">$Larray</span>[<span class="number">0</span>] - <span class="variable">$days</span>;</span><br><span class="line">            <span class="variable">$Larray</span> = <span class="variable language_">$this</span>-&gt;_LMDay[<span class="variable">$Lyear</span> - <span class="variable language_">$this</span>-&gt;_LStart];</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$days</span> &lt; <span class="variable">$Larray</span>[<span class="number">12</span>]) &#123;</span><br><span class="line">                <span class="variable">$Lmonth</span> = <span class="number">12</span>;</span><br><span class="line">                <span class="variable">$Lday</span>   = <span class="variable">$Larray</span>[<span class="number">12</span>] - <span class="variable">$days</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$Lmonth</span> = <span class="number">11</span>;</span><br><span class="line">                <span class="variable">$days</span>   = <span class="variable">$days</span> - <span class="variable">$Larray</span>[<span class="number">12</span>];</span><br><span class="line">                <span class="variable">$Lday</span>   = <span class="variable">$Larray</span>[<span class="number">11</span>] - <span class="variable">$days</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$Lyear</span> = <span class="variable">$year</span>;</span><br><span class="line">            <span class="variable">$days</span>  = <span class="variable">$days</span> - <span class="variable">$Larray</span>[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">1</span>; <span class="variable">$i</span> &lt;= <span class="number">12</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable">$days</span> &gt; <span class="variable">$Larray</span>[<span class="variable">$i</span>]) <span class="variable">$days</span> = <span class="variable">$days</span> - <span class="variable">$Larray</span>[<span class="variable">$i</span>];</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="variable">$days</span> &gt; <span class="number">30</span>) &#123;</span><br><span class="line">                        <span class="variable">$days</span>  = <span class="variable">$days</span> - <span class="variable">$Larray</span>[<span class="number">13</span>];</span><br><span class="line">                        <span class="variable">$Ltype</span> = <span class="number">1</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="variable">$Lmonth</span> = <span class="variable">$i</span>;</span><br><span class="line">                    <span class="variable">$Lday</span>   = <span class="variable">$days</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">mktime</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="variable">$Lmonth</span>, <span class="variable">$Lday</span>, <span class="variable">$Lyear</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//农历转公历(date：农历日期； type：是否闰月)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">L2S</span>(<span class="params"><span class="variable">$date</span>, <span class="variable">$type</span> = <span class="number">0</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">list</span>(<span class="variable">$year</span>, <span class="variable">$month</span>, <span class="variable">$day</span>) = <span class="title function_ invoke__">explode</span>(<span class="string">&quot;-&quot;</span>, <span class="variable">$date</span>);</span><br><span class="line">        <span class="variable">$month</span> = <span class="title function_ invoke__">intval</span>(<span class="variable">$month</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$year</span> &lt;= <span class="number">1951</span> || <span class="variable">$month</span> &lt;= <span class="number">0</span> || <span class="variable">$day</span> &lt;= <span class="number">0</span> || <span class="variable">$year</span> &gt;= <span class="number">2051</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="variable">$Larray</span> = <span class="variable language_">$this</span>-&gt;_LMDay[<span class="variable">$year</span> - <span class="variable language_">$this</span>-&gt;_LStart];</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$type</span> == <span class="number">1</span> &amp;&amp; <span class="title function_ invoke__">count</span>(<span class="variable">$Larray</span>) &lt;= <span class="number">12</span>) <span class="keyword">return</span> <span class="literal">false</span>;<span class="comment">//要求查询闰，但查无闰月</span></span><br><span class="line">        <span class="comment">//如果查询的农历是闰月并该年度农历数组存在闰月数据就获取</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$Larray</span>[<span class="variable">$month</span>] &gt; <span class="number">30</span> &amp;&amp; <span class="variable">$type</span> == <span class="number">1</span> &amp;&amp; <span class="title function_ invoke__">count</span>(<span class="variable">$Larray</span>) &gt;= <span class="number">13</span>) <span class="variable">$day</span> = <span class="variable">$Larray</span>[<span class="number">13</span>] + <span class="variable">$day</span>;</span><br><span class="line">        <span class="comment">//获取该年农历日期到公历1月1日的天数</span></span><br><span class="line">        <span class="variable">$days</span> = <span class="variable">$day</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt;= <span class="variable">$month</span> - <span class="number">1</span>; <span class="variable">$i</span>++)</span><br><span class="line">            <span class="variable">$days</span> += <span class="variable">$Larray</span>[<span class="variable">$i</span>];</span><br><span class="line">        <span class="comment">//当查询农历日期距离公历1月1日超过一年时</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$days</span> &gt; <span class="number">366</span> || (<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">GetSMon</span>(<span class="variable">$month</span>, <span class="number">2</span>) != <span class="number">29</span> &amp;&amp; <span class="variable">$days</span> &gt; <span class="number">365</span>)) &#123;</span><br><span class="line">            <span class="variable">$Syear</span> = <span class="variable">$year</span> + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">GetSMon</span>(<span class="variable">$month</span>, <span class="number">2</span>) != <span class="number">29</span>)</span><br><span class="line">                <span class="variable">$days</span> -= <span class="number">366</span>;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="variable">$days</span> -= <span class="number">365</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$days</span> &gt; <span class="variable language_">$this</span>-&gt;_SMDay[<span class="number">1</span>]) &#123;</span><br><span class="line">                <span class="variable">$Smonth</span> = <span class="number">2</span>;</span><br><span class="line">                <span class="variable">$Sday</span>   = <span class="variable">$days</span> - <span class="variable language_">$this</span>-&gt;_SMDay[<span class="number">1</span>];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$Smonth</span> = <span class="number">1</span>;</span><br><span class="line">                <span class="variable">$Sday</span>   = <span class="variable">$days</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$Syear</span> = <span class="variable">$year</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">1</span>; <span class="variable">$i</span> &lt;= <span class="number">12</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable">$days</span> &gt; <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">GetSMon</span>(<span class="variable">$Syear</span>, <span class="variable">$i</span>))</span><br><span class="line">                    <span class="variable">$days</span> -= <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">GetSMon</span>(<span class="variable">$Syear</span>, <span class="variable">$i</span>);</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="variable">$Smonth</span> = <span class="variable">$i</span>;</span><br><span class="line">                    <span class="variable">$Sday</span>   = <span class="variable">$days</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">mktime</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="variable">$Smonth</span>, <span class="variable">$Sday</span>, <span class="variable">$Syear</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>php</category>
      </categories>
      <tags>
        <tag>php</tag>
      </tags>
  </entry>
  <entry>
    <title>PHP编程基础语法</title>
    <url>/2017/01/23/PHP%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/</url>
    <content><![CDATA[<h3 id="基础语法"><a href="#基础语法" class="headerlink" title="基础语法"></a>基础语法</h3><h4 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">array_chunk</span>(<span class="variable">$array</span>, <span class="variable">$size</span>): 将数组按size大小分为多个数组</span><br><span class="line"><span class="title function_ invoke__">array_diff</span>(<span class="variable">$a</span>, <span class="variable">$b</span>): 比较数组的不同，可以用来判断两个数组是否相等，需要注意的是这里返回的是在array1中但是不在array2中的值，而不是两个的交集</span><br><span class="line"><span class="title function_ invoke__">array_key_exists</span>(<span class="string">&quot;key&quot;</span>,<span class="variable">$a</span>)  <span class="comment"># 查看key是否存在于某个字典</span></span><br><span class="line"><span class="title function_ invoke__">array_intersect</span>(<span class="variable">$array1</span>, <span class="variable">$array2</span>[,<span class="variable">$array</span> $...])	<span class="comment"># 返回一个数组，该数组包含了所有在array1同时也出现在其他参数数组中的值</span></span><br><span class="line"><span class="title function_ invoke__">array_merge</span>()			<span class="comment"># 合并数组，相同的key直接覆盖</span></span><br><span class="line"><span class="title function_ invoke__">array_merge_recursive</span>()	<span class="comment"># 合并数组，相同的key不覆盖</span></span><br><span class="line"><span class="title function_ invoke__">array_push</span>(<span class="variable">$source</span>, <span class="string">&quot;red&quot;</span>, <span class="string">&quot;gree&quot;</span>)	<span class="comment"># 给数组添加元素</span></span><br><span class="line"><span class="title function_ invoke__">array_search</span>(): 搜索一个key的索引，如果是二维的数组，那么就是通过value搜索key</span><br><span class="line"><span class="title function_ invoke__">array_search</span>(<span class="title function_ invoke__">strtolower</span>(<span class="variable">$search</span>), <span class="title function_ invoke__">array_map</span>(<span class="string">&#x27;strtolower&#x27;</span>, <span class="variable">$array</span>)): array_search忽略大小写</span><br><span class="line"><span class="title function_ invoke__">array_slice</span>(<span class="variable">$arr</span>, <span class="number">0</span>, <span class="number">1</span>) <span class="comment"># 数组分片</span></span><br><span class="line"><span class="title function_ invoke__">array_sum</span>(<span class="variable">$arr</span>): 计算数组中所有值的和</span><br><span class="line"><span class="title function_ invoke__">array_values</span>(<span class="variable">$arr</span>): 获取数组所有的value值</span><br><span class="line">&lt;!--more--&gt;</span><br><span class="line">  </span><br><span class="line"><span class="title function_ invoke__">count</span>()函数：输出数组的长度</span><br><span class="line"><span class="keyword">empty</span>()函数：判断数组是否为空</span><br><span class="line"><span class="title function_ invoke__">end</span>()		<span class="comment">// 返回当前数组的最后一个值，需要注意的是这个函数不仅仅是返回最后一个值，还会把数组当前的指针指向最后一个数据</span></span><br><span class="line"><span class="title function_ invoke__">explode</span>(<span class="string">&#x27;,&#x27;</span>, <span class="variable">$str</span>)	<span class="comment"># 将字符串分割为数组	</span></span><br><span class="line"><span class="title function_ invoke__">implode</span>(<span class="string">&#x27;,&#x27;</span>, <span class="variable">$arr</span>)	<span class="comment"># 将数组拼接成字符串</span></span><br><span class="line"><span class="title function_ invoke__">in_array</span>(<span class="string">&#x27;a&#x27;</span>, <span class="variable">$a</span>)				<span class="comment"># 查看数组是否存在某个元素</span></span><br><span class="line"><span class="title function_ invoke__">json_encode</span>(<span class="variable">$arr</span>)	<span class="comment"># 数组转换城字符串</span></span><br><span class="line"><span class="keyword">list</span>(<span class="variable">$a</span>, <span class="variable">$b</span>) = [<span class="number">1</span>, <span class="number">2</span>]	<span class="comment"># 分别赋值</span></span><br><span class="line"><span class="title function_ invoke__">rsort</span>(): 以降序对数组排序</span><br><span class="line"><span class="title function_ invoke__">sort</span>();		<span class="comment"># 排序，可以给数组排序，会修改原来数组的值</span></span><br><span class="line"><span class="title function_ invoke__">uasort</span>(<span class="variable">$array</span>, <span class="variable">$cmp_function</span>)	<span class="comment"># 定义对比函数进行排序</span></span><br><span class="line"><span class="keyword">unset</span>(arr[<span class="number">1</span>]): 删除数组元素</span><br><span class="line"><span class="comment"># 数组遍历</span></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$array</span> <span class="keyword">as</span> <span class="variable">$value</span>): 数组遍历</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$array</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>): 数组(字典)遍历</span><br><span class="line">  </span><br><span class="line"><span class="comment"># 数组用于函数</span></span><br><span class="line"><span class="title function_ invoke__">func</span>(*<span class="keyword">list</span>): 将数组作为函数的输入</span><br><span class="line">  </span><br><span class="line"><span class="comment"># 在数组里面添加数组元素，在不确定key的情况下</span></span><br><span class="line"><span class="variable">$arr</span> = [];</span><br><span class="line"><span class="variable">$arr</span>[<span class="string">&#x27;a&#x27;</span>][] = <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line"><span class="variable">$arr</span>[<span class="string">&#x27;a&#x27;</span>][] = <span class="string">&#x27;b&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h4 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h4><p>PHP里面单引号和双引号确实有些地方的用法是不同的，比如匹配换行符的时候</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">json_decode</span>(<span class="keyword">string</span>, <span class="variable">$assoc</span>=<span class="literal">false</span>)	<span class="comment"># 将字符串转换为json对象,$assoc=true时返回array而不是object</span></span><br><span class="line"><span class="title function_ invoke__">lcfirst</span>(<span class="variable">$str</span>)			<span class="comment"># 将字符串首字母转换为小写</span></span><br><span class="line"><span class="title function_ invoke__">mb_strlen</span>(<span class="variable">$str</span>, <span class="string">&#x27;utf-8&#x27;</span>) <span class="comment"># 求中文字符串长度</span></span><br><span class="line"><span class="title function_ invoke__">mb_substr</span>(<span class="variable">$str</span>, <span class="variable">$start</span>, <span class="variable">$length</span>, <span class="string">&#x27;utf-8&#x27;</span>): 字符串分割，可以分割中文哟，如果要获得所有右边的，那么<span class="variable">$length</span>不用填或者填上<span class="literal">NULL</span>，如果版本不行那就是用功能弱一点的substr</span><br><span class="line"><span class="title function_ invoke__">nl2br</span>() <span class="comment"># 将字符串中的\n转换成网页的换行符&lt;br&gt;</span></span><br><span class="line"><span class="title function_ invoke__">sprintf</span>()	<span class="comment"># 字符串格式化，需要注意的是，它不是用\转义，而是用的%来转义</span></span><br><span class="line"><span class="title function_ invoke__">strlen</span>() <span class="comment"># 求字符串长度</span></span><br><span class="line"><span class="title function_ invoke__">strpos</span>(<span class="string">&#x27;abc&#x27;</span>, <span class="string">&#x27;a&#x27;</span>); 	<span class="comment"># 在字符串中查找第一次出现位置，没找到返回false</span></span><br><span class="line"><span class="title function_ invoke__">str_repeat</span>(<span class="string">&#x27;abc&#x27;</span>, n)	<span class="comment"># 将字符串重复n次</span></span><br><span class="line"><span class="title function_ invoke__">str_replace</span>(搜索值，替换值，目标)	<span class="comment"># 字符串替换</span></span><br><span class="line"><span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;\n&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="variable">$content</span>);	<span class="comment"># 去除换行符</span></span><br><span class="line"><span class="title function_ invoke__">substr_count</span>(<span class="variable">$haystack</span>, <span class="variable">$needle</span>, [<span class="variable">$offset</span>, <span class="variable">$length</span>]);	<span class="comment"># 计算子字符串needle在字符串haystack中出现的次数</span></span><br><span class="line"><span class="title function_ invoke__">trim</span>(<span class="variable">$string</span>);	<span class="comment"># 去除字符串前后的空白字符，如果要去除所有的字符只能使用preg_replace(&#x27;/\s+/&#x27;, &#x27;&#x27;, $string)，这是stackoverflow上面给出的答案</span></span><br><span class="line"><span class="variable">$a</span> . <span class="variable">$b</span> . <span class="string">&#x27;abc&#x27;</span>:字符串连接直接用点号</span><br><span class="line"><span class="title function_ invoke__">explode</span>(<span class="string">&#x27;,&#x27;</span>, <span class="variable">$str</span>, [<span class="variable">$limit</span>])	<span class="comment"># 字符串分割，第三个参数大于0表示限制分组数量，limit规定所返回的数组元素的个数，小于0时，返回包含除了最后的-limit个元素以外的所有元素的数组；0表示返回包含一个元素的数组</span></span><br><span class="line"><span class="title function_ invoke__">array_map</span>(<span class="string">&#x27;strrev&#x27;</span>, <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;-&#x27;</span>, <span class="title function_ invoke__">strrev</span>(<span class="variable">$a</span>), <span class="number">2</span>))	<span class="comment"># 字符串分割，逆向</span></span><br><span class="line"><span class="title function_ invoke__">iconv</span>(<span class="string">&#x27;utf-8&#x27;</span>, <span class="string">&#x27;GBK&#x27;</span>, <span class="variable">$data</span>): 将字符编码从utf-<span class="number">8</span>转换为GBK</span><br><span class="line"><span class="title function_ invoke__">join</span>(<span class="string">&quot;&amp;&quot;</span>, <span class="variable">$arr</span>)	<span class="comment"># 拼接字符串</span></span><br><span class="line"><span class="title function_ invoke__">parse_str</span>(<span class="string">&#x27;name=wang&amp;age=18&#x27;</span>): 从查询字符串中解析到变量，可以得到<span class="variable">$name</span>和<span class="variable">$age</span>两个变量</span><br><span class="line"><span class="title function_ invoke__">parse_url</span>(<span class="variable">$url</span>): 解析url成数组，与<span class="title function_ invoke__">http_build_query</span>()功能相反</span><br><span class="line"><span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/user_id=\d+&amp;name=/&#x27;</span>, <span class="string">&#x27;user_id=&#x27;</span> . <span class="number">1048</span> . <span class="string">&#x27;&amp;name=&#x27;</span>, <span class="variable">$code</span>): 正则替换</span><br><span class="line"><span class="title function_ invoke__">preg_replace_callback</span>(<span class="string">&#x27;//&#x27;</span>, function(<span class="variable">$matches</span>)&#123;<span class="keyword">return</span> <span class="title function_ invoke__">strtolower</span>(<span class="variable">$matchs</span>[<span class="number">0</span>])&#125;: 执行一个正则表达式搜索并且使用一个回调函数进行替换</span><br><span class="line"><span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/Chongqing(?&lt;right&gt;.*)/&#x27;</span>, <span class="variable">$string</span>, <span class="variable">$matches</span>): 正则匹配，pattern参数前后必须加斜杠</span><br><span class="line"><span class="title function_ invoke__">sprintf</span>(<span class="string">&quot;sahgoiahg%s&quot;</span>, <span class="variable">$a</span>): 格式化输出</span><br><span class="line"><span class="title function_ invoke__">strtolower</span>(<span class="variable">$str</span>)/<span class="title function_ invoke__">strtoupper</span>(<span class="variable">$str</span>): 大小写字符串</span><br><span class="line"><span class="title function_ invoke__">ucfirst</span>(<span class="variable">$str</span>): 将字符串首字母大写</span><br><span class="line"><span class="title function_ invoke__">ucwords</span>(<span class="variable">$str</span>): 将字符串每个单词首字母大写</span><br><span class="line">                      </span><br><span class="line"><span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="title function_ invoke__">lcfirst</span>(<span class="title function_ invoke__">ucwords</span>(<span class="title function_ invoke__">str_replace</span>([<span class="string">&#x27;-&#x27;</span>, <span class="string">&#x27;_&#x27;</span>], <span class="string">&#x27; &#x27;</span>, <span class="variable">$str</span>))));	<span class="comment"># 字符串转换为驼峰命名法</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="数字"><a href="#数字" class="headerlink" title="数字"></a>数字</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">ceil</span>()函数：向上取整</span><br><span class="line"><span class="title function_ invoke__">rand</span>(min, max)：产生随机数，不需要给初始值了现在</span><br><span class="line"><span class="title function_ invoke__">intval</span>(<span class="variable">$val</span>): 字符串转整数，如果不是数字型字符串，那么转换会失败，失败后返回<span class="number">0</span>，没错是<span class="number">0</span>，mmp</span><br><span class="line"><span class="keyword">int</span> <span class="title function_ invoke__">ip2long</span>(<span class="keyword">string</span> <span class="variable">$ip_address</span>)：IP转换成整数值</span><br><span class="line"><span class="keyword">string</span> <span class="title function_ invoke__">long2ip</span>(<span class="keyword">string</span> <span class="variable">$proper_address</span>)：整数值转换成IP</span><br><span class="line"><span class="title function_ invoke__">number_format</span>(<span class="keyword">float</span> <span class="variable">$number</span>)	<span class="comment">// 以千位分隔符方式格式化一个数字，返回字符串</span></span><br><span class="line"><span class="title function_ invoke__">sprintf</span>(<span class="string">&#x27;%04d&#x27;</span>, <span class="number">2</span>)	<span class="comment">// 数字前补零</span></span><br></pre></td></tr></table></figure>

<h4 id="时间"><a href="#时间" class="headerlink" title="时间"></a>时间</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">time</span>(): 获取当前时间戳</span><br><span class="line"><span class="title function_ invoke__">strtotime</span>(<span class="string">&#x27;&#x27;</span>): 字符串转换为时间戳</span><br><span class="line"><span class="title function_ invoke__">gmdate</span>(<span class="string">&quot;Y-m-d\TH:i:s\Z&quot;</span>): 获取GMT时区的时间</span><br><span class="line"><span class="variable">$beginToday</span>=<span class="title function_ invoke__">mktime</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="title function_ invoke__">date</span>(<span class="string">&#x27;m&#x27;</span>),<span class="title function_ invoke__">date</span>(<span class="string">&#x27;d&#x27;</span>),<span class="title function_ invoke__">date</span>(<span class="string">&#x27;Y&#x27;</span>)):获取今天开始时的时间戳</span><br><span class="line"><span class="variable">$endToday</span>=<span class="title function_ invoke__">mktime</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="title function_ invoke__">date</span>(<span class="string">&#x27;m&#x27;</span>),<span class="title function_ invoke__">date</span>(<span class="string">&#x27;d&#x27;</span>)+<span class="number">1</span>,<span class="title function_ invoke__">date</span>(<span class="string">&#x27;Y&#x27;</span>))-<span class="number">1</span>:获取今天结束时的时间戳</span><br><span class="line"><span class="variable">$beginYesterday</span>=<span class="title function_ invoke__">mktime</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="title function_ invoke__">date</span>(<span class="string">&#x27;m&#x27;</span>),<span class="title function_ invoke__">date</span>(<span class="string">&#x27;d&#x27;</span>)-<span class="number">1</span>,<span class="title function_ invoke__">date</span>(<span class="string">&#x27;Y&#x27;</span>))：获取昨天开始时的时间戳</span><br><span class="line"><span class="variable">$endYesterday</span>=<span class="title function_ invoke__">mktime</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="title function_ invoke__">date</span>(<span class="string">&#x27;m&#x27;</span>),<span class="title function_ invoke__">date</span>(<span class="string">&#x27;d&#x27;</span>),<span class="title function_ invoke__">date</span>(<span class="string">&#x27;Y&#x27;</span>))-<span class="number">1</span>：获取昨天结束时的时间戳</span><br><span class="line"><span class="variable">$beginLastweek</span>=<span class="title function_ invoke__">mktime</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="title function_ invoke__">date</span>(<span class="string">&#x27;m&#x27;</span>),<span class="title function_ invoke__">date</span>(<span class="string">&#x27;d&#x27;</span>)-<span class="title function_ invoke__">date</span>(<span class="string">&#x27;w&#x27;</span>)+<span class="number">1</span>-<span class="number">7</span>,<span class="title function_ invoke__">date</span>(<span class="string">&#x27;Y&#x27;</span>))：获取上周开始时的时间戳</span><br><span class="line"><span class="variable">$endLastweek</span>=<span class="title function_ invoke__">mktime</span>(<span class="number">23</span>,<span class="number">59</span>,<span class="number">59</span>,<span class="title function_ invoke__">date</span>(<span class="string">&#x27;m&#x27;</span>),<span class="title function_ invoke__">date</span>(<span class="string">&#x27;d&#x27;</span>)-<span class="title function_ invoke__">date</span>(<span class="string">&#x27;w&#x27;</span>)+<span class="number">7</span>-<span class="number">7</span>,<span class="title function_ invoke__">date</span>(<span class="string">&#x27;Y&#x27;</span>))：获取上周结束时的时间戳</span><br><span class="line"><span class="variable">$beginThismonth</span>=<span class="title function_ invoke__">mktime</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="title function_ invoke__">date</span>(<span class="string">&#x27;m&#x27;</span>),<span class="number">1</span>,<span class="title function_ invoke__">date</span>(<span class="string">&#x27;Y&#x27;</span>))：获取本月开始时的时间戳</span><br><span class="line"><span class="variable">$endThismonth</span>=<span class="title function_ invoke__">mktime</span>(<span class="number">23</span>,<span class="number">59</span>,<span class="number">59</span>,<span class="title function_ invoke__">date</span>(<span class="string">&#x27;m&#x27;</span>),<span class="title function_ invoke__">date</span>(<span class="string">&#x27;t&#x27;</span>),<span class="title function_ invoke__">date</span>(<span class="string">&#x27;Y&#x27;</span>))：获取本月结束时的时间戳</span><br><span class="line"><span class="comment"># 单独获取当前的年、月、日、时、分、秒等</span></span><br><span class="line"><span class="title function_ invoke__">date</span>(<span class="string">&#x27;Y-m-d H:i:s&#x27;</span>); <span class="comment">// 如果要单独获取或者修改格式，那么直接按照里面的格式修改即可</span></span><br><span class="line"><span class="comment"># 输出指定格式</span></span><br><span class="line"><span class="title function_ invoke__">date</span>(<span class="string">&#x27;Y-m-d H:i&#x27;</span>, <span class="title function_ invoke__">time</span>())</span><br><span class="line"><span class="comment"># 时间的表示</span></span><br><span class="line">d: 月份中的第几天，有前导零的<span class="number">2</span>位数字，<span class="number">01</span>到<span class="number">31</span></span><br><span class="line">D: 星期中的第几天，文本表示，<span class="number">3</span>个字母，Mon 到 Sun</span><br><span class="line">j: 月份中的第几天，没有前导零，<span class="number">1</span> 到 <span class="number">31</span></span><br><span class="line">l:（“L”的小写字母），星期几，完整的文本格式	Sunday 到 Saturday</span><br><span class="line">N: ISO-<span class="number">8601</span> 格式数字表示的星期中的第几天（PHP <span class="number">5.1</span>.<span class="number">0</span> 新加），<span class="number">1</span>（表示星期一）到 <span class="number">7</span>（表示星期天）</span><br><span class="line">S: 每月天数后面的英文后缀，<span class="number">2</span> 个字符，st，nd，rd 或者 th。可以和 j 一起用</span><br><span class="line">w: 星期中的第几天，数字表示	<span class="number">0</span>（表示星期天）到 <span class="number">6</span>（表示星期六）</span><br><span class="line">z: 年份中的第几天	<span class="number">0</span> 到 <span class="number">365</span></span><br><span class="line">星期	---	---</span><br><span class="line">W	ISO-<span class="number">8601</span> 格式年份中的第几周，每周从星期一开始（PHP <span class="number">4.1</span>.<span class="number">0</span> 新加的）	例如：<span class="number">42</span>（当年的第 <span class="number">42</span> 周）</span><br><span class="line">月	---	---</span><br><span class="line">F	月份，完整的文本格式，例如 January 或者 March	January 到 December</span><br><span class="line">m	数字表示的月份，有前导零	<span class="number">01</span> 到 <span class="number">12</span></span><br><span class="line">M	三个字母缩写表示的月份	Jan 到 Dec</span><br><span class="line">n	数字表示的月份，没有前导零	<span class="number">1</span> 到 <span class="number">12</span></span><br><span class="line">t	指定的月份有几天	<span class="number">28</span> 到 <span class="number">31</span></span><br><span class="line">年	---	---</span><br><span class="line">L	是否为闰年	如果是闰年为 <span class="number">1</span>，否则为 <span class="number">0</span></span><br><span class="line">o	ISO-<span class="number">8601</span> 格式年份数字。这和 Y 的值相同，只除了如果 ISO 的星期数（W）属于前一年或下一年，则用那一年。（PHP <span class="number">5.1</span>.<span class="number">0</span> 新加）	Examples: <span class="number">1999</span> <span class="keyword">or</span> <span class="number">2003</span></span><br><span class="line">Y	<span class="number">4</span> 位数字完整表示的年份	例如：<span class="number">1999</span> 或 <span class="number">2003</span></span><br><span class="line">y	<span class="number">2</span> 位数字表示的年份	例如：<span class="number">99</span> 或 <span class="number">03</span></span><br><span class="line">时间	---	---</span><br><span class="line">a	小写的上午和下午值	am 或 pm</span><br><span class="line">A	大写的上午和下午值	AM 或 PM</span><br><span class="line">B	Swatch Internet 标准时	<span class="number">000</span> 到 <span class="number">999</span></span><br><span class="line">g	小时，<span class="number">12</span> 小时格式，没有前导零	<span class="number">1</span> 到 <span class="number">12</span></span><br><span class="line">G	小时，<span class="number">24</span> 小时格式，没有前导零	<span class="number">0</span> 到 <span class="number">23</span></span><br><span class="line">h	小时，<span class="number">12</span> 小时格式，有前导零	<span class="number">01</span> 到 <span class="number">12</span></span><br><span class="line">H	小时，<span class="number">24</span> 小时格式，有前导零	<span class="number">00</span> 到 <span class="number">23</span></span><br><span class="line">i	有前导零的分钟数	<span class="number">00</span> 到 <span class="number">59</span>&gt;</span><br><span class="line">s	秒数，有前导零	<span class="number">00</span> 到 <span class="number">59</span>&gt;</span><br><span class="line">u	毫秒 （PHP <span class="number">5.2</span>.<span class="number">2</span> 新加）。需要注意的是 <span class="title function_ invoke__">date</span>() 函数总是返回 <span class="number">000000</span> 因为它只接受 <span class="keyword">integer</span> 参数， 而 <span class="title class_">DateTime</span>::<span class="title function_ invoke__">format</span>() 才支持毫秒。	示例: <span class="number">654321</span></span><br><span class="line">时区	---	---</span><br><span class="line">e	时区标识（PHP <span class="number">5.1</span>.<span class="number">0</span> 新加）	例如：UTC，GMT，Atlantic/Azores</span><br><span class="line">I	是否为夏令时	如果是夏令时为 <span class="number">1</span>，否则为 <span class="number">0</span></span><br><span class="line">O	与格林威治时间相差的小时数	例如：+<span class="number">0200</span></span><br><span class="line">P	与格林威治时间（GMT）的差别，小时和分钟之间有冒号分隔（PHP <span class="number">5.1</span>.<span class="number">3</span> 新加）	例如：+<span class="number">02</span>:<span class="number">00</span></span><br><span class="line">T	本机所在的时区	例如：EST，MDT（【译者注】在 Windows 下为完整文本格式，例如“Eastern Standard Time”，中文版会显示“中国标准时间”）。</span><br><span class="line">Z	时差偏移量的秒数。UTC 西边的时区偏移量总是负的，UTC 东边的时区偏移量总是正的。	-<span class="number">43200</span> 到 <span class="number">43200</span></span><br><span class="line">完整的日期／时间	---	---</span><br><span class="line">c	ISO <span class="number">8601</span> 格式的日期（PHP <span class="number">5</span> 新加）	<span class="number">2004</span>-<span class="number">02</span>-<span class="number">12</span>T15:<span class="number">19</span>:<span class="number">21</span>+<span class="number">00</span>:<span class="number">00</span></span><br><span class="line">r	RFC <span class="number">822</span> 格式的日期	例如：Thu, <span class="number">21</span> Dec <span class="number">2000</span> <span class="number">16</span>:<span class="number">01</span>:<span class="number">07</span> +<span class="number">0200</span></span><br><span class="line">U	从 Unix 纪元（January <span class="number">1</span> <span class="number">1970</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> GMT）开始至今的秒数	参见 <span class="title function_ invoke__">time</span>()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="Carbon时间处理第三方库"><a href="#Carbon时间处理第三方库" class="headerlink" title="Carbon时间处理第三方库"></a>Carbon时间处理第三方库</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Carbon</span>::<span class="title function_ invoke__">parse</span>(<span class="string">&#x27;2017-08-25 18:18:18&#x27;</span>);	<span class="comment"># 不用指定格式即可将时间字符串自动转换为Carbon对象</span></span><br></pre></td></tr></table></figure>

<h4 id="文件操作"><a href="#文件操作" class="headerlink" title="文件操作"></a>文件操作</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$fp</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&quot;test&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;Unable to open file!&quot;</span>);	<span class="comment"># 打开文件</span></span><br><span class="line"><span class="variable">$fp</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&#x27;test&#x27;</span>, <span class="string">&#x27;w&#x27;</span>)	<span class="comment"># 写入</span></span><br><span class="line"><span class="title function_ invoke__">fread</span>(<span class="variable">$fp</span>,<span class="title function_ invoke__">filesize</span>(<span class="string">&quot;webdictionary.txt&quot;</span>));	<span class="comment"># 读取指定大小的内容</span></span><br><span class="line"><span class="title function_ invoke__">fgetc</span>(<span class="variable">$fp</span>)		<span class="comment"># 读取一个字符</span></span><br><span class="line"><span class="title function_ invoke__">fgets</span>(<span class="variable">$fp</span>)		<span class="comment"># 读取一行</span></span><br><span class="line"><span class="title function_ invoke__">feof</span>(<span class="variable">$fp</span>)		<span class="comment"># 判断指针是否指向文件尾了</span></span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$fp</span>, <span class="string">&#x27;haofly&#x27;</span>)	<span class="comment"># 写入字符串到文件</span></span><br><span class="line"><span class="title function_ invoke__">fclose</span>(<span class="variable">$fp</span>);	<span class="comment"># 关闭文件</span></span><br></pre></td></tr></table></figure>

<h4 id="函数-x2F-类-x2F-对象"><a href="#函数-x2F-类-x2F-对象" class="headerlink" title="函数&#x2F;类&#x2F;对象"></a>函数&#x2F;类&#x2F;对象</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># public, private, projtected的区别:</span></span><br><span class="line"><span class="keyword">public</span> <span class="comment"># 权限最多，可以内部调用，实例调用</span></span><br><span class="line"><span class="keyword">protected</span>	<span class="comment"># 受保护类型，用于本类和继承类调用</span></span><br><span class="line"><span class="keyword">private</span>		<span class="comment"># 私有类型，只有在本类中使用</span></span><br><span class="line">  </span><br><span class="line"><span class="comment"># 对象的序列化和反序列化</span></span><br><span class="line"><span class="title function_ invoke__">serialize</span>()</span><br><span class="line"><span class="title function_ invoke__">unserialize</span>()</span><br><span class="line">  </span><br><span class="line"><span class="comment"># 一些自省(反射)方法</span></span><br><span class="line"><span class="title function_ invoke__">func_get_args</span>()					<span class="comment"># 获取当前方法所有的参数</span></span><br><span class="line"><span class="title function_ invoke__">get_class</span>(className)			<span class="comment"># 取得当前语句所在的类名</span></span><br><span class="line"><span class="title function_ invoke__">get_class_methods</span>(className)	<span class="comment"># 取得相应class所包含的所有的方法名</span></span><br><span class="line"><span class="title function_ invoke__">get_class_vars</span>(clasName)		<span class="comment"># 取得相应class所包含的所有的变量名</span></span><br><span class="line"><span class="title function_ invoke__">get_object_vars</span>(<span class="variable">$object</span>)		<span class="comment"># 获取类或者对象的属性，返回数组</span></span><br><span class="line"><span class="title function_ invoke__">property_exists</span>(<span class="variable">$object</span>, <span class="variable">$key</span>)	<span class="comment"># 类或者对象是否存在某个属性</span></span><br><span class="line"><span class="title function_ invoke__">setAttribute</span>(<span class="variable">$name</span>, <span class="variable">$value</span>)		<span class="comment"># 设置函数的属性或者直接设置函数的内部变量</span></span><br><span class="line"><span class="variable language_">$this</span>-&gt;&#123;<span class="variable">$key</span>&#125; = <span class="variable">$value</span>			<span class="comment"># 给类动态添加属性</span></span><br><span class="line"><span class="variable language_">$this</span>-&gt;&#123;<span class="variable">$key</span>&#125;					<span class="comment"># 返回对象指定的属性</span></span><br><span class="line"><span class="comment"># 根据类名知道类的定义文件</span></span><br><span class="line"><span class="variable">$reflector</span> = <span class="keyword">new</span> <span class="title class_">ReflectionClass</span>(<span class="string">&#x27;className&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$reflector</span>-&gt;<span class="title function_ invoke__">getFileName</span>();</span><br><span class="line"><span class="comment"># 标准嘞StdClass</span></span><br><span class="line"><span class="variable">$obj</span>-&gt;value <span class="comment"># 直接获取其内部的变量</span></span><br><span class="line">  </span><br><span class="line"><span class="comment"># trait: 一种代码复用机制，从基类继承的成员会被trait插入的成员所覆盖，优先顺序是来自当前类的成员覆盖了trait的方法，而trait则覆盖了被继承的方法。这是为了弥补PHP单继承的局限</span></span><br><span class="line"><span class="comment"># 例如可以写一个单例:</span></span><br><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">SingleInstance</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">  <span class="built_in">static</span> <span class="keyword">private</span> <span class="variable">$instance</span> = <span class="literal">null</span>;</span><br><span class="line">  <span class="built_in">static</span> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInstance</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">self</span>::<span class="variable">$instance</span>) &#123;</span><br><span class="line">      <span class="built_in">self</span>::<span class="variable">$instance</span> = <span class="keyword">new</span> <span class="built_in">static</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">self</span>::<span class="variable">$instance</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 在其他类里面只需要use SingleInstance就行了。再比如，文档里面的例子</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Base</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">sayHello</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Hello &#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">SayWorld</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">sayHello</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">parent</span>::<span class="title function_ invoke__">sayHello</span>();</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;World!&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyHelloWorld</span> <span class="keyword">extends</span> <span class="title">Base</span> </span>&#123;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">SayWorld</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$o</span> = <span class="keyword">new</span> <span class="title class_">MyHelloWorld</span>();</span><br><span class="line"><span class="variable">$o</span>-&gt;<span class="title function_ invoke__">sayHello</span>();		<span class="comment">// 输出的是Hello World</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="发送CURL请求"><a href="#发送CURL请求" class="headerlink" title="发送CURL请求"></a>发送CURL请求</h4><p>注意：使用CURL之前一定要先确定服务器是否已经安装php的curl扩展，如果没有，可能会报奇怪的错误，安装完扩展后记得重启php进程。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ch</span> = <span class="title function_ invoke__">curl_init</span>();								<span class="comment">// 初始化curl</span></span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>();									<span class="comment">// 设置参数</span></span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_URL, <span class="string">&#x27;url&#x27;</span>);			<span class="comment">// 设置URL</span></span><br><span class="line"><span class="title function_ invoke__">curl_setop</span>(<span class="variable">$ch</span>, CURLOPT_POST, <span class="literal">true</span>);			<span class="comment">// 发送POST请求</span></span><br><span class="line"><span class="title function_ invoke__">curl_setop</span>(<span class="variable">$ch</span>, CURL_POSTFIELDS, <span class="variable">$data</span>);		<span class="comment">// POST的数据</span></span><br><span class="line"><span class="title function_ invoke__">curl_setop</span>(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="literal">true</span>);	<span class="comment">// 获取返回结果，如果不加这个，那么$result=true</span></span><br><span class="line"><span class="variable">$result</span> = <span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);						<span class="comment">// 执行curl请求</span></span><br><span class="line"><span class="title function_ invoke__">curl_getinfo</span>(<span class="variable">$ch</span>, CURLINFO_HTTP_CODE)			<span class="comment">// 获取http_code</span></span><br><span class="line">  </span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curlHandle</span>, CURLOPT_HTTPHEADER, [<span class="string">&#x27;Accept: application/json&#x27;</span>]);	<span class="comment">// 添加HTTP头</span></span><br><span class="line"><span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);								<span class="comment">// 关闭连接</span></span><br><span class="line"><span class="comment"># 如果要通过CURL 上传文件，那么需要这样对$data进行处理</span></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">function_exists</span>(<span class="string">&#x27;curl_file_create&#x27;</span>)) &#123; <span class="comment">// php 5.6+</span></span><br><span class="line">  <span class="variable">$cFile</span> = <span class="title function_ invoke__">curl_file_create</span>(<span class="variable">$scriptPath</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123; <span class="comment">//</span></span><br><span class="line">  <span class="variable">$cFile</span> = <span class="string">&#x27;@&#x27;</span> . <span class="title function_ invoke__">realpath</span>(<span class="variable">$scriptPath</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$data</span> = [<span class="string">&#x27;file&#x27;</span> =&gt; <span class="variable">$cFile</span>];</span><br><span class="line"><span class="comment"># 获取curl所有参数所代表的常量值</span></span><br><span class="line"><span class="variable">$arr</span> = <span class="title function_ invoke__">get_defined_constants</span>(<span class="literal">true</span>);</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$arr</span>[<span class="string">&#x27;curl&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<h4 id="WEB程序"><a href="#WEB程序" class="headerlink" title="WEB程序"></a>WEB程序</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_METHOD&#x27;</span>]    <span class="comment"># 返回数据提交的方式，GET、POST等</span></span><br><span class="line"><span class="variable">$_SERVER</span>[<span class="string">&quot;SERVER_PORT&quot;</span>]     <span class="comment"># 获取端口</span></span><br><span class="line"><span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_HOST&#x27;</span>]        <span class="comment"># 获取域名或主机地址</span></span><br><span class="line"><span class="variable">$_SERVER</span>[<span class="string">&#x27;SERVER_NAME&#x27;</span>]        <span class="comment"># 获取域名或主机名</span></span><br><span class="line"><span class="variable">$_SERVER</span>[<span class="string">&quot;REQUEST_URI&quot;</span>]        <span class="comment"># 获取域名后的详细地址</span></span><br><span class="line"><span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_SELF&#x27;</span>]        <span class="comment"># 获取PHP文件名</span></span><br><span class="line"><span class="variable">$_SERVER</span>[<span class="string">&quot;QUERY_STRING&quot;</span>]    <span class="comment"># 获取网址后的参数</span></span><br><span class="line"><span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_REFERER&#x27;</span>]    <span class="comment"># 获取来源url</span></span><br><span class="line"><span class="title function_ invoke__">parse_str</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;php://input&quot;</span>),<span class="variable">$post_vars</span>); <span class="comment"># 获取PUT数据</span></span><br><span class="line">getallheaders        <span class="comment"># 获取请求头</span></span><br><span class="line"><span class="title function_ invoke__">error_log</span>(<span class="string">&#x27;message&#x27;</span>)    <span class="comment"># 把错误信息发送到web服务器的错误日志，或者到一个文件里，有长度限制</span></span><br></pre></td></tr></table></figure>

<h4 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&#x27;soahg&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">catch</span>(<span class="built_in">Exception</span> <span class="variable">$e</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="帮助函数"><a href="#帮助函数" class="headerlink" title="帮助函数"></a>帮助函数</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">gettype</span>(): 获取变量类型</span><br><span class="line"><span class="variable">$obj</span> <span class="keyword">instanceof</span> A <span class="comment"># 判断对象是否属于某个类，不过判断是不是数组只能用is_array()	# 判断是否是数组</span></span><br><span class="line"><span class="title function_ invoke__">is_string</span>()	<span class="comment"># 判断是否是字符串</span></span><br><span class="line"><span class="title function_ invoke__">is_object</span>()	<span class="comment"># 判断是否是object</span></span><br><span class="line"><span class="title function_ invoke__">is_bool</span>()	<span class="comment"># 是否是布尔值</span></span><br><span class="line"><span class="title function_ invoke__">is_int</span>()	<span class="comment"># 是否是整数</span></span><br><span class="line"><span class="title function_ invoke__">is_integer</span>()<span class="comment"># 是否是整数</span></span><br><span class="line"><span class="title function_ invoke__">is_float</span>()	<span class="comment"># 是否是浮点数</span></span><br><span class="line"><span class="title function_ invoke__">is_real</span>()	<span class="comment"># 是否是实数</span></span><br><span class="line">is_numeric	<span class="comment"># 是否是数字或者数字字符串</span></span><br><span class="line"><span class="title function_ invoke__">interface_exists</span>()	<span class="comment"># 检查接口是否已经定义</span></span><br><span class="line"><span class="title function_ invoke__">class_exists</span>()		<span class="comment"># 检查类是否已经定义</span></span><br><span class="line">  </span><br><span class="line">PHP_INT_MAX	<span class="comment"># 最大整数</span></span><br><span class="line">PHP_INT_MIN	<span class="comment"># 最小整数</span></span><br><span class="line"><span class="title function_ invoke__">min</span>(<span class="variable">$value1</span>, <span class="variable">$value2</span>...)	<span class="comment"># 选出最小值，最大值max同理</span></span><br><span class="line"><span class="title function_ invoke__">min</span>([<span class="variable">$value1</span>, <span class="variable">$value2</span>,...])	<span class="comment"># 选出最小值，最大值max同理</span></span><br><span class="line">  </span><br><span class="line"><span class="title function_ invoke__">hash_hmac</span>(算法名, 明文, 盐)	<span class="comment"># hash加密函数，可以选定加密算法，例如hash_hmac(&#x27;sha1&#x27;, &#x27;mingwen&#x27;, &#x27;salt&#x27;)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="composer包管理"><a href="#composer包管理" class="headerlink" title="composer包管理"></a>composer包管理</h3><p>require是指在生产环境中必须的包，而require-dev则是开发的时候要用而生产环境无需用的包，常用命令:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">composer config --list	# 列出当前所有的配置</span><br><span class="line">composer show 	# 获取所有安装的包的列表</span><br><span class="line">composer require package_name --dev	# 安装包，并将其写入composer.json的require-dev中去</span><br><span class="line">composer remove package_name	# 移除包</span><br><span class="line">composer config -g repo.packagist composer https://packagist.phpcomposer.com	# 更换为国内的源</span><br><span class="line"># 忽略ssl证书验证</span><br><span class="line">composer config --global disable-tls true</span><br><span class="line">composer config --global secure-http false</span><br><span class="line">&quot;package/ppkg&quot;: &quot;2.7.*@beta&quot;	# 安装beta版</span><br></pre></td></tr></table></figure>

<h3 id="autoload"><a href="#autoload" class="headerlink" title="autoload"></a>autoload</h3><p>autoload，可以预加载类，自动索引所有的类，能够加快依赖的索引速度。但是autoload并不是实时更新的，如果发现vendor&#x2F;composer&#x2F;autoload_classmap.php中的类与你预想的有冲突，那么就需要更新一下了：composer dump-autoload。<br>在composer.json中有四种自动加载类型:</p>
<ul>
<li>classmap: development相关的:<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;classmap&quot;</span>: [<span class="string">&quot;src/&quot;</span>]	<span class="comment"># 这样composer就会读取这个文件夹下所有的文件，然后再vendor/composer/autoload_classmap.php中将所有的class的namespace+classname生成一个key=&gt;value的数组</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>psr-0: 已经被弃用</li>
<li>psr-4: 一般用于项目代码的自动加载</li>
<li>files: helper相关的</li>
</ul>
]]></content>
      <categories>
        <category>php</category>
      </categories>
      <tags>
        <tag>php</tag>
      </tags>
  </entry>
  <entry>
    <title>Python3.9 Pyinstaller 打包Face_Recognition程序</title>
    <url>/2024/05/22/Python3-9-Pyinstaller-%E6%89%93%E5%8C%85Face-Recognition%E7%A8%8B%E5%BA%8F/</url>
    <content><![CDATA[<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>直接使用pyinstaller -F find.py 进行打包，之后运行exe会报错，报错内容为：RuntimeError: Unable to open C:\Users\pc\AppData\Local\Temp_MEI70802\face_recognition_models\models\shape_predictor_68_face_landmarks. dat<br><img src="/../img/20240522-01.png" alt="pic"></p>
<h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><p>这个错误的意思是无法找到face_recognition的模型文件，那么我们需要去face_recognition找到对应的模型文件的真实地址，此时需要修改spec文件</p>
<span id="more"></span>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- mode: python -*-</span></span><br><span class="line"></span><br><span class="line">block_cipher = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">face_models = [</span><br><span class="line">(<span class="string">&#x27;.\\face_recognition_models\\models\\dlib_face_recognition_resnet_model_v1.dat&#x27;</span>, <span class="string">&#x27;./face_recognition_models/models&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;.\\face_recognition_models\\models\\mmod_human_face_detector.dat&#x27;</span>, <span class="string">&#x27;./face_recognition_models/models&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;.\\face_recognition_models\\models\\shape_predictor_5_face_landmarks.dat&#x27;</span>, <span class="string">&#x27;./face_recognition_models/models&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;.\\face_recognition_models\\models\\shape_predictor_68_face_landmarks.dat&#x27;</span>, <span class="string">&#x27;./face_recognition_models/models&#x27;</span>),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 以上四个模型文件需要找到本机的真实地址后，再放入到对应位置，比如此时我的windows下的模型文件地址为：</span></span><br><span class="line"><span class="comment"># C:\\Users\\pc\\AppData\\Local\\Programs\\Python\\Python39\\Lib\\site-packages\\face_recognition_models\\models\\dlib_face_recognition_resnet_model_v1.dat</span></span><br><span class="line"><span class="comment"># 将上面的地址分别放入到四个模型文件对应的地址中，此时在打包exe时，就可以正常运行了</span></span><br><span class="line"></span><br><span class="line">a = Analysis([<span class="string">&#x27;find.py&#x27;</span>],   <span class="comment"># 自己的python文件名 </span></span><br><span class="line">             pathex=[<span class="string">&#x27;C:\\Users\\pc\\Desktop\\test&#x27;</span>], <span class="comment"># python文件路径</span></span><br><span class="line">             binaries=face_models,</span><br><span class="line">             datas=[],</span><br><span class="line">             hiddenimports=[],</span><br><span class="line">             hookspath=[],</span><br><span class="line">             runtime_hooks=[],</span><br><span class="line">             excludes=[],</span><br><span class="line">             win_no_prefer_redirects=<span class="literal">False</span>,</span><br><span class="line">             win_private_assemblies=<span class="literal">False</span>,</span><br><span class="line">             cipher=block_cipher)</span><br><span class="line"></span><br><span class="line">pyz = PYZ(a.pure, a.zipped_data,</span><br><span class="line">             cipher=block_cipher)</span><br><span class="line">exe = EXE(pyz,</span><br><span class="line">          a.scripts,</span><br><span class="line">          a.binaries,</span><br><span class="line">          a.zipfiles,</span><br><span class="line">          a.datas,</span><br><span class="line">          name=<span class="string">&#x27;find&#x27;</span>,     <span class="comment"># 文件名，不带后缀</span></span><br><span class="line">          debug=<span class="literal">False</span>,</span><br><span class="line">          strip=<span class="literal">False</span>,</span><br><span class="line">          upx=<span class="literal">True</span>,</span><br><span class="line">          runtime_tmpdir=<span class="literal">None</span>,</span><br><span class="line">          console=<span class="literal">True</span> )</span><br></pre></td></tr></table></figure>


<p>修改好spec文件后，继续执行 <strong>pyinstaller find.spec</strong> 命令重新尝试打包。</p>
]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue.js的快速安装</title>
    <url>/2018/04/11/Vue-js%E7%9A%84%E5%BF%AB%E9%80%9F%E5%AE%89%E8%A3%85/</url>
    <content><![CDATA[<h3 id="Vue-js-教程"><a href="#Vue-js-教程" class="headerlink" title="Vue.js 教程"></a>Vue.js 教程</h3><p><img src="/../img/vue.png" alt="xx"></p>
<ul>
<li>Vue.js（读音 &#x2F;vjuː&#x2F;, 类似于 view） 是一套构建用户界面的渐进式框架。</li>
<li>Vue 只关注视图层， 采用自底向上增量开发的设计。</li>
<li>Vue 的目标是通过尽可能简单的 API 实现响应的数据绑定和组合的视图组件。</li>
<li>Vue 学习起来非常简单，本教程基于 Vue 2.1.8 版本测试。</li>
</ul>
<span id="more"></span>
<h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><p>vue.js的安装方式大致有三种，这里推荐一种npm的一种安装方式，npm版本必须大于3.0，如果低于这个版本请升级。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看版本</span></span><br><span class="line">npm -v</span><br><span class="line"></span><br><span class="line"><span class="comment"># 升级版本</span></span><br><span class="line">cnpm install npm -g</span><br></pre></td></tr></table></figure>

<p>在用Vue.js构建大型应用时推荐使用NPM安装：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">cnpm install vue</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Vue.js提供一个官方命令行工具，可用于快速搭建大型单页应用。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 全局安装</span></span><br><span class="line"></span><br><span class="line">cnpm install --<span class="keyword">global</span> vue-cli</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个基于webpack模板的新项目</span></span><br><span class="line"></span><br><span class="line">vue init webpack my-project </span><br><span class="line"></span><br><span class="line"><span class="comment"># 后面需要进行一些配置，默认回车即可</span></span><br><span class="line">This will install Vue <span class="number">2</span>.x version of the template.</span><br><span class="line"></span><br><span class="line">For Vue <span class="number">1</span>.x <span class="keyword">use</span>: <span class="title">vue</span> <span class="title">init</span> <span class="title">webpack</span>#1.0 <span class="title">my</span>-<span class="title">project</span></span><br><span class="line"></span><br><span class="line">? <span class="title">Project</span> <span class="title">name</span> <span class="title">my</span>-<span class="title">project</span></span><br><span class="line">? <span class="title">Project</span> <span class="title">description</span> <span class="title">A</span> <span class="title">Vue</span>.<span class="title">js</span> <span class="title">project</span></span><br><span class="line">? <span class="title">Author</span> <span class="title">runoob</span> &lt;<span class="title">test</span>@<span class="title">runoob</span>.<span class="title">com</span>&gt;</span><br><span class="line">? <span class="title">Vue</span> <span class="title">build</span> <span class="title">standalone</span></span><br><span class="line">? <span class="title">Use</span> <span class="title">ESLint</span> <span class="title">to</span> <span class="title">lint</span> <span class="title">your</span> <span class="title">code</span>? <span class="title">Yes</span></span><br><span class="line">? <span class="title">Pick</span> <span class="title">an</span> <span class="title">ESLint</span> <span class="title">preset</span> <span class="title">Standard</span></span><br><span class="line">? <span class="title">Setup</span> <span class="title">unit</span> <span class="title">tests</span> <span class="title">with</span> <span class="title">Karma</span> + <span class="title">Mocha</span>? <span class="title">Yes</span></span><br><span class="line">? <span class="title">Setup</span> <span class="title">e2e</span> <span class="title">tests</span> <span class="title">with</span> <span class="title">Nightwatch</span>? <span class="title">Yes</span></span><br><span class="line"></span><br><span class="line">   <span class="title">vue</span>-<span class="title">cli</span> · <span class="title">Generated</span> &quot;<span class="title">my</span>-<span class="title">project</span>&quot;.</span><br><span class="line"></span><br><span class="line">   <span class="title">To</span> <span class="title">get</span> <span class="title">started</span>:</span><br><span class="line">   </span><br><span class="line">     <span class="title">cd</span> <span class="title">my</span>-<span class="title">project</span></span><br><span class="line">     <span class="title">npm</span> <span class="title">install</span></span><br><span class="line">     <span class="title">npm</span> <span class="title">run</span> <span class="title">dev</span></span><br><span class="line">   </span><br><span class="line">   <span class="title">Documentation</span> <span class="title">can</span> <span class="title">be</span> <span class="title">found</span> <span class="title">at</span> <span class="title">https</span>://<span class="title">vuejs</span>-<span class="title">templates</span>.<span class="title">github</span>.<span class="title">io</span>/<span class="title">webpack</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>进入项目，安装并运行：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">cd my-project</span><br><span class="line"> cnpm install</span><br><span class="line"> cnpm run dev</span><br><span class="line"> DONE  Compiled successfully in <span class="number">4388</span>ms</span><br><span class="line"></span><br><span class="line"> Listening at http:<span class="comment">//localhost:8080</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ok!这个时候就看到帅气优雅的Vue.js的输出界面了！可以开始开发之旅了。</p>
<p>注意：Vue.js 不支持 IE8 及其以下 IE 版本。</p>
]]></content>
      <categories>
        <category>vue</category>
      </categories>
      <tags>
        <tag>vue</tag>
      </tags>
  </entry>
  <entry>
    <title>ajax轮询，定时去请求服务器数据</title>
    <url>/2023/03/21/ajax%E8%BD%AE%E8%AF%A2%EF%BC%8C%E5%AE%9A%E6%97%B6%E5%8E%BB%E8%AF%B7%E6%B1%82%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%95%B0%E6%8D%AE/</url>
    <content><![CDATA[<h3 id="服务端"><a href="#服务端" class="headerlink" title="服务端"></a>服务端</h3><p>Notify.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//获取通知消息</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getNotifyCount</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="title function_ invoke__">db</span>(<span class="string">&#x27;message_logs&#x27;</span>)-&gt;<span class="title function_ invoke__">where</span>(<span class="string">&#x27;isscan&#x27;</span>,<span class="number">0</span>)-&gt;<span class="title function_ invoke__">count</span>();</span><br><span class="line">        <span class="title class_">RestfulTools</span>::<span class="title function_ invoke__">restData</span>(<span class="variable">$msg</span>); <span class="comment">//这里是封装好的json_encode方法</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="前端"><a href="#前端" class="headerlink" title="前端"></a>前端</h3><p>notify.js</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;span <span class="class"><span class="keyword">class</span>=&quot;<span class="title">am</span>-<span class="title">icon</span>-<span class="title">envelope</span>-<span class="title">o</span>&quot;&gt;&lt;/<span class="title">span</span>&gt; 消息 &lt;<span class="title">span</span> <span class="title">class</span>=&quot;<span class="title">am</span>-<span class="title">badge</span> <span class="title">am</span>-<span class="title">badge</span>-<span class="title">warning</span>&quot; <span class="title">id</span>=&quot;<span class="title">msgCount</span>&quot;&gt; </span></span><br><span class="line"><span class="class"></span>&#123;<span class="variable">$msgCount</span>&#125;  <span class="comment">//这是是通过tp的 assign方法分配过来的变量，作为初始值</span></span><br><span class="line">&lt;/span&gt;</span><br></pre></td></tr></table></figure>
<span id="more"></span>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> getting = &#123;</span><br><span class="line">        url:<span class="string">&quot;&#123;:url(&#x27;Notify/getNotifyCount&#x27;)&#125;&quot;</span>,</span><br><span class="line">        dataType:<span class="string">&#x27;json&#x27;</span>,</span><br><span class="line">        success:<span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">            console.<span class="title function_ invoke__">log</span>(res);</span><br><span class="line">            <span class="keyword">var</span> msgCount = res.result;</span><br><span class="line">            $(<span class="string">&quot;#msgCount&quot;</span>).<span class="title function_ invoke__">html</span>(msgCount); <span class="comment">//用js的 html方法去改变id为msgCount的值</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Ajax定时访问服务端,这里是3分钟请求一次。</span></span><br><span class="line">    window.<span class="title function_ invoke__">setInterval</span>(function()&#123;</span><br><span class="line">        $.<span class="title function_ invoke__">ajax</span>(getting)</span><br><span class="line">    &#125;,<span class="number">180000</span>);</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>php</category>
      </categories>
      <tags>
        <tag>php</tag>
      </tags>
  </entry>
  <entry>
    <title>PHP根据二维数组中的某个字段进行排序</title>
    <url>/2019/05/29/PHP%E6%A0%B9%E6%8D%AE%E4%BA%8C%E7%BB%B4%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E6%9F%90%E4%B8%AA%E5%AD%97%E6%AE%B5%E8%BF%9B%E8%A1%8C%E6%8E%92%E5%BA%8F/</url>
    <content><![CDATA[<h3 id="函数介绍"><a href="#函数介绍" class="headerlink" title="函数介绍"></a>函数介绍</h3><p>1、array_column() 返回输入数组中某个单一列的值 </p>
<p><img src="/../img/sort-01.png" alt="php"></p>
<p>2、array_multisort() 函数返回排序数组。您可以输入一个或多个数组。函数先对第一个数组进行排序，接着是其他数组，如果两个或多<br>个值相同，它将对下一个数组进行排序。</p>
<p><img src="/../img/sort-02.png" alt="php"></p>
<span id="more"></span>

<h3 id="具体实现代码实例"><a href="#具体实现代码实例" class="headerlink" title="具体实现代码实例"></a>具体实现代码实例</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="variable">$data</span> = <span class="keyword">array</span>(</span><br><span class="line">	  <span class="keyword">array</span>(</span><br><span class="line">	    <span class="string">&#x27;id&#x27;</span> =&gt; <span class="number">5698</span>,</span><br><span class="line">	    <span class="string">&#x27;first_name&#x27;</span> =&gt; <span class="string">&#x27;Bill&#x27;</span>,</span><br><span class="line">	    <span class="string">&#x27;last_name&#x27;</span> =&gt; <span class="string">&#x27;Gates&#x27;</span>,</span><br><span class="line">	  ),</span><br><span class="line">	  <span class="keyword">array</span>(</span><br><span class="line">	    <span class="string">&#x27;id&#x27;</span> =&gt; <span class="number">4767</span>,</span><br><span class="line">	    <span class="string">&#x27;first_name&#x27;</span> =&gt; <span class="string">&#x27;Steve&#x27;</span>,</span><br><span class="line">	    <span class="string">&#x27;last_name&#x27;</span> =&gt; <span class="string">&#x27;Aobs&#x27;</span>,</span><br><span class="line">	  ),</span><br><span class="line">	  <span class="keyword">array</span>(</span><br><span class="line">	    <span class="string">&#x27;id&#x27;</span> =&gt; <span class="number">3809</span>,</span><br><span class="line">	    <span class="string">&#x27;first_name&#x27;</span> =&gt; <span class="string">&#x27;Mark&#x27;</span>,</span><br><span class="line">	    <span class="string">&#x27;last_name&#x27;</span> =&gt; <span class="string">&#x27;Zuckerberg&#x27;</span>,</span><br><span class="line">	  )</span><br><span class="line">	);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//根据字段last_name对数组$data进行降序排列</span></span><br><span class="line">	<span class="variable">$last_names</span> = <span class="title function_ invoke__">array_column</span>(<span class="variable">$data</span>,<span class="string">&#x27;last_name&#x27;</span>);</span><br><span class="line">	<span class="title function_ invoke__">array_multisort</span>(<span class="variable">$last_names</span>,SORT_DESC,<span class="variable">$data</span>);</span><br><span class="line"></span><br><span class="line">	<span class="title function_ invoke__">var_dump</span>(<span class="variable">$data</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">注意：这里有个问题就是，排序的方式是按照字符串的首字母判断的，数组中不能出现大小写同时出现，必须统一，否则无法排序，亲测！</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>php</category>
      </categories>
      <tags>
        <tag>php</tag>
      </tags>
  </entry>
  <entry>
    <title>composer.json架构</title>
    <url>/2018/04/09/composer-json%E6%9E%B6%E6%9E%84/</url>
    <content><![CDATA[<h3 id="Root包"><a href="#Root包" class="headerlink" title="Root包"></a>Root包</h3><p>“root 包”是指由 composer.json 定义的在你项目根目录的包。这是 composer.json 定义你项目所需的主要条件。（简单的说，你自己的项目就是一个 root 包）<br>某些字段仅适用于“root 包”上下文。config 字段就是其中一个例子。只有“root 包”可以定义。在依赖包中定义的 config 字段将被忽略，这使得 config 字段只有“root 包”可用（root-only）</p>
<p>如果你克隆了其中的一个依赖包，直接在其上开始工作，那么它就变成了“root 包”。与作为他人的依赖包时使用相同的 composer.json 文件，但上下文发生了变化。</p>
<span id="more"></span>
<h3 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h3><h4 id="包名-name"><a href="#包名-name" class="headerlink" title="包名 name"></a>包名 name</h4><p>包的名称，它包括供应商名称和项目名称，使用&#x2F;分隔。</p>
<p>eg:dept-jccp&#x2F;zbj_agent</p>
<h4 id="描述-description"><a href="#描述-description" class="headerlink" title="描述 description"></a>描述 description</h4><p>包的描述，对于需要发布的包（库），这个是必填的。</p>
<h4 id="版本-version"><a href="#版本-version" class="headerlink" title="版本 version"></a>版本 version</h4><p>version不是必须的，可以忽略。<br>通常，我们能够从 VCS (git, svn, hg) 的信息推断出包的版本号，在这种情况下，我们建议忽略 version。</p>
<h4 id="安装类型-type"><a href="#安装类型-type" class="headerlink" title="安装类型 type"></a>安装类型 type</h4><p>包的安装类型，默认为 library。</p>
<p>包的安装类型，用来定义安装逻辑。如果你有一个包需要一个特殊的逻辑，你可以设定一个自定义的类型。这可以是一个 symfony-bundle，一个 wordpress-plugin 或者一个 typo3-module。这些类型都将是具体到某一个项目，而对应的项目将要提供一种能够安装该类型包的安装程序。</p>
<p>composer原生支持以下4种类型：</p>
<ul>
<li>library: 这是默认类型，它会简单的将文件复制到vendor目录。</li>
<li>project: 这表示当前包是一个项目，而不是一个库。例：框架应用程序 Symfony standard edition，内容管理系统 SilverStripe installer 或者完全成熟的分布式应用程序。使用 IDE 创建一个新的工作区时，这可以为其提供项目列表的初始化。</li>
<li>metapackage: 当一个空的包，包含依赖并且需要触发依赖的安装，这将不会对系统写入额外的文件。因此这种安装类型并不需要一个 dist 或 source。</li>
<li>composer-plugin: 一个安装类型为 composer-plugin 的包，它有一个自定义安装类型，可以为其它包提供一个 installler。详细请查看 自定义安装类型。</li>
</ul>
<p>仅在你需要一个自定义的安装逻辑时才使用它。建议忽略这个属性，采用默认的 library。</p>
<h4 id="关键词-keyword"><a href="#关键词-keyword" class="headerlink" title="关键词 keyword"></a>关键词 keyword</h4><p>该包相关的关键词的数组。这些可用于搜索和过滤。</p>
<h4 id="项目主页-homepage"><a href="#项目主页-homepage" class="headerlink" title="项目主页 homepage"></a>项目主页 homepage</h4><p>该项目网站的 URL 地址。可选。</p>
<h4 id="版本发布时间-time"><a href="#版本发布时间-time" class="headerlink" title="版本发布时间 time"></a>版本发布时间 time</h4><p>版本发布时间。<br>必须符合 YYYY-MM-DD 或 YYYY-MM-DD HH:MM:SS 格式。<br>可选。</p>
<h4 id="许可协议-license"><a href="#许可协议-license" class="headerlink" title="许可协议 license"></a>许可协议 license</h4><p>包的许可协议，它可以是一个字符串或者字符串数组。</p>
<p>最常见的许可协议的推荐写法（按字母排序）：</p>
<ul>
<li>Apache-2.0</li>
<li>BSD-2-Clause</li>
<li>BSD-3-Clause</li>
<li>BSD-4-Clause</li>
<li>GPL-2.0</li>
<li>GPL-2.0+</li>
<li>GPL-3.0</li>
<li>GPL-3.0+</li>
<li>LGPL-2.1</li>
<li>LGPL-2.1+</li>
<li>LGPL-3.0</li>
<li>LGPL-3.0+</li>
<li>MIT</li>
</ul>
<p>可选。</p>
<p>对于闭源软件，你必须使用 “proprietary” 协议标识符。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;license&quot;</span>: <span class="string">&quot;MIT&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对于一个包，当允许在多个许可协议间进行选择时（”disjunctive license”），这些协议标识符可以被指定为数组。<br>多协议的一个例：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;license&quot;</span>: [</span><br><span class="line">       <span class="string">&quot;LGPL-2.1&quot;</span>,</span><br><span class="line">       <span class="string">&quot;GPL-3.0+&quot;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>另外它们也可以由 “or” 分隔，并写在括号中：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;license&quot;</span>: <span class="string">&quot;(LGPL-2.1 or GPL-3.0+)&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同样，当有多个许可协议需要结合使用时（”conjunctive license”），它们应该被 “and” 分隔，并写在括号中。</p>
<h4 id="作者-authors"><a href="#作者-authors" class="headerlink" title="作者 authors"></a>作者 authors</h4><p>包的作者。这是一个对象数组。</p>
<p>这个对象必须包含以下属性：</p>
<ul>
<li>name: 作者的姓名，通常使用真名。</li>
<li>email: 作者的 email 地址。</li>
<li>homepage: 作者主页的 URL 地址。</li>
<li>role: 该作者在此项目中担任的角色（例：开发人员 或 翻译）。<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;authors&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Nils Adermann&quot;</span>,</span><br><span class="line">            <span class="string">&quot;email&quot;</span>: <span class="string">&quot;naderman@naderman.de&quot;</span>,</span><br><span class="line">            <span class="string">&quot;homepage&quot;</span>: <span class="string">&quot;http://www.naderman.de&quot;</span>,</span><br><span class="line">            <span class="string">&quot;role&quot;</span>: <span class="string">&quot;Developer&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Jordi Boggiano&quot;</span>,</span><br><span class="line">            <span class="string">&quot;email&quot;</span>: <span class="string">&quot;j.boggiano@seld.be&quot;</span>,</span><br><span class="line">            <span class="string">&quot;homepage&quot;</span>: <span class="string">&quot;http://seld.be&quot;</span>,</span><br><span class="line">            <span class="string">&quot;role&quot;</span>: <span class="string">&quot;Developer&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
可选，但强烈建议提供此内容。</li>
</ul>
<h4 id="支持-support"><a href="#支持-support" class="headerlink" title="支持 support"></a>支持 support</h4><p>取项目支持的向相关信息对象。</p>
<p>这个对象必须包含以下属性：</p>
<ul>
<li>email: 项目支持 email 地址。</li>
<li>issues: 跟踪问题的 URL 地址。</li>
<li>forum: 论坛地址。</li>
<li>wiki: Wiki 地址。</li>
<li>irc: IRC 聊天频道地址，类似于 irc:&#x2F;&#x2F;server&#x2F;channel。</li>
<li>source: 网址浏览或下载源。</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;support&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;email&quot;</span>: <span class="string">&quot;support@example.org&quot;</span>,</span><br><span class="line">        <span class="string">&quot;irc&quot;</span>: <span class="string">&quot;irc://irc.freenode.org/composer&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Package-links"><a href="#Package-links" class="headerlink" title="Package links"></a>Package links</h4><p>下面提到的所有对象，都应该是 包名 到 版本 的映射对象。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;require&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;monolog/monolog&quot;</span>: <span class="string">&quot;1.0.*&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>所有的这些都是可选的。</p>
<h4 id="suggest"><a href="#suggest" class="headerlink" title="suggest"></a>suggest</h4><p>建议安装的包，它们增强或能够与当前包良好的工作。这些只是信息，并显示在依赖包安装完成之后，给你的用户一个建议，他们可以添加更多的包。</p>
<p>格式如下，版本约束变成了描述信息。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;suggest&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;monolog/monolog&quot;</span>: <span class="string">&quot;Allows more advanced logging of the application flow&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="autoload"><a href="#autoload" class="headerlink" title="autoload"></a>autoload</h4><p>PHP autoloader 的自动加载映射。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;autoload&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;psr-4&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Monolog\\&quot;</span>: <span class="string">&quot;src/&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Vendor\\Namespace\\&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="推荐"><a href="#推荐" class="headerlink" title="推荐"></a>推荐</h3><p>推荐一些常用的依赖：</p>
<ul>
<li>predis&#x2F;predis</li>
<li>nesbot&#x2F;carbon</li>
<li>react&#x2F;http-client</li>
<li>itsgoingd&#x2F;clockwork</li>
<li>codeception&#x2F;verify</li>
<li>qiniu&#x2F;php-sdk</li>
<li>dingo&#x2F;api</li>
<li>urmaul&#x2F;httpclient</li>
<li>nmred&#x2F;kafka-php</li>
<li>ramsey&#x2F;uuid</li>
<li>spatie&#x2F;laravel-pjax</li>
<li>douyasi&#x2F;laravel-editor-md</li>
</ul>
]]></content>
      <categories>
        <category>php</category>
      </categories>
      <tags>
        <tag>php</tag>
      </tags>
  </entry>
  <entry>
    <title>centos7 - centos 7.2 /var/run/php-fpm/php-fpm.sock不存在</title>
    <url>/2018/06/20/centos7-centos-7-2-var-run-php-fpm-php-fpm-sock%E4%B8%8D%E5%AD%98%E5%9C%A8/</url>
    <content><![CDATA[<p>在搭建Lnmp环境的时候可能会遇到这么一个问题，发现nginx安装好之后只能解析html文件的代码，却不能解析php文件的代码，这个时候可能出现的情况有两种，第一种是看php、php-fpm是否有装完成和是否启动；第二种情况就是下面的方案，跟系统的关系，nginx的配置有所不同。在nginx中配置重写规则中，有这么一句话：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">fastcgi_pass unix:/<span class="keyword">var</span>/run/php-fpm/php-fpm.sock</span><br></pre></td></tr></table></figure>

<p>可是在centos7.2中，这个路径没有这个文件，只有一个php-fpm.pid文件，那么上面这个文件在哪里？</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">[root@izwz9a3uv2157di5ogaaytz sites-enabled]<span class="comment"># cd /var/run/php-fpm/</span></span><br><span class="line">[root@izwz9a3uv2157di5ogaaytz php-fpm]<span class="comment"># ls</span></span><br><span class="line">php-fpm.pid</span><br></pre></td></tr></table></figure>
<span id="more"></span>

<p>用find &#x2F; -name “<em>php</em>.sock”找一下sock文件的位置，如果没找到的话就是没配置Unix Socket，只能访问TCP端口，可以为改为fastcgi_pass 127.0.0.1:9000</p>
<p>正确的配置：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">location ~ \.php$ &#123;</span><br><span class="line">                try_files <span class="variable">$uri</span> =<span class="number">404</span>;</span><br><span class="line">                fastcgi_split_path_info ^(.+\.php)(/.+)$;</span><br><span class="line">                <span class="comment">#fastcgi_pass unix:/var/run/php-fpm/php-fpm.sock; //原来的</span></span><br><span class="line">                fastcgi_pass <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">9000</span>;   <span class="comment">//更改之后</span></span><br><span class="line">                fastcgi_param SCRIPT_FILENAME                 </span><br><span class="line">                <span class="variable">$document</span>_root<span class="variable">$fastcgi_script_name</span>;</span><br><span class="line">                fastcgi_param PATH_INFO <span class="variable">$uri</span>;</span><br><span class="line">                fastcgi_param SCRIPT_NAME <span class="variable">$fastcgi_script_name</span>;</span><br><span class="line">                fastcgi_index index.php;</span><br><span class="line">                <span class="keyword">include</span> fastcgi_params;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>CentOS7yum安装PHP7.2</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">yum -y remove php*  <span class="comment">//如果之前已经安装我们先卸载一下</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//由于linux的yum源不存在php7.x，所以我们要更改yum源</span></span><br><span class="line">rpm -Uvh https:<span class="comment">//dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm   </span></span><br><span class="line">rpm -Uvh https:<span class="comment">//mirror.webtatic.com/yum/el7/webtatic-release.rpm    </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//yum 安装php72w和各种拓展，选自己需要的即可</span></span><br><span class="line">yum -y install php72w php72w-cli php72w-common php72w-devel php72w-embedded php72w-fpm php72w-gd php72w-mbstring php72w-mysqlnd php72w-opcache php72w-pdo php72w-xml</span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>docker容器内部无法连网</title>
    <url>/2023/03/24/docker%E5%AE%B9%E5%99%A8%E5%86%85%E9%83%A8%E6%97%A0%E6%B3%95%E8%BF%9E%E7%BD%91/</url>
    <content><![CDATA[<h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><p>docker创建的容器内部无法访问网络</p>
<h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><p>在容器内部执行</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="string">&quot;nameserver 114.114.114.114&quot;</span> &gt;&gt; /etc/resolv.conf</span><br></pre></td></tr></table></figure>


]]></content>
      <categories>
        <category>docker</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>mysql设置外网ip访问</title>
    <url>/2018/06/27/mysql%E8%AE%BE%E7%BD%AE%E5%A4%96%E7%BD%91ip%E8%AE%BF%E9%97%AE/</url>
    <content><![CDATA[<blockquote>
<p>使用mysql的过程中，可能会遇到这样的问题：在服务器上安装了mysql之后，使用其他工具在外网ip之下连接不上mysql，以下是解决方案：</p>
</blockquote>
<h3 id="方案一"><a href="#方案一" class="headerlink" title="方案一"></a>方案一</h3><p>1、登录数据库</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">mysql -u root -p xxxx</span><br></pre></td></tr></table></figure>
<p>2、选择mysql数据库</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">use</span> <span class="title">mysql</span>;</span><br></pre></td></tr></table></figure>
<span id="more"></span>

<p>3、查询host</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">mysql&gt; select user,host <span class="keyword">from</span> user;</span><br></pre></td></tr></table></figure>
<p>4、创建host</p>
<p>如果没有”%”这个host值,就执行下面这两句:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">mysql&gt; update user set host=<span class="string">&#x27;%&#x27;</span> where user=<span class="string">&#x27;root&#x27;</span>;</span><br><span class="line">mysql&gt; flush privileges;    <span class="comment">//刷新权限</span></span><br></pre></td></tr></table></figure>

<p>5.授权用户</p>
<p>任意主机以用户root和密码mypwd连接到mysql服务器</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">mysql&gt; GRANT ALL PRIVILEGES ON . TO ‘root‘@’%’ IDENTIFIED BY ‘mypwd’ WITH GRANT OPTION;</span><br><span class="line">mysql&gt; flush privileges; <span class="comment">//刷新权限</span></span><br></pre></td></tr></table></figure>


<h3 id="方案二"><a href="#方案二" class="headerlink" title="方案二"></a>方案二</h3><p>1、登录数据库</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">mysql -u root -p xxxx</span><br></pre></td></tr></table></figure>

<p>2、进入mysql</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">use</span> <span class="title">mysql</span>;</span><br></pre></td></tr></table></figure>
<p>3、输入以下命令</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">mysql&gt; GRANT ALL PRIVILEGES ON *.* TO <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED BY <span class="string">&#x27;root&#x27;</span> WITH GRANT OPTION;</span><br><span class="line"></span><br><span class="line">mysql&gt; FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure>
<p>####以上方案做了之后，有可能发现还是没有设置成功，需通过如下排查：</p>
<ul>
<li>如果是阿里云服务器，需要在网络安全组设置数据库对应的端口的入口和出口；</li>
<li>检查服务器上面的端口占用情况；</li>
<li>新开的主机，需要将高级安全模式和防火墙关闭，否则，数据进不来</li>
<li></li>
</ul>
]]></content>
      <categories>
        <category>mysql</category>
      </categories>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title>http中的referer</title>
    <url>/2017/11/24/http%E4%B8%AD%E7%9A%84referer/</url>
    <content><![CDATA[<blockquote>
<p>安全培训中提到可以通过referer判断安全性，hackbar中也有一个enable referer的选项，则，这个referer到底是个什么角色？</p>
</blockquote>
<p>在http请求的Headers部分可见Referer.</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Referer http:<span class="comment">//www.baidu.com/s?tn=98835442_hao_pg&amp;ie=utf-8&amp;f=3&amp;wd=126.com&amp;oq=126.&amp;bs=126.com&amp;rsv_bp=1&amp;inputT=5799&amp;rsp=0</span></span><br></pre></td></tr></table></figure>
<p>Http协议头中的Referer主要用来让服务器判断来源页面, 即用户是从哪个页面来的,通常被网站用来统计用户来源,是从搜索页面来的,还是从其他网站链接过来,或是从书签等访问,以便网站合理定位.</p>
<p>Referer有时也被用作防盗链, 即下载时判断来源地址是不是在网站域名之内, 否则就不能下载或显示,很多网站,如天涯就是通过Referer页面来判断用户是否能够下载图片</p>
<span id="more"></span>
<p>当然,对于某些恶意用户,也可能伪造Referer来获得某些权限,在设计网站时要考虑到这个问题.</p>
<p>还可用做电子商务网站的安全，在提交信用卡等重要信息的页面用referer来判断上一页是不是自己的网站，如果不是，可能是黑客用自己写的一个表单，来提交，为了能跳过你上一页里的javascript的验证等目的。</p>
<p><strong>但是注意不要把Rerferer用在身份验证或者其他非常重要的检查上，因为Rerferer非常容易在客户端被改变。</strong></p>
<p>（火狐的一个插件RefControl修改Referer引用）</p>
<p>对浏览器来说,一般以下几种情况是不会发送Referer,因为可能有潜在的安全问题:</p>
<ul>
<li>1.用户手动输入网址或是从收藏夹&#x2F;书签中访问.</li>
<li>2.页面从Https跳转到Http；应该是处于安全考虑，该点在RFC-2616中有说明；主流浏览器均遵守这个规则，比如IE、FF；但默认情况下Https到Https是会发送Referer的<br>安全问题在于有可能把地址中含有的一些关于用户的敏感信息发送到其他恶意网站上.</li>
<li>3、由于FF提供了很强大的自定义参数设置功能，所以我们可以通过about:config页面修改以下两个选项的默认设置：<br>network.http.sendRefererHeader (default&#x3D;2)<br>设置Referer的发送方式，0为完全不发送，1为只在点击链接时发送，在访问页面中的图像什么的时候不发送，2为始终发送。</li>
</ul>
<p>参考： <a href="http://blog.csdn.net/mutsinghua/article/details/5187595">http://blog.csdn.net/mutsinghua/article/details/5187595</a></p>
]]></content>
      <categories>
        <category>php</category>
      </categories>
      <tags>
        <tag>php</tag>
      </tags>
  </entry>
  <entry>
    <title>hexo手动百度推送</title>
    <url>/2020/08/28/hexo%E6%89%8B%E5%8A%A8%E7%99%BE%E5%BA%A6%E6%8E%A8%E9%80%81/</url>
    <content><![CDATA[<p>手动百度推送简单的逻辑就是先需要在百度站长上注册该域名下的信息，再用代码获取blog中所有文章的链接地址进行推送，除了手动之外还可以使用hexo自带的工具进行推送，实现的效果是一样，当然在百度SEO中，不管是自动推送还是手动推送，能达到的SEO效果还是很小，文章的质量、数量、访问量永远才是核心的因素，加油各位博主！</p>
<span id="more"></span>
<p>以下直接上代码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// 百度手动推送！！！！</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取blog中的所有有效链接，推送到百度站长</span></span><br><span class="line"><span class="comment">// token 的获取https://ziyuan.baidu.com/linksubmit/index?site=https://www.xiang007.com/</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$path</span> = <span class="string">&#x27;./public&#x27;</span>;</span><br><span class="line"><span class="variable">$domain</span> = <span class="string">&#x27;https://www.xiang007.com&#x27;</span>;</span><br><span class="line"><span class="variable">$result</span> = <span class="title function_ invoke__">scanFile</span>(<span class="variable">$path</span>);</span><br><span class="line"><span class="variable">$urls</span> = [];</span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$result</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>) &#123;</span><br><span class="line">  <span class="variable">$all_url</span> = <span class="variable">$domain</span>.<span class="title function_ invoke__">str_replace</span>(<span class="variable">$path</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$value</span>);</span><br><span class="line">  <span class="keyword">echo</span> <span class="variable">$all_url</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">  <span class="variable">$urls</span>[] = <span class="variable">$all_url</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$api</span> = <span class="string">&#x27;http://data.zz.baidu.com/urls?site=https://www.xiang007.com&amp;token=nwmiI8Qsd5B4WRjJ&#x27;</span>;</span><br><span class="line"><span class="variable">$ch</span> = <span class="title function_ invoke__">curl_init</span>();</span><br><span class="line"><span class="variable">$options</span> =  <span class="keyword">array</span>(</span><br><span class="line">    CURLOPT_URL =&gt; <span class="variable">$api</span>,</span><br><span class="line">    CURLOPT_POST =&gt; <span class="literal">true</span>,</span><br><span class="line">    CURLOPT_RETURNTRANSFER =&gt; <span class="literal">true</span>,</span><br><span class="line">    CURLOPT_POSTFIELDS =&gt; <span class="title function_ invoke__">implode</span>(<span class="string">&quot;\n&quot;</span>, <span class="variable">$urls</span>),</span><br><span class="line">    CURLOPT_HTTPHEADER =&gt; <span class="keyword">array</span>(<span class="string">&#x27;Content-Type: text/plain&#x27;</span>),</span><br><span class="line">);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt_array</span>(<span class="variable">$ch</span>, <span class="variable">$options</span>);</span><br><span class="line"><span class="variable">$result</span> = <span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$result</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">scanFile</span>(<span class="params"><span class="variable">$path</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">global</span> <span class="variable">$result</span>;</span><br><span class="line">  <span class="variable">$files</span> = <span class="title function_ invoke__">scandir</span>(<span class="variable">$path</span>);</span><br><span class="line">  <span class="keyword">foreach</span> (<span class="variable">$files</span> <span class="keyword">as</span> <span class="variable">$file</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$file</span> != <span class="string">&#x27;.&#x27;</span> &amp;&amp; <span class="variable">$file</span> != <span class="string">&#x27;..&#x27;</span> &amp;&amp; !<span class="title function_ invoke__">in_array</span>(<span class="variable">$file</span>, </span><br><span class="line">    	[<span class="string">&#x27;css&#x27;</span>,<span class="string">&#x27;images&#x27;</span>,<span class="string">&#x27;img&#x27;</span>,<span class="string">&#x27;js&#x27;</span>,<span class="string">&#x27;lib&#x27;</span>,<span class="string">&#x27;link&#x27;</span>,<span class="string">&#x27;page&#x27;</span>,<span class="string">&#x27;tags&#x27;</span>,<span class="string">&#x27;archives&#x27;</span>,<span class="string">&#x27;categories&#x27;</span>])) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_ invoke__">is_dir</span>(<span class="variable">$path</span> . <span class="string">&#x27;/&#x27;</span> . <span class="variable">$file</span>)) &#123;</span><br><span class="line">        <span class="title function_ invoke__">scanFile</span>(<span class="variable">$path</span> . <span class="string">&#x27;/&#x27;</span> . <span class="variable">$file</span>);</span><br><span class="line">        <span class="variable">$link_add</span> = <span class="variable">$path</span> . <span class="string">&#x27;/&#x27;</span> . <span class="variable">$file</span>;</span><br><span class="line">        <span class="variable">$count</span> = <span class="title function_ invoke__">substr_count</span>(<span class="variable">$link_add</span>, <span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$count</span> &gt;= <span class="number">5</span>) &#123;</span><br><span class="line">        	<span class="variable">$result</span>[] = <span class="variable">$link_add</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>php base64形式图片处理，保存到文件以及插件介绍</title>
    <url>/2021/05/19/php-base64%E5%BD%A2%E5%BC%8F%E5%9B%BE%E7%89%87%E5%A4%84%E7%90%86%EF%BC%8C%E4%BF%9D%E5%AD%98%E5%88%B0%E6%96%87%E4%BB%B6%E4%BB%A5%E5%8F%8A%E6%8F%92%E4%BB%B6%E4%BB%8B%E7%BB%8D/</url>
    <content><![CDATA[<p>网页上有些图片的src或者css背景图片都是后面跟了一大串字符串，比如：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAJAQMAAADaX </span><br><span class="line"><span class="number">5</span>RTAAAAA3NCSVQICAjb4U/gAAAABlBMVEX<span class="comment">///+ZmZmOUEqyAAAAAnRSTlMA/1uR </span></span><br><span class="line">IrUAAAAJcEhZcwAACusAAArrAYKLDVoAAAAWdEVYdENyZWF0aW9uIFRpbWUAMDk </span><br><span class="line">vMjAvMTIGkKG+AAAAHHRFWHRTb2Z0d2FyZQBBZG9iZSBGaXJld29ya3MgQ1M26L </span><br><span class="line">yyjAAAAB1JREFUCJljONjA8LiBoZyBwY6BQQZMAtlAkYMNAF1fBs/zPvcnAAAAA </span><br><span class="line">ElFTkSuQmCC ....</span><br></pre></td></tr></table></figure>

<p>Data URI scheme是在RFC2397中定义的，目的是将一些小的数据，直接嵌入到网页中，从而不用再从外部文件载入。比如上面那串字符，其实是一张小图片，将这些字符复制黏贴到火狐的地址栏中并转到，就能看到它了，一张1X36的白灰png图片。</p>
<p>在上面的Data URI中，data表示取得数据的协定名称，image&#x2F;png 是数据类型名称，base64 是数据的编码方法，逗号后面就是这个image&#x2F;png文件base64编码后的数据。</p>
<span id="more"></span>

<p>目前，Data URI scheme支持的类型有：<br>data:,文本数据<br>data:text&#x2F;plain,文本数据<br>data:text&#x2F;html,HTML代码<br>data:text&#x2F;html;base64,base64编码的HTML代码<br>data:text&#x2F;css,CSS代码<br>data:text&#x2F;css;base64,base64编码的CSS代码<br>data:text&#x2F;javascript,Javascript代码<br>data:text&#x2F;javascript;base64,base64编码的Javascript代码<br>data:image&#x2F;gif;base64,base64编码的gif图片数据<br>data:image&#x2F;png;base64,base64编码的png图片数据<br>data:image&#x2F;jpeg;base64,base64编码的jpeg图片数据<br>data:image&#x2F;x-icon;base64,base64编码的icon图片数据</p>
<p>目前，IE8、Firfox、Chrome、Opera浏览器都支持这种小文件嵌入。</p>
<h3 id="以下是php处理实战："><a href="#以下是php处理实战：" class="headerlink" title="以下是php处理实战："></a>以下是php处理实战：</h3><h4 id="插件准备"><a href="#插件准备" class="headerlink" title="插件准备"></a>插件准备</h4><p>插件地址：<a href="https://www.jq22.com/jquery-info18454">https://www.jq22.com/jquery-info18454</a><br>如果地址失效可以根据下面操作：</p>
<h4 id="插件渲染"><a href="#插件渲染" class="headerlink" title="插件渲染"></a>插件渲染</h4><p><code>资源准备:</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;http://www.jq22.com/jquery/jquery-1.10.2.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span> src=<span class="string">&quot;imgFileupload.js&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p><code>html和css:</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;style&gt;</span><br><span class="line">        .box&#123;</span><br><span class="line">            margin: <span class="number">50</span>px auto;</span><br><span class="line">        &#125;</span><br><span class="line">        .imgFileUploade&#123;</span><br><span class="line">            width: <span class="number">100</span>%;padding: <span class="number">10</span>px;</span><br><span class="line">        &#125;</span><br><span class="line">        .imgFileUploade .header&#123;</span><br><span class="line">            height: <span class="number">50</span>px;width: <span class="number">100</span>%;line-height:<span class="number">50</span>px;</span><br><span class="line">        &#125;</span><br><span class="line">        .imgFileUploade .header span&#123;</span><br><span class="line">            display: block;<span class="keyword">float</span>:left;</span><br><span class="line">        &#125;</span><br><span class="line">        .imgFileUploade .header span.imgTitle&#123;</span><br><span class="line">            line-height:<span class="number">50</span>px;</span><br><span class="line">        &#125;</span><br><span class="line">        .imgFileUploade .header span.imgTitle b&#123;</span><br><span class="line">            color:red;margin:<span class="number">0</span> <span class="number">5</span>px;line-height: <span class="number">57</span>px;display: block;<span class="keyword">float</span>: right;font-size: <span class="number">20</span>px;</span><br><span class="line">        &#125;</span><br><span class="line">        .imgFileUploade .header span.imgClick&#123;</span><br><span class="line">            width: <span class="number">50</span>px;height: <span class="number">50</span>px;margin-left: <span class="number">10</span>px;cursor: pointer;</span><br><span class="line">            background: <span class="title function_ invoke__">url</span>(/libs/img-file-update/img/addUpload.png) no-repeat center center;background-size:cover;</span><br><span class="line">            background-size: <span class="number">40</span>px <span class="number">40</span>px;</span><br><span class="line">        &#125;</span><br><span class="line">        .imgFileUploade .header span.imgcontent&#123;</span><br><span class="line">            color:<span class="comment">#999;margin-left:120px;line-height: 50px;</span></span><br><span class="line">        &#125;</span><br><span class="line">        .imgFileUploade .imgAll&#123;</span><br><span class="line">            width: <span class="number">100</span>%;    margin-top: <span class="number">5</span>px;</span><br><span class="line">        &#125;</span><br><span class="line">        .imgFileUploade .imgAll ul:after&#123;</span><br><span class="line">            visibility: hidden;  display: block; font-size: <span class="number">0</span>; content: <span class="string">&quot;.&quot;</span>;  clear: both; height: <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">        .imgFileUploade .imgAll li&#123;</span><br><span class="line">            width: <span class="number">100</span>px;height: <span class="number">100</span>px;border:solid <span class="number">1</span>px <span class="comment">#ccc;margin:8px 5px;float: left;position: relative;box-shadow: 0 0 10px #eee;</span></span><br><span class="line">        &#125;</span><br><span class="line">        .imgFileUploade .imgAll li img&#123;</span><br><span class="line">            position: absolute;top:<span class="number">0</span>;left:<span class="number">0</span>;width: <span class="number">100</span>%;height: <span class="number">100</span>%;display: block;</span><br><span class="line">        &#125;</span><br><span class="line">        .delImg&#123;</span><br><span class="line">            position: absolute;top:-<span class="number">10</span>px;right:-<span class="number">7</span>px;width: <span class="number">22</span>px;height: <span class="number">22</span>px;background: <span class="comment">#000;border-radius: 50%;display: block;text-align:  center;line-height: 22px;color:#fff;font-weight: 700;font-style:normal;cursor: pointer;</span></span><br><span class="line">        &#125;</span><br><span class="line">        .box,.box2,.box3,.box4&#123;</span><br><span class="line">            border:solid <span class="number">1</span>px <span class="comment">#ccc;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dl <span class="class"><span class="keyword">class</span>=&quot;<span class="title">zs_f</span>&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">dt</span>&gt;图片信息：&lt;/<span class="title">dt</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">box</span>&quot;&gt;&lt;/<span class="title">div</span>&gt;    &lt;!-- <span class="title">box</span>为插件容器 --&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">dl</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>js</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 图片上传插件加载 初始化</span></span><br><span class="line">   <span class="keyword">var</span> imgFile = <span class="keyword">new</span> <span class="title class_">ImgUploadeFiles</span>(<span class="string">&#x27;.box&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">       this.<span class="title function_ invoke__">init</span>(&#123;</span><br><span class="line">           MAX : <span class="number">10</span>, //限制上传个数</span><br><span class="line">           MH : <span class="number">2200</span>, //像素限制高度</span><br><span class="line">           MW : <span class="number">2000</span>, //像素限制宽度</span><br><span class="line">           callback : function(arr)&#123;</span><br><span class="line">               console.<span class="title function_ invoke__">log</span>(arr)</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;);</span><br><span class="line">   &#125;);</span><br></pre></td></tr></table></figure>

<p><code>imgFileupload.js:</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">~(<span class="function"><span class="keyword">function</span>(<span class="params">win</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> htmls = <span class="string">&#x27;&lt;input type=&quot;file&quot; name=&quot;&quot; id=&quot;&quot; class=&quot;imgFiles&quot; style=&quot;display: none&quot; accept=&quot;image/gif,image/jpeg,image/jpg,image/png,image/svg&quot; multiple&gt;&#x27;</span>+</span><br><span class="line">				<span class="string">&#x27;&lt;div class=&quot;header&quot;&gt;&#x27;</span>+</span><br><span class="line">				<span class="string">&#x27;    &lt;span class=&quot;imgTitle&quot;&gt;&#x27;</span>+</span><br><span class="line">				<span class="string">&#x27;        点击添加&#x27;</span>+</span><br><span class="line">				<span class="string">&#x27;    &lt;/span&gt;&#x27;</span>+</span><br><span class="line">				<span class="string">&#x27;    &lt;span class=&quot;imgClick&quot;&gt;&#x27;</span>+</span><br><span class="line">				<span class="string">&#x27;    &lt;/span&gt;&#x27;</span>+</span><br><span class="line">				<span class="string">&#x27;    &lt;span class=&quot;imgcontent&quot;&gt;&#x27;</span>+</span><br><span class="line">				<span class="string">&#x27;        请上传&#x27;</span>+</span><br><span class="line">				<span class="string">&#x27;    &lt;/span&gt;&#x27;</span>+</span><br><span class="line">				<span class="string">&#x27;&lt;/div&gt;&#x27;</span>+</span><br><span class="line">				<span class="string">&#x27;&lt;div class=&quot;imgAll&quot;&gt;&#x27;</span>+</span><br><span class="line">				<span class="string">&#x27;    &lt;ul&gt;&#x27;</span>+</span><br><span class="line">				<span class="string">&#x27;    &lt;/ul&gt;&#x27;</span>+</span><br><span class="line">				<span class="string">&#x27;&lt;/div&gt;&#x27;</span>;</span><br><span class="line">	<span class="keyword">var</span> ImgUploadeFiles = <span class="function"><span class="keyword">function</span>(<span class="params">obj,fn</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">var</span> _this = this;</span><br><span class="line">		this.bom = document.<span class="title function_ invoke__">querySelector</span>(obj);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span>(<span class="function"><span class="keyword">fn</span>) <span class="title">fn</span>.<span class="title">call</span>(<span class="params">_this</span>)</span>;</span><br><span class="line">		this.<span class="title function_ invoke__">ready</span>();</span><br><span class="line"></span><br><span class="line">	&#125;;</span><br><span class="line">	ImgUploadeFiles.prototype = &#123;</span><br><span class="line">		init : <span class="function"><span class="keyword">function</span>(<span class="params">o</span>)</span>&#123;</span><br><span class="line">			this.MAX = o.MAX || <span class="number">5</span>;</span><br><span class="line">			this.callback = o.callback;</span><br><span class="line">			this.MW = o.MW || <span class="number">10000</span>;</span><br><span class="line">			this.MH = o.MH || <span class="number">10000</span>;</span><br><span class="line">		&#125;,</span><br><span class="line">		ready : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">			<span class="keyword">var</span> _self = this;</span><br><span class="line">			this.dom = document.<span class="title function_ invoke__">createElement</span>(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line">			this.dom.className = <span class="string">&#x27;imgFileUploade&#x27;</span>;</span><br><span class="line">			this.dom.innerHTML = htmls;</span><br><span class="line">			this.bom.<span class="title function_ invoke__">appendChild</span>(this.dom);</span><br><span class="line">			this.files = this.bom.<span class="title function_ invoke__">querySelector</span>(<span class="string">&#x27;.imgFiles&#x27;</span>);</span><br><span class="line">			this.fileClick = this.bom.<span class="title function_ invoke__">querySelector</span>(<span class="string">&#x27;.imgClick&#x27;</span>);</span><br><span class="line">			this.<span class="title function_ invoke__">fileBtn</span>(this.fileClick,this.files);</span><br><span class="line">			this.imgcontent = this.bom.<span class="title function_ invoke__">querySelector</span>(<span class="string">&#x27;.imgcontent&#x27;</span>);</span><br><span class="line">			this.imgcontent.innerHTML = <span class="string">&#x27;限制上传 &lt;b style=&quot;color:red&quot;&gt;&#x27;</span>+this.MAX+<span class="string">&#x27;&lt;/b&gt;张 &#x27;</span>+_self.MW+<span class="string">&#x27; * &#x27;</span>+_self.MH+<span class="string">&#x27;像素的图片&#x27;</span>;</span><br><span class="line">			</span><br><span class="line">		&#125;,</span><br><span class="line">		fileBtn : <span class="function"><span class="keyword">function</span>(<span class="params">c,f</span>)</span>&#123;</span><br><span class="line">			<span class="keyword">var</span> _self = this;</span><br><span class="line">			<span class="keyword">var</span> _imgAll = $(c).<span class="built_in">parent</span>().<span class="built_in">parent</span>().<span class="title function_ invoke__">find</span>(<span class="string">&#x27;.imgAll ul&#x27;</span>);</span><br><span class="line">			$(c).<span class="title function_ invoke__">off</span>().<span class="title function_ invoke__">on</span>(<span class="string">&#x27;click&#x27;</span>,function()&#123;</span><br><span class="line">				$(f).<span class="title function_ invoke__">click</span>();</span><br><span class="line"></span><br><span class="line">				$(f).<span class="title function_ invoke__">off</span>().<span class="title function_ invoke__">on</span>(<span class="string">&#x27;change&#x27;</span>,function()&#123;</span><br><span class="line">					<span class="keyword">var</span> _this = this;</span><br><span class="line">					_private.<span class="title function_ invoke__">startUploadImg</span>(_imgAll,_this.files,_self.MAX,_self.callback,_self.MW,_self.MH);</span><br><span class="line">				&#125;);</span><br><span class="line">			&#125;);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="keyword">var</span> _dataArr = [];</span><br><span class="line">	<span class="keyword">var</span> _private = &#123;</span><br><span class="line">		startUploadImg : <span class="function"><span class="keyword">function</span>(<span class="params">o,files,MAX,callback,W,H</span>)</span>&#123;</span><br><span class="line">			_dataArr.length = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">var</span> _this = this;</span><br><span class="line">			<span class="keyword">var</span> fileImgArr = [];</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">if</span>(files.length &gt; MAX )&#123;</span><br><span class="line">				<span class="title function_ invoke__">alert</span>(<span class="string">&#x27;不能大于&#x27;</span>+MAX+<span class="string">&#x27;张&#x27;</span>);</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">			&#125;;</span><br><span class="line">			<span class="keyword">var</span> lens = $(o).<span class="title function_ invoke__">find</span>(<span class="string">&#x27;li&#x27;</span>).length ;</span><br><span class="line">			<span class="keyword">if</span>(lens &gt;= MAX )&#123;</span><br><span class="line">				<span class="title function_ invoke__">alert</span>(<span class="string">&#x27;不能大于&#x27;</span>+MAX+<span class="string">&#x27;张&#x27;</span>);</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">			&#125;;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>,file;file=files[i++];)&#123;</span><br><span class="line"></span><br><span class="line">				<span class="keyword">var</span> reader = <span class="keyword">new</span> <span class="title class_">FileReader</span>();</span><br><span class="line">				reader.onload = (<span class="function"><span class="keyword">function</span>(<span class="params">file</span>)</span>&#123;</span><br><span class="line">					<span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">ev</span>)</span>&#123;</span><br><span class="line">						<span class="keyword">var</span> image = <span class="keyword">new</span> <span class="title class_">Image</span>();  </span><br><span class="line">						image.onload=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;  </span><br><span class="line">					          <span class="keyword">var</span> width = image.width;  </span><br><span class="line">					          <span class="keyword">var</span> height = image.height;  </span><br><span class="line">					            </span><br><span class="line">					        fileImgArr.<span class="title function_ invoke__">push</span>(&#123;</span><br><span class="line">								fileSrc : ev.target.result,</span><br><span class="line">								fileName : file.name,</span><br><span class="line">								fileSize : file.size,</span><br><span class="line">								height : height,</span><br><span class="line">								width : width</span><br><span class="line">							&#125;);</span><br><span class="line">					    &#125;;  </span><br><span class="line">					     image.src= ev.target.result; </span><br><span class="line"></span><br><span class="line">						</span><br><span class="line">					&#125;;</span><br><span class="line">				&#125;)(file);</span><br><span class="line">				reader.<span class="title function_ invoke__">readAsDataURL</span>(file);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">//创建分时函数</span></span><br><span class="line">			<span class="keyword">var</span> imgTimeSlice = _this.<span class="title function_ invoke__">timeChunk</span>(fileImgArr,function(file)&#123;</span><br><span class="line">				<span class="keyword">if</span>(file.width &gt; W || file.height &gt; H)&#123;</span><br><span class="line">	            	<span class="title function_ invoke__">alert</span>(<span class="string">&#x27;图片不能大于&#x27;</span>+W+<span class="string">&#x27;*&#x27;</span>+H+<span class="string">&#x27;像素&#x27;</span>);</span><br><span class="line">	            	<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	            &#125;</span><br><span class="line">				<span class="comment">//调用图片类</span></span><br><span class="line">				<span class="keyword">var</span> up = <span class="keyword">new</span> <span class="title class_">ImgFileupload</span>(o,file.fileName,file.fileSrc,file.fileSize,callback);</span><br><span class="line">				up.<span class="title function_ invoke__">init</span>();</span><br><span class="line">			&#125;,<span class="number">1</span>);</span><br><span class="line">			<span class="title function_ invoke__">imgTimeSlice</span>(); <span class="comment">//调用分时函数</span></span><br><span class="line">		&#125;,</span><br><span class="line">		timeChunk : <span class="function"><span class="keyword">function</span>(<span class="params">arr, fn, count</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> obj, t;</span><br><span class="line">            <span class="keyword">var</span> len = arr.length;</span><br><span class="line">            <span class="keyword">var</span> start = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; Math.<span class="title function_ invoke__">min</span>(count || <span class="number">1</span>, arr.length); i++) &#123;</span><br><span class="line">                    <span class="keyword">var</span> obj = arr.<span class="title function_ invoke__">shift</span>();</span><br><span class="line">                    <span class="function"><span class="keyword">fn</span>(<span class="params">obj</span>)</span></span><br><span class="line"><span class="function">                &#125;</span></span><br><span class="line"><span class="function">            &#125;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                t = <span class="title function_ invoke__">setInterval</span>(function() &#123;</span><br><span class="line">                    <span class="keyword">if</span> (arr.length === <span class="number">0</span>) &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="title function_ invoke__">clearInterval</span>(t);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="title function_ invoke__">start</span>();</span><br><span class="line">                &#125;,<span class="number">200</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> ImgFileupload = <span class="function"><span class="keyword">function</span>(<span class="params">b,imgName,imgSrc,imgSize,callback</span>)</span>&#123;</span><br><span class="line">		this.b = b;</span><br><span class="line">		this.imgName = imgName;</span><br><span class="line">		this.imgSize = imgSize;</span><br><span class="line">		this.imgSrc = imgSrc;</span><br><span class="line">		this.callback = callback;</span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="keyword">var</span> _delId = <span class="number">1</span>; <span class="comment">//删除id用于判断删除个数</span></span><br><span class="line">	ImgFileupload.prototype.init =<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		_delId++;</span><br><span class="line">		<span class="keyword">var</span> _self = this;</span><br><span class="line">		this.dom = document.<span class="title function_ invoke__">createElement</span>(<span class="string">&#x27;li&#x27;</span>);</span><br><span class="line">		this.dom.innerHTML = </span><br><span class="line">							<span class="string">&#x27;    &lt;img src=&quot;/libs/img-file-update/img/login.gif&quot; alt=&quot;&quot; data-src=&quot;&#x27;</span>+this.imgSrc +<span class="string">&#x27;&quot; class=&quot;imsg&quot;&gt;&#x27;</span>+</span><br><span class="line">							<span class="string">&#x27;    &lt;i class=&quot;delImg&quot;&gt;&#x27;</span>+</span><br><span class="line">							<span class="string">&#x27;        X&#x27;</span>+</span><br><span class="line">							<span class="string">&#x27;    &lt;/i&gt;&#x27;</span>;</span><br><span class="line">		$(this.dom).<span class="title function_ invoke__">attr</span>(&#123;<span class="string">&#x27;data-delId&#x27;</span>:_delId,<span class="string">&#x27;data-delName&#x27;</span>:this.imgName&#125;);				</span><br><span class="line">		$(this.b).<span class="title function_ invoke__">append</span>(this.dom);</span><br><span class="line">		<span class="keyword">var</span> _Img = <span class="keyword">new</span> <span class="title class_">Image</span>();</span><br><span class="line">		_Img.src = $(this.dom).<span class="title function_ invoke__">find</span>(<span class="string">&#x27;img&#x27;</span>).<span class="title function_ invoke__">attr</span>(<span class="string">&#x27;data-src&#x27;</span>);</span><br><span class="line">		_Img.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">			$(_self.dom).<span class="title function_ invoke__">find</span>(<span class="string">&#x27;img&#x27;</span>).<span class="title function_ invoke__">attr</span>(<span class="string">&#x27;src&#x27;</span>,_Img.src);</span><br><span class="line">		&#125;</span><br><span class="line">		_dataArr.<span class="title function_ invoke__">push</span>(&#123;<span class="string">&#x27;delId&#x27;</span> :_delId,src :  this.imgSrc&#125;);</span><br><span class="line">		_self.<span class="title function_ invoke__">callback</span>(_dataArr);</span><br><span class="line">		<span class="comment">// $(this.b).parent().parent().parent().attr(&#x27;data-dataImgs&#x27;,JSON.stringify(_dataArr));</span></span><br><span class="line">		<span class="keyword">var</span> _delAll = $(this.b).<span class="title function_ invoke__">find</span>(<span class="string">&#x27;.delImg&#x27;</span>);</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;_delAll.length;i++)&#123;</span><br><span class="line">			$(_delAll[i]).<span class="title function_ invoke__">off</span>().<span class="title function_ invoke__">on</span>(<span class="string">&#x27;click&#x27;</span>,function()&#123;</span><br><span class="line">				$(this).<span class="built_in">parent</span>().<span class="title function_ invoke__">fadeOut</span>(<span class="string">&#x27;slow&#x27;</span>,function()&#123;</span><br><span class="line">					$(this).<span class="title function_ invoke__">remove</span>();</span><br><span class="line">				&#125;);</span><br><span class="line">				<span class="keyword">var</span> _deid = $(this).<span class="built_in">parent</span>().<span class="title function_ invoke__">attr</span>(<span class="string">&#x27;data-delId&#x27;</span>);</span><br><span class="line">				<span class="keyword">for</span>(<span class="keyword">var</span> n=<span class="number">0</span>;n&lt;_dataArr.length;n++)&#123;</span><br><span class="line">					<span class="keyword">if</span>(_dataArr[n].delId == _deid)&#123;</span><br><span class="line">						_dataArr.<span class="title function_ invoke__">splice</span>(n,<span class="number">1</span>);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				_self.<span class="title function_ invoke__">callback</span>(_dataArr)</span><br><span class="line">				<span class="comment">// $(this.b).parent().parent().parent().attr(&#x27;data-dataImgs&#x27;,JSON.stringify(_dataArr))</span></span><br><span class="line">				</span><br><span class="line">			&#125;);</span><br><span class="line">		&#125;;</span><br><span class="line">		<span class="keyword">var</span> _Imgpreview = $(this.b).<span class="title function_ invoke__">find</span>(<span class="string">&#x27;img&#x27;</span>);</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">var</span> k=<span class="number">0</span>;k&lt;_Imgpreview.length; k++)&#123;</span><br><span class="line">			$(_Imgpreview[k]).<span class="title function_ invoke__">off</span>().<span class="title function_ invoke__">on</span>(<span class="string">&#x27;click&#x27;</span>,function()&#123;</span><br><span class="line">				console.<span class="title function_ invoke__">log</span>($(this).<span class="title function_ invoke__">attr</span>(<span class="string">&#x27;src&#x27;</span>))</span><br><span class="line">			&#125;)</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	win.ImgUploadeFiles = ImgUploadeFiles;</span><br><span class="line">&#125;)(window);</span><br></pre></td></tr></table></figure>

<p><code>页面渲染效果：</code><br><img src="/../img/base64-01.png" alt="pic"><br><img src="/../img/base64-02.png" alt="pic"></p>
<p>上图能够看到，这个插件所加载的图片资源就是存储在浏览器上面的资源，也就是上面所说的base64的方式，那么后端如何来解析又怎么保存图片到本地呢？</p>
<h4 id="后端处理-php"><a href="#后端处理-php" class="headerlink" title="后端处理 - php"></a>后端处理 - php</h4><p>前端在传输图片信息的时候就需要把这个带data:image&#x2F;jpeg;base64.&#x2F;…这个数据传递到后端，由后端来解析；</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * - 将Base64图片转换为本地图片并保存</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $base64_image_content_list</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $path  //路径</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> array|bool</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">base64_image_content</span>(<span class="params"><span class="variable">$base64_image_content_list</span>, <span class="variable">$path</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$upload_img_name</span> = [];</span><br><span class="line">        <span class="variable">$error_data</span> = [];</span><br><span class="line">        <span class="variable">$file_path</span> = <span class="string">&#x27;/data/htdocs/psi.a.hongju.cc/public&#x27;</span>.<span class="variable">$path</span>;  <span class="comment">// 拼接成绝对路径，这里必须要绝对路径</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="variable">$base64_image_content_list</span> <span class="keyword">as</span> <span class="variable">$base64_image_content</span>) &#123;</span><br><span class="line">                <span class="comment">//匹配出图片的格式</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^(data:\s*image\/(\w+);base64,)/&#x27;</span>, <span class="variable">$base64_image_content</span>, <span class="variable">$result</span>)) &#123;</span><br><span class="line">                    <span class="variable">$type</span> = <span class="variable">$result</span>[<span class="number">2</span>];</span><br><span class="line">                    <span class="variable">$new_file</span> = <span class="variable">$file_path</span> . <span class="string">&quot;/&quot;</span> . <span class="title function_ invoke__">date</span>(<span class="string">&#x27;Ymd&#x27;</span>, <span class="title function_ invoke__">time</span>()) . <span class="string">&quot;/&quot;</span>;</span><br><span class="line">                    <span class="keyword">if</span> (!<span class="title function_ invoke__">file_exists</span>(<span class="variable">$new_file</span>)) &#123;</span><br><span class="line">                        <span class="comment">//检查是否有该文件夹，如果没有就创建，并给予最高权限</span></span><br><span class="line">                        <span class="title function_ invoke__">mkdir</span>(<span class="variable">$new_file</span>);   <span class="comment">// 规定权限。默认是 0777。</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// 重新命名</span></span><br><span class="line">                    <span class="variable">$new_file</span> = <span class="variable">$new_file</span> . <span class="title function_ invoke__">time</span>().<span class="title function_ invoke__">mt_rand</span>(<span class="number">100</span>,<span class="number">999</span>). <span class="string">&quot;.<span class="subst">&#123;$type&#125;</span>&quot;</span>;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 写入文件夹 执行文件的写入</span></span><br><span class="line">                    <span class="keyword">if</span> (<span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$new_file</span>, <span class="title function_ invoke__">base64_decode</span>(<span class="title function_ invoke__">str_replace</span>(<span class="variable">$result</span>[<span class="number">1</span>], <span class="string">&#x27;&#x27;</span>, <span class="variable">$base64_image_content</span>)))) &#123;</span><br><span class="line">                        <span class="variable">$upload_img_name</span>[] = <span class="variable">$new_file</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="variable">$error_data</span>[] = <span class="variable">$base64_image_content</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (<span class="built_in">Exception</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">            <span class="variable">$error_data</span>[] = <span class="variable">$base64_image_content</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$error_data</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> [];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$upload_img_name</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$upload_img_name</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>上面的方法是批量处理的，其中的mkdir地方在创建文件夹的时候，特别注意服务器上面的文件权限问题，不然创建文件夹不成功，其次$file_path参数必须为绝对路径（我没太明白，就这么用吧）<br>我给的$path &#x3D; ‘&#x2F;upload&#x2F;abnormal’;</p>
<p>上传后效果：<br><img src="/../img/base64-03.png" alt="pic"></p>
<p>总结</p>
<p>1、这种资源是存储在浏览器上面的；<br>2、利用上诉js插件可以模拟这个场景；<br>3、注意避坑的地方；</p>
]]></content>
      <categories>
        <category>php</category>
      </categories>
      <tags>
        <tag>php</tag>
      </tags>
  </entry>
  <entry>
    <title>layui框架中layer父子页面交互的方法分析</title>
    <url>/2021/09/09/layui%E6%A1%86%E6%9E%B6%E4%B8%ADlayer%E7%88%B6%E5%AD%90%E9%A1%B5%E9%9D%A2%E4%BA%A4%E4%BA%92%E7%9A%84%E6%96%B9%E6%B3%95%E5%88%86%E6%9E%90/</url>
    <content><![CDATA[<p>layer是一款近年来备受青睐的web弹层组件，官网地址是：<a href="http://layer.layui.com/">http://layer.layui.com/</a><br>可以从官网上下载最新版本。<br>当layer以iframe层的方式弹出新的窗口（子页面），如何在子页面中访问父页面的元素和函数。</p>
<h3 id="访问父页面元素值"><a href="#访问父页面元素值" class="headerlink" title="访问父页面元素值"></a>访问父页面元素值</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> parentId=<span class="built_in">parent</span>.$(<span class="string">&quot;#id&quot;</span>).<span class="title function_ invoke__">val</span>();<span class="comment">//访问父页面元素值</span></span><br></pre></td></tr></table></figure>
<span id="more"></span>

<h3 id="访问父页面方法"><a href="#访问父页面方法" class="headerlink" title="访问父页面方法"></a>访问父页面方法</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> parentMethodValue=<span class="built_in">parent</span>.<span class="title function_ invoke__">getMethodValue</span>();<span class="comment">//访问父页面方法</span></span><br></pre></td></tr></table></figure>

<h3 id="如何关闭弹出的子页面窗口"><a href="#如何关闭弹出的子页面窗口" class="headerlink" title="如何关闭弹出的子页面窗口"></a>如何关闭弹出的子页面窗口</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> index = <span class="built_in">parent</span>.layer.<span class="title function_ invoke__">getFrameIndex</span>(window.name); <span class="comment">//获取窗口索引</span></span><br><span class="line"><span class="built_in">parent</span>.layer.<span class="title function_ invoke__">close</span>(index);<span class="comment">//关闭弹出的子页面窗口</span></span><br></pre></td></tr></table></figure>

<h3 id="如何从子页面执行刷新父页面操作"><a href="#如何从子页面执行刷新父页面操作" class="headerlink" title="如何从子页面执行刷新父页面操作"></a>如何从子页面执行刷新父页面操作</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="built_in">parent</span>.location.<span class="title function_ invoke__">reload</span>(); <span class="comment">// 父页面刷新</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>jquery</category>
      </categories>
      <tags>
        <tag>jquery</tag>
      </tags>
  </entry>
  <entry>
    <title>oh-my-zsh的安装与配置</title>
    <url>/2024/07/03/oh-my-zsh%E7%9A%84%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<h2 id="一、安装zsh"><a href="#一、安装zsh" class="headerlink" title="一、安装zsh"></a>一、安装zsh</h2><p>安装 <strong>oh-my-zsh</strong> 需要首先安装 <strong>zsh</strong> </p>
<p>使用以下命令安装zsh，若其他linux系统可以使用yum来安装，不再赘述</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt install zsh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">或者</span>  </span><br><span class="line"></span><br><span class="line">sudo yum install zsh</span><br></pre></td></tr></table></figure>

<h2 id="二、安装oh-my-zsh"><a href="#二、安装oh-my-zsh" class="headerlink" title="二、安装oh-my-zsh"></a>二、安装oh-my-zsh</h2><p>oh-my-zsh官网： <a href="https://ohmyz.sh/#install">https://ohmyz.sh/#install</a></p>
<p>执行命令如下命令直接进行安装</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sh -c &quot;$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)&quot;</span><br></pre></td></tr></table></figure>

<p>执行之后终端界面已经发生了变化<br><img src="/../img/2024070301.png"></p>
<span id="more"></span>

<p>至此oh-my-zsh已经安装完毕，为优化使用体验，可安装插件和更换主题</p>
<h2 id="三、插件安装"><a href="#三、插件安装" class="headerlink" title="三、插件安装"></a>三、插件安装</h2><h4 id="1、-zsh-syntax-highlighting"><a href="#1、-zsh-syntax-highlighting" class="headerlink" title="1、 zsh-syntax-highlighting "></a>1、<span style="color:#098"> zsh-syntax-highlighting </span></h4><p>官网：<a href="https://github.com/zsh-users/zsh-syntax-highlighting">https://github.com/zsh-users/zsh-syntax-highlighting</a></p>
<p>按次序执行以下命令进行安装</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">git <span class="keyword">clone</span> https:<span class="comment">//github.com/zsh-users/zsh-syntax-highlighting.git ~/.zsh/zsh-syntax-highlighting</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="string">&quot;source ~/.zsh/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh&quot;</span> &gt;&gt; $&#123;ZDOTDIR:-<span class="variable">$HOME</span>&#125;/.zshrc</span><br></pre></td></tr></table></figure>

<p>安装完成后可以使用 <strong>source ~&#x2F;.zshrc</strong> 重载配置文件启用插件</p>
<h4 id="2、-zsh-autosuggestions"><a href="#2、-zsh-autosuggestions" class="headerlink" title="2、 zsh-autosuggestions "></a>2、<span style="color:#098"> zsh-autosuggestions </span></h4><p>官网：<a href="https://github.com/zsh-users/zsh-autosuggestions">https://github.com/zsh-users/zsh-autosuggestions</a></p>
<p>使用以下命令进行安装</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">git <span class="keyword">clone</span> https:<span class="comment">//github.com/zsh-users/zsh-autosuggestions ~/.zsh/zsh-autosuggestions</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="string">&quot;source ~/.zsh/zsh-autosuggestions/zsh-autosuggestions.zsh&quot;</span> &gt;&gt; $&#123;ZDOTDIR:-<span class="variable">$HOME</span>&#125;/.zshrc</span><br></pre></td></tr></table></figure>

<p>安装完成后可以使用 <strong>source ~&#x2F;.zshrc</strong> 重载配置文件启用插件</p>
<h2 id="四、主题设置"><a href="#四、主题设置" class="headerlink" title="四、主题设置"></a>四、主题设置</h2><p>使用命令编辑zsh配置文件 <strong>~&#x2F;.zshrc</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim ~/.zshrc</span><br></pre></td></tr></table></figure>
<p>找到 ZSH_THEME&#x3D;”” 行，后面引号中即为主题名称</p>
<p><img src="/../img/2024070302.png"></p>
<p>也可以使用 ZSH_THEME&#x3D;”random” 使用随机主题</p>
<p>随机主题下可以使用 source ~&#x2F;.zshrc 重载配置文件来刷新主题</p>
<p>选出一个合适的主题后 可以使用命令 echo $RANDOM_THEME 来输出当前的主题名称</p>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>phpstorm 主题及插件分享</title>
    <url>/2021/11/25/phpstorm-%E4%B8%BB%E9%A2%98%E5%88%86%E4%BA%AB/</url>
    <content><![CDATA[<p>先看下效果，个人比较喜欢<br><img src="/../img/phpstorm-01.png" alt="pic"></p>
<span id="more"></span>

<h3 id="插件安装位置"><a href="#插件安装位置" class="headerlink" title="插件安装位置"></a>插件安装位置</h3><p>phpstorm-&gt;preferences-&gt;Plugins<br><img src="/../img/phpstorm-02.png" alt="pic"></p>
<h3 id="下载插件"><a href="#下载插件" class="headerlink" title="下载插件"></a>下载插件</h3><p>插件名称：<br>Atom Material Icon （文件夹图标）<br>One Dark theme （主题）</p>
<h3 id="启用插件"><a href="#启用插件" class="headerlink" title="启用插件"></a>启用插件</h3><p>安装完成勾选上对应的插件，点击应用即可</p>
<h3 id="好用的插件及设置推荐"><a href="#好用的插件及设置推荐" class="headerlink" title="好用的插件及设置推荐"></a>好用的插件及设置推荐</h3><ul>
<li><p>PHP Annotation 自动引用命名空间和注解类跳转<br><img src="/../img/20211213-01.png"></p>
</li>
<li><p>选中变量底色更改<br><img src="/../img/phpstorm--03.png"></p>
</li>
<li><p>代码地图</p>
</li>
</ul>
<p><img src="/../img/phpstorm-code.png"></p>
<ul>
<li>代码格式化规则设置<br><img src="/../img/phpstorm-gui.jpg"></li>
</ul>
]]></content>
      <categories>
        <category>php</category>
      </categories>
      <tags>
        <tag>php</tag>
      </tags>
  </entry>
  <entry>
    <title>php如何发送邮件</title>
    <url>/2024/12/19/php%E5%A6%82%E4%BD%95%E5%8F%91%E9%80%81%E9%82%AE%E4%BB%B6/</url>
    <content><![CDATA[<blockquote>
<p>php邮件发送比较简单，这里整理了一下，方便小伙伴们收藏后直接开箱即用，当然，如果需要更复杂的配置，可以参考官网文档。</p>
</blockquote>
<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>下载对应的依赖包</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">composer <span class="keyword">require</span> phpmailer/phpmailer</span><br></pre></td></tr></table></figure>

<h2 id="代码封装与实现"><a href="#代码封装与实现" class="headerlink" title="代码封装与实现"></a>代码封装与实现</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">app</span>\<span class="title class_">services</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">PHPMailer</span>\<span class="title">PHPMailer</span>\<span class="title">PHPMailer</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">facade</span>\<span class="title">Log</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 邮件类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MailServer</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">static</span> <span class="keyword">string</span> <span class="variable">$host</span> = <span class="string">&quot;&quot;</span>; <span class="comment">// smtp服务器地址</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">static</span> <span class="keyword">string</span> <span class="variable">$username</span> = <span class="string">&quot;&quot;</span>; <span class="comment">// SMTP用户名 （通常为你的邮箱地址）</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">static</span> <span class="keyword">string</span> <span class="variable">$smtp_password</span> = <span class="string">&quot;&quot;</span>;  <span class="comment">// SMTP密码;</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">static</span> <span class="keyword">int</span> <span class="variable">$port</span> = <span class="number">587</span>;  <span class="comment">// 端口号;</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">static</span> <span class="keyword">string</span> <span class="variable">$addresser</span> = <span class="string">&quot;&quot;</span>;  <span class="comment">// 发件人;</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">static</span> <span class="keyword">array</span> <span class="variable">$recover_mails</span> = []; <span class="comment">// 收件人</span></span><br><span class="line">        </span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * - 发送邮件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $mail_subject  // 邮件主题</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $content       // 邮件内容</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $recover_name  // 收件人姓名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">send</span>(<span class="params"><span class="variable">$mail_subject</span>, <span class="variable">$content</span>, <span class="keyword">string</span> <span class="variable">$recover_name</span> = <span class="string">&quot;&quot;</span></span>): <span class="title">array</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$mail</span> = <span class="keyword">new</span> <span class="title class_">PHPMailer</span>(<span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 服务器配置</span></span><br><span class="line">            <span class="variable">$mail</span>-&gt;SMTPDebug  = <span class="number">0</span>;  <span class="comment">// 启动详细调试输出  2：详细输出 1：简要删除 0：不输出</span></span><br><span class="line">            <span class="variable">$mail</span>-&gt;<span class="title function_ invoke__">isSMTP</span>();    <span class="comment">// 启用SMTP</span></span><br><span class="line">            <span class="variable">$mail</span>-&gt;Host       = <span class="built_in">self</span>::<span class="variable">$host</span>; <span class="comment">// smtp服务器地址</span></span><br><span class="line">            <span class="variable">$mail</span>-&gt;SMTPAuth   = <span class="literal">true</span>;  <span class="comment">// 启用SMTP认证</span></span><br><span class="line">            <span class="variable">$mail</span>-&gt;Username   = <span class="built_in">self</span>::<span class="variable">$username</span>;    <span class="comment">// SMTP用户名 （通常为你的邮箱地址）</span></span><br><span class="line">            <span class="variable">$mail</span>-&gt;Password   = <span class="built_in">self</span>::<span class="variable">$smtp_password</span>;    <span class="comment">// SMTP密码</span></span><br><span class="line">            <span class="variable">$mail</span>-&gt;SMTPSecure = <span class="title class_">PHPMailer</span>::<span class="variable constant_">ENCRYPTION_STARTTLS</span>;  <span class="comment">// 启用TLS加密，`PHPMailer::ENCRYPTION_SMTPS` 代表使用SSL协议</span></span><br><span class="line">            <span class="variable">$mail</span>-&gt;Port       = <span class="built_in">self</span>::<span class="variable">$port</span>;  <span class="comment">// 端口号</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 邮件发件人配置</span></span><br><span class="line">            <span class="variable">$mail</span>-&gt;<span class="title function_ invoke__">setFrom</span>(<span class="built_in">self</span>::<span class="variable">$username</span>, <span class="built_in">self</span>::<span class="variable">$addresser</span>); <span class="comment">// 设置发件人信息</span></span><br><span class="line">            <span class="comment">// 添加收件人信息</span></span><br><span class="line">            <span class="keyword">foreach</span> (<span class="built_in">self</span>::<span class="variable">$recover_mails</span> <span class="keyword">as</span> <span class="variable">$mail_add</span>) &#123;</span><br><span class="line">                <span class="variable">$mail</span>-&gt;<span class="title function_ invoke__">addAddress</span>(<span class="variable">$mail_add</span>, <span class="variable">$recover_name</span>); <span class="comment">// 添加收件人地址</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 内容</span></span><br><span class="line">            <span class="variable">$mail</span>-&gt;<span class="title function_ invoke__">isHTML</span>(<span class="literal">true</span>); <span class="comment">// 设置邮件格式为HTML</span></span><br><span class="line">            <span class="variable">$mail</span>-&gt;CharSet = <span class="string">&quot;utf-8&quot;</span>;   <span class="comment">// 设置编码防止乱码</span></span><br><span class="line">            <span class="variable">$mail</span>-&gt;Subject = <span class="variable">$mail_subject</span>; <span class="comment">// 邮件标题</span></span><br><span class="line">            <span class="variable">$mail</span>-&gt;Body = <span class="variable">$content</span> . <span class="string">&quot; 【remote_phone】&quot;</span>; <span class="comment">// 邮件正文</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 发送邮件</span></span><br><span class="line">            <span class="keyword">if</span> (!<span class="variable">$mail</span>-&gt;<span class="title function_ invoke__">send</span>()) &#123;</span><br><span class="line">                <span class="keyword">return</span> [<span class="literal">false</span>, <span class="string">&quot;mail send fail：&quot;</span>.<span class="variable">$mail</span>-&gt;ErrorInfo];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> [<span class="literal">true</span>, <span class="string">&quot;mail send success&quot;</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (\<span class="built_in">Exception</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">            <span class="title class_">Log</span>::<span class="title function_ invoke__">error</span>(<span class="string">&quot;邮件发送失败：&quot;</span>.<span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>());</span><br><span class="line">            <span class="keyword">return</span> [<span class="literal">false</span>, <span class="string">&quot;mail send exception：&quot;</span>.<span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>()];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>php</category>
      </categories>
      <tags>
        <tag>php</tag>
      </tags>
  </entry>
  <entry>
    <title>php指定某个文件/文件夹下所有文件 在指定行插入内容</title>
    <url>/2018/08/08/php%E6%8C%87%E5%AE%9A%E6%9F%90%E4%B8%AA%E6%96%87%E4%BB%B6-%E6%96%87%E4%BB%B6%E5%A4%B9%E4%B8%8B%E6%89%80%E6%9C%89%E6%96%87%E4%BB%B6-%E5%9C%A8%E6%8C%87%E5%AE%9A%E8%A1%8C%E6%8F%92%E5%85%A5%E5%86%85%E5%AE%B9/</url>
    <content><![CDATA[<p>今天在引用阿里云SDK在Laravel下的应用时需要在每个类中添加命名空间，可恶的是没有alipay的Org包，开始没注意文件个数，人肉添加，越来越多…我发现这样并不是办法，并不是一两个文件，于是乎写了下面两个类适用于在单个或者多个文件中指定某行添加内容，根据以下两个类也可以做出更多需求的改变，也相信在更多的地方会使用到，看看实现吧，有建议欢迎提出。</p>
<h3 id="在某个文件指定行的地方插入内容"><a href="#在某个文件指定行的地方插入内容" class="headerlink" title="在某个文件指定行的地方插入内容"></a>在某个文件指定行的地方插入内容</h3><p>类名：writeIntoFileContent.php</p>
<span id="more"></span>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * - 在某个文件指定行的地方插入内容</span></span><br><span class="line"><span class="comment"> * Created by PhpStorm.</span></span><br><span class="line"><span class="comment"> * User: xiexiang</span></span><br><span class="line"><span class="comment"> * Date: 2018/8/8</span></span><br><span class="line"><span class="comment"> * Time: 上午9:30</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">writeIntoFileContent</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$file</span>;   <span class="comment">//文件地址</span></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$code</span>;   <span class="comment">//写入的内容</span></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$lineNo</span>; <span class="comment">//写到第几行</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span>, <span class="variable">$code</span>, <span class="variable">$lineNo</span></span>)</span>&#123;</span><br><span class="line">          <span class="variable language_">$this</span>-&gt;file   = <span class="variable">$file</span>;</span><br><span class="line">          <span class="variable language_">$this</span>-&gt;code   = <span class="variable">$code</span>;</span><br><span class="line">          <span class="variable language_">$this</span>-&gt;lineNo = <span class="variable">$lineNo</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 类的出口方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">writeToLineContent</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$f</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$this</span>-&gt;file, <span class="string">&quot;r+&quot;</span>);</span><br><span class="line">        <span class="variable">$content</span> = <span class="title function_ invoke__">fread</span>(<span class="variable">$f</span>, <span class="title function_ invoke__">filesize</span>(<span class="variable">$this</span>-&gt;file));</span><br><span class="line">        <span class="title function_ invoke__">fclose</span>(<span class="variable">$f</span>);</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">strstr</span>(<span class="variable">$content</span>, <span class="variable">$this</span>-&gt;code)) &#123;</span><br><span class="line">            <span class="variable">$arrInsert</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">insertContent</span>(<span class="variable">$this</span>-&gt;file, <span class="variable">$this</span>-&gt;code,  <span class="variable">$this</span>-&gt;lineNo-<span class="number">1</span>);</span><br><span class="line">            <span class="title function_ invoke__">unlink</span>(<span class="variable">$this</span>-&gt;file);</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="variable">$arrInsert</span> <span class="keyword">as</span> <span class="variable">$value</span>) &#123;</span><br><span class="line">                <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$this</span>-&gt;file, <span class="variable">$value</span>, FILE_APPEND);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">insertContent</span>(<span class="params"><span class="variable">$file</span>, <span class="variable">$code</span>, <span class="variable">$lineNo</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$file_handle</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$file</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">        <span class="variable">$i</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable">$arr</span> = <span class="keyword">array</span>();</span><br><span class="line">        <span class="keyword">while</span> (!<span class="title function_ invoke__">feof</span>(<span class="variable">$file_handle</span>)) &#123;</span><br><span class="line">            <span class="variable">$line</span> = <span class="title function_ invoke__">fgets</span>(<span class="variable">$file_handle</span>);</span><br><span class="line">            ++<span class="variable">$i</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$i</span> == <span class="variable">$lineNo</span>) &#123;</span><br><span class="line">                <span class="variable">$arr</span>[] = <span class="variable">$line</span> . <span class="variable">$code</span> . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$arr</span>[] = <span class="variable">$line</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">fclose</span>(<span class="variable">$file_handle</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$arr</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="在某个文件夹下所有的文件的指定行插入内容"><a href="#在某个文件夹下所有的文件的指定行插入内容" class="headerlink" title="在某个文件夹下所有的文件的指定行插入内容"></a>在某个文件夹下所有的文件的指定行插入内容</h3><p>类名：writeIntoAllFileContent.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * - 在某个文件夹下所有的文件的指定行插入内容 （暂支持一个层级，多个层级支持可以自己改造）</span></span><br><span class="line"><span class="comment"> * Created by PhpStorm.</span></span><br><span class="line"><span class="comment"> * User: xiexiang</span></span><br><span class="line"><span class="comment"> * Date: 2018/8/8</span></span><br><span class="line"><span class="comment"> * Time: 上午9:30</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">writeIntoAllFileContent</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$filePath</span>;   <span class="comment">//文件夹地址 （支持一个层级）</span></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$code</span>;       <span class="comment">//写入的内容</span></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$lineNo</span>;     <span class="comment">//写到第几行</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$filePath</span>, <span class="variable">$code</span>, <span class="variable">$lineNo</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;filePath   = <span class="variable">$filePath</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;code       = <span class="variable">$code</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;lineNo     = <span class="variable">$lineNo</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 类的出口方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">writeContentToAllFile</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$files</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">findAllFile</span>(<span class="variable">$this</span>-&gt;filePath);</span><br><span class="line">        <span class="keyword">if</span>( !<span class="keyword">empty</span>(<span class="variable">$files</span>))&#123;</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="variable">$files</span> <span class="keyword">as</span> <span class="variable">$fileName</span>)&#123;</span><br><span class="line">                <span class="variable">$file</span> = <span class="variable language_">$this</span>-&gt;filePath.<span class="string">&#x27;/&#x27;</span>.<span class="variable">$fileName</span>;</span><br><span class="line">                <span class="variable">$f</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$file</span>, <span class="string">&quot;r+&quot;</span>);</span><br><span class="line">                <span class="variable">$content</span> = <span class="title function_ invoke__">fread</span>(<span class="variable">$f</span>, <span class="title function_ invoke__">filesize</span>(<span class="variable">$file</span>));</span><br><span class="line">                <span class="title function_ invoke__">fclose</span>(<span class="variable">$f</span>);</span><br><span class="line">                <span class="keyword">if</span> (!<span class="title function_ invoke__">strstr</span>(<span class="variable">$content</span>, <span class="variable">$this</span>-&gt;code)) &#123;</span><br><span class="line">                    <span class="variable">$arrInsert</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">insertContent</span>(<span class="variable">$file</span>, <span class="variable">$this</span>-&gt;code,  <span class="variable">$this</span>-&gt;lineNo-<span class="number">1</span>);</span><br><span class="line">                    <span class="title function_ invoke__">unlink</span>(<span class="variable">$file</span>);</span><br><span class="line">                    <span class="keyword">foreach</span> (<span class="variable">$arrInsert</span> <span class="keyword">as</span> <span class="variable">$value</span>) &#123;</span><br><span class="line">                        <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$file</span>, <span class="variable">$value</span>, FILE_APPEND);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;文件下面没有文件！&quot;</span>;</span><br><span class="line">            <span class="keyword">exit</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">insertContent</span>(<span class="params"><span class="variable">$file</span>, <span class="variable">$code</span>, <span class="variable">$lineNo</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$file_handle</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$file</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">        <span class="variable">$i</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable">$arr</span> = <span class="keyword">array</span>();</span><br><span class="line">        <span class="keyword">while</span> (!<span class="title function_ invoke__">feof</span>(<span class="variable">$file_handle</span>)) &#123;</span><br><span class="line">            <span class="variable">$line</span> = <span class="title function_ invoke__">fgets</span>(<span class="variable">$file_handle</span>);</span><br><span class="line">            ++<span class="variable">$i</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$i</span> == <span class="variable">$lineNo</span>) &#123;</span><br><span class="line">                <span class="variable">$arr</span>[] = <span class="variable">$line</span> . <span class="variable">$code</span> . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$arr</span>[] = <span class="variable">$line</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">fclose</span>(<span class="variable">$file_handle</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$arr</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 遍历出文件夹下所有的文件</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">findAllFile</span>(<span class="params"><span class="variable">$dir</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$files</span> = <span class="keyword">array</span>();</span><br><span class="line">        <span class="keyword">if</span>(@<span class="variable">$handle</span> = <span class="title function_ invoke__">opendir</span>(<span class="variable">$dir</span>)) &#123;                          <span class="comment">//注意这里要加一个@，不然会有warning错误提示：）</span></span><br><span class="line">            <span class="keyword">while</span>((<span class="variable">$file</span> = <span class="title function_ invoke__">readdir</span>(<span class="variable">$handle</span>)) !== <span class="literal">false</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$file</span> != <span class="string">&quot;..&quot;</span> &amp;&amp; <span class="variable">$file</span> != <span class="string">&quot;.&quot;</span>) &#123;             <span class="comment">//排除根目录；</span></span><br><span class="line">                    <span class="keyword">if</span>(<span class="title function_ invoke__">is_dir</span>(<span class="variable">$dir</span>.<span class="string">&quot;/&quot;</span>.<span class="variable">$file</span>)) &#123;        <span class="comment">//如果是子文件夹，就进行递归</span></span><br><span class="line">                        <span class="variable">$files</span>[<span class="variable">$file</span>] = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">findAllFile</span>(<span class="variable">$dir</span>.<span class="string">&quot;/&quot;</span>.<span class="variable">$file</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;                                     <span class="comment">//不然就将文件的名字存入数组；</span></span><br><span class="line">                        <span class="variable">$files</span>[] = <span class="variable">$file</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="title function_ invoke__">closedir</span>(<span class="variable">$handle</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$files</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>php</category>
      </categories>
      <tags>
        <tag>php</tag>
      </tags>
  </entry>
  <entry>
    <title>php实现导出excel</title>
    <url>/2023/09/13/php%E5%AE%9E%E7%8E%B0%E5%AF%BC%E5%87%BAexcel/</url>
    <content><![CDATA[<blockquote>
<p>php实现简单的excel导出案例如下，能很方便、便捷的导出所需数据，性能比较好；如需定制化导出，比如需要设置行高宽度、颜色填充、居中等效果建议使用PHPExcel插件去做，该插件具有更强大的定制化功能，能满足你各种样式需求</p>
</blockquote>
<p>以下是php导出代码</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">exportcos</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">set_time_limit</span>(<span class="number">0</span>);          <span class="comment">// 设置长时执行</span></span><br><span class="line">        <span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;memory_limit&#x27;</span>, <span class="string">&#x27;512M&#x27;</span>); <span class="comment">// 设置执行内存</span></span><br><span class="line">        <span class="variable">$fileName</span> = <span class="title function_ invoke__">date</span>(<span class="string">&#x27;ymd&#x27;</span>).<span class="string">&#x27;_cos.csv&#x27;</span>; <span class="comment">// 导出的excel文件名</span></span><br><span class="line">        <span class="comment">//设置header头</span></span><br><span class="line">        <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-Description: File Transfer&#x27;</span>);</span><br><span class="line">        <span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-Type: application/vnd.ms-excel;charset=UTF-8&quot;</span>);</span><br><span class="line">        <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-Disposition: attachment;filename=&quot;&#x27;</span> . <span class="variable">$fileName</span> . <span class="string">&#x27;&quot;&#x27;</span>);</span><br><span class="line">        <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Expires: 0&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_USER_AGENT&#x27;</span>], <span class="string">&#x27;MSIE&#x27;</span>) === <span class="literal">false</span>) &#123;</span><br><span class="line">            <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Cache-Control: no-cache&#x27;</span>);</span><br><span class="line">            <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Pragma: no-cache&#x27;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Cache-Control: must-revalidate, post-check=0, pre-check=0&#x27;</span>);</span><br><span class="line">            <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Pragma: public&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//打开php数据输入缓冲区</span></span><br><span class="line">        <span class="variable">$fp</span>     = <span class="title function_ invoke__">fopen</span>(<span class="string">&#x27;php://output&#x27;</span>, <span class="string">&#x27;ab&#x27;</span>);</span><br><span class="line">        <span class="variable">$header</span> = [<span class="string">&#x27;序号&#x27;</span>,<span class="string">&#x27;姓名&#x27;</span>,<span class="string">&#x27;性别&#x27;</span>,<span class="string">&#x27;学校&#x27;</span>,<span class="string">&#x27;班级&#x27;</span>];    <span class="comment">// 设置excel表头</span></span><br><span class="line">        <span class="title function_ invoke__">fwrite</span>(<span class="variable">$fp</span>, <span class="title function_ invoke__">chr</span>(<span class="number">0xEF</span>) . <span class="title function_ invoke__">chr</span>(<span class="number">0xBB</span>) . <span class="title function_ invoke__">chr</span>(<span class="number">0xBF</span>));</span><br><span class="line">        <span class="title function_ invoke__">fputcsv</span>(<span class="variable">$fp</span>, <span class="variable">$header</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 数据列表处理   </span></span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">1</span>; <span class="variable">$i</span> &lt;= <span class="number">50000</span>; <span class="variable">$i</span>++) &#123;          <span class="comment">// 如是真实查询数据，加入筛选条件得到过滤后需要的数据</span></span><br><span class="line">            <span class="variable">$item</span>[<span class="string">&#x27;id&#x27;</span>] = <span class="variable">$i</span>;</span><br><span class="line">            <span class="variable">$item</span>[<span class="string">&#x27;name&#x27;</span>] = <span class="string">&quot;谢晨奕&quot;</span>;</span><br><span class="line">            <span class="variable">$item</span>[<span class="string">&#x27;sex&#x27;</span>] = <span class="string">&quot;女&quot;</span>;</span><br><span class="line">            <span class="variable">$item</span>[<span class="string">&#x27;school&#x27;</span>] = <span class="string">&quot;璞普幼儿园&quot;</span>;</span><br><span class="line">            <span class="variable">$item</span>[<span class="string">&#x27;class&#x27;</span>] = <span class="string">&quot;中二班&quot;</span>;</span><br><span class="line">            <span class="title function_ invoke__">fputcsv</span>(<span class="variable">$fp</span>, <span class="variable">$item</span>);  <span class="comment">// 写一行excel</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">fclose</span>(<span class="variable">$fp</span>);  <span class="comment">// 最后关闭缓冲区</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>php</category>
      </categories>
      <tags>
        <tag>php</tag>
      </tags>
  </entry>
  <entry>
    <title>php按照数组中某个字段排序</title>
    <url>/2024/06/17/php%E6%8C%89%E7%85%A7%E6%95%B0%E7%BB%84%E4%B8%AD%E6%9F%90%E4%B8%AA%E5%AD%97%E6%AE%B5%E6%8E%92%E5%BA%8F/</url>
    <content><![CDATA[<p>在PHP中，可以使用usort函数对数组进行排序，并且可以指定一个回调函数来定义排序的逻辑。如果要按照数组元素的某个字段进行排序，可以使用匿名函数（闭包）来实现。</p>
<p>同时也支持多个字段进行升&#x2F;降序排列。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$arr</span> = [</span><br><span class="line">            [<span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;age&#x27;</span> =&gt; <span class="number">25</span>, <span class="string">&#x27;k_sort&#x27;</span> =&gt; <span class="number">3</span>, <span class="string">&#x27;recommend&#x27;</span> =&gt; <span class="number">2</span>],</span><br><span class="line">            [<span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;李四&#x27;</span>, <span class="string">&#x27;age&#x27;</span> =&gt; <span class="number">23</span>, <span class="string">&#x27;k_sort&#x27;</span> =&gt; <span class="number">3</span>, <span class="string">&#x27;recommend&#x27;</span> =&gt; <span class="number">1</span>],</span><br><span class="line">            [<span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;王五&#x27;</span>, <span class="string">&#x27;age&#x27;</span> =&gt; <span class="number">30</span>, <span class="string">&#x27;k_sort&#x27;</span> =&gt; <span class="number">5</span>, <span class="string">&#x27;recommend&#x27;</span> =&gt; <span class="number">2</span>],</span><br><span class="line">        ];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 排序操作：含有活动优惠的商品靠前排序</span></span><br><span class="line">        <span class="title function_ invoke__">usort</span>(<span class="variable">$arr</span>, function (<span class="variable">$a</span>, <span class="variable">$b</span>) &#123;</span><br><span class="line">            <span class="variable">$result</span> = <span class="variable">$b</span>[<span class="string">&#x27;k_sort&#x27;</span>] - <span class="variable">$a</span>[<span class="string">&#x27;k_sort&#x27;</span>];               <span class="comment">// 优先活动（降序）</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$result</span> == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="variable">$result</span> = <span class="variable">$a</span>[<span class="string">&#x27;recommend&#x27;</span>] &lt;=&gt; <span class="variable">$b</span>[<span class="string">&#x27;recommend&#x27;</span>];   <span class="comment">// 其次置顶（升序）</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="variable">$result</span> == <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="variable">$result</span> = <span class="variable">$b</span>[<span class="string">&#x27;age&#x27;</span>] - <span class="variable">$a</span>[<span class="string">&#x27;age&#x27;</span>];             <span class="comment">// 再次排序（降序）</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="title function_ invoke__">print_r</span>(<span class="variable">$arr</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">运行结果：</span><br><span class="line"><span class="title function_ invoke__">Array</span></span><br><span class="line">(</span><br><span class="line">    [<span class="number">0</span>] =&gt; <span class="title function_ invoke__">Array</span></span><br><span class="line">        (</span><br><span class="line">            [name] =&gt; 王五</span><br><span class="line">            [age] =&gt; <span class="number">30</span></span><br><span class="line">            [k_sort] =&gt; <span class="number">5</span></span><br><span class="line">            [recommend] =&gt; <span class="number">2</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    [<span class="number">1</span>] =&gt; <span class="title function_ invoke__">Array</span></span><br><span class="line">        (</span><br><span class="line">            [name] =&gt; 李四</span><br><span class="line">            [age] =&gt; <span class="number">23</span></span><br><span class="line">            [k_sort] =&gt; <span class="number">3</span></span><br><span class="line">            [recommend] =&gt; <span class="number">1</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    [<span class="number">2</span>] =&gt; <span class="title function_ invoke__">Array</span></span><br><span class="line">        (</span><br><span class="line">            [name] =&gt; 张三</span><br><span class="line">            [age] =&gt; <span class="number">25</span></span><br><span class="line">            [k_sort] =&gt; <span class="number">3</span></span><br><span class="line">            [recommend] =&gt; <span class="number">2</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">)</span><br></pre></td></tr></table></figure>








]]></content>
      <categories>
        <category>php</category>
      </categories>
      <tags>
        <tag>php</tag>
      </tags>
  </entry>
  <entry>
    <title>php如何对接微信支付V3版本（保姆级别）</title>
    <url>/2024/08/15/php%E5%A6%82%E4%BD%95%E5%AF%B9%E6%8E%A5%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98V3%E7%89%88%E6%9C%AC%EF%BC%88%E4%BF%9D%E5%A7%86%E7%BA%A7%E5%88%AB%EF%BC%89/</url>
    <content><![CDATA[<blockquote>
<p>本文主要记录php对接微信支付v3版本的整个过程，包含支付、退款、回调等功能，会从申请证书开始记录</p>
</blockquote>
<h2 id="一、证书申请-V3"><a href="#一、证书申请-V3" class="headerlink" title="一、证书申请 V3"></a>一、证书申请 V3</h2><h4 id="1、入口介绍"><a href="#1、入口介绍" class="headerlink" title="1、入口介绍"></a>1、入口介绍</h4><p> 在微信商户平台中，[账户中心]-&gt;[API安全]中可以看到这样的界面<br> <img src="/../img/24081501.png"><br> 证书的申请在商户API证书下面的管理证书</p>
<span id="more"></span>
<h4 id="2、证书工具下载"><a href="#2、证书工具下载" class="headerlink" title="2、证书工具下载"></a>2、证书工具下载</h4><p><img src="/../img/24081505.png"><br>目前支持windows和mac版本，下载安装到本机</p>
<h4 id="3、修改证书保存地址"><a href="#3、修改证书保存地址" class="headerlink" title="3、修改证书保存地址"></a>3、修改证书保存地址</h4><p>运行证书工具后，修改证书保存路径<br><img src="/../img/24081502.jpg"></p>
<h4 id="4、生成证书请求串"><a href="#4、生成证书请求串" class="headerlink" title="4、生成证书请求串"></a>4、生成证书请求串</h4><p><img src="/../img/24081503.png"></p>
<h4 id="5、生成证书"><a href="#5、生成证书" class="headerlink" title="5、生成证书"></a>5、生成证书</h4><p>将证书请求串复制到商户平台证书管理界面粘贴进去，然后在工具上点击生成证书，会在你证书保存路径的地方生成两个文件：<strong>apiclient_cert.pem</strong>和<strong>apiclinet_key.pem</strong></p>
<h2 id="二、cert-pem证书生成"><a href="#二、cert-pem证书生成" class="headerlink" title="二、cert.pem证书生成"></a>二、cert.pem证书生成</h2><p><strong>注意：V3版本中<span style="color:red">cert.pem</span>证书不同于apiclient_cert.pem证书，它是由命令工具生成，确切的说apiclient_cert.pem是没有用的，而cert.pem才是真正在代码对接中有用的，这里相对于v2版本有很大的区别，这里也是最容易混淆的地方。</strong></p>
<h4 id="1、下载php依赖"><a href="#1、下载php依赖" class="headerlink" title="1、下载php依赖"></a>1、下载php依赖</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">composer <span class="keyword">require</span> wechatpay/wechatpay</span><br></pre></td></tr></table></figure>

<p>github地址：<a href="https://github.com/wechatpay-apiv3/wechatpay-php">https://github.com/wechatpay-apiv3/wechatpay-php</a></p>
<h4 id="2、运行命令生成证书"><a href="#2、运行命令生成证书" class="headerlink" title="2、运行命令生成证书"></a>2、运行命令生成证书</h4><p><img src="/../img/24081506.png"></p>
<p>找到该路径： <strong>&#x2F;vendor&#x2F;wechatpay&#x2F;wechatpay&#x2F;bin</strong> 下，有个 <strong>CertificateDownloader.php</strong> 文件，可通过php去执行它能看到命令行的提示：</p>
<p><img src="/../img/24081507.png"></p>
<ul>
<li>-m 商户号：这个不用说</li>
<li>-s 商户证书序列号：在商户平台生成证书后所对应的证书序列号</li>
<li>-f 商户的秘钥文件：通过证书工具生成的apiclient_key.pem这个文件</li>
<li>-k APIv3: 在商户平台API安全中可以找到，本文中图一可以看到</li>
</ul>
<p>全部设置好后执行命令（参考）:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">php CertificateDownloader.php -m 1635059363 -k NrAsJhcefMRkHKkMtNGrAtTdKtKaTTmY -f ../../../../config/merchant/apiclient_key.pem -s 7A56DCFEEE02E7F56C18E04EFF7D488A44D6AABB </span><br></pre></td></tr></table></figure>

<p>成功后会得到以下结果：</p>
<p><img src="/../img/2024081508.png"></p>
<p>此时就得到了cert.pem的内容，自行保存证书。</p>
<h2 id="三、业务对接"><a href="#三、业务对接" class="headerlink" title="三、业务对接"></a>三、业务对接</h2><p>以下<strong>WechatPayServiceV3.php</strong>为实例，以app支付为场景，提供如下service，里面有微信支付、退款、回调等业务逻辑，特别注意微信配置的地方，也可以参照github上提供的参考代码。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">app</span>\<span class="title class_">api</span>\<span class="title class_">service</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">facade</span>\<span class="title">Log</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">WeChatPay</span>\<span class="title">Builder</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">WeChatPay</span>\<span class="title">Crypto</span>\<span class="title">Rsa</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">WeChatPay</span>\<span class="title">Formatter</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">WeChatPay</span>\<span class="title">Util</span>\<span class="title">PemUtil</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 微信支付 V3</span></span><br><span class="line"><span class="comment"> * Class WechatPayServiceV3</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WechatPayServiceV3</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/** <span class="doctag">@var</span> Builder::factory $resp */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$instance</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">_init</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * - apiV3实例初始化</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">_init</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 商户号，假定为`1000100`</span></span><br><span class="line">        <span class="variable">$merchantId</span> = <span class="title function_ invoke__">config</span>(<span class="string">&#x27;wechat.merchantId&#x27;</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">        <span class="comment">// 从本地文件中加载「商户API私钥」，「商户API私钥」会用来生成请求的签名</span></span><br><span class="line">        <span class="variable">$merchantPrivateKeyFilePath</span> = <span class="string">&quot;file://&quot;</span>.<span class="title function_ invoke__">config_path</span>().<span class="string">&#x27;merchant/apiclient_key.pem&#x27;</span>;</span><br><span class="line">        <span class="variable">$merchantPrivateKeyInstance</span> = <span class="title class_">Rsa</span>::<span class="keyword">from</span>(<span class="variable">$merchantPrivateKeyFilePath</span>, <span class="title class_">Rsa</span>::<span class="variable constant_">KEY_TYPE_PRIVATE</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 「商户API证书」的「证书序列号」 ，从微信支付提供的「平台证书」中获取</span></span><br><span class="line">        <span class="variable">$merchantCertificateSerial</span> = <span class="title function_ invoke__">config</span>(<span class="string">&#x27;wechat.mchSerialNo&#x27;</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 从本地文件中加载「微信支付平台证书」，用来验证微信支付应答的签名</span></span><br><span class="line">        <span class="comment">// 【**】【打死要特别注意】：这里是坑，以下的cert.pem并不是工具生成的apiclient_cert.pem这个证书，而是通过/vendor/wechatpay/wechatpay/bin 下的工具生成的！</span></span><br><span class="line">        <span class="variable">$platformCertificateFilePath</span> = <span class="string">&quot;file://&quot;</span>.<span class="title function_ invoke__">config_path</span>().<span class="string">&#x27;merchant/cert.pem&#x27;</span>;</span><br><span class="line">        <span class="variable">$platformPublicKeyInstance</span> = <span class="title class_">Rsa</span>::<span class="keyword">from</span>(<span class="variable">$platformCertificateFilePath</span>, <span class="title class_">Rsa</span>::<span class="variable constant_">KEY_TYPE_PUBLIC</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 从「微信支付平台证书」中获取「证书序列号」</span></span><br><span class="line">        <span class="variable">$platformCertificateSerial</span> = <span class="title class_">PemUtil</span>::<span class="title function_ invoke__">parseCertificateSerialNo</span>(<span class="variable">$platformCertificateFilePath</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 构造一个 APIv3 客户端实例</span></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;instance = <span class="title class_">Builder</span>::<span class="title function_ invoke__">factory</span>([</span><br><span class="line">            <span class="string">&#x27;mchid&#x27;</span>      =&gt; <span class="variable">$merchantId</span>,</span><br><span class="line">            <span class="string">&#x27;serial&#x27;</span>     =&gt; <span class="variable">$merchantCertificateSerial</span>,</span><br><span class="line">            <span class="string">&#x27;privateKey&#x27;</span> =&gt; <span class="variable">$merchantPrivateKeyInstance</span>,</span><br><span class="line">            <span class="string">&#x27;certs&#x27;</span>      =&gt; [</span><br><span class="line">                <span class="variable">$platformCertificateSerial</span> =&gt; <span class="variable">$platformPublicKeyInstance</span>,</span><br><span class="line">            ],</span><br><span class="line">        ]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * - 生成支付签名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $prepayId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getPaySign</span>(<span class="params"><span class="variable">$prepayId</span></span>): <span class="title">array</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$merchantPrivateKeyFilePath</span> = <span class="string">&quot;file://&quot;</span>.<span class="title function_ invoke__">config_path</span>().<span class="string">&#x27;merchant/apiclient_key.pem&#x27;</span>;</span><br><span class="line">        <span class="variable">$merchantPrivateKeyInstance</span> = <span class="title class_">Rsa</span>::<span class="keyword">from</span>(<span class="variable">$merchantPrivateKeyFilePath</span>);</span><br><span class="line">        <span class="variable">$params</span> = [</span><br><span class="line">            <span class="string">&#x27;appId&#x27;</span>     =&gt; <span class="title function_ invoke__">config</span>(<span class="string">&#x27;wechat.appid&#x27;</span>, <span class="string">&#x27;&#x27;</span>),</span><br><span class="line">            <span class="string">&#x27;timeStamp&#x27;</span> =&gt; (<span class="keyword">string</span>)<span class="title class_">Formatter</span>::<span class="title function_ invoke__">timestamp</span>(),</span><br><span class="line">            <span class="string">&#x27;nonceStr&#x27;</span>  =&gt; <span class="title class_">Formatter</span>::<span class="title function_ invoke__">nonce</span>(),</span><br><span class="line">            <span class="string">&#x27;prepay_id&#x27;</span> =&gt; <span class="variable">$prepayId</span>,</span><br><span class="line">        ];</span><br><span class="line">        <span class="variable">$params</span> += [<span class="string">&#x27;paySign&#x27;</span> =&gt; <span class="title class_">Rsa</span>::<span class="title function_ invoke__">sign</span>(</span><br><span class="line">            <span class="title class_">Formatter</span>::<span class="title function_ invoke__">joinedByLineFeed</span>(...<span class="title function_ invoke__">array_values</span>(<span class="variable">$params</span>)),</span><br><span class="line">            <span class="variable">$merchantPrivateKeyInstance</span></span><br><span class="line">        ), <span class="string">&#x27;signType&#x27;</span> =&gt; <span class="string">&#x27;RSA&#x27;</span>];</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$params</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * - 微信支付 V3</span></span><br><span class="line"><span class="comment">     * #依赖包文档： https://packagist.org/packages/wechatpay/wechatpay</span></span><br><span class="line"><span class="comment">     * #微信app支付文档：https://pay.weixin.qq.com/docs/merchant/apis/in-app-payment/direct-jsons/app-prepay.html</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $options</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $notifyURL // 回调地址</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> array</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> \Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">pay</span>(<span class="params"><span class="variable">$options</span>, <span class="variable">$notifyURL</span></span>): <span class="title">array</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="variable">$appid</span> = <span class="title function_ invoke__">config</span>(<span class="string">&#x27;wechat.appid&#x27;</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">            <span class="variable">$mchid</span> = <span class="title function_ invoke__">config</span>(<span class="string">&#x27;wechat.merchantId&#x27;</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">            <span class="comment">// 同步支付</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// 参数整理 请参照：https://pay.weixin.qq.com/docs/merchant/apis/in-app-payment/direct-jsons/app-prepay.html</span></span><br><span class="line">                <span class="variable">$params</span> = [</span><br><span class="line">                    <span class="string">&#x27;json&#x27;</span> =&gt; [</span><br><span class="line">                        <span class="string">&#x27;appid&#x27;</span>        =&gt; <span class="variable">$appid</span>, <span class="comment">// 微信appid</span></span><br><span class="line">                        <span class="string">&#x27;mchid&#x27;</span>        =&gt; <span class="variable">$mchid</span>, <span class="comment">// 商户号</span></span><br><span class="line">                        <span class="string">&#x27;description&#x27;</span>  =&gt; <span class="variable">$options</span>[<span class="string">&#x27;subject&#x27;</span>],     <span class="comment">//商品描述</span></span><br><span class="line">                        <span class="string">&#x27;out_trade_no&#x27;</span> =&gt; <span class="variable">$options</span>[<span class="string">&#x27;outTradeNo&#x27;</span>],  <span class="comment">// 商户系统内部订单号</span></span><br><span class="line">                        <span class="string">&#x27;notify_url&#x27;</span>   =&gt; <span class="variable">$notifyURL</span>,              <span class="comment">// 回调地址</span></span><br><span class="line">                        <span class="string">&#x27;amount&#x27;</span>       =&gt; [</span><br><span class="line">                            <span class="string">&#x27;total&#x27;</span>    =&gt; <span class="title function_ invoke__">intval</span>(<span class="variable">$options</span>[<span class="string">&#x27;totalAmount&#x27;</span>] * <span class="number">100</span>),   <span class="comment">// 订单总金额，单位为分。</span></span><br><span class="line">                            <span class="string">&#x27;currency&#x27;</span> =&gt; <span class="string">&#x27;CNY&#x27;</span>,</span><br><span class="line">                        ],</span><br><span class="line">                    ],</span><br><span class="line">                ];</span><br><span class="line">                <span class="variable">$resp</span> = <span class="variable language_">$this</span>-&gt;instance-&gt;<span class="title function_ invoke__">chain</span>(<span class="string">&#x27;v3/pay/transactions/app&#x27;</span>)-&gt;<span class="title function_ invoke__">post</span>(<span class="variable">$params</span>);</span><br><span class="line">                <span class="variable">$resp</span> = <span class="variable">$resp</span>-&gt;<span class="title function_ invoke__">getBody</span>()-&gt;<span class="title function_ invoke__">getContents</span>();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (\GuzzleHttp\<span class="built_in">Exception</span>\RequestException <span class="variable">$e</span>) &#123;</span><br><span class="line">                <span class="variable">$r</span> = <span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getResponse</span>();</span><br><span class="line">                <span class="variable">$resp</span> = <span class="variable">$r</span>-&gt;<span class="title function_ invoke__">getBody</span>()-&gt;<span class="title function_ invoke__">getContents</span>();</span><br><span class="line">                <span class="title class_">Log</span>::<span class="title function_ invoke__">channel</span>(<span class="string">&#x27;wechat_notify&#x27;</span>)-&gt;<span class="title function_ invoke__">error</span>(<span class="string">&quot;微信支付创建订单 请求异常&quot;</span>, [<span class="string">&#x27;StatusCode&#x27;</span> =&gt; <span class="variable">$r</span>-&gt;<span class="title function_ invoke__">getStatusCode</span>() . <span class="string">&#x27; &#x27;</span> . <span class="variable">$r</span>-&gt;<span class="title function_ invoke__">getReasonPhrase</span>(), <span class="string">&#x27;Body&#x27;</span> =&gt; <span class="variable">$r</span>-&gt;<span class="title function_ invoke__">getBody</span>(), <span class="string">&#x27;outTradeNo&#x27;</span> =&gt; <span class="variable">$options</span>[<span class="string">&#x27;outTradeNo&#x27;</span>]]);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (\<span class="built_in">Exception</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">                <span class="title class_">Log</span>::<span class="title function_ invoke__">channel</span>(<span class="string">&#x27;wechat_notify&#x27;</span>)-&gt;<span class="title function_ invoke__">error</span>(<span class="string">&quot;微信支付创建订单 异常&quot;</span>, [<span class="string">&#x27;description&#x27;</span> =&gt; <span class="variable">$options</span>[<span class="string">&#x27;subject&#x27;</span>], <span class="string">&#x27;outTradeNo&#x27;</span> =&gt; <span class="variable">$options</span>[<span class="string">&#x27;outTradeNo&#x27;</span>], <span class="string">&#x27;money&#x27;</span> =&gt; <span class="variable">$options</span>[<span class="string">&#x27;totalAmount&#x27;</span>], <span class="string">&#x27;TraceAsString&#x27;</span> =&gt; <span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getTraceAsString</span>(), <span class="string">&#x27;msg&#x27;</span> =&gt; <span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>()]);</span><br><span class="line">                <span class="keyword">throw</span> <span class="variable">$e</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 处理结果</span></span><br><span class="line">            <span class="variable">$res</span> = <span class="title function_ invoke__">json_decode</span>(<span class="variable">$resp</span>, <span class="literal">true</span>);</span><br><span class="line">            <span class="variable">$paySign</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getPaySign</span>(<span class="variable">$res</span>[<span class="string">&#x27;prepay_id&#x27;</span>]);</span><br><span class="line">            <span class="keyword">return</span> [</span><br><span class="line">                <span class="string">&#x27;appid&#x27;</span>     =&gt; <span class="variable">$appid</span>,</span><br><span class="line">                <span class="string">&#x27;partnerid&#x27;</span> =&gt; <span class="variable">$mchid</span>,</span><br><span class="line">                <span class="string">&#x27;prepayid&#x27;</span>  =&gt; <span class="variable">$res</span>[<span class="string">&#x27;prepay_id&#x27;</span>],</span><br><span class="line">                <span class="string">&#x27;package&#x27;</span>   =&gt; <span class="string">&quot;Sign=WXPay&quot;</span>,</span><br><span class="line">                <span class="string">&#x27;noncestr&#x27;</span>  =&gt; <span class="variable">$paySign</span>[<span class="string">&#x27;nonceStr&#x27;</span>],</span><br><span class="line">                <span class="string">&#x27;timestamp&#x27;</span> =&gt; <span class="variable">$paySign</span>[<span class="string">&#x27;timeStamp&#x27;</span>],</span><br><span class="line">                <span class="string">&#x27;sign&#x27;</span>      =&gt; <span class="variable">$paySign</span>[<span class="string">&#x27;paySign&#x27;</span>],</span><br><span class="line">            ];</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (\<span class="built_in">Exception</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">            <span class="comment">// 进行错误处理</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$e</span> <span class="keyword">instanceof</span> \GuzzleHttp\<span class="built_in">Exception</span>\RequestException &amp;&amp; <span class="variable">$e</span>-&gt;<span class="title function_ invoke__">hasResponse</span>()) &#123;</span><br><span class="line">                <span class="variable">$r</span> = <span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getResponse</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//echo $e-&gt;getTraceAsString(), PHP_EOL;</span></span><br><span class="line">            <span class="title class_">Log</span>::<span class="title function_ invoke__">channel</span>(<span class="string">&#x27;wechat_notify&#x27;</span>)-&gt;<span class="title function_ invoke__">error</span>(<span class="string">&quot;微信支付创建订单 异常&quot;</span>. <span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>().<span class="string">&quot;|&quot;</span>.<span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getLine</span>());</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">\Exception</span>(<span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * - 微信退单 V3</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $info</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> bool</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">orderRefund</span>(<span class="params"><span class="variable">$info</span></span>): <span class="title">bool</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$promise</span> = <span class="variable language_">$this</span>-&gt;instance</span><br><span class="line">            -&gt;<span class="title function_ invoke__">chain</span>(<span class="string">&#x27;v3/refund/domestic/refunds&#x27;</span>)</span><br><span class="line">            <span class="comment">// 参数整理 请参考：https://pay.weixin.qq.com/docs/merchant/apis/in-app-payment/create.html</span></span><br><span class="line">            -&gt;<span class="title function_ invoke__">postAsync</span>([</span><br><span class="line">                <span class="string">&#x27;json&#x27;</span> =&gt; [</span><br><span class="line">                    <span class="string">&#x27;transaction_id&#x27;</span> =&gt; (<span class="keyword">string</span>)<span class="variable">$info</span>[<span class="string">&#x27;trade_no&#x27;</span>],  <span class="comment">// 交易号</span></span><br><span class="line">                    <span class="string">&#x27;out_refund_no&#x27;</span>  =&gt; (<span class="keyword">string</span>)<span class="variable">$info</span>[<span class="string">&#x27;order_sn&#x27;</span>],  <span class="comment">// 系统内部订单号</span></span><br><span class="line">                    <span class="string">&#x27;amount&#x27;</span>         =&gt; [</span><br><span class="line">                        <span class="string">&#x27;refund&#x27;</span>   =&gt; <span class="variable">$info</span>[<span class="string">&#x27;actual_price&#x27;</span>] * <span class="number">100</span>,  <span class="comment">// 退款金额，单位为分，只能为整数，不能超过原订单支付金额。</span></span><br><span class="line">                        <span class="string">&#x27;total&#x27;</span>    =&gt; <span class="variable">$info</span>[<span class="string">&#x27;actual_price&#x27;</span>] * <span class="number">100</span>,  <span class="comment">// 原支付交易的订单总金额，单位为分，只能为整数</span></span><br><span class="line">                        <span class="string">&#x27;currency&#x27;</span> =&gt; <span class="string">&#x27;CNY&#x27;</span>,</span><br><span class="line">                    ],</span><br><span class="line">                ],</span><br><span class="line">            ])</span><br><span class="line">            -&gt;<span class="title function_ invoke__">then</span>(<span class="built_in">static</span> function(<span class="variable">$response</span>) &#123;</span><br><span class="line">                <span class="comment">// 正常逻辑回调处理</span></span><br><span class="line">                <span class="keyword">echo</span> <span class="variable">$response</span>-&gt;<span class="title function_ invoke__">getBody</span>(), PHP_EOL;</span><br><span class="line">                <span class="keyword">return</span> <span class="variable">$response</span>;</span><br><span class="line">            &#125;)</span><br><span class="line">            -&gt;<span class="title function_ invoke__">otherwise</span>(<span class="built_in">static</span> function(<span class="variable">$e</span>) &#123;</span><br><span class="line">                <span class="comment">// 异常错误处理</span></span><br><span class="line">                <span class="keyword">echo</span> <span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>(), PHP_EOL;</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable">$e</span> <span class="keyword">instanceof</span> \GuzzleHttp\<span class="built_in">Exception</span>\RequestException &amp;&amp; <span class="variable">$e</span>-&gt;<span class="title function_ invoke__">hasResponse</span>()) &#123;</span><br><span class="line">                    <span class="variable">$r</span> = <span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getResponse</span>();</span><br><span class="line">                    <span class="keyword">echo</span> <span class="variable">$r</span>-&gt;<span class="title function_ invoke__">getStatusCode</span>() . <span class="string">&#x27; &#x27;</span> . <span class="variable">$r</span>-&gt;<span class="title function_ invoke__">getReasonPhrase</span>(), PHP_EOL;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="variable">$r</span>-&gt;<span class="title function_ invoke__">getBody</span>(), PHP_EOL, PHP_EOL, PHP_EOL;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">echo</span> <span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getTraceAsString</span>(), PHP_EOL;</span><br><span class="line">            &#125;);</span><br><span class="line">        <span class="comment">// 同步等待</span></span><br><span class="line">        <span class="variable">$promise</span>-&gt;<span class="title function_ invoke__">wait</span>();</span><br><span class="line">        <span class="title class_">Log</span>::<span class="title function_ invoke__">error</span>(<span class="string">&quot;微信退款结果：&quot;</span>.<span class="title function_ invoke__">json_encode</span>(<span class="variable">$promise</span>));</span><br><span class="line">        <span class="variable">$promise</span> = <span class="title function_ invoke__">json_decode</span>(<span class="variable">$promise</span>, <span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$promise</span>[<span class="string">&#x27;status&#x27;</span>]) &amp;&amp; <span class="variable">$promise</span>[<span class="string">&#x27;status&#x27;</span>] == <span class="string">&#x27;SUCCESS&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * - 解析回调数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $requestHead array 请求头</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $requestData array 获取的请求数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">analysisCallBackData</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$requestHead</span>, <span class="keyword">array</span> <span class="variable">$requestData</span></span>): <span class="title">array</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="title class_">Log</span>::<span class="title function_ invoke__">channel</span>(<span class="string">&#x27;wechat_notify&#x27;</span>)-&gt;<span class="title function_ invoke__">info</span>(<span class="string">&quot;requestHead:&quot;</span>. <span class="title function_ invoke__">json_encode</span>(<span class="variable">$requestHead</span>));</span><br><span class="line">        <span class="variable">$inWechatpaySignature</span> = <span class="variable">$requestHead</span>[<span class="string">&#x27;wechatpay-signature&#x27;</span>];</span><br><span class="line">        <span class="variable">$inWechatpayTimestamp</span> = <span class="variable">$requestHead</span>[<span class="string">&#x27;wechatpay-timestamp&#x27;</span>];</span><br><span class="line">        <span class="variable">$inWechatpayNonce</span> = <span class="variable">$requestHead</span>[<span class="string">&#x27;wechatpay-nonce&#x27;</span>];</span><br><span class="line">        <span class="variable">$inBody</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;php://input&#x27;</span>);<span class="comment">// json类型字符串 请根据实际情况获取，例如: file_get_contents(&#x27;php://input&#x27;);</span></span><br><span class="line">        <span class="title class_">Log</span>::<span class="title function_ invoke__">channel</span>(<span class="string">&#x27;wechat_notify&#x27;</span>)-&gt;<span class="title function_ invoke__">info</span>(<span class="string">&quot;inBody:&quot;</span>. <span class="title function_ invoke__">json_encode</span>(<span class="variable">$inBody</span>));</span><br><span class="line">        <span class="variable">$apiv3Key</span> = <span class="title function_ invoke__">config</span>(<span class="string">&#x27;wechat.apiv3Key&#x27;</span>, <span class="string">&#x27;&#x27;</span>);<span class="comment">// 在商户平台上设置的APIv3密钥</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据通知的平台证书序列号，查询本地平台证书文件【**注意】这个证书也是通过命令生成的那个证书</span></span><br><span class="line">        <span class="variable">$wechatPaySerialFilePath</span> = <span class="string">&quot;file://&quot;</span>.<span class="title function_ invoke__">config_path</span>().<span class="string">&#x27;merchant/cert.pem&#x27;</span>;</span><br><span class="line">        <span class="variable">$platformPublicKeyInstance</span> = <span class="title class_">Rsa</span>::<span class="keyword">from</span>(<span class="variable">$wechatPaySerialFilePath</span>, <span class="title class_">Rsa</span>::<span class="variable constant_">KEY_TYPE_PUBLIC</span>);</span><br><span class="line">        <span class="comment">// 检查通知时间偏移量，允许5分钟之内的偏移</span></span><br><span class="line">        <span class="variable">$timeOffsetStatus</span> = <span class="number">300</span> &gt;= <span class="title function_ invoke__">abs</span>(<span class="title class_">Formatter</span>::<span class="title function_ invoke__">timestamp</span>() - (<span class="keyword">int</span>)<span class="variable">$inWechatpayTimestamp</span>);</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable">$timeOffsetStatus</span>) &#123;<span class="comment">//超过5分钟的订单</span></span><br><span class="line">            <span class="title class_">Log</span>::<span class="title function_ invoke__">channel</span>(<span class="string">&#x27;wechat_notify&#x27;</span>)-&gt;<span class="title function_ invoke__">info</span>(<span class="string">&#x27;超过5分钟才回调的信息&#x27;</span>. <span class="title function_ invoke__">json_encode</span>([<span class="string">&#x27;requestHead&#x27;</span> =&gt; <span class="variable">$requestHead</span>, <span class="string">&#x27;requestData&#x27;</span> =&gt; <span class="variable">$requestData</span>]));</span><br><span class="line">            <span class="keyword">return</span> [];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$verifiedStatus</span> = <span class="title class_">Rsa</span>::<span class="title function_ invoke__">verify</span>(</span><br><span class="line">        // 构造验签名串</span><br><span class="line">            <span class="title class_">Formatter</span>::<span class="title function_ invoke__">joinedByLineFeed</span>(<span class="variable">$inWechatpayTimestamp</span>, <span class="variable">$inWechatpayNonce</span>, <span class="variable">$inBody</span>),</span><br><span class="line">            <span class="variable">$inWechatpaySignature</span>,</span><br><span class="line">            <span class="variable">$platformPublicKeyInstance</span></span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable">$verifiedStatus</span>) &#123;</span><br><span class="line">            <span class="title class_">Log</span>::<span class="title function_ invoke__">channel</span>(<span class="string">&#x27;wechat_notify&#x27;</span>)-&gt;<span class="title function_ invoke__">info</span>(<span class="string">&#x27;验证签名失败&#x27;</span>.<span class="title function_ invoke__">json_encode</span>([<span class="string">&#x27;requestHead&#x27;</span> =&gt; <span class="variable">$requestHead</span>, <span class="string">&#x27;requestData&#x27;</span> =&gt; <span class="variable">$requestData</span>]));</span><br><span class="line">            <span class="keyword">return</span> [];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$timeOffsetStatus</span> &amp;&amp; <span class="variable">$verifiedStatus</span>) &#123;</span><br><span class="line">            <span class="comment">// 转换通知的JSON文本消息为PHP Array数组</span></span><br><span class="line">            <span class="variable">$inBodyArray</span> = (<span class="keyword">array</span>)<span class="title function_ invoke__">json_decode</span>(<span class="variable">$inBody</span>, <span class="literal">true</span>);</span><br><span class="line">            <span class="comment">// 使用PHP7的数据解构语法，从Array中解构并赋值变量</span></span><br><span class="line">            [<span class="string">&#x27;resource&#x27;</span> =&gt; [</span><br><span class="line">                <span class="string">&#x27;ciphertext&#x27;</span>      =&gt; <span class="variable">$ciphertext</span>,</span><br><span class="line">                <span class="string">&#x27;nonce&#x27;</span>           =&gt; <span class="variable">$nonce</span>,</span><br><span class="line">                <span class="string">&#x27;associated_data&#x27;</span> =&gt; <span class="variable">$aad</span></span><br><span class="line">            ]] = <span class="variable">$inBodyArray</span>;</span><br><span class="line">            <span class="comment">// 加密文本消息解密</span></span><br><span class="line">            <span class="variable">$inBodyResource</span> = <span class="title class_">AesGcm</span>::<span class="title function_ invoke__">decrypt</span>(<span class="variable">$ciphertext</span>, <span class="variable">$apiv3Key</span>, <span class="variable">$nonce</span>, <span class="variable">$aad</span>);</span><br><span class="line">            <span class="title class_">Log</span>::<span class="title function_ invoke__">channel</span>(<span class="string">&quot;wechat_notify&quot;</span>)-&gt;<span class="title function_ invoke__">info</span>(<span class="string">&quot;回调解密后的数据：&quot;</span>.<span class="variable">$inBodyResource</span>);</span><br><span class="line">            <span class="comment">// 把解密后的文本转换为PHP Array数组</span></span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">array</span>)<span class="title function_ invoke__">json_decode</span>(<span class="variable">$inBodyResource</span>, <span class="literal">true</span>);</span><br><span class="line">            <span class="comment">// 返回的示例数据</span></span><br><span class="line">            <span class="comment">//            &#123;</span></span><br><span class="line">            <span class="comment">//                &quot;mchid&quot;: &quot;1635059363&quot;,</span></span><br><span class="line">            <span class="comment">//                &quot;appid&quot;: &quot;wx7dbfd345da91dc3d&quot;,</span></span><br><span class="line">            <span class="comment">//                &quot;out_trade_no&quot;: &quot;jprj20240820170409725215853&quot;,</span></span><br><span class="line">            <span class="comment">//                &quot;transaction_id&quot;: &quot;4200002354202408200706648259&quot;,</span></span><br><span class="line">            <span class="comment">//                &quot;trade_type&quot;: &quot;APP&quot;,</span></span><br><span class="line">            <span class="comment">//                &quot;trade_state&quot;: &quot;SUCCESS&quot;,</span></span><br><span class="line">            <span class="comment">//                &quot;trade_state_desc&quot;: &quot;支付成功&quot;,</span></span><br><span class="line">            <span class="comment">//                &quot;bank_type&quot;: &quot;OTHERS&quot;,</span></span><br><span class="line">            <span class="comment">//                &quot;attach&quot;: &quot;&quot;,</span></span><br><span class="line">            <span class="comment">//                &quot;success_time&quot;: &quot;2024-08-20T17:04:16+08:00&quot;,</span></span><br><span class="line">            <span class="comment">//                &quot;payer&quot;: &#123;</span></span><br><span class="line">            <span class="comment">//                    &quot;openid&quot;: &quot;o1pFV6VnFfmWFz6VgilbErtxSalk&quot;</span></span><br><span class="line">            <span class="comment">//                &#125;,</span></span><br><span class="line">            <span class="comment">//                &quot;amount&quot;: &#123;</span></span><br><span class="line">            <span class="comment">//                    &quot;total&quot;: 30,</span></span><br><span class="line">            <span class="comment">//                    &quot;payer_total&quot;: 30,</span></span><br><span class="line">            <span class="comment">//                    &quot;currency&quot;: &quot;CNY&quot;,</span></span><br><span class="line">            <span class="comment">//                    &quot;payer_currency&quot;: &quot;CNY&quot;</span></span><br><span class="line">            <span class="comment">//                &#125;</span></span><br><span class="line">            <span class="comment">//            &#125;</span></span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> [];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ============== 》【微信V3】回调触发《====================</span></span><br><span class="line"><span class="comment">     * 【微信V3】回调入口</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> \think\db\exception\DbException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">wechatnotify</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// v3需要获取header信息</span></span><br><span class="line">        <span class="variable">$headers</span> = <span class="variable language_">$this</span>-&gt;request-&gt;<span class="title function_ invoke__">header</span>();</span><br><span class="line">        <span class="comment">// 获取body信息</span></span><br><span class="line">        <span class="variable">$inBody</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;php://input&quot;</span>);</span><br><span class="line">        <span class="comment">// 解析回调数据</span></span><br><span class="line">        <span class="variable">$parsedData</span> = (<span class="keyword">new</span> <span class="title class_">WechatPayServiceV3</span>())-&gt;<span class="title function_ invoke__">analysisCallBackData</span>(<span class="variable">$headers</span>, <span class="title function_ invoke__">json_decode</span>(<span class="variable">$inBody</span>, <span class="literal">true</span>));</span><br><span class="line">        <span class="comment">// 解析后的数据</span></span><br><span class="line"><span class="comment">//        $parsedData = [</span></span><br><span class="line"><span class="comment">//            &#x27;trade_state&#x27; =&gt; &quot;SUCCESS&quot;,</span></span><br><span class="line"><span class="comment">//            &#x27;transaction_id&#x27; =&gt; &quot;20245543435551&quot;,</span></span><br><span class="line"><span class="comment">//            &#x27;out_trade_no&#x27; =&gt; &quot;ysj20241008140356417220366&quot;</span></span><br><span class="line"><span class="comment">//        ];</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>php</category>
      </categories>
      <tags>
        <tag>php</tag>
      </tags>
  </entry>
  <entry>
    <title>layui table列属性以、判断以及加css属性</title>
    <url>/2023/09/13/layui-table%E5%88%97%E5%B1%9E%E6%80%A7%E4%BB%A5%E3%80%81%E5%88%A4%E6%96%AD%E4%BB%A5%E5%8F%8A%E5%8A%A0css%E5%B1%9E%E6%80%A7/</url>
    <content><![CDATA[<blockquote>
<p>这里介绍layui table前端渲染、判断、css属性添加等处理方法，在遇到需要判断的某些列值的时候可以加入这种方式</p>
</blockquote>
<p>在layui.js的 table 组件中，cols 属性是用于定义表格列的配置项。<br>每个列的配置都是一个对象，包含了一些属性，下面是一些常用的属性及其作用：</p>
<ul>
<li>field：列字段名，对应数据源中的属性名。</li>
<li>title：列标题，显示在表头中。</li>
<li>width：列宽度，可以是数字或百分比。</li>
<li>sort：是否开启排序功能，可选值为 true 或者 false。</li>
<li>align：列的水平对齐方式，可选值为 left、center 或 right。</li>
<li>templet：自定义列模板，可以是一个函数或者一个 HTML 字符串。</li>
<li>toolbar：绑定工具条，可以是一个 HTML 字符串或者一个选择器。</li>
<li>edit：是否开启单元格编辑功能，可选值为 text、select 或者 checkbox。</li>
<li>fixed：列固定，可选值为 left、right 或者 true（固定在左侧）或者 true（固定在右侧）。</li>
</ul>
<span id="more"></span>

<p>处理实例：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        $(<span class="string">&#x27;#OplogData&#x27;</span>).<span class="title function_ invoke__">layTable</span>(&#123;</span><br><span class="line">            <span class="attr">even</span>: <span class="literal">true</span>, <span class="attr">height</span>: <span class="string">&#x27;full&#x27;</span>,</span><br><span class="line">            <span class="attr">sort</span>: &#123;<span class="attr">field</span>: <span class="string">&#x27;id&#x27;</span>, <span class="attr">type</span>: <span class="string">&#x27;desc&#x27;</span>&#125;,</span><br><span class="line">            <span class="attr">cols</span>: [[   // 字段渲染板块</span><br><span class="line">                &#123;<span class="attr">checkbox</span>: <span class="literal">true</span>&#125;,</span><br><span class="line">                &#123;<span class="attr">field</span>: <span class="string">&#x27;id&#x27;</span>, <span class="attr">title</span>: <span class="string">&#x27;ID&#x27;</span>, <span class="attr">width</span>: <span class="number">60</span>, <span class="attr">sort</span>: <span class="literal">true</span>, <span class="attr">align</span>: <span class="string">&#x27;center&#x27;</span>&#125;,</span><br><span class="line">                &#123;<span class="attr">field</span>: <span class="string">&#x27;uid&#x27;</span>, <span class="attr">title</span>: <span class="string">&#x27;X-UID&#x27;</span>, <span class="attr">minWidth</span>: <span class="number">60</span>, <span class="attr">sort</span>: <span class="literal">true</span>, <span class="attr">align</span>: <span class="string">&#x27;center&#x27;</span>&#125;,</span><br><span class="line">                &#123;<span class="attr">field</span>: <span class="string">&#x27;nickname&#x27;</span>, <span class="attr">title</span>: <span class="string">&#x27;昵称&#x27;</span>, <span class="attr">minWidth</span>: <span class="number">80</span>, <span class="attr">sort</span>: <span class="literal">true</span>, <span class="attr">align</span>: <span class="string">&#x27;center&#x27;</span>&#125;,</span><br><span class="line">                &#123;<span class="attr">field</span>: <span class="string">&#x27;phone&#x27;</span>, <span class="attr">title</span>: <span class="string">&#x27;手机号码&#x27;</span>, <span class="attr">minWidth</span>: <span class="number">50</span>, <span class="attr">templet</span>: <span class="string">&#x27;#ViewPhoneTpl&#x27;</span>, <span class="attr">event</span>: <span class="string">&quot;viewPhone&quot;</span>&#125;,</span><br><span class="line">                &#123;<span class="attr">field</span>: <span class="string">&#x27;channel&#x27;</span>, <span class="attr">title</span>: <span class="string">&#x27;渠道&#x27;</span>, <span class="attr">minWidth</span>: <span class="number">80</span>&#125;,</span><br><span class="line">                &#123;<span class="attr">field</span>: <span class="string">&#x27;origin_channel&#x27;</span>, <span class="attr">title</span>: <span class="string">&#x27;归因渠道&#x27;</span>, <span class="attr">minWidth</span>: <span class="number">30</span>&#125;,</span><br><span class="line">                &#123;<span class="attr">field</span>: <span class="string">&#x27;system&#x27;</span>, <span class="attr">title</span>: <span class="string">&#x27;操作系统&#x27;</span>, <span class="attr">minWidth</span>: <span class="number">60</span>&#125;,</span><br><span class="line">                &#123;<span class="attr">field</span>: <span class="string">&#x27;versionname&#x27;</span>, <span class="attr">title</span>: <span class="string">&#x27;APP版本&#x27;</span>, <span class="attr">minWidth</span>: <span class="number">50</span>&#125;,</span><br><span class="line">                &#123;<span class="attr">field</span>: <span class="string">&#x27;versioncode&#x27;</span>, <span class="attr">title</span>: <span class="string">&#x27;APP版本值&#x27;</span>, <span class="attr">minWidth</span>: <span class="number">50</span>&#125;,</span><br><span class="line">                &#123;<span class="attr">field</span>: <span class="string">&#x27;is_vip&#x27;</span>, <span class="attr">title</span>: <span class="string">&#x27;VIP状态&#x27;</span>, <span class="attr">minWidth</span>: <span class="number">40</span>, <span class="attr">align</span>: <span class="string">&#x27;center&#x27;</span>&#125;,</span><br><span class="line">                &#123;<span class="attr">field</span>: <span class="string">&#x27;vip_type&#x27;</span>, <span class="attr">title</span>: <span class="string">&#x27;VIP类型&#x27;</span>, <span class="attr">minWidth</span>: <span class="number">40</span>, <span class="attr">align</span>: <span class="string">&#x27;center&#x27;</span>&#125;,</span><br><span class="line">                &#123;<span class="attr">field</span>: <span class="string">&#x27;created_at&#x27;</span>, <span class="attr">title</span>: <span class="string">&#x27;添加时间&#x27;</span>, <span class="attr">minWidth</span>: <span class="number">160</span>, <span class="attr">align</span>: <span class="string">&#x27;center&#x27;</span>&#125;,</span><br><span class="line">                &#123;<span class="attr">field</span>: <span class="string">&#x27;expired_at&#x27;</span>, <span class="attr">title</span>: <span class="string">&#x27;vip到期时间&#x27;</span>, <span class="attr">minWidth</span>: <span class="number">160</span>, <span class="attr">align</span>: <span class="string">&#x27;center&#x27;</span>&#125;,</span><br><span class="line">                &#123;<span class="attr">field</span>: <span class="string">&#x27;state&#x27;</span>, <span class="attr">title</span>: <span class="string">&#x27;状态&#x27;</span>, <span class="attr">minWidth</span>: <span class="number">110</span>, <span class="attr">align</span>: <span class="string">&#x27;center&#x27;</span>, <span class="attr">templet</span>: <span class="string">&#x27;#StatusSwitchTpl&#x27;</span>&#125;,</span><br><span class="line">                &#123;<span class="attr">toolbar</span>: <span class="string">&#x27;#toolbar&#x27;</span>, <span class="attr">title</span>: <span class="string">&#x27;操作面板&#x27;</span>, <span class="attr">minWidth</span>: <span class="number">250</span>, <span class="attr">align</span>: <span class="string">&#x27;center&#x27;</span>&#125;,</span><br><span class="line">            ]],</span><br><span class="line">            // 对某些字段的处理 判断、css属性</span><br><span class="line">            <span class="attr">done</span>: function(res, curr, count) &#123;</span><br><span class="line">                $(<span class="string">&quot;[data-field=&#x27;is_vip&#x27;]&quot;</span>).<span class="title function_ invoke__">children</span>().<span class="title function_ invoke__">each</span>(function() &#123;</span><br><span class="line">                    <span class="keyword">if</span> ($(this).<span class="title function_ invoke__">text</span>() == <span class="number">1</span>) &#123;</span><br><span class="line">                        $(this).<span class="title function_ invoke__">text</span>(<span class="string">&quot;是&quot;</span>).<span class="title function_ invoke__">css</span>(<span class="string">&#x27;color&#x27;</span>, <span class="string">&#x27;red&#x27;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> ($(this).<span class="title function_ invoke__">text</span>() == <span class="number">0</span>) &#123;</span><br><span class="line">                        $(this).<span class="title function_ invoke__">text</span>(<span class="string">&quot;否&quot;</span>).<span class="title function_ invoke__">css</span>(<span class="string">&#x27;color&#x27;</span>, <span class="string">&#x27;#ccc&#x27;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="comment">// 会员状态 0：非会员   1=&gt;天 2=&gt;月 3=&gt;季 4=&gt;年 6=&gt;手动 10=&gt;终身</span></span><br><span class="line">                $(<span class="string">&quot;[data-field=&#x27;vip_type&#x27;]&quot;</span>).<span class="title function_ invoke__">children</span>().<span class="title function_ invoke__">each</span>(function ()&#123;</span><br><span class="line">                    <span class="keyword">if</span> ($(this).<span class="title function_ invoke__">text</span>() == <span class="number">1</span>) &#123;</span><br><span class="line">                        $(this).<span class="title function_ invoke__">text</span>(<span class="string">&quot;天会员&quot;</span>).<span class="title function_ invoke__">css</span>(<span class="string">&#x27;color&#x27;</span>, <span class="string">&#x27;#00FF00&#x27;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> ($(this).<span class="title function_ invoke__">text</span>() == <span class="number">2</span>) &#123;</span><br><span class="line">                        $(this).<span class="title function_ invoke__">text</span>(<span class="string">&quot;月会员&quot;</span>).<span class="title function_ invoke__">css</span>(<span class="string">&#x27;color&#x27;</span>, <span class="string">&#x27;#008000&#x27;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> ($(this).<span class="title function_ invoke__">text</span>() == <span class="number">3</span>) &#123;</span><br><span class="line">                        $(this).<span class="title function_ invoke__">text</span>(<span class="string">&quot;季会员&quot;</span>).<span class="title function_ invoke__">css</span>(<span class="string">&#x27;color&#x27;</span>, <span class="string">&#x27;#FFFF00&#x27;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> ($(this).<span class="title function_ invoke__">text</span>() == <span class="number">4</span>) &#123;</span><br><span class="line">                        $(this).<span class="title function_ invoke__">text</span>(<span class="string">&quot;年会员&quot;</span>).<span class="title function_ invoke__">css</span>(<span class="string">&#x27;color&#x27;</span>, <span class="string">&#x27;#FF8C00&#x27;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> ($(this).<span class="title function_ invoke__">text</span>() == <span class="number">6</span>) &#123;</span><br><span class="line">                        $(this).<span class="title function_ invoke__">text</span>(<span class="string">&quot;临时会员&quot;</span>).<span class="title function_ invoke__">css</span>(<span class="string">&#x27;color&#x27;</span>, <span class="string">&#x27;#20B2AA&#x27;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> ($(this).<span class="title function_ invoke__">text</span>() == <span class="number">10</span>) &#123;</span><br><span class="line">                        $(this).<span class="title function_ invoke__">text</span>(<span class="string">&quot;永久会员&quot;</span>).<span class="title function_ invoke__">css</span>(<span class="string">&#x27;color&#x27;</span>, <span class="string">&#x27;#DC143C&#x27;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> ($(this).<span class="title function_ invoke__">text</span>() == <span class="number">0</span>) &#123;</span><br><span class="line">                        $(this).<span class="title function_ invoke__">text</span>(<span class="string">&quot;暂无&quot;</span>).<span class="title function_ invoke__">css</span>(<span class="string">&#x27;color&#x27;</span>, <span class="string">&#x27;#ccc&#x27;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 监听点击事件</span></span><br><span class="line">        layui.table.<span class="title function_ invoke__">on</span>(<span class="string">&#x27;tool(table)&#x27;</span>, function (result) &#123;</span><br><span class="line">            let event = result.event;</span><br><span class="line">            let row = result.data;</span><br><span class="line">            <span class="keyword">if</span> (event === <span class="string">&quot;viewPhone&quot;</span>) &#123;</span><br><span class="line">                <span class="comment">// 处理你的业务逻辑</span></span><br><span class="line">                layer.<span class="title function_ invoke__">confirm</span>(<span class="string">&#x27;确定要查看该用户手机号码吗？&#x27;</span>, &#123;</span><br><span class="line">                    <span class="attr">btn</span>: [<span class="string">&#x27;确定&#x27;</span>, <span class="string">&#x27;取消&#x27;</span>] //按钮</span><br><span class="line">                &#125;, function () &#123;</span><br><span class="line">                    $.form.<span class="title function_ invoke__">load</span>(<span class="string">&quot;&#123;:url(&#x27;viewphone&#x27;)&#125;&quot;</span>, &#123;<span class="attr">id</span>: row.id&#125;, <span class="string">&#x27;post&#x27;</span>, function (ret) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (ret.code &lt; <span class="number">1</span>) &#123;</span><br><span class="line">                            $.msg.<span class="title function_ invoke__">error</span>(ret.info, <span class="number">3</span>, function () &#123;</span><br><span class="line">                                layer.<span class="title function_ invoke__">alert</span>(ret.info, &#123;<span class="attr">icon</span>: <span class="number">1</span>&#125;);</span><br><span class="line">                            &#125;);</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            result.<span class="title function_ invoke__">update</span>(&#123;</span><br><span class="line">                                <span class="string">&#x27;phone&#x27;</span>: ret.data</span><br><span class="line">                            &#125;);</span><br><span class="line">                        &#125;</span><br><span class="line">                        layer.<span class="title function_ invoke__">closeAll</span>();</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                    &#125;, <span class="literal">false</span>);</span><br><span class="line">                &#125;, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                    layer.<span class="title function_ invoke__">closeAll</span>();</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 数据状态切换操作</span></span><br><span class="line">        layui.form.<span class="title function_ invoke__">on</span>(<span class="string">&#x27;switch(StatusSwitch)&#x27;</span>, function (obj) &#123;</span><br><span class="line">            $.form.<span class="title function_ invoke__">load</span>(<span class="string">&quot;&#123;:url(&#x27;state&#x27;)&#125;&quot;</span>, &#123;</span><br><span class="line">                <span class="attr">id</span>: obj.value,</span><br><span class="line">                <span class="attr">state</span>: obj.elem.checked &gt; <span class="number">0</span> ? <span class="number">1</span> : <span class="number">2</span></span><br><span class="line">            &#125;, <span class="string">&#x27;post&#x27;</span>, function (ret) &#123;</span><br><span class="line">                <span class="keyword">if</span> (ret.code &lt; <span class="number">1</span>) $.msg.<span class="title function_ invoke__">error</span>(ret.info, <span class="number">3</span>, function () &#123;</span><br><span class="line">                    $(<span class="string">&#x27;#RoleData&#x27;</span>).<span class="title function_ invoke__">trigger</span>(<span class="string">&#x27;reload&#x27;</span>); <span class="comment">// 操作异常时重载数据</span></span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;, <span class="literal">false</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>jquery</category>
      </categories>
      <tags>
        <tag>jquery</tag>
      </tags>
  </entry>
  <entry>
    <title>pyenv安装python版本被墙问题</title>
    <url>/2021/04/22/pyenv-%E5%AE%89%E8%A3%85python%E7%89%88%E6%9C%AC%E8%A2%AB%E5%A2%99%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><p>在python虚拟环境搭建的很多时候都用到了pyenv，pyenv主要用于管理python的不同版本，便于在开发或者线上环境下随时切换，我们发现在利用pyenv install 3.7.5安装python版本的很多时候都被墙了，由于是这个命令是直接拉取的国外资源，所以在执行这个命令的时候基本不成功</p>
<h3 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h3><p>1、直接访问python官网，找到Downloads下的Source code，就能看到各种python的版本<br><img src="/../img/python-pyenv-01.png" alt="python"><br>官网地址：<a href="https://www.python.org/downloads/source/">https://www.python.org/downloads/source/</a></p>
<span id="more"></span>

<p>2、需下载Download XZ compressed source tarball这个资源<br>3、执行下载</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">wget https:<span class="comment">//www.python.org/ftp/python/3.9.4/Python-3.9.4.tar.xz -P ~/.pyenv/cache</span></span><br></pre></td></tr></table></figure>
<p>注意：</p>
<ul>
<li>需要下载至~&#x2F;.pyenv&#x2F;cache目录下</li>
<li>需要下载.tar.xz后缀文件</li>
</ul>
<p>4、安装 </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">pyenv install <span class="number">3.9</span>.<span class="number">4</span></span><br></pre></td></tr></table></figure>

<p>说明：之前执行这个命令为什么不行而现在可以了，是因为pyenv install 这个命令首先会去扫描~&#x2F;.pyenv&#x2F;cache下是否存在下载资源，不存在的时候才会去远程拉取，存在资源文件就直接安装。<br>注意下载的版本，此时就安装对应版本<br><img src="/../img/python-pyenv-02.png"></p>
]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>php框架中的.env文件是如何加载的</title>
    <url>/2020/07/10/php%E6%A1%86%E6%9E%B6%E4%B8%AD%E7%9A%84-env%E6%96%87%E4%BB%B6%E6%98%AF%E5%A6%82%E4%BD%95%E5%8A%A0%E8%BD%BD%E7%9A%84/</url>
    <content><![CDATA[<h3 id="设置国内源"><a href="#设置国内源" class="headerlink" title="设置国内源"></a>设置国内源</h3><p>阿里云镜像设置</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">composer config -g repo.packagist composer https:<span class="comment">//mirrors.aliyun.com/composer/</span></span><br></pre></td></tr></table></figure>

<h3 id="拉取依赖"><a href="#拉取依赖" class="headerlink" title="拉取依赖"></a>拉取依赖</h3><p>拉取名字为<code>vlucas/phpdotenv</code>的依赖<br>添加composer.json文件中的require中添加</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;require&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;php&quot;</span>: <span class="string">&quot;^7.2&quot;</span>,</span><br><span class="line">        <span class="string">&quot;ext-json&quot;</span>: <span class="string">&quot;*&quot;</span>,</span><br><span class="line">        <span class="string">&quot;monolog/monolog&quot;</span>: <span class="string">&quot;^2.1&quot;</span>,</span><br><span class="line">        <span class="string">&quot;php-di/php-di&quot;</span>: <span class="string">&quot;^6.1&quot;</span>,</span><br><span class="line">        <span class="string">&quot;predis/predis&quot;</span>: <span class="string">&quot;^1.1&quot;</span>,</span><br><span class="line">        <span class="string">&quot;rmccue/requests&quot;</span>: <span class="string">&quot;^1.7&quot;</span>,</span><br><span class="line">        <span class="string">&quot;slim/psr7&quot;</span>: <span class="string">&quot;^1.1&quot;</span>,</span><br><span class="line">        <span class="string">&quot;slim/slim&quot;</span>: <span class="string">&quot;^4.5&quot;</span>,</span><br><span class="line">        <span class="string">&quot;slim/twig-view&quot;</span>: <span class="string">&quot;^3.0&quot;</span>,</span><br><span class="line">        <span class="string">&quot;twig/twig&quot;</span>: <span class="string">&quot;^2.12&quot;</span>,</span><br><span class="line">        <span class="string">&quot;vlucas/phpdotenv&quot;</span>: <span class="string">&quot;^5.0&quot;</span></span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>
<span id="more"></span>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">composer update</span><br></pre></td></tr></table></figure>

<h3 id="使用依赖"><a href="#使用依赖" class="headerlink" title="使用依赖"></a>使用依赖</h3><p>在项目中新建文件，使用依赖，我在app&#x2F;下新建一个文件名为env.php的文件，内容为：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="variable">$dotenv</span> = <span class="title class_">Dotenv\Dotenv</span>::<span class="title function_ invoke__">createImmutable</span>(<span class="title function_ invoke__">dirname</span>(<span class="keyword">__DIR__</span>));</span><br><span class="line">    <span class="variable">$dotenv</span>-&gt;<span class="title function_ invoke__">load</span>();</span><br><span class="line">&#125; <span class="keyword">catch</span> (\Dotenv\<span class="built_in">Exception</span>\InvalidPathException <span class="variable">$e</span>) &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="入口加载"><a href="#入口加载" class="headerlink" title="入口加载"></a>入口加载</h3><p>新建的文件env.php需在框架的入口文件中加载，否则不会生效<br>我目前使用的是Slim框架，入口文件在public下的index.php,注意，需要首先加载env.php文件</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">declare</span>(strict_types=<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Application</span>\<span class="title">Handlers</span>\<span class="title">HttpErrorHandler</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Application</span>\<span class="title">Handlers</span>\<span class="title">ShutdownHandler</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Application</span>\<span class="title">ResponseEmitter</span>\<span class="title">ResponseEmitter</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">DI</span>\<span class="title">ContainerBuilder</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Slim</span>\<span class="title">Factory</span>\<span class="title">AppFactory</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Slim</span>\<span class="title">Factory</span>\<span class="title">ServerRequestCreatorFactory</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">require</span> <span class="keyword">__DIR__</span> . <span class="string">&#x27;/../vendor/autoload.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Instantiate PHP-DI ContainerBuilder</span></span><br><span class="line"><span class="variable">$containerBuilder</span> = <span class="keyword">new</span> <span class="title class_">ContainerBuilder</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="literal">false</span>) &#123; <span class="comment">// Should be set to true in production</span></span><br><span class="line">	<span class="variable">$containerBuilder</span>-&gt;<span class="title function_ invoke__">enableCompilation</span>(<span class="keyword">__DIR__</span> . <span class="string">&#x27;/../var/cache&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// load .env 首先加载</span></span><br><span class="line"><span class="keyword">require</span> <span class="keyword">__DIR__</span> . <span class="string">&#x27;/../app/env.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Set up settings</span></span><br><span class="line"><span class="variable">$settings</span> = <span class="keyword">require</span> <span class="keyword">__DIR__</span> . <span class="string">&#x27;/../app/settings.php&#x27;</span>;</span><br><span class="line"><span class="variable">$settings</span>(<span class="variable">$containerBuilder</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Set up dependencies</span></span><br><span class="line"><span class="variable">$dependencies</span> = <span class="keyword">require</span> <span class="keyword">__DIR__</span> . <span class="string">&#x27;/../app/dependencies.php&#x27;</span>;</span><br><span class="line"><span class="variable">$dependencies</span>(<span class="variable">$containerBuilder</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Set up repositories</span></span><br><span class="line"><span class="variable">$repositories</span> = <span class="keyword">require</span> <span class="keyword">__DIR__</span> . <span class="string">&#x27;/../app/repositories.php&#x27;</span>;</span><br><span class="line"><span class="variable">$repositories</span>(<span class="variable">$containerBuilder</span>);</span><br></pre></td></tr></table></figure>

<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p>这时候尝试在根目录下新建.env文件，设置常量，通过$_ENV[‘’]就能获取到.env中的变量 </p>
<p>.env</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 版本</span></span><br><span class="line">VERSION = <span class="number">1.0</span>.<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## db</span></span><br><span class="line">DB_HOST=<span class="number">192.168</span>.<span class="number">1.252</span></span><br><span class="line">DB_DATABASE=knight_s</span><br><span class="line">DB_USER=root</span><br><span class="line">DB_PASSWORD=dev2312</span><br></pre></td></tr></table></figure>

<p>获取</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title function_ invoke__">PDO</span>(<span class="title function_ invoke__">sprintf</span>(<span class="string">&#x27;mysql:host=%s;dbname=%s&#x27;</span>,<span class="variable">$_ENV</span>[<span class="string">&#x27;DB_HOST&#x27;</span>],<span class="variable">$_ENV</span>[<span class="string">&#x27;DB_DATABASE&#x27;</span>]),  <span class="variable">$_ENV</span>[<span class="string">&#x27;DB_USER&#x27;</span>], <span class="variable">$_ENV</span>[<span class="string">&#x27;DB_PASSWORD&#x27;</span>])</span><br></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>php</category>
      </categories>
      <tags>
        <tag>php</tag>
      </tags>
  </entry>
  <entry>
    <title>python3快速生成model模型字段</title>
    <url>/2021/07/01/python3%E5%BF%AB%E9%80%9F%E7%94%9F%E6%88%90model%E6%A8%A1%E5%9E%8B%E5%AD%97%E6%AE%B5/</url>
    <content><![CDATA[<p>针对于python3快速生成model模型字段，指定在python3以上</p>
<h3 id="安装sqlacodegen"><a href="#安装sqlacodegen" class="headerlink" title="安装sqlacodegen"></a>安装sqlacodegen</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">pip install sqlacodegen</span><br></pre></td></tr></table></figure>

<h3 id="执行命令，生成model-py文件"><a href="#执行命令，生成model-py文件" class="headerlink" title="执行命令，生成model.py文件"></a>执行命令，生成model.py文件</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">sqlacodegen --outfile ~/路径/model.py mysql+pymysql:<span class="comment">//root:123456@192.168.1.252:3306/op_erp_db --tables 数据库表名</span></span><br></pre></td></tr></table></figure>
<span id="more"></span>

<h3 id="执行实例"><a href="#执行实例" class="headerlink" title="执行实例"></a>执行实例</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># 按数据库表生成model</span></span><br><span class="line"></span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line">def <span class="title function_ invoke__">run</span>():</span><br><span class="line">    <span class="comment">#db_url = input(&quot;please input the db url: &quot;)</span></span><br><span class="line">    <span class="comment">#tables = input(&quot;please input table: &quot;)</span></span><br><span class="line"></span><br><span class="line">    db_url = <span class="string">&quot;mysql+pymysql://root:123456@192.168.1.252:3306/op_erp_db&quot;</span> <span class="comment"># 数据库信息</span></span><br><span class="line">    tables = <span class="string">&quot;product_attributes&quot;</span>  <span class="comment">#表名</span></span><br><span class="line"></span><br><span class="line">    command = <span class="string">&quot;sqlacodegen --outfile ~/data/htdocs/foreign_way_platform/tools/model.py &#123;db_url&#125; --tables &#123;tables&#125;&quot;</span>.<span class="title function_ invoke__">format</span>(db_url=db_url, tables=tables)</span><br><span class="line">    os.<span class="title function_ invoke__">system</span>(command)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 生成 model</span></span><br><span class="line">    <span class="keyword">print</span>(<span class="string">&quot;generator model class complete !&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="title function_ invoke__">run</span>()</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>php结合php-ampqlib做rabbitMQ队列</title>
    <url>/2023/03/21/php%E7%BB%93%E5%90%88php-ampqlib%E5%81%9ArabbitMQ%E9%98%9F%E5%88%97/</url>
    <content><![CDATA[<h3 id="内容概述"><a href="#内容概述" class="headerlink" title="内容概述"></a>内容概述</h3><p>php使用rabbitMQ做消息队列，这是一种常见的异步的工作方式，在很多的工作场景都能遇到，在阅读该文章之前，需要提前了解rabbitMQ的工作原理以及下面的几种工作模式，这样更有助于阅读这篇文章，以下代码是通过自行封装对amqplib的各种模式的使用，便于记忆，在此记录。</p>
<h3 id="composer安装扩展"><a href="#composer安装扩展" class="headerlink" title="composer安装扩展"></a>composer安装扩展</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">composer安装</span><br><span class="line">composer <span class="keyword">require</span>  PHP-amqplib/PHP-amqplib</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<h3 id="代码展示"><a href="#代码展示" class="headerlink" title="代码展示"></a>代码展示</h3><h4 id="1、加入队列"><a href="#1、加入队列" class="headerlink" title="1、加入队列"></a>1、加入队列</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//RabbitMQ使用</span></span><br><span class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test4</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">       <span class="variable">$client</span> = <span class="title class_">Producer</span>::<span class="title function_ invoke__">getInstance</span>();</span><br><span class="line">       <span class="variable">$res</span> = <span class="variable">$client</span>-&gt;<span class="title function_ invoke__">publishMsg</span>(<span class="string">&#x27;exchange_name&#x27;</span>,[<span class="string">&#x27;queue_name&#x27;</span>],<span class="string">&#x27;111111&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">       <span class="title function_ invoke__">dump</span>(<span class="variable">$res</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-生产者类库"><a href="#2-生产者类库" class="headerlink" title="2.生产者类库"></a>2.生产者类库</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?</span>PHP</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">services</span>\<span class="title class_">rabbitmq</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">PHPAmqpLib</span>\<span class="title">Connection</span>\<span class="title">AMQPStreamConnection</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">PHPAmqpLib</span>\<span class="title">Exception</span>\<span class="title">AMQPIOException</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">PHPAmqpLib</span>\<span class="title">Exchange</span>\<span class="title">AMQPExchangeType</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">PHPAmqpLib</span>\<span class="title">Message</span>\<span class="title">AMQPMessage</span>;</span><br><span class="line"><span class="comment">/**生产者类</span></span><br><span class="line"><span class="comment"> * Class Producer</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@package</span> services\rabbitmq</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Producer</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$host</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$port</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$user</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$pwd</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$vhost</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">static</span> <span class="variable">$client</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">static</span> <span class="variable">$instance</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$host</span>,<span class="variable">$port</span>,<span class="variable">$user</span>,<span class="variable">$pwd</span>,<span class="variable">$vhost</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$host</span>) || <span class="keyword">empty</span>(<span class="variable">$port</span>) || <span class="keyword">empty</span>(<span class="variable">$user</span>) || <span class="keyword">empty</span>(<span class="variable">$pwd</span>) || <span class="keyword">empty</span>(<span class="variable">$vhost</span>))&#123;</span><br><span class="line">            <span class="variable">$info</span> = <span class="title function_ invoke__">config</span>(<span class="string">&#x27;config&#x27;</span>)[<span class="string">&#x27;RabbitMQ&#x27;</span>];</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;host = <span class="variable">$info</span>[<span class="string">&#x27;address&#x27;</span>];</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;port = <span class="variable">$info</span>[<span class="string">&#x27;port&#x27;</span>];</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;user = <span class="variable">$info</span>[<span class="string">&#x27;user&#x27;</span>];</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;pwd = <span class="variable">$info</span>[<span class="string">&#x27;pwd&#x27;</span>];</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;vhost = <span class="variable">$info</span>[<span class="string">&#x27;vhost&#x27;</span>];</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;host = <span class="variable">$host</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;port = <span class="variable">$port</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;user = <span class="variable">$user</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;pwd = <span class="variable">$pwd</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;vhost = <span class="variable">$vhost</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">self</span>::<span class="variable">$client</span> = <span class="keyword">new</span> <span class="title class_">AMQPStreamConnection</span>(<span class="variable language_">$this</span>-&gt;host, <span class="variable language_">$this</span>-&gt;port, <span class="variable language_">$this</span>-&gt;user, <span class="variable language_">$this</span>-&gt;pwd, <span class="variable language_">$this</span>-&gt;vhost);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * - 获取实例 </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $host</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $port</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $user</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $pwd</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $vhost</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Producer</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">getInstance</span>(<span class="params"><span class="variable">$host</span> = <span class="string">&#x27;&#x27;</span>,<span class="variable">$port</span> = <span class="string">&#x27;&#x27;</span>,<span class="variable">$user</span> = <span class="string">&#x27;&#x27;</span>,<span class="variable">$pwd</span> = <span class="string">&#x27;&#x27;</span>,<span class="variable">$vhost</span> = <span class="string">&#x27;&#x27;</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!(<span class="built_in">self</span>::<span class="variable">$instance</span> <span class="keyword">instanceof</span> <span class="built_in">self</span>)) &#123;</span><br><span class="line">            <span class="built_in">self</span>::<span class="variable">$instance</span> = <span class="keyword">new</span> <span class="built_in">self</span>(<span class="variable">$host</span>,<span class="variable">$port</span>,<span class="variable">$user</span>,<span class="variable">$pwd</span>,<span class="variable">$vhost</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">self</span>::<span class="variable">$instance</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">   </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">publishMsg</span>(<span class="params"><span class="variable">$exchange</span>,<span class="variable">$QueueArr</span>,<span class="variable">$msg</span>,<span class="variable">$message_id</span>,<span class="variable">$route_key</span> = <span class="string">&#x27;&#x27;</span>,<span class="variable">$expiration</span> = <span class="number">3600</span> * <span class="number">90</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$channel</span> = <span class="built_in">self</span>::<span class="variable">$client</span>-&gt;<span class="title function_ invoke__">channel</span>();</span><br><span class="line">        <span class="comment">/**交换机声明</span></span><br><span class="line"><span class="comment">         * $exchange 交换机名称</span></span><br><span class="line"><span class="comment">         * AMQPExchangeType::DIRECT 路由模式</span></span><br><span class="line"><span class="comment">         * passive: false</span></span><br><span class="line"><span class="comment">         * durable: true  持久化  交换器将在服务器重启后继续存在</span></span><br><span class="line"><span class="comment">         * auto_delete: false  一旦通道关闭，交换器将不会被删除</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="variable">$channel</span>-&gt;<span class="title function_ invoke__">exchange_declare</span>(<span class="variable">$exchange</span>, <span class="title class_">AMQPExchangeType</span>::<span class="variable constant_">DIRECT</span>, <span class="literal">false</span>, <span class="literal">true</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, [], <span class="literal">null</span>);</span><br><span class="line">        <span class="comment">//绑定多个对列</span></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$QueueArr</span> <span class="keyword">as</span> <span class="variable">$key</span>=&gt;<span class="variable">$value</span>)&#123;</span><br><span class="line">            <span class="comment">/**声明队列（设置队列的时间必须设置一次，如要修改需要删除这个队列）new AMQPTable([&#x27;x-message-ttl&#x27;=&gt;10000])</span></span><br><span class="line"><span class="comment">             * $value  队列名称</span></span><br><span class="line"><span class="comment">             * passive false</span></span><br><span class="line"><span class="comment">             * 持久durable true 队列将在服务器重启后继续存在</span></span><br><span class="line"><span class="comment">             * 互斥exclusive false  队列可以通过其他渠道访问</span></span><br><span class="line"><span class="comment">             * auto_delete false 通道关闭后，队列不会被删除</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="variable">$channel</span>-&gt;<span class="title function_ invoke__">queue_declare</span>(<span class="variable">$value</span>,<span class="literal">false</span>,<span class="literal">true</span>,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">false</span>);</span><br><span class="line">            <span class="comment">//队列和交换机绑定</span></span><br><span class="line">            <span class="variable">$channel</span>-&gt;<span class="title function_ invoke__">queue_bind</span>(<span class="variable">$value</span>, <span class="variable">$exchange</span>,<span class="variable">$route_key</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//发送消息</span></span><br><span class="line">        <span class="variable">$message</span> = <span class="keyword">new</span> <span class="title class_">AMQPMessage</span>(<span class="variable">$msg</span>,<span class="keyword">array</span>(<span class="string">&#x27;content_type&#x27;</span> =&gt; <span class="string">&#x27;text/plain&#x27;</span>, <span class="string">&#x27;delivery_mode&#x27;</span> =&gt; <span class="title class_">AMQPMessage</span>::<span class="variable constant_">DELIVERY_MODE_PERSISTENT</span>,<span class="string">&#x27;expiration&#x27;</span>=&gt;<span class="variable">$expiration</span> * <span class="number">1000</span>,<span class="string">&#x27;message_id&#x27;</span>=&gt;<span class="variable">$message_id</span>));</span><br><span class="line">        <span class="variable">$channel</span>-&gt;<span class="title function_ invoke__">basic_publish</span>(<span class="variable">$message</span>,<span class="variable">$exchange</span>,<span class="variable">$route_key</span>);</span><br><span class="line">        <span class="variable">$channel</span>-&gt;<span class="title function_ invoke__">close</span>();</span><br><span class="line">        <span class="built_in">self</span>::<span class="variable">$client</span>-&gt;<span class="title function_ invoke__">close</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-消费者类库"><a href="#3-消费者类库" class="headerlink" title="3.消费者类库"></a>3.消费者类库</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?</span>PHP</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">services</span>\<span class="title class_">rabbitmq</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">PHPAmqpLib</span>\<span class="title">Connection</span>\<span class="title">AMQPStreamConnection</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Consumer</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$host</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$port</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$user</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$pwd</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$vhost</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$client</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$channel</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$info</span> = <span class="title function_ invoke__">config</span>(<span class="string">&#x27;config&#x27;</span>)[<span class="string">&#x27;RabbitMQ&#x27;</span>];</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;host = <span class="variable">$info</span>[<span class="string">&#x27;address&#x27;</span>];</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;port = <span class="variable">$info</span>[<span class="string">&#x27;port&#x27;</span>];</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;user = <span class="variable">$info</span>[<span class="string">&#x27;user&#x27;</span>];</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;pwd = <span class="variable">$info</span>[<span class="string">&#x27;pwd&#x27;</span>];</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;vhost = <span class="variable">$info</span>[<span class="string">&#x27;vhost&#x27;</span>];</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;client = <span class="keyword">new</span> <span class="title class_">AMQPStreamConnection</span>(<span class="variable language_">$this</span>-&gt;host, <span class="variable language_">$this</span>-&gt;port, <span class="variable language_">$this</span>-&gt;user, <span class="variable language_">$this</span>-&gt;pwd, <span class="variable language_">$this</span>-&gt;vhost);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;channel = <span class="variable language_">$this</span>-&gt;client-&gt;<span class="title function_ invoke__">channel</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">start</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * queue: queue_name    // 被消费的队列名称</span></span><br><span class="line"><span class="comment">         * consumer_tag: consumer_tag // 消费者客户端身份标识，用于区分多个客户端</span></span><br><span class="line"><span class="comment">         * no_local: false      // 这个功能属于AMQP的标准，但是RabbitMQ并没有做实现</span></span><br><span class="line"><span class="comment">         * no_ack: true         // 收到消息后，是否不需要回复确认即被认为被消费</span></span><br><span class="line"><span class="comment">         * exclusive: false     // 是否排他，即这个队列只能由一个消费者消费。适用于任务不允许进行并发处理的情况下</span></span><br><span class="line"><span class="comment">         * Nowait: false        // 不返回执行结果，但是如果排他开启的话，则必须需要等待结果的，如果两个一起开就会报错</span></span><br><span class="line"><span class="comment">         * callback: $callback  // 回调逻辑处理函数</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;channel-&gt;<span class="title function_ invoke__">basic_consume</span>(<span class="string">&#x27;queue_name&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>,[<span class="variable">$this</span>,<span class="string">&#x27;process_message&#x27;</span>]);</span><br><span class="line">        <span class="title function_ invoke__">register_shutdown_function</span>([<span class="variable">$this</span>, <span class="string">&#x27;shutdown&#x27;</span>], <span class="variable">$this</span>-&gt;channel, <span class="variable">$this</span>-&gt;client);</span><br><span class="line">        <span class="keyword">while</span> (<span class="title function_ invoke__">count</span>(<span class="variable">$this</span>-&gt;channel-&gt;callbacks)) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;channel-&gt;<span class="title function_ invoke__">wait</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">shutdown</span>(<span class="params"><span class="variable">$channel</span>, <span class="variable">$connection</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$channel</span>-&gt;<span class="title function_ invoke__">close</span>();</span><br><span class="line">        <span class="variable">$connection</span>-&gt;<span class="title function_ invoke__">close</span>();</span><br><span class="line">        <span class="title function_ invoke__">save_log</span>(<span class="string">&#x27;close&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">process_message</span>(<span class="params"><span class="variable">$message</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span>  <span class="variable">$message</span>-&gt;body.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="comment">//手动发送ack</span></span><br><span class="line">        <span class="variable">$message</span>-&gt;delivery_info[<span class="string">&#x27;channel&#x27;</span>]-&gt;<span class="title function_ invoke__">basic_ack</span>(<span class="variable">$message</span>-&gt;delivery_info[<span class="string">&#x27;delivery_tag&#x27;</span>]);</span><br><span class="line">        <span class="comment">// Send a message with the string &quot;quit&quot; to cancel the consumer.</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$message</span>-&gt;body === <span class="string">&#x27;quit&#x27;</span>) &#123;</span><br><span class="line">            <span class="variable">$message</span>-&gt;delivery_info[<span class="string">&#x27;channel&#x27;</span>]-&gt;<span class="title function_ invoke__">basic_cancel</span>(<span class="variable">$message</span>-&gt;delivery_info[<span class="string">&#x27;consumer_tag&#x27;</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4、PHP中-register-shutdown-function-函数的基础介绍与用法详解"><a href="#4、PHP中-register-shutdown-function-函数的基础介绍与用法详解" class="headerlink" title="4、PHP中 register_shutdown_function 函数的基础介绍与用法详解"></a>4、PHP中 register_shutdown_function 函数的基础介绍与用法详解</h4><p>参考链接：<a href="https://www.jb51.net/article/129213.htm">https://www.jb51.net/article/129213.htm</a></p>
]]></content>
      <categories>
        <category>php</category>
      </categories>
      <tags>
        <tag>php</tag>
      </tags>
  </entry>
  <entry>
    <title>redis连接报错read error on connection解决</title>
    <url>/2023/03/23/redis-%E8%BF%9E%E6%8E%A5%E6%8A%A5%E9%94%99read-error-on-connection%E8%A7%A3%E5%86%B3/</url>
    <content><![CDATA[<h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><p>用redis作 消息队列，php连接redis，用brpop函数消费队列时，60秒连接会自动断开，报错：read error on connection</p>
<p><img src="/../img/redis-23-01.png" alt="redis"></p>
<h3 id="原因分析"><a href="#原因分析" class="headerlink" title="原因分析"></a>原因分析</h3><p>查看了下php.ini文件里面有个参数default_socket_timeout &#x3D; 60，就是这个配置导致redis过60秒会自动断开。<br>这个配置是什么意思？default_socket_timeout是socket流的超时参数，即socket流从建立到传输再到关闭整个过程必须要在这个参数设置的时间以内完成，如果不能完成，那么PHP将自动结束这个socket并返回一个警告。</p>
<span id="more"></span>
<p>由于php得redis扩展是基于php 的socket方式实现，因此该参数值同样会起作用。在redis里面brpop会建立一个socket流，如果这个socket流建立之后超过特定的时间都没有返回则会自动结束该socket流。</p>
<h3 id="解决方案1"><a href="#解决方案1" class="headerlink" title="解决方案1"></a>解决方案1</h3><p>动态修改 php.ini , 在连接redis处把 default_socket_timeout 这个参数设置成-1 不超时即可。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;default_socket_timeout&#x27;</span>, -<span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<h3 id="解决方案2"><a href="#解决方案2" class="headerlink" title="解决方案2"></a>解决方案2</h3><p>设置 redis 的超时时间为不超时：<br>$redis-&gt;setOption(\Redis::OPT_READ_TIMEOUT, -1);</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$redis</span> = <span class="keyword">new</span> <span class="title class_">Redis</span>();</span><br><span class="line"><span class="variable">$redis</span>-&gt;<span class="title function_ invoke__">connect</span>(<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">6379</span>);</span><br><span class="line"><span class="variable">$redis</span>-&gt;<span class="title function_ invoke__">setOption</span>(<span class="title class_">\Redis</span>::<span class="variable constant_">OPT_READ_TIMEOUT</span>, -<span class="number">1</span>);</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>redis</category>
      </categories>
      <tags>
        <tag>redis,php</tag>
      </tags>
  </entry>
  <entry>
    <title>python实现windows下通过人脸识别找到所有的类似图片</title>
    <url>/2024/05/22/python%E5%AE%9E%E7%8E%B0windows%E4%B8%8B%E9%80%9A%E8%BF%87%E4%BA%BA%E8%84%B8%E8%AF%86%E5%88%AB%E6%89%BE%E5%88%B0%E6%89%80%E6%9C%89%E7%9A%84%E7%B1%BB%E4%BC%BC%E5%9B%BE%E7%89%87/</url>
    <content><![CDATA[<blockquote>
<p>最近给我亲戚实现一个在windows下根据人脸识别找到所有类似照片的需求，通过python学了下，特别在windows下的环境搭建方面遇到了很多的坑，环境搭建可以查看前两篇博客有讲述安装中的坑，这里分享下通过python实现这个功能的代码</p>
</blockquote>
<p>代码的实现并不是很难，其中主要用到的类库就是Face_Recognition，这个类库在mac、linux上可以完美适配，特别在windows上出现的问题很多，特别是Face_Recognition需要用到的dlib在windows上无法安装，以下的这个通过一张照片全局查找类似照片的代码，谢谢指正。</p>
<span id="more"></span>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> face_recognition</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"><span class="keyword">from</span> glob <span class="keyword">import</span> glob</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image <span class="keyword">as</span> pil_image</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Find</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">find_start</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;处理完成后命中的图片会被复制到C盘下的[target]文件夹！&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;全盘扫描中，速度较慢，耐心等待！&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 加载一张参考图片 (E:/download/z.jpg)</span></span><br><span class="line">        target_img = <span class="built_in">input</span>(<span class="string">f&quot;请输入目标图片绝对地址(例如：E:/download/z.jpg)：&quot;</span>)</span><br><span class="line">        <span class="comment">#target_img = &quot;E:/download/z.jpg&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;开始处理，请等待...&quot;</span>)</span><br><span class="line">        <span class="comment"># 获取盘符所有图片资源</span></span><br><span class="line">        images_list = self.get_images_from_all_drives()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;总共扫描到&quot;</span> + <span class="built_in">str</span>(<span class="built_in">len</span>(images_list)) + <span class="string">&quot;张有效图片&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 获取参考图片的面部</span></span><br><span class="line">        reference_image = face_recognition.load_image_file(target_img)</span><br><span class="line">        reference_face_images = face_recognition.face_locations(reference_image)</span><br><span class="line">        reference_face_encodings = face_recognition.face_encodings(reference_image, reference_face_images)</span><br><span class="line"></span><br><span class="line">        target_images = []</span><br><span class="line">        <span class="comment"># 计算其他图片中每个人脸的相似度</span></span><br><span class="line">        <span class="keyword">for</span> image_path <span class="keyword">in</span> images_list:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                pil_image.<span class="built_in">open</span>(image_path)</span><br><span class="line">                image = face_recognition.load_image_file(image_path)</span><br><span class="line">                location_images = face_recognition.face_locations(image)</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(location_images) &lt;= <span class="number">0</span> <span class="keyword">or</span> <span class="built_in">len</span>(location_images) &gt; <span class="number">5</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;.&quot;</span>, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">                    <span class="comment"># print(f&quot;没有检测到面部或者照片人数太多，无法识别&quot; + image_path)</span></span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                face_encodings = face_recognition.face_encodings(image, location_images)</span><br><span class="line">                <span class="comment"># 比较两张照片中的每个面部编码</span></span><br><span class="line">                <span class="keyword">for</span> face_encoding1 <span class="keyword">in</span> reference_face_encodings:</span><br><span class="line">                    <span class="keyword">for</span> face_encoding2 <span class="keyword">in</span> face_encodings:</span><br><span class="line">                        match_score = face_recognition.face_distance([face_encoding1], face_encoding2)</span><br><span class="line">                        <span class="keyword">if</span> match_score[<span class="number">0</span>] &lt;= <span class="number">0.5</span>:  <span class="comment"># 阈值可以根据需要调整</span></span><br><span class="line">                            target_images.append(image_path)</span><br><span class="line">                            <span class="built_in">print</span>(<span class="string">&quot;.&quot;</span>, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">                        <span class="keyword">else</span>:</span><br><span class="line">                            <span class="built_in">print</span>(<span class="string">&quot;.&quot;</span>, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">                            <span class="comment"># print(&quot;两张照片不是同一个人&quot; + image_path)</span></span><br><span class="line">            <span class="keyword">except</span> pil_image.UnidentifiedImageError:</span><br><span class="line">                <span class="comment"># print(f&quot;图片无法识别&quot;)</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 处理图片结果，将图片结果copy到一个文件夹</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(target_images) &gt; <span class="number">0</span>:</span><br><span class="line">            destination_path = <span class="string">&quot;C:\\target&quot;</span></span><br><span class="line">            self.create_folder_if_not_exists(destination_path)</span><br><span class="line">            <span class="keyword">for</span> img <span class="keyword">in</span> target_images:</span><br><span class="line">                shutil.copy2(img, destination_path)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;处理完成！&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="comment"># 判断文件夹是否存在，否则创建文件夹</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_folder_if_not_exists</span>(<span class="params">folder_name</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(folder_name):</span><br><span class="line">            os.makedirs(folder_name)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="comment"># 获取盘符中所有图片资源</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_images_from_all_drives</span>():</span><br><span class="line">        images_list = []</span><br><span class="line">        drives = [<span class="string">f&quot;<span class="subst">&#123;letter&#125;</span>:&quot;</span> <span class="keyword">for</span> letter <span class="keyword">in</span> <span class="string">&#x27;CDEFGH&#x27;</span> <span class="keyword">if</span> os.path.exists(<span class="string">f&quot;<span class="subst">&#123;letter&#125;</span>:\\&quot;</span>)]</span><br><span class="line">        <span class="keyword">for</span> drive <span class="keyword">in</span> drives:</span><br><span class="line">            <span class="keyword">for</span> pattern <span class="keyword">in</span> (<span class="string">&#x27;*.jpg&#x27;</span>, <span class="string">&#x27;*.jpeg&#x27;</span>, <span class="string">&#x27;*.png&#x27;</span>):</span><br><span class="line">                images_list.extend(glob(<span class="string">f&quot;<span class="subst">&#123;drive&#125;</span>\\**\\<span class="subst">&#123;pattern&#125;</span>&quot;</span>, recursive=<span class="literal">True</span>))</span><br><span class="line">        <span class="keyword">return</span> images_list</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 入口</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    find_class = Find()</span><br><span class="line">    images = find_class.find_start()</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>python报错 ModuleNotFoundError: No module named &quot;_lzma&quot;</title>
    <url>/2024/12/03/python%E6%8A%A5%E9%94%99-ModuleNotFoundError-No-module-named-%E2%80%98-lzma%E2%80%98/</url>
    <content><![CDATA[<p>运行scrapy爬虫项目时报错：ModuleNotFoundError: No module named ‘_lzma‘，很多文章的解决方案是重新安装python，但重新安装后会发现一样还是会报错，报错如下图：</p>
<p><img src="/../img/py1203-01.png" alt="python"></p>
<p><strong>解决思路</strong>：用backports.lzma代替_lzma包</p>
<h3 id="解决步骤"><a href="#解决步骤" class="headerlink" title="解决步骤"></a>解决步骤</h3><h4 id="1、安装依赖"><a href="#1、安装依赖" class="headerlink" title="1、安装依赖"></a>1、安装依赖</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt-get install liblzma-dev</span><br></pre></td></tr></table></figure>
<p>如果报如下镜像404错误，先升级一下apt：sudo apt update</p>
<h4 id="2、安装替代库-backports-lzma"><a href="#2、安装替代库-backports-lzma" class="headerlink" title="2、安装替代库 backports.lzma"></a>2、安装替代库 backports.lzma</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pip3 install backports.lzma</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<h4 id="3、修改lzma-py源码"><a href="#3、修改lzma-py源码" class="headerlink" title="3、修改lzma.py源码"></a>3、修改lzma.py源码</h4><p>lzma.py源码文件路径在上图，根据自己的环境位置确定该文件的地址，或者可根据 find &#x2F; -name lzma.py找到源码文件路径</p>
<p>修改&#x2F;Users&#x2F;xiexiang&#x2F;.pyenv&#x2F;versions&#x2F;3.10.10&#x2F;lib&#x2F;python3.10&#x2F;lzma.py这个文件：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#修改前</span></span><br><span class="line"><span class="keyword">from</span> _lzma import *</span><br><span class="line"><span class="keyword">from</span> _lzma import _encode_filter_properties, _decode_filter_properties</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改后 </span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">from</span> _lzma import *</span><br><span class="line">    <span class="keyword">from</span> _lzma import _encode_filter_properties, _decode_filter_properties</span><br><span class="line">except ImportError:</span><br><span class="line">    <span class="keyword">from</span> backports.lzma import *</span><br><span class="line">    <span class="keyword">from</span> backports.lzma import _encode_filter_properties, _decode_filter_properties</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="4、验证"><a href="#4、验证" class="headerlink" title="4、验证"></a>4、验证</h4><p>爬虫就正常运行了 </p>
]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>slim4获取所有路由</title>
    <url>/2023/04/28/slim4%E8%8E%B7%E5%8F%96%E6%89%80%E6%9C%89%E8%B7%AF%E7%94%B1/</url>
    <content><![CDATA[<blockquote>
<p>可能是因为slim框架大家使用少，加上官方文档也非常的简单，这里整理一下slim4所有所有路由的方式；问：为什么要获取所有的路由？ 答：肯定是用来做权限控制啦~~~</p>
</blockquote>
<h4 id="路由设置"><a href="#路由设置" class="headerlink" title="路由设置"></a>路由设置</h4><p>本文的方式在通过中间件的方式去获取所有路由，在用户登录的时候会触发中间件去整理所有的路由</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="variable">$app</span>-&gt;<span class="title function_ invoke__">group</span>(<span class="string">&#x27;/admin&#x27;</span>, function(Group <span class="variable">$group</span>) <span class="keyword">use</span> ($<span class="title">app</span>)&#123;</span><br><span class="line">    $<span class="title">group</span>-&gt;<span class="title">post</span>(&#x27;/<span class="title">go_login</span>&#x27;, <span class="title">LoginController</span>::<span class="title">class</span>.&#x27;:<span class="title">login</span>&#x27;)-&gt;<span class="title">addMiddleware</span>(<span class="title">new</span> <span class="title">AuthNodesMiddleware</span>($<span class="title">app</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<h4 id="中间件整理所有路由"><a href="#中间件整理所有路由" class="headerlink" title="中间件整理所有路由"></a>中间件整理所有路由</h4><p>中间件中的逻辑主要是获取并解析所有的路由，然后整理存储在表里，每次登录的时候都需要重新整理</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Application</span>\<span class="title class_">Middleware</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Application</span>\<span class="title">Models</span>\<span class="title">SystemRoutes</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Util</span>\<span class="title">System</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Util</span>\<span class="title">Tools</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Psr</span>\<span class="title">Http</span>\<span class="title">Message</span>\<span class="title">ResponseInterface</span> <span class="keyword">as</span> <span class="title">Response</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Psr</span>\<span class="title">Http</span>\<span class="title">Message</span>\<span class="title">ServerRequestInterface</span> <span class="keyword">as</span> <span class="title">Request</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Psr</span>\<span class="title">Http</span>\<span class="title">Server</span>\<span class="title">MiddlewareInterface</span> <span class="keyword">as</span> <span class="title">Middleware</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Psr</span>\<span class="title">Http</span>\<span class="title">Server</span>\<span class="title">RequestHandlerInterface</span> <span class="keyword">as</span> <span class="title">RequestHandler</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">ReflectionClass</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Slim</span>\<span class="title">App</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Slim</span>\<span class="title">Factory</span>\<span class="title">AppFactory</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Slim</span>\<span class="title">Routing</span>\<span class="title">RouteCollector</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Slim</span>\<span class="title">Routing</span>\<span class="title">RouteContext</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * - 权限节点处理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AuthNodesMiddleware</span> <span class="keyword">implements</span> <span class="title">Middleware</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$app</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">App <span class="variable">$app</span></span>) </span>&#123;</span><br><span class="line">       <span class="variable language_">$this</span>-&gt;app = <span class="variable">$app</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * - 整理并存储权限节点</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> Request $request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> RequestHandler $handler</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Response</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">process</span>(<span class="params">Request <span class="variable">$request</span>, RequestHandler <span class="variable">$handler</span></span>): <span class="title">Response</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 获取所有路由</span></span><br><span class="line">        <span class="variable">$routes</span> = <span class="variable language_">$this</span>-&gt;app-&gt;<span class="title function_ invoke__">getRouteCollector</span>()-&gt;<span class="title function_ invoke__">getRoutes</span>();</span><br><span class="line">        <span class="variable">$routes_list</span> = [];</span><br><span class="line">        <span class="comment">// 遍历</span></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$routes</span> <span class="keyword">as</span> <span class="variable">$route</span>) &#123;</span><br><span class="line">            <span class="variable">$params</span> = <span class="variable">$route</span>-&gt;<span class="title function_ invoke__">getArguments</span>();</span><br><span class="line">            <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$params</span>)) &#123;</span><br><span class="line">                <span class="variable">$class_name</span> = <span class="title class_">Tools</span>::<span class="title function_ invoke__">arrGetVal</span>(<span class="variable">$params</span>, <span class="string">&#x27;class_name&#x27;</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">                <span class="variable">$auth_name</span>  = <span class="title class_">Tools</span>::<span class="title function_ invoke__">arrGetVal</span>(<span class="variable">$params</span>, <span class="string">&#x27;auth_name&#x27;</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">                <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$class_name</span>) &amp;&amp; !<span class="keyword">empty</span>(<span class="variable">$auth_name</span>)) &#123;</span><br><span class="line">                    <span class="variable">$item</span> = [</span><br><span class="line">                        <span class="string">&#x27;route&#x27;</span>      =&gt; <span class="variable">$route</span>-&gt;<span class="title function_ invoke__">getPattern</span>(),</span><br><span class="line">                        <span class="string">&#x27;route_name&#x27;</span> =&gt; <span class="variable">$auth_name</span></span><br><span class="line">                    ];</span><br><span class="line">                    <span class="variable">$routes_list</span>[<span class="variable">$class_name</span>][] = <span class="variable">$item</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$system_routes_model</span> = <span class="keyword">new</span> <span class="title class_">SystemRoutes</span>();</span><br><span class="line">        <span class="comment">// 重新整理存储数据</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$routes_list</span>)) &#123;</span><br><span class="line">            <span class="comment">// 删除原始数据</span></span><br><span class="line">            <span class="variable">$old_ids</span> = <span class="variable">$system_routes_model</span>-&gt;<span class="title function_ invoke__">column</span>(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line">            <span class="variable">$system_routes_model</span>-&gt;<span class="title function_ invoke__">where</span>(<span class="string">&#x27;id&#x27;</span>,<span class="string">&#x27;IN&#x27;</span>,<span class="variable">$old_ids</span>)-&gt;<span class="title function_ invoke__">delete</span>();</span><br><span class="line">            <span class="comment">// 节点数据保存</span></span><br><span class="line">            <span class="variable">$now_time</span> = <span class="title function_ invoke__">time</span>();</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="variable">$routes_list</span> <span class="keyword">as</span> <span class="variable">$class_name</span> =&gt; <span class="variable">$items</span>) &#123;</span><br><span class="line">                <span class="variable">$last_id</span> = <span class="variable">$system_routes_model</span>-&gt;<span class="title function_ invoke__">insertGetId</span>([</span><br><span class="line">                    <span class="string">&#x27;pid&#x27;</span> =&gt; <span class="number">0</span>,</span><br><span class="line">                    <span class="string">&#x27;group_name&#x27;</span> =&gt; <span class="variable">$class_name</span>,</span><br><span class="line">                    <span class="string">&#x27;created_at&#x27;</span> =&gt; <span class="variable">$now_time</span>,</span><br><span class="line">                    <span class="string">&#x27;updated_at&#x27;</span> =&gt; <span class="variable">$now_time</span></span><br><span class="line">                ]);</span><br><span class="line">                <span class="keyword">foreach</span> (<span class="variable">$items</span> <span class="keyword">as</span> <span class="variable">$item</span>) &#123;</span><br><span class="line">                    <span class="variable">$system_routes_model</span>-&gt;<span class="title function_ invoke__">insert</span>([</span><br><span class="line">                        <span class="string">&#x27;pid&#x27;</span>        =&gt; <span class="variable">$last_id</span>,</span><br><span class="line">                        <span class="string">&#x27;group_name&#x27;</span> =&gt; <span class="variable">$class_name</span>,</span><br><span class="line">                        <span class="string">&#x27;route&#x27;</span>      =&gt; <span class="variable">$item</span>[<span class="string">&#x27;route&#x27;</span>],</span><br><span class="line">                        <span class="string">&#x27;route_name&#x27;</span> =&gt; <span class="variable">$item</span>[<span class="string">&#x27;route_name&#x27;</span>],</span><br><span class="line">                        <span class="string">&#x27;created_at&#x27;</span> =&gt; <span class="variable">$now_time</span>,</span><br><span class="line">                        <span class="string">&#x27;updated_at&#x27;</span> =&gt; <span class="variable">$now_time</span></span><br><span class="line">                    ]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$handler</span>-&gt;<span class="title function_ invoke__">handle</span>(<span class="variable">$request</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>php</category>
      </categories>
      <tags>
        <tag>php</tag>
      </tags>
  </entry>
  <entry>
    <title>slime/twig-view</title>
    <url>/2021/08/16/slime-twig-view/</url>
    <content><![CDATA[<h3 id="Templates"><a href="#Templates" class="headerlink" title="Templates"></a>Templates</h3><p>Slim does not have a view layer like traditional MVC frameworks. Instead, Slim’s “view” is the HTTP response. Each Slim application route is responsible for preparing and returning an appropriate PSR-7 response object.</p>
<h3 id="Slim’s-“view”-is-the-HTTP-response"><a href="#Slim’s-“view”-is-the-HTTP-response" class="headerlink" title="Slim’s “view” is the HTTP response."></a>Slim’s “view” is the HTTP response.</h3><p>That being said, the Slim project provides the Twig-View and PHP-View components to help you render templates to a PSR7 Response object.</p>
<h3 id="The-slim-x2F-twig-view-component"><a href="#The-slim-x2F-twig-view-component" class="headerlink" title="The slim&#x2F;twig-view component"></a>The slim&#x2F;twig-view component</h3><p>The Twig-View PHP component helps you render Twig templates in your application. This component is available on Packagist, and it’s easy to install with Composer like this:</p>
<span id="more"></span>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">composer <span class="keyword">require</span> slime/twig-view</span><br></pre></td></tr></table></figure>

<p>Next, you need to add the slim&#x2F;twig-view middleware to the Slim app:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">use</span> <span class="title">Slim</span>\<span class="title">Factory</span>\<span class="title">AppFactory</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Slim</span>\<span class="title">Views</span>\<span class="title">Twig</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Slim</span>\<span class="title">Views</span>\<span class="title">TwigMiddleware</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">require</span> <span class="keyword">__DIR__</span> . <span class="string">&#x27;/vendor/autoload.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create App</span></span><br><span class="line"><span class="variable">$app</span> = <span class="title class_">AppFactory</span>::<span class="title function_ invoke__">create</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create Twig</span></span><br><span class="line"><span class="variable">$twig</span> = <span class="title class_">Twig</span>::<span class="title function_ invoke__">create</span>(<span class="string">&#x27;path/to/templates&#x27;</span>, [<span class="string">&#x27;cache&#x27;</span> =&gt; <span class="literal">false</span>]);   <span class="comment">// 设置view的路劲</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Add Twig-View Middleware</span></span><br><span class="line"><span class="variable">$app</span>-&gt;<span class="title function_ invoke__">add</span>(<span class="title class_">TwigMiddleware</span>::<span class="title function_ invoke__">create</span>(<span class="variable">$app</span>, <span class="variable">$twig</span>));</span><br></pre></td></tr></table></figure>

<p>Note : For production scenarios, cache should be set to some ‘path&#x2F;to&#x2F;cache’ to store compiled templates (thus avoiding recomplication on every request). For more information, see Twig environment options</p>
<p>Now you can use the slim&#x2F;twig-view component service inside an app route to render a template and write it to a PSR-7 Response object like this:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">app-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;/hello/&#123;name&#125;&#x27;</span>, function (<span class="variable">$request</span>, <span class="variable">$response</span>, <span class="variable">$args</span>) &#123;</span><br><span class="line">    <span class="variable">$view</span> = <span class="title class_">Twig</span>::<span class="title function_ invoke__">fromRequest</span>(<span class="variable">$request</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$view</span>-&gt;<span class="title function_ invoke__">render</span>(<span class="variable">$response</span>, <span class="string">&#x27;profile.html&#x27;</span>, [</span><br><span class="line">        <span class="string">&#x27;name&#x27;</span> =&gt; <span class="variable">$args</span>[<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line">    ]);</span><br><span class="line">&#125;)-&gt;<span class="title function_ invoke__">setName</span>(<span class="string">&#x27;profile&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Run app</span></span><br><span class="line"><span class="variable">$app</span>-&gt;<span class="title function_ invoke__">run</span>();</span><br></pre></td></tr></table></figure>

<p>In this example, $view invoked inside the route callback is a reference to the \Slim\Views\Twig instance returned by the fromRequest method. The \Slim\Views\Twig instance’s render() method accepts a PSR-7 Response object as its first argument, the Twig template path as its second argument, and an array of template variables as its final argument. The render() method returns a new PSR-7 Response object whose body is the rendered Twig template.</p>
<p>The url_for() method<br>The slim&#x2F;twig-view component exposes a custom url_for() function to your Twig templates. You can use this function to generate complete URLs to any named route in your Slim application. The url_for() function accepts two arguments:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>.A route name</span><br><span class="line"><span class="number">2</span>.A hash of route placeholder names <span class="keyword">and</span> replacement values</span><br></pre></td></tr></table></figure>

<p>The second argument’s keys should correspond to the selected route’s pattern placeholders. This is an example Twig template that draws a link URL for the “profile” named route shown in the example Slim application above.</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&#123;% <span class="keyword">extends</span> <span class="string">&quot;layout.html&quot;</span> %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block body %&#125;</span><br><span class="line">&lt;h1&gt;User List&lt;/h1&gt;</span><br><span class="line">&lt;ul&gt;</span><br><span class="line">    &lt;li&gt;&lt;a href=<span class="string">&quot;&#123;&#123; url_for(&#x27;profile&#x27;, &#123; &#x27;name&#x27;: &#x27;josh&#x27; &#125;) &#125;&#125;&quot;</span>&gt;Josh&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>

<h3 id="实例："><a href="#实例：" class="headerlink" title="实例："></a>实例：</h3><p><code>app/routes.php</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 云手机相关routes</span></span><br><span class="line">   <span class="variable">$app</span>-&gt;<span class="title function_ invoke__">group</span>(<span class="string">&#x27;/cloud/v1&#x27;</span>, function(Group <span class="variable">$group</span>) &#123;</span><br><span class="line">       <span class="comment">// 支付页面</span></span><br><span class="line">       <span class="variable">$group</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;/pay_now_temp&#x27;</span>,<span class="title class_">TemplateController</span>::<span class="variable language_">class</span>.<span class="string">&#x27;:payNowTemp&#x27;</span>);</span><br><span class="line">       <span class="comment">// 续费页面</span></span><br><span class="line">       <span class="variable">$group</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;/pay_renew_temp&#x27;</span>, <span class="title class_">TemplateController</span>::<span class="variable language_">class</span>.<span class="string">&#x27;:payRenewTemp&#x27;</span>);</span><br><span class="line">   &#125;);</span><br></pre></td></tr></table></figure>

<p><code>TemplateController.php</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span>(strict_types=<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Application</span>\<span class="title class_">Controllers</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Psr</span>\<span class="title">Http</span>\<span class="title">Message</span>\<span class="title">ResponseInterface</span> <span class="keyword">as</span> <span class="title">Response</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Psr</span>\<span class="title">Http</span>\<span class="title">Message</span>\<span class="title">ServerRequestInterface</span> <span class="keyword">as</span> <span class="title">Request</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Slim</span>\<span class="title">Views</span>\<span class="title">Twig</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TemplateController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">payNowTemp</span>(<span class="params">Request <span class="variable">$request</span>, Response <span class="variable">$response</span></span>) : <span class="title">Response</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$view</span> = <span class="title class_">Twig</span>::<span class="title function_ invoke__">fromRequest</span>(<span class="variable">$request</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$view</span>-&gt;<span class="title function_ invoke__">render</span>(<span class="variable">$response</span>, <span class="string">&#x27;cloud-vip/index.html&#x27;</span>, [</span><br><span class="line">            <span class="string">&#x27;name&#x27;</span> =&gt; <span class="number">11</span></span><br><span class="line">        ]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">payRenewTemp</span>(<span class="params">Request <span class="variable">$request</span>, Response <span class="variable">$response</span></span>) : <span class="title">Response</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$view</span> = <span class="title class_">Twig</span>::<span class="title function_ invoke__">fromRequest</span>(<span class="variable">$request</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$view</span>-&gt;<span class="title function_ invoke__">render</span>(<span class="variable">$response</span>, <span class="string">&#x27;cloud-vip/renew.html&#x27;</span>, [</span><br><span class="line">            <span class="string">&#x27;name&#x27;</span> =&gt; <span class="number">11</span></span><br><span class="line">        ]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>php</category>
      </categories>
      <tags>
        <tag>php</tag>
      </tags>
  </entry>
  <entry>
    <title>windows10下安装face_recognition</title>
    <url>/2024/05/22/windows10%E4%B8%8B%E5%AE%89%E8%A3%85face-recognition/</url>
    <content><![CDATA[<blockquote>
<p>这里主要讲解windows下face_recognition的安装，因为face_recognition不能完美的适配windows，如果在Mac、Linux平台就能完美的是适配，这里整理了windows下按照face_recognition遇到的问题及解决方案。</p>
</blockquote>
<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>人脸识别库有很多，但DeepFace、Face_Recognition绝对是最具代表性的两个库，其中Face_Recognition库更是被称为这个星球上最好的人脸识别库。</p>
<p>但是Face_Recognition官方却明确声明，只针对<strong>Mac</strong>和<strong>Linux</strong>做适配，对windows系统不做适配，官方的原话为：<strong>windows或许能正常工作</strong>。</p>
<p>这让很多windows用户焦头烂额了，因为可能连库本身的安装都存在问题，本文既是针对这个情况为大家介绍一个在windows下极简安装Face_Recognition库的方法。</p>
<span id="more"></span>

<h2 id="face-recognition简介"><a href="#face-recognition简介" class="headerlink" title="face_recognition简介"></a>face_recognition简介</h2><p>face_recognition项目的人脸识别是基于业内领先的C++开源库 dlib中的深度学习模型，用Labeled Faces in the Wild人脸数据集进行测试，有高达99.38%的准确率。但对小孩和亚洲人脸的识别准确率尚待提升。</p>
<p>face_recognition是基于业内领先的C++开源库dlib中的深度学习模型，用Labeled Faces in the Wild人脸数据集进行测试，有高达99.38%的准确率。因此，安装face_recognition前需要安装<strong>dlib</strong>库。</p>
<h2 id="face-recognition安装"><a href="#face-recognition安装" class="headerlink" title="face_recognition安装"></a>face_recognition安装</h2><p>由于face_recognition库是以来dlib库而开发，所以必须要安装dlib库，只有dlib库正常安装，face_recognition才能正常安装。face_recognition安装的难点也正是dlib库的安装，因为就是该库未提供windows下的适配。</p>
<p>dlib库whl文件下载地址：<a href="https://github.com/xiexiangnow/Dlib">Dlib whl文件下载地址</a></p>
<p>注意：该下载地址中，包含了针对64位Windows和python 3.7、3.8、3.9的三个版本文件</p>
<h3 id="安装过程："><a href="#安装过程：" class="headerlink" title="安装过程："></a>安装过程：</h3><p>1、cmake和boost安装 </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pip install cmake</span><br><span class="line">pip install boost</span><br></pre></td></tr></table></figure>

<p>2、Dlib安装</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">先进入dlib-19.17.0-cp37-cp37m-win_amd64.whl文件所在目录，或者写成绝对路径</span></span><br><span class="line">pip install dlib-19.17.0-cp37-cp37m-win_amd64.whl</span><br></pre></td></tr></table></figure>

<p>3、face_recognition安装</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pip install face_recognition</span><br></pre></td></tr></table></figure>

<h3 id="cmake和boost"><a href="#cmake和boost" class="headerlink" title="cmake和boost"></a>cmake和boost</h3><p>这两个工具也可以去官网地址下载安装</p>
<p>cmake: <a href="https://cmake.org/download/">https://cmake.org/download/</a></p>
<p>boost: <a href="https://www.boost.org/users/download/">https://www.boost.org/users/download/</a></p>
<p>至此，face_recognition就安装成功了！</p>
]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>x-admin刷新后清除左侧菜单选中</title>
    <url>/2023/04/20/x-admin%E5%88%B7%E6%96%B0%E5%90%8E%E6%B8%85%E9%99%A4%E5%B7%A6%E4%BE%A7%E8%8F%9C%E5%8D%95%E9%80%89%E4%B8%AD/</url>
    <content><![CDATA[<p>在用x-admin前端模板的时候，发现了一个问题，对于左侧的菜单栏，如果点击之后（即菜单页为展开）再退出了系统，重新登录后，发现菜单栏和退出时是一样的</p>
<p>而我们的要求是在刷新或者重新登录后，需要清除左侧菜单的选中效果</p>
<h3 id="清除选中"><a href="#清除选中" class="headerlink" title="清除选中"></a>清除选中</h3><p>我们只需要在页面加载的地方加如下js代码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//清除缓存</span></span><br><span class="line">sessionStorage.<span class="title function_ invoke__">clear</span>();</span><br><span class="line">localStorage.<span class="title function_ invoke__">clear</span>();</span><br></pre></td></tr></table></figure>


<h3 id="手动添加选中"><a href="#手动添加选中" class="headerlink" title="手动添加选中"></a>手动添加选中</h3><p>但是现在又有问题了，清除完缓存之后，就发现任何的标签页都没有被选中，真的好丑，解决这个问题很简单，只要在x-admin模板中找到相应的菜单栏，找到初始管理相对应的a标签</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;li&gt;</span><br><span class="line">   &lt;a onclick=<span class="string">&quot;xadmin.add_tab(&#x27;首页&#x27;,&#x27;/admin/wel&#x27;)&quot;</span> <span class="class"><span class="keyword">class</span>=&quot;<span class="title">active</span>&quot;&gt;</span></span><br><span class="line"><span class="class">     &lt;<span class="title">i</span> <span class="title">class</span>=&quot;<span class="title">iconfont</span> <span class="title">left</span>-<span class="title">nav</span>-<span class="title">li</span>&quot; <span class="title">lay</span>-<span class="title">tips</span>=&quot;首页&quot;&gt;&amp;#<span class="title">xe6b8</span>;&lt;/<span class="title">i</span>&gt;</span></span><br><span class="line"><span class="class">     &lt;<span class="title">cite</span>&gt;首页&lt;/<span class="title">cite</span>&gt;</span></span><br><span class="line"><span class="class">     &lt;<span class="title">i</span> <span class="title">class</span>=&quot;<span class="title">iconfont</span> <span class="title">nav_right</span>&quot;&gt;&amp;#<span class="title">xe697</span>;&lt;/<span class="title">i</span>&gt;</span></span><br><span class="line"><span class="class">   &lt;/<span class="title">a</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">li</span>&gt;</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>javascript</category>
      </categories>
      <tags>
        <tag>javascript</tag>
      </tags>
  </entry>
  <entry>
    <title>windows平台实战装机</title>
    <url>/2023/11/28/windows%E5%B9%B3%E5%8F%B0%E5%AE%9E%E6%88%98%E8%A3%85%E6%9C%BA/</url>
    <content><![CDATA[<blockquote>
<p>闲来无事，将自己原有的台式机进行了升级，很享受自己diy的这个过程，特别是装机过程；硬件迭代更新很快，本人不太喜欢追求最新硬件，比如刚出的14代cpu，喜欢淘一些二手硬件进行装机，主要是体验装机过程，将自己喜欢的配件全部组装在一起的快感。</p>
</blockquote>
<h4 id="升级后的配置信息"><a href="#升级后的配置信息" class="headerlink" title="升级后的配置信息"></a>升级后的配置信息</h4><ul>
<li>cpu：Intel I5 12400F </li>
<li>主板：微星B660 迫击炮 wifi版</li>
<li>内存：刚威 3600hz 16G * 2</li>
<li>显卡：微星RTX2060 6G</li>
<li>硬盘：铠侠 NVME m.2 pcie3.0 500G </li>
<li>电源：酷冷至尊 G600金牌 600w</li>
<li>cpu散热： 酷冷至尊</li>
<li>风扇：RGB 集线器控制4个 </li>
<li>机箱：乔思伯 U4 plus</li>
</ul>
<h4 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h4><p><img src="/../img/windows-01.png" alt="装机"></p>
<span id="more"></span>

<p><img src="/../img/windows-02.png" alt="装机"></p>
]]></content>
      <categories>
        <category>其他</category>
      </categories>
      <tags>
        <tag>其他</tag>
      </tags>
  </entry>
  <entry>
    <title>《维和步兵营》观后感</title>
    <url>/2017/11/23/%E3%80%8A%E7%BB%B4%E5%92%8C%E6%AD%A5%E5%85%B5%E8%90%A5%E3%80%8B%E8%A7%82%E5%90%8E%E6%84%9F/</url>
    <content><![CDATA[<p>《维和步兵营》看完之后给我给我的感触和启发都颇深，脑子里久久都回荡着里面的每一个场景，不得不说是一部好的电视剧，从《士兵突击》到《我是特种兵》系列到《维和步兵营》不得不让我爱上那种军人气概、军人气节、军人情怀。天气转凉，蜷缩在被窝里，写点观后感，一部电视剧也是一种经历，记录下此刻的心境。</p>
<span id="more"></span>
<p>不是每个人生下来就拥有和平的生活，也不是每个人生下来就该面临残酷的社会境况。当我们在一个和平的国度每天上下班努力打拼赚钱养家，回家能洗上热乎乎的热水澡，晚上抱着媳妇儿孩子睡觉，工作之余出门旅游度假时，或者其他国家的人正在面临着战争、饥荒、疾病、死亡；我们生活在和平的国家，能谈理想、能享受生活，或许他们是否能活过明天都还是未知数。这不电视剧里面有很多都是真实的写照，部落之间的冲突与矛盾，政府军与反政府军的冲突，恐怖分子与资源争夺的冲突，这些都是真实发生在遥远的非洲，非洲人民面临战争、面临饥荒、面临贫穷与落后，里面有多个镜头是他们在马路浑浊的小水沟里取水的场景，看着着实辛酸；小孩们很多都是衣不遮体，很多的小孩和大人为了生活，不得不拿起手中的枪参加杀戮。</p>
<p>《维护步兵营》讲述的是一群训练有素的中国特种部队（隶属于中国特种部队红一连，红一连历史悠久、战功卓绝，跟随毛泽东参加过秋收起义，也称秋收起义红一连）奔赴非洲，维护世界和平的一段故事，在里面，我们看到了中国军人不畏艰难，有勇有谋，敢流血、敢牺牲的英勇精神；他们奔赴远方，头戴蓝盔，走向世界，维护和平。观影过程中不由自主留下四次泪水，有激动的泪水、感人的泪水、也有愤概的泪水，他们不是以个人、集团军的名义走向世界，他们是以国家荣誉而走向世界，13亿中国人是他们坚实的后盾，流血流泪，哪怕是牺牲，他们也只是默默的付出，不求回报。</p>
<p>人物描述</p>
<ul>
<li>戈睿：参军前，一个耀武扬威的公子哥，仗着自己家里有点钱，不可一世，整天都在想给身边的人证明点什么，却什么也没能证明；参军之后，也是一个‘买一赠一’的货，随着机缘来到特种部队，并且进入到红一连的维护部队训练营，毕竟年轻，桀骜不顺，吃过苦头，但还是觉得自己了不起，成天与薛三桥斗嘴，去导非洲之后还与外国士兵为争夺郑百合大打出手；当然，行事正义，为人大方。对于他非常特别的转变应该在薛三桥死后，真正的成熟不少，沉稳、执着，特别是在他给她妈打电话的那一刻，我不忍热泪盈眶。</li>
<li>薛三桥：记忆最深刻的当然是他的口头禅：“我不是针对谁，我也不是挑事的人”，一直都是戈睿的死对头，每次听到他说这句话我都想笑，有了他和戈睿，军营多了很多的欢声笑语、军营氛围；在他被炸弹击中倒下的那一刻，我又重新理解了战友之间的情怀，哪怕不是薛三桥，有可能其他的人也上了，因为在我的理解下，那是一种本能的反应，谁都有可能冲上去，就在冲上去的那一刻，倒下就再也没起来，头上都炸了几个窟窿。</li>
<li>戈向东：商人、退伍军人，有着浓烈的军人情结，不管是在利比亚还是非洲，都为中国军人给予不少的帮助，在他看来军民早就是一家人，同时他的身影，也体现了中国人民对非洲人民作出的贡献与付出，不畏战争，不畏死亡，为世界和平事业奉献一份力量。</li>
<li>岳东明：从《我是特种兵》里面的身影一直到这部戏，给我的感觉都是一个特别刚直不阿、不折不扣的军人，他的言语很有气势也很能打动人，我相信不仅仅是演戏，生活中也是一个很受欢迎的人。他在剧中的角色可以说是一个关键人物，在两连队人重组之后几乎到了快散架的时候，是他的出现稳定了全局；在赵忠宝失意决心离开部队退伍的时候，是他的出现，重新燃起赵忠宝那股战斗热情；在林浩楠决心离开连长一职，走向司令部获取更多情报时，是他的出现，重新带领整个连队继续战斗。他的角色可以说文武双全，有战略思想，同时也有政治情怀，剧中最让他无助的是在他还在部落战争维和的时候，他的母亲却悄然离开了人世，相隔万里，那种思念之痛可想而知；在剧中后半部分的时候，他却因为保护几个孩子，被恐怖分子的火箭弹击中，从此永远离开了红一连。家里有老婆，还有两个孩子，面对这样的情况编剧是不是有点太残忍了。</li>
<li>罗汉：罗汉这个演员还是在《我是特种兵》里面认识的，帅气、冷酷的形象让人记忆尤新，在本剧里面扮演的是林浩楠的助手，参演过很多的电视剧，可能以后也不会是男一号，但是他的人物个性鲜明，演技到位，我现在看这种电视剧有个情结，凡是有特种兵里面的人物，我都会继续看下去。</li>
<li>田爽：饰演者孙晶晶，在里面是个不折不扣的大美女，身材火辣性感，在本剧中为戈向东在非洲企业中的得力经理。。。</li>
</ul>
]]></content>
      <categories>
        <category>生活</category>
      </categories>
      <tags>
        <tag>生活</tag>
      </tags>
  </entry>
  <entry>
    <title>x-admin页面刷新清除tab</title>
    <url>/2023/04/20/x-admin%E9%A1%B5%E9%9D%A2%E5%88%B7%E6%96%B0%E6%B8%85%E9%99%A4tab/</url>
    <content><![CDATA[<blockquote>
<p>x-admin的原生是没有页面刷新（外层）清除tab的，而且是刷新后会停留在最后一个tab上，体验不是很好，这里做下更改</p>
</blockquote>
<p>因为tab部分的代码全部是由js生成的，需要在body上添加一个事件（onbeforeunload）去触发</p>
<h3 id="onbeforeunload"><a href="#onbeforeunload" class="headerlink" title="onbeforeunload"></a>onbeforeunload</h3><p>在即将离开当前页面(刷新或关闭)时执行 JavaScript :</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;body onbeforeunload=<span class="string">&quot;return myFunction()&quot;</span>&gt;</span><br></pre></td></tr></table></figure>

<p>将<body onbeforeunload="return myFunction()"> 放在外层iframe里面</p>
<h3 id="代码实例"><a href="#代码实例" class="headerlink" title="代码实例"></a>代码实例</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;body <span class="class"><span class="keyword">class</span>=&quot;<span class="title">index</span>&quot; <span class="title">onbeforeunload</span>=&quot;<span class="title">close_tabs</span>()&quot;&gt; &lt;!--在即将离开当前页面(刷新或关闭)时执行 <span class="title">JavaScript</span> :--&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">close_tabs</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">   $(<span class="string">&#x27;.layui-tab-title li[lay-id]&#x27;</span>).<span class="title function_ invoke__">find</span>(<span class="string">&#x27;.layui-tab-close&#x27;</span>).<span class="title function_ invoke__">click</span>();</span><br><span class="line">   $(<span class="string">&#x27;#tab_right&#x27;</span>).<span class="title function_ invoke__">hide</span>();</span><br><span class="line">   $(<span class="string">&#x27;#tab_show&#x27;</span>).<span class="title function_ invoke__">hide</span>();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>搞定！也可以在退出、切换账号的时候触发这个关闭所有tab</p>
]]></content>
      <categories>
        <category>javascript</category>
      </categories>
      <tags>
        <tag>javascript</tag>
      </tags>
  </entry>
  <entry>
    <title>x-admin使用的问题整理</title>
    <url>/2023/04/21/x-admin%E4%BD%BF%E7%94%A8%E7%9A%84%E9%97%AE%E9%A2%98%E6%95%B4%E7%90%86/</url>
    <content><![CDATA[<h4 id="1、登录失效如何跳转外层页面"><a href="#1、登录失效如何跳转外层页面" class="headerlink" title="1、登录失效如何跳转外层页面"></a>1、登录失效如何跳转外层页面</h4><p>当登录失效时，如果使用header(“location:&#x2F;admin&#x2F;login”);的方式跳转，就会在内层页面跳转到登录页面，体验非常不好，正确应该使用下面的跳转能跳转到外层页面的登录</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">exit</span>(<span class="string">&#x27;&lt;script&gt;top.location.href= &quot;/admin/login&quot;&lt;/script&gt;&#x27;</span>); </span><br></pre></td></tr></table></figure>

<h4 id="2、如何弹窗页面保存完后跳转并刷新父级页面"><a href="#2、如何弹窗页面保存完后跳转并刷新父级页面" class="headerlink" title="2、如何弹窗页面保存完后跳转并刷新父级页面"></a>2、如何弹窗页面保存完后跳转并刷新父级页面</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获得frame索引</span></span><br><span class="line"><span class="keyword">var</span> index = <span class="built_in">parent</span>.layer.<span class="title function_ invoke__">getFrameIndex</span>(window.name);</span><br><span class="line"><span class="comment">//关闭当前frame</span></span><br><span class="line"><span class="built_in">parent</span>.layer.<span class="title function_ invoke__">close</span>(index);</span><br><span class="line"><span class="comment">// 父页面刷新</span></span><br><span class="line"><span class="built_in">parent</span>.location.<span class="title function_ invoke__">reload</span>();</span><br></pre></td></tr></table></figure>
<h4 id="3、弹窗页面如何更好的提交体验"><a href="#3、弹窗页面如何更好的提交体验" class="headerlink" title="3、弹窗页面如何更好的提交体验"></a>3、弹窗页面如何更好的提交体验</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//监听提交</span></span><br><span class="line">    form.<span class="title function_ invoke__">on</span>(<span class="string">&#x27;submit(add)&#x27;</span>, function(data)&#123;</span><br><span class="line">      console.<span class="title function_ invoke__">log</span>(data);</span><br><span class="line">      <span class="keyword">var</span> a = <span class="literal">true</span>;</span><br><span class="line">      </span><br><span class="line">      $.<span class="title function_ invoke__">post</span>(<span class="string">&#x27;/admin/menu_save&#x27;</span>, data.field, function(res)&#123;</span><br><span class="line">        res = JSON.<span class="title function_ invoke__">parse</span>(res);</span><br><span class="line">        <span class="keyword">if</span>(res.success)&#123;</span><br><span class="line">          <span class="comment">// 获得frame索引</span></span><br><span class="line">          <span class="keyword">var</span> index = <span class="built_in">parent</span>.layer.<span class="title function_ invoke__">getFrameIndex</span>(window.name);</span><br><span class="line">          <span class="comment">//关闭当前frame</span></span><br><span class="line">          <span class="built_in">parent</span>.layer.<span class="title function_ invoke__">close</span>(index);</span><br><span class="line">          <span class="comment">// 父页面刷新</span></span><br><span class="line">          <span class="built_in">parent</span>.location.<span class="title function_ invoke__">reload</span>();</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          layer.<span class="title function_ invoke__">msg</span>(res.msg)</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;  <span class="comment">// 这个return false一定要加</span></span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>javascript</category>
      </categories>
      <tags>
        <tag>javascript</tag>
      </tags>
  </entry>
  <entry>
    <title>web前端HTML播放HLS在线视频流（m3u8）</title>
    <url>/2024/06/17/web%E5%89%8D%E7%AB%AFHTML%E6%92%AD%E6%94%BEHLS%E5%9C%A8%E7%BA%BF%E8%A7%86%E9%A2%91%E6%B5%81%EF%BC%88m3u8%EF%BC%89/</url>
    <content><![CDATA[<p>m3u8为视频流文件，里面包含多个ts文件，ts为视频流切片，很多播放器是无法直接播放m3u8文件的，这里提供两种方式进行在线m3u8视频播放（预览）</p>
<h3 id="1、hls-js"><a href="#1、hls-js" class="headerlink" title="1、hls.js"></a>1、<a href="https://github.com/video-dev/hls.js">hls.js</a></h3><p>前端页面引入js:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;./js/HLC_paly/hls.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>播放代码：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">video</span> <span class="attr">id</span>=<span class="string">&quot;HLS_Player&quot;</span> <span class="attr">autoplay</span>=<span class="string">&quot;autoplay&quot;</span> <span class="attr">loop</span> <span class="attr">muted</span> <span class="attr">controls</span>=<span class="string">&quot;controls&quot;</span> <span class="attr">width</span>=<span class="string">&quot;100%&quot;</span> <span class="attr">height</span>=<span class="string">&quot;100%&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">video</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> &gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">	 HLS_Player = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;HLS_Player&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">if</span> (<span class="title class_">Hls</span>.<span class="title function_">isSupported</span>()) &#123;</span></span><br><span class="line"><span class="language-javascript">			HLS_Controller = <span class="keyword">new</span> <span class="title class_">Hls</span>();</span></span><br><span class="line"><span class="language-javascript">			HLS_Controller.<span class="title function_">loadSource</span>(<span class="string">&quot;视屏流地址&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">			HLS_Controller.<span class="title function_">attachMedia</span>(HLS_Player);</span></span><br><span class="line"><span class="language-javascript">			HLS_Controller.<span class="title function_">on</span>(<span class="title class_">Hls</span>.<span class="property">Events</span>.<span class="property">MANIFEST_PARSED</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">			    HLS_Player.<span class="title function_">play</span>();</span></span><br><span class="line"><span class="language-javascript">	        &#125;);</span></span><br><span class="line"><span class="language-javascript">						</span></span><br><span class="line"><span class="language-javascript">	&#125;</span></span><br><span class="line"><span class="language-javascript"><span class="comment">// hls.js is not supported on platforms that do not have Media Source Extensions (MSE) enabled.</span></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// When the browser has built-in HLS support (check using `canPlayType`), we can provide an HLS manifest (i.e. .m3u8 URL) directly to the video element through the `src` property.</span></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// This is using the built-in support of the plain video element, without using hls.js.</span></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// Note: it would be more normal to wait on the &#x27;canplay&#x27; event below however on Safari (where you are most likely to find built-in HLS support) the video.src URL must be on the user-driven</span></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// white-list before a &#x27;canplay&#x27; event will be emitted; the last video event that can be reliably listened-for when the URL is not on the white-list is &#x27;loadedmetadata&#x27;.</span></span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">else</span> <span class="keyword">if</span> (HLS_Player.<span class="title function_">canPlayType</span>(<span class="string">&#x27;application/vnd.apple.mpegurl&#x27;</span>)) &#123;</span></span><br><span class="line"><span class="language-javascript">		HLS_Player.<span class="property">src</span> = <span class="string">&#x27;http://ivi.bupt.edu.cn/hls/cctv1hd.m3u8&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">		HLS_Player.<span class="title function_">addEventListener</span>(<span class="string">&#x27;loadedmetadata&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">		    HLS_Player.<span class="title function_">play</span>();</span></span><br><span class="line"><span class="language-javascript">		&#125;);</span></span><br><span class="line"><span class="language-javascript">	&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<span id="more"></span>

<h3 id="2、chimee"><a href="#2、chimee" class="headerlink" title="2、chimee"></a>2、<a href="https://github.com/Chimeejs/chimee">chimee</a></h3><p>这个插件不仅支持HTML，而且还支持手机移动端</p>
<p>PC端调用 </p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;http://lib.baomitu.com/chimee-player/1.1.10/chimee-player.browser.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>调用播放视屏流</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;wrapper&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">		<span class="keyword">new</span> <span class="title class_">ChimeePlayer</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">			<span class="attr">wrapper</span>: <span class="string">&#x27;#wrapper&#x27;</span>, <span class="comment">// video dom容器</span></span></span><br><span class="line"><span class="language-javascript">			<span class="attr">src</span>: <span class="string">&#x27;http://ivi.bupt.edu.cn/hls/cctv1hd.m3u8&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">			<span class="attr">box</span>: <span class="string">&#x27;hls&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">			<span class="attr">isLive</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">			<span class="attr">autoplay</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">			<span class="attr">controls</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">		&#125;);</span></span><br><span class="line"><span class="language-javascript">	</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>


]]></content>
      <categories>
        <category>html</category>
      </categories>
      <tags>
        <tag>html</tag>
      </tags>
  </entry>
  <entry>
    <title>微信公众号开发-测试号申请及配置</title>
    <url>/2018/09/29/%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7%E5%BC%80%E5%8F%91-%E6%B5%8B%E8%AF%95%E5%8F%B7%E7%94%B3%E8%AF%B7%E5%8F%8A%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<blockquote>
<p>微信公众号的开发在目前来说还有占有一定的市场比重的，因为它具有它独有的特点已经有点，所以目前还有一大部分项目仍然是嫁接在微信公众号上面作为出入口的；目前有绝大部分的公司内部都有自己的测试（test）环境，当然有的公司具有多个测试环境，代码的冒烟、压测等都在是测试环境完成的，所以对应的我们也需要申请测试版的微信公众号作为开发测试所需要的必备工具，本篇文章主要就是讲述的如何申请微信测试公众号以及参数配置。</p>
</blockquote>
<h3 id="申请地址"><a href="#申请地址" class="headerlink" title="申请地址"></a>申请地址</h3><p>地址：<a href="https://mp.weixin.qq.com/wiki?t=resource/res_main&id=mp1421137522">https://mp.weixin.qq.com/wiki?t=resource/res_main&amp;id=mp1421137522</a></p>
<span id="more"></span>

<p>登录地址之后，通过自己的微信扫码登录后进入到测试号管理界面，每个测试号都会对应的分配一组appID和appsecret，这两个参数在开发的时候会用到。</p>
<p><img src="/../img/wx-test-01.png" alt="wechat"></p>
<h3 id="参数配置"><a href="#参数配置" class="headerlink" title="参数配置"></a>参数配置</h3><h4 id="接口配置信息修改"><a href="#接口配置信息修改" class="headerlink" title="接口配置信息修改"></a>接口配置信息修改</h4><p>测试号管理里面有个接口配置信息修改，里面对应有URL和Token两个值的修改</p>
<p>URL：此参数是微信端来验证开发者这端是否拥有自己的服务器资源，填入的地址必须是一个外网能访问到的地址（路由），同时必须是80端口，否者无法配置该参数；</p>
<p>Token：这个值为开发者与微信公众平台约定的一个字符串，可以自定义，两者一致即可；</p>
<p>备注：在很多公司代码在未上线之前，对应的开发项目可能只是一个测试的域名，该域名还有可能只能内网访问，这个时候就需要对测试域名做外网映射处理，让外网也能访问到该测试域名，不然该URL参数无法配置。</p>
<p><img src="/../img/wx-test-02.png" alt="wechat"></p>
<h4 id="JS接口安全域名修改"><a href="#JS接口安全域名修改" class="headerlink" title="JS接口安全域名修改"></a>JS接口安全域名修改</h4><p>设置JS接口安全域后，通过关注该测试号，开发者即可在该域名下调用微信开放的JS接口，这里的域名一般填写项目对应的域名即可</p>
<p><img src="/../img/wx-test-03.png" alt="wechat"></p>
<h4 id="OAuth2-0-网页授权"><a href="#OAuth2-0-网页授权" class="headerlink" title="OAuth2.0 网页授权"></a>OAuth2.0 网页授权</h4><p>在该页面的下面的体验接口权限表里面有一个网页授权获取用户基本信息的参数配置，点击修改后，授权回调页面域名填入项目对应的域名即可，不然前端页面会报一个10003的错误。</p>
<p><img src="/../img/wx-test-04.png" alt="wechat"></p>
<p>在此时所有的参数配置好之后，就可以做正常的开发了，有的公司或许有多个线下环境（灰度、预发布、性能）等，也可以同样的方式申请不同环境的微信测试公众号作为开发需要。</p>
]]></content>
      <categories>
        <category>php</category>
      </categories>
      <tags>
        <tag>php</tag>
      </tags>
  </entry>
  <entry>
    <title>supervisor的安装以及使用</title>
    <url>/2023/04/04/supervisor%E7%9A%84%E5%AE%89%E8%A3%85%E4%BB%A5%E5%8F%8A%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<blockquote>
<p>本文只针对于centos7以上系统</p>
</blockquote>
<h3 id="supervisor简介"><a href="#supervisor简介" class="headerlink" title="supervisor简介"></a>supervisor简介</h3><p>supervisor是一个用python语言编写的进程管理工具，它可以很方便的监听、启动、停止、重启一个或多个进程。当一个进程意外被杀死，supervisor监听到进程死后，可以很方便的让进程自动恢复，不再需要程序员或系统管理员自己编写代码来控制。</p>
<h3 id="supervisor-会涉及三个重要的命令"><a href="#supervisor-会涉及三个重要的命令" class="headerlink" title="supervisor 会涉及三个重要的命令"></a>supervisor 会涉及三个重要的命令</h3><ul>
<li>supervisord</li>
</ul>
<p>运行supervisor时会启动一个进程supervisord，它负责启动所管理的进程，并将所管理的进程作为自己的子进程来启动，而且可以在所管理的进程出现崩溃时自动重启</p>
<ul>
<li>supervisorctl</li>
</ul>
<p>可以理解成supervisor的客户端，upervisorctl是命令行管理工具，可以用如下命令来进行子进程的管理</p>
<ul>
<li>echo_supervisord_conf</li>
</ul>
<p>用来生成默认的配置文件,一般生成默认文件为 supervisor.conf</p>
<p>supervisor是用python写的运行在linux下的进程管理工具，安装supervisor的时候依赖 python的一些包，它依赖：python、setuptools、meld3</p>
<span id="more"></span>

<h3 id="安装及配置"><a href="#安装及配置" class="headerlink" title="安装及配置"></a>安装及配置</h3><h4 id="1、安装supervisor"><a href="#1、安装supervisor" class="headerlink" title="1、安装supervisor"></a>1、安装supervisor</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">yum -y install supervisor</span><br></pre></td></tr></table></figure>

<h4 id="2、配置文件生成-supervisord-conf"><a href="#2、配置文件生成-supervisord-conf" class="headerlink" title="2、配置文件生成 supervisord.conf"></a>2、配置文件生成 supervisord.conf</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">echo_supervisord_conf  &gt; /etc/supervisord.conf</span><br></pre></td></tr></table></figure>

<h4 id="3、配置文件的修改"><a href="#3、配置文件的修改" class="headerlink" title="3、配置文件的修改"></a>3、配置文件的修改</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">vi /etc/supervisord.conf</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">[unix_http_server]</span><br><span class="line">;file=/tmp/supervisor.sock   ; (the path to the socket file)</span><br><span class="line">file=/<span class="keyword">var</span>/run/supervisor.sock   ; 修改为 /<span class="keyword">var</span>/run 目录，避免被系统删除</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">[supervisord]</span><br><span class="line">;logfile=/tmp/supervisord.log ; (main log file;<span class="keyword">default</span> <span class="variable">$CWD</span>/supervisord.log)</span><br><span class="line">logfile=/<span class="keyword">var</span>/log/supervisor/supervisord.log ; 修改为 /<span class="keyword">var</span>/log 目录，避免被系统删除</span><br><span class="line">pidfile=/<span class="keyword">var</span>/run/supervisord.pid ; 修改为 /<span class="keyword">var</span>/run 目录，避免被系统删除</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">[supervisorctl]</span><br><span class="line">; 必须和<span class="string">&#x27;unix_http_server&#x27;</span>里面的设定匹配</span><br><span class="line">;serverurl=unix:<span class="comment">///tmp/supervisor.sock ; use a unix:// URL  for a unix socket</span></span><br><span class="line">serverurl=unix:<span class="comment">///var/run/supervisor.sock ; 修改为 /var/run 目录，避免被系统删除</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 更改加载子程序位置</span></span><br><span class="line"></span><br><span class="line">[<span class="keyword">include</span>]</span><br><span class="line">files = supervisord.d<span class="comment">/*.ini</span></span><br></pre></td></tr></table></figure>


<p>配置文件全文参考：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">; Sample supervisor config file.</span><br><span class="line"></span><br><span class="line">[unix_http_server]</span><br><span class="line">file=/run/supervisor/supervisor.sock   ; (the path to the socket file)</span><br><span class="line">;chmod=<span class="number">0700</span>                 ; sockef file <span class="title function_ invoke__">mode</span> (<span class="keyword">default</span> <span class="number">0700</span>)</span><br><span class="line">;chown=nobody:nogroup       ; socket file uid:gid owner</span><br><span class="line">;username=user              ; (<span class="keyword">default</span> is no <span class="title function_ invoke__">username</span> (open server))</span><br><span class="line">;password=<span class="number">123</span>               ; (<span class="keyword">default</span> is no <span class="title function_ invoke__">password</span> (open server))</span><br><span class="line"></span><br><span class="line">;[inet_http_server]         ; <span class="title function_ invoke__">inet</span> (TCP) server disabled by <span class="keyword">default</span></span><br><span class="line">;port=<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">9001</span>        ; (ip_address:port specifier, *:port <span class="keyword">for</span> all iface)</span><br><span class="line">;username=user              ; (<span class="keyword">default</span> is no <span class="title function_ invoke__">username</span> (open server))</span><br><span class="line">;password=<span class="number">123</span>               ; (<span class="keyword">default</span> is no <span class="title function_ invoke__">password</span> (open server))</span><br><span class="line"></span><br><span class="line">[supervisord]</span><br><span class="line">logfile=/<span class="keyword">var</span>/log/supervisor/supervisord.log  ; (main log file;<span class="keyword">default</span> <span class="variable">$CWD</span>/supervisord.log)</span><br><span class="line">logfile_maxbytes=<span class="number">50</span>MB       ; (max main logfile bytes b4 rotation;<span class="keyword">default</span> <span class="number">50</span>MB)</span><br><span class="line">logfile_backups=<span class="number">10</span>          ; (num of main logfile rotation backups;<span class="keyword">default</span> <span class="number">10</span>)</span><br><span class="line">loglevel=info               ; (log level;<span class="keyword">default</span> info; others: debug,warn,trace)</span><br><span class="line">pidfile=/run/supervisord.pid ; (supervisord pidfile;<span class="keyword">default</span> supervisord.pid)</span><br><span class="line">nodaemon=<span class="literal">false</span>              ; (start in foreground <span class="keyword">if</span> <span class="literal">true</span>;<span class="keyword">default</span> <span class="literal">false</span>)</span><br><span class="line">minfds=<span class="number">1024</span>                 ; (min. avail startup file descriptors;<span class="keyword">default</span> <span class="number">1024</span>)</span><br><span class="line">minprocs=<span class="number">200</span>                ; (min. avail process descriptors;<span class="keyword">default</span> <span class="number">200</span>)</span><br><span class="line">;umask=<span class="number">022</span>                  ; (process file creation umask;<span class="keyword">default</span> <span class="number">022</span>)</span><br><span class="line">;user=chrism                 ; (<span class="keyword">default</span> is current user, required <span class="keyword">if</span> root)</span><br><span class="line">;identifier=supervisor       ; (supervisord identifier, <span class="keyword">default</span> is <span class="string">&#x27;supervisor&#x27;</span>)</span><br><span class="line">;directory=/tmp              ; (<span class="keyword">default</span> is not to cd during start)</span><br><span class="line">;nocleanup=<span class="literal">true</span>              ; (don<span class="string">&#x27;t clean up tempfiles at start;default false)</span></span><br><span class="line"><span class="string">;childlogdir=/tmp            ; (&#x27;</span>AUTO<span class="string">&#x27; child log dir, default $TEMP)</span></span><br><span class="line"><span class="string">;environment=KEY=value       ; (key value pairs to add to environment)</span></span><br><span class="line"><span class="string">;strip_ansi=false            ; (strip ansi escape codes in logs; def. false)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">; the below section must remain in the config file for RPC</span></span><br><span class="line"><span class="string">; (supervisorctl/web interface) to work, additional interfaces may be</span></span><br><span class="line"><span class="string">; added by defining them in separate rpcinterface: sections</span></span><br><span class="line"><span class="string">[rpcinterface:supervisor]</span></span><br><span class="line"><span class="string">supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface</span></span><br><span class="line"><span class="string">&quot;/etc/supervisord.conf&quot; 129L, 7941C                                                                           1,1          顶端</span></span><br><span class="line"><span class="string">; Sample supervisor config file.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[unix_http_server]</span></span><br><span class="line"><span class="string">file=/run/supervisor/supervisor.sock   ; (the path to the socket file)</span></span><br><span class="line"><span class="string">;chmod=0700                 ; sockef file mode (default 0700)</span></span><br><span class="line"><span class="string">;chown=nobody:nogroup       ; socket file uid:gid owner</span></span><br><span class="line"><span class="string">;username=user              ; (default is no username (open server))</span></span><br><span class="line"><span class="string">;password=123               ; (default is no password (open server))</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">;[inet_http_server]         ; inet (TCP) server disabled by default</span></span><br><span class="line"><span class="string">;port=127.0.0.1:9001        ; (ip_address:port specifier, *:port for all iface)</span></span><br><span class="line"><span class="string">;username=user              ; (default is no username (open server))</span></span><br><span class="line"><span class="string">;password=123               ; (default is no password (open server))</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[supervisord]</span></span><br><span class="line"><span class="string">logfile=/var/log/supervisor/supervisord.log  ; (main log file;default $CWD/supervisord.log)</span></span><br><span class="line"><span class="string">logfile_maxbytes=50MB       ; (max main logfile bytes b4 rotation;default 50MB)</span></span><br><span class="line"><span class="string">logfile_backups=10          ; (num of main logfile rotation backups;default 10)</span></span><br><span class="line"><span class="string">loglevel=info               ; (log level;default info; others: debug,warn,trace)</span></span><br><span class="line"><span class="string">pidfile=/run/supervisord.pid ; (supervisord pidfile;default supervisord.pid)</span></span><br><span class="line"><span class="string">nodaemon=false              ; (start in foreground if true;default false)</span></span><br><span class="line"><span class="string">minfds=1024                 ; (min. avail startup file descriptors;default 1024)</span></span><br><span class="line"><span class="string">minprocs=200                ; (min. avail process descriptors;default 200)</span></span><br><span class="line"><span class="string">;umask=022                  ; (process file creation umask;default 022)</span></span><br><span class="line"><span class="string">;user=chrism                 ; (default is current user, required if root)</span></span><br><span class="line"><span class="string">;identifier=supervisor       ; (supervisord identifier, default is &#x27;</span>supervisor<span class="string">&#x27;)</span></span><br><span class="line"><span class="string">;directory=/tmp              ; (default is not to cd during start)</span></span><br><span class="line"><span class="string">;nocleanup=true              ; (don&#x27;</span>t clean up tempfiles at start;<span class="keyword">default</span> <span class="literal">false</span>)</span><br><span class="line">;childlogdir=/tmp            ; (<span class="string">&#x27;AUTO&#x27;</span> child log dir, <span class="keyword">default</span> <span class="variable">$TEMP</span>)</span><br><span class="line">;environment=KEY=value       ; (key value pairs to add to environment)</span><br><span class="line">;strip_ansi=<span class="literal">false</span>            ; (strip ansi escape codes in logs; def. <span class="literal">false</span>)</span><br><span class="line"></span><br><span class="line">; the below section must remain in the config file <span class="keyword">for</span> RPC</span><br><span class="line">; (supervisorctl/web <span class="class"><span class="keyword">interface</span>) <span class="title">to</span> <span class="title">work</span>, <span class="title">additional</span> <span class="title">interfaces</span> <span class="title">may</span> <span class="title">be</span></span></span><br><span class="line"><span class="class">; <span class="title">added</span> <span class="title">by</span> <span class="title">defining</span> <span class="title">them</span> <span class="title">in</span> <span class="title">separate</span> <span class="title">rpcinterface</span>: <span class="title">sections</span></span></span><br><span class="line"><span class="class">[<span class="title">rpcinterface</span>:<span class="title">supervisor</span>]</span></span><br><span class="line"><span class="class"><span class="title">supervisor</span>.<span class="title">rpcinterface_factory</span> = <span class="title">supervisor</span>.<span class="title">rpcinterface</span>:<span class="title">make_main_rpcinterface</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">[<span class="title">supervisorctl</span>]</span></span><br><span class="line"><span class="class"><span class="title">serverurl</span>=<span class="title">unix</span>:///<span class="title">run</span>/<span class="title">supervisor</span>/<span class="title">supervisor</span>.<span class="title">sock</span> ; <span class="title">use</span> <span class="title">a</span> <span class="title">unix</span>:// <span class="title">URL</span>  <span class="title">for</span> <span class="title">a</span> <span class="title">unix</span> <span class="title">socket</span></span></span><br><span class="line"><span class="class">;<span class="title">serverurl</span>=<span class="title">http</span>://127.0.0.1:9001 ; <span class="title">use</span> <span class="title">an</span> <span class="title">http</span>:// <span class="title">url</span> <span class="title">to</span> <span class="title">specify</span> <span class="title">an</span> <span class="title">inet</span> <span class="title">socket</span></span></span><br><span class="line"><span class="class">;<span class="title">username</span>=<span class="title">chris</span>              ; <span class="title">should</span> <span class="title">be</span> <span class="title">same</span> <span class="title">as</span> <span class="title">http_username</span> <span class="title">if</span> <span class="title">set</span></span></span><br><span class="line"><span class="class">;<span class="title">password</span>=123                ; <span class="title">should</span> <span class="title">be</span> <span class="title">same</span> <span class="title">as</span> <span class="title">http_password</span> <span class="title">if</span> <span class="title">set</span></span></span><br><span class="line"><span class="class">;<span class="title">prompt</span>=<span class="title">mysupervisor</span>         ; <span class="title">cmd</span> <span class="title">line</span> <span class="title">prompt</span> (<span class="title">default</span> &quot;<span class="title">supervisor</span>&quot;)</span></span><br><span class="line"><span class="class">;<span class="title">history_file</span>=~/.<span class="title">sc_history</span>  ; <span class="title">use</span> <span class="title">readline</span> <span class="title">history</span> <span class="title">if</span> <span class="title">available</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">; <span class="title">The</span> <span class="title">below</span> <span class="title">sample</span> <span class="title">program</span> <span class="title">section</span> <span class="title">shows</span> <span class="title">all</span> <span class="title">possible</span> <span class="title">program</span> <span class="title">subsection</span> <span class="title">values</span>,</span></span><br><span class="line"><span class="class">; <span class="title">create</span> <span class="title">one</span> <span class="title">or</span> <span class="title">more</span> &#x27;<span class="title">real</span>&#x27; <span class="title">program</span>: <span class="title">sections</span> <span class="title">to</span> <span class="title">be</span> <span class="title">able</span> <span class="title">to</span> <span class="title">control</span> <span class="title">them</span> <span class="title">under</span></span></span><br><span class="line"><span class="class">; <span class="title">supervisor</span>.</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">;[<span class="title">program</span>:<span class="title">theprogramname</span>]</span></span><br><span class="line"><span class="class">;<span class="title">command</span>=/<span class="title">bin</span>/<span class="title">cat</span>              ; <span class="title">the</span> <span class="title">program</span> (<span class="title">relative</span> <span class="title">uses</span> <span class="title">PATH</span>, <span class="title">can</span> <span class="title">take</span> <span class="title">args</span>)</span></span><br><span class="line"><span class="class">;<span class="title">process_name</span>=%(<span class="title">program_name</span>)<span class="title">s</span> ; <span class="title">process_name</span> <span class="title">expr</span> (<span class="title">default</span> %(<span class="title">program_name</span>)<span class="title">s</span>)</span></span><br><span class="line"><span class="class">;<span class="title">numprocs</span>=1                    ; <span class="title">number</span> <span class="title">of</span> <span class="title">processes</span> <span class="title">copies</span> <span class="title">to</span> <span class="title">start</span> (<span class="title">def</span> 1)</span></span><br><span class="line"><span class="class">;<span class="title">directory</span>=/<span class="title">tmp</span>                ; <span class="title">directory</span> <span class="title">to</span> <span class="title">cwd</span> <span class="title">to</span> <span class="title">before</span> <span class="title">exec</span> (<span class="title">def</span> <span class="title">no</span> <span class="title">cwd</span>)</span></span><br><span class="line"><span class="class">;<span class="title">umask</span>=022                     ; <span class="title">umask</span> <span class="title">for</span> <span class="title">process</span> (<span class="title">default</span> <span class="title">None</span>)</span></span><br><span class="line"><span class="class">;<span class="title">priority</span>=999                  ; <span class="title">the</span> <span class="title">relative</span> <span class="title">start</span> <span class="title">priority</span> (<span class="title">default</span> 999)</span></span><br><span class="line"><span class="class">;<span class="title">autostart</span>=<span class="title">true</span>                ; <span class="title">start</span> <span class="title">at</span> <span class="title">supervisord</span> <span class="title">start</span> (<span class="title">default</span>: <span class="title">true</span>)</span></span><br><span class="line"><span class="class">;<span class="title">autorestart</span>=<span class="title">true</span>              ; <span class="title">retstart</span> <span class="title">at</span> <span class="title">unexpected</span> <span class="title">quit</span> (<span class="title">default</span>: <span class="title">true</span>)</span></span><br><span class="line"><span class="class">;<span class="title">startsecs</span>=10                  ; <span class="title">number</span> <span class="title">of</span> <span class="title">secs</span> <span class="title">prog</span> <span class="title">must</span> <span class="title">stay</span> <span class="title">running</span> (<span class="title">def</span>. 1)</span></span><br><span class="line"><span class="class">;<span class="title">startretries</span>=3                ; <span class="title">max</span> # <span class="title">of</span> <span class="title">serial</span> <span class="title">start</span> <span class="title">failures</span> (<span class="title">default</span> 3)</span></span><br><span class="line"><span class="class">;<span class="title">exitcodes</span>=0,2                 ; &#x27;<span class="title">expected</span>&#x27; <span class="title">exit</span> <span class="title">codes</span> <span class="title">for</span> <span class="title">process</span> (<span class="title">default</span> 0,2)</span></span><br><span class="line"><span class="class">;<span class="title">stopsignal</span>=<span class="title">QUIT</span>               ; <span class="title">signal</span> <span class="title">used</span> <span class="title">to</span> <span class="title">kill</span> <span class="title">process</span> (<span class="title">default</span> <span class="title">TERM</span>)</span></span><br><span class="line"><span class="class">;<span class="title">stopwaitsecs</span>=10               ; <span class="title">max</span> <span class="title">num</span> <span class="title">secs</span> <span class="title">to</span> <span class="title">wait</span> <span class="title">b4</span> <span class="title">SIGKILL</span> (<span class="title">default</span> 10)</span></span><br><span class="line"><span class="class">;<span class="title">user</span>=<span class="title">chrism</span>                   ; <span class="title">setuid</span> <span class="title">to</span> <span class="title">this</span> <span class="title">UNIX</span> <span class="title">account</span> <span class="title">to</span> <span class="title">run</span> <span class="title">the</span> <span class="title">program</span></span></span><br><span class="line"><span class="class">;<span class="title">redirect_stderr</span>=<span class="title">true</span>          ; <span class="title">redirect</span> <span class="title">proc</span> <span class="title">stderr</span> <span class="title">to</span> <span class="title">stdout</span> (<span class="title">default</span> <span class="title">false</span>)</span></span><br><span class="line"><span class="class">;<span class="title">stdout_logfile</span>=/<span class="title">a</span>/<span class="title">path</span>        ; <span class="title">stdout</span> <span class="title">log</span> <span class="title">path</span>, <span class="title">NONE</span> <span class="title">for</span> <span class="title">none</span>; <span class="title">default</span> <span class="title">AUTO</span></span></span><br><span class="line"><span class="class">;<span class="title">stdout_logfile_maxbytes</span>=1<span class="title">MB</span>   ; <span class="title">max</span> # <span class="title">logfile</span> <span class="title">bytes</span> <span class="title">b4</span> <span class="title">rotation</span> (<span class="title">default</span> 50<span class="title">MB</span>)</span></span><br><span class="line"><span class="class">;<span class="title">stdout_logfile_backups</span>=10     ; # <span class="title">of</span> <span class="title">stdout</span> <span class="title">logfile</span> <span class="title">backups</span> (<span class="title">default</span> 10)</span></span><br><span class="line"><span class="class">;<span class="title">stdout_capture_maxbytes</span>=1<span class="title">MB</span>   ; <span class="title">number</span> <span class="title">of</span> <span class="title">bytes</span> <span class="title">in</span> &#x27;<span class="title">capturemode</span>&#x27; (<span class="title">default</span> 0)</span></span><br><span class="line"><span class="class">;<span class="title">stdout_events_enabled</span>=<span class="title">false</span>   ; <span class="title">emit</span> <span class="title">events</span> <span class="title">on</span> <span class="title">stdout</span> <span class="title">writes</span> (<span class="title">default</span> <span class="title">false</span>)</span></span><br><span class="line"><span class="class">;<span class="title">stderr_logfile</span>=/<span class="title">a</span>/<span class="title">path</span>        ; <span class="title">stderr</span> <span class="title">log</span> <span class="title">path</span>, <span class="title">NONE</span> <span class="title">for</span> <span class="title">none</span>; <span class="title">default</span> <span class="title">AUTO</span></span></span><br><span class="line"><span class="class">;<span class="title">stderr_logfile_maxbytes</span>=1<span class="title">MB</span>   ; <span class="title">max</span> # <span class="title">logfile</span> <span class="title">bytes</span> <span class="title">b4</span> <span class="title">rotation</span> (<span class="title">default</span> 50<span class="title">MB</span>)</span></span><br><span class="line"><span class="class">;<span class="title">stderr_logfile_backups</span>=10     ; # <span class="title">of</span> <span class="title">stderr</span> <span class="title">logfile</span> <span class="title">backups</span> (<span class="title">default</span> 10)</span></span><br><span class="line"><span class="class">;<span class="title">stderr_capture_maxbytes</span>=1<span class="title">MB</span>   ; <span class="title">number</span> <span class="title">of</span> <span class="title">bytes</span> <span class="title">in</span> &#x27;<span class="title">capturemode</span>&#x27; (<span class="title">default</span> 0)</span></span><br><span class="line"><span class="class">;<span class="title">stderr_events_enabled</span>=<span class="title">false</span>   ; <span class="title">emit</span> <span class="title">events</span> <span class="title">on</span> <span class="title">stderr</span> <span class="title">writes</span> (<span class="title">default</span> <span class="title">false</span>)</span></span><br><span class="line"><span class="class">;<span class="title">environment</span>=<span class="title">A</span>=1,<span class="title">B</span>=2           ; <span class="title">process</span> <span class="title">environment</span> <span class="title">additions</span> (<span class="title">def</span> <span class="title">no</span> <span class="title">adds</span>)</span></span><br><span class="line"><span class="class">;<span class="title">serverurl</span>=<span class="title">AUTO</span>                ; <span class="title">override</span> <span class="title">serverurl</span> <span class="title">computation</span> (<span class="title">childutils</span>)</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">; <span class="title">The</span> <span class="title">below</span> <span class="title">sample</span> <span class="title">eventlistener</span> <span class="title">section</span> <span class="title">shows</span> <span class="title">all</span> <span class="title">possible</span></span></span><br><span class="line"><span class="class">; <span class="title">eventlistener</span> <span class="title">subsection</span> <span class="title">values</span>, <span class="title">create</span> <span class="title">one</span> <span class="title">or</span> <span class="title">more</span> &#x27;<span class="title">real</span>&#x27;</span></span><br><span class="line"><span class="class">; <span class="title">eventlistener</span>: <span class="title">sections</span> <span class="title">to</span> <span class="title">be</span> <span class="title">able</span> <span class="title">to</span> <span class="title">handle</span> <span class="title">event</span> <span class="title">notifications</span></span></span><br><span class="line"><span class="class">; <span class="title">sent</span> <span class="title">by</span> <span class="title">supervisor</span>.</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">;[<span class="title">eventlistener</span>:<span class="title">theeventlistenername</span>]</span></span><br><span class="line"><span class="class">;<span class="title">command</span>=/<span class="title">bin</span>/<span class="title">eventlistener</span>    ; <span class="title">the</span> <span class="title">program</span> (<span class="title">relative</span> <span class="title">uses</span> <span class="title">PATH</span>, <span class="title">can</span> <span class="title">take</span> <span class="title">args</span>)</span></span><br><span class="line"><span class="class">;<span class="title">process_name</span>=%(<span class="title">program_name</span>)<span class="title">s</span> ; <span class="title">process_name</span> <span class="title">expr</span> (<span class="title">default</span> %(<span class="title">program_name</span>)<span class="title">s</span>)</span></span><br><span class="line"><span class="class">;<span class="title">numprocs</span>=1                    ; <span class="title">number</span> <span class="title">of</span> <span class="title">processes</span> <span class="title">copies</span> <span class="title">to</span> <span class="title">start</span> (<span class="title">def</span> 1)</span></span><br><span class="line"><span class="class">;<span class="title">events</span>=<span class="title">EVENT</span>                  ; <span class="title">event</span> <span class="title">notif</span>. <span class="title">types</span> <span class="title">to</span> <span class="title">subscribe</span> <span class="title">to</span> (<span class="title">req</span>&#x27;<span class="title">d</span>)</span></span><br><span class="line"><span class="class">;<span class="title">buffer_size</span>=10                ; <span class="title">event</span> <span class="title">buffer</span> <span class="title">queue</span> <span class="title">size</span> (<span class="title">default</span> 10)</span></span><br><span class="line"><span class="class">;<span class="title">directory</span>=/<span class="title">tmp</span>                ; <span class="title">directory</span> <span class="title">to</span> <span class="title">cwd</span> <span class="title">to</span> <span class="title">before</span> <span class="title">exec</span> (<span class="title">def</span> <span class="title">no</span> <span class="title">cwd</span>)</span></span><br><span class="line"><span class="class">;<span class="title">umask</span>=022                     ; <span class="title">umask</span> <span class="title">for</span> <span class="title">process</span> (<span class="title">default</span> <span class="title">None</span>)</span></span><br><span class="line"><span class="class">;<span class="title">umask</span>=022                     ; <span class="title">umask</span> <span class="title">for</span> <span class="title">process</span> (<span class="title">default</span> <span class="title">None</span>)</span></span><br><span class="line"><span class="class">;<span class="title">priority</span>=999                  ; <span class="title">the</span> <span class="title">relative</span> <span class="title">start</span> <span class="title">priority</span> (<span class="title">default</span> 999)</span></span><br><span class="line"><span class="class">;<span class="title">autostart</span>=<span class="title">true</span>                ; <span class="title">start</span> <span class="title">at</span> <span class="title">supervisord</span> <span class="title">start</span> (<span class="title">default</span>: <span class="title">true</span>)</span></span><br><span class="line"><span class="class">;<span class="title">autorestart</span>=<span class="title">true</span>              ; <span class="title">retstart</span> <span class="title">at</span> <span class="title">unexpected</span> <span class="title">quit</span> (<span class="title">default</span>: <span class="title">true</span>)</span></span><br><span class="line"><span class="class">;<span class="title">startsecs</span>=10                  ; <span class="title">number</span> <span class="title">of</span> <span class="title">secs</span> <span class="title">prog</span> <span class="title">must</span> <span class="title">stay</span> <span class="title">running</span> (<span class="title">def</span>. 1)</span></span><br><span class="line"><span class="class">;<span class="title">startretries</span>=3                ; <span class="title">max</span> # <span class="title">of</span> <span class="title">serial</span> <span class="title">start</span> <span class="title">failures</span> (<span class="title">default</span> 3)</span></span><br><span class="line"><span class="class">;<span class="title">exitcodes</span>=0,2                 ; &#x27;<span class="title">expected</span>&#x27; <span class="title">exit</span> <span class="title">codes</span> <span class="title">for</span> <span class="title">process</span> (<span class="title">default</span> 0,2)</span></span><br><span class="line"><span class="class">;<span class="title">stopsignal</span>=<span class="title">QUIT</span>               ; <span class="title">signal</span> <span class="title">used</span> <span class="title">to</span> <span class="title">kill</span> <span class="title">process</span> (<span class="title">default</span> <span class="title">TERM</span>)</span></span><br><span class="line"><span class="class">;<span class="title">stopwaitsecs</span>=10               ; <span class="title">max</span> <span class="title">num</span> <span class="title">secs</span> <span class="title">to</span> <span class="title">wait</span> <span class="title">b4</span> <span class="title">SIGKILL</span> (<span class="title">default</span> 10)</span></span><br><span class="line"><span class="class">;<span class="title">user</span>=<span class="title">chrism</span>                   ; <span class="title">setuid</span> <span class="title">to</span> <span class="title">this</span> <span class="title">UNIX</span> <span class="title">account</span> <span class="title">to</span> <span class="title">run</span> <span class="title">the</span> <span class="title">program</span></span></span><br><span class="line"><span class="class">;<span class="title">redirect_stderr</span>=<span class="title">true</span>          ; <span class="title">redirect</span> <span class="title">proc</span> <span class="title">stderr</span> <span class="title">to</span> <span class="title">stdout</span> (<span class="title">default</span> <span class="title">false</span>)</span></span><br><span class="line"><span class="class">;<span class="title">stdout_logfile</span>=/<span class="title">a</span>/<span class="title">path</span>        ; <span class="title">stdout</span> <span class="title">log</span> <span class="title">path</span>, <span class="title">NONE</span> <span class="title">for</span> <span class="title">none</span>; <span class="title">default</span> <span class="title">AUTO</span></span></span><br><span class="line"><span class="class">;<span class="title">stdout_logfile_maxbytes</span>=1<span class="title">MB</span>   ; <span class="title">max</span> # <span class="title">logfile</span> <span class="title">bytes</span> <span class="title">b4</span> <span class="title">rotation</span> (<span class="title">default</span> 50<span class="title">MB</span>)</span></span><br><span class="line"><span class="class">;<span class="title">stdout_logfile_backups</span>=10     ; # <span class="title">of</span> <span class="title">stdout</span> <span class="title">logfile</span> <span class="title">backups</span> (<span class="title">default</span> 10)</span></span><br><span class="line"><span class="class">;<span class="title">stdout_capture_maxbytes</span>=1<span class="title">MB</span>   ; <span class="title">number</span> <span class="title">of</span> <span class="title">bytes</span> <span class="title">in</span> &#x27;<span class="title">capturemode</span>&#x27; (<span class="title">default</span> 0)</span></span><br><span class="line"><span class="class">;<span class="title">stdout_events_enabled</span>=<span class="title">false</span>   ; <span class="title">emit</span> <span class="title">events</span> <span class="title">on</span> <span class="title">stdout</span> <span class="title">writes</span> (<span class="title">default</span> <span class="title">false</span>)</span></span><br><span class="line"><span class="class">;<span class="title">stderr_logfile</span>=/<span class="title">a</span>/<span class="title">path</span>        ; <span class="title">stderr</span> <span class="title">log</span> <span class="title">path</span>, <span class="title">NONE</span> <span class="title">for</span> <span class="title">none</span>; <span class="title">default</span> <span class="title">AUTO</span></span></span><br><span class="line"><span class="class">;<span class="title">stderr_logfile_maxbytes</span>=1<span class="title">MB</span>   ; <span class="title">max</span> # <span class="title">logfile</span> <span class="title">bytes</span> <span class="title">b4</span> <span class="title">rotation</span> (<span class="title">default</span> 50<span class="title">MB</span>)</span></span><br><span class="line"><span class="class">;<span class="title">stderr_logfile_backups</span>=10     ; # <span class="title">of</span> <span class="title">stderr</span> <span class="title">logfile</span> <span class="title">backups</span> (<span class="title">default</span> 10)</span></span><br><span class="line"><span class="class">;<span class="title">stderr_capture_maxbytes</span>=1<span class="title">MB</span>   ; <span class="title">number</span> <span class="title">of</span> <span class="title">bytes</span> <span class="title">in</span> &#x27;<span class="title">capturemode</span>&#x27; (<span class="title">default</span> 0)</span></span><br><span class="line"><span class="class">;<span class="title">stderr_events_enabled</span>=<span class="title">false</span>   ; <span class="title">emit</span> <span class="title">events</span> <span class="title">on</span> <span class="title">stderr</span> <span class="title">writes</span> (<span class="title">default</span> <span class="title">false</span>)</span></span><br><span class="line"><span class="class">;<span class="title">environment</span>=<span class="title">A</span>=1,<span class="title">B</span>=2           ; <span class="title">process</span> <span class="title">environment</span> <span class="title">additions</span> (<span class="title">def</span> <span class="title">no</span> <span class="title">adds</span>)</span></span><br><span class="line"><span class="class">;<span class="title">serverurl</span>=<span class="title">AUTO</span>                ; <span class="title">override</span> <span class="title">serverurl</span> <span class="title">computation</span> (<span class="title">childutils</span>)</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">; <span class="title">The</span> <span class="title">below</span> <span class="title">sample</span> <span class="title">eventlistener</span> <span class="title">section</span> <span class="title">shows</span> <span class="title">all</span> <span class="title">possible</span></span></span><br><span class="line"><span class="class">; <span class="title">eventlistener</span> <span class="title">subsection</span> <span class="title">values</span>, <span class="title">create</span> <span class="title">one</span> <span class="title">or</span> <span class="title">more</span> &#x27;<span class="title">real</span>&#x27;</span></span><br><span class="line"><span class="class">; <span class="title">eventlistener</span>: <span class="title">sections</span> <span class="title">to</span> <span class="title">be</span> <span class="title">able</span> <span class="title">to</span> <span class="title">handle</span> <span class="title">event</span> <span class="title">notifications</span></span></span><br><span class="line"><span class="class">; <span class="title">sent</span> <span class="title">by</span> <span class="title">supervisor</span>.</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">;[<span class="title">eventlistener</span>:<span class="title">theeventlistenername</span>]</span></span><br><span class="line"><span class="class">;<span class="title">command</span>=/<span class="title">bin</span>/<span class="title">eventlistener</span>    ; <span class="title">the</span> <span class="title">program</span> (<span class="title">relative</span> <span class="title">uses</span> <span class="title">PATH</span>, <span class="title">can</span> <span class="title">take</span> <span class="title">args</span>)</span></span><br><span class="line"><span class="class">;<span class="title">process_name</span>=%(<span class="title">program_name</span>)<span class="title">s</span> ; <span class="title">process_name</span> <span class="title">expr</span> (<span class="title">default</span> %(<span class="title">program_name</span>)<span class="title">s</span>)</span></span><br><span class="line"><span class="class">;<span class="title">numprocs</span>=1                    ; <span class="title">number</span> <span class="title">of</span> <span class="title">processes</span> <span class="title">copies</span> <span class="title">to</span> <span class="title">start</span> (<span class="title">def</span> 1)</span></span><br><span class="line"><span class="class">;<span class="title">events</span>=<span class="title">EVENT</span>                  ; <span class="title">event</span> <span class="title">notif</span>. <span class="title">types</span> <span class="title">to</span> <span class="title">subscribe</span> <span class="title">to</span> (<span class="title">req</span>&#x27;<span class="title">d</span>)</span></span><br><span class="line"><span class="class">;<span class="title">buffer_size</span>=10                ; <span class="title">event</span> <span class="title">buffer</span> <span class="title">queue</span> <span class="title">size</span> (<span class="title">default</span> 10)</span></span><br><span class="line"><span class="class">;<span class="title">directory</span>=/<span class="title">tmp</span>                ; <span class="title">directory</span> <span class="title">to</span> <span class="title">cwd</span> <span class="title">to</span> <span class="title">before</span> <span class="title">exec</span> (<span class="title">def</span> <span class="title">no</span> <span class="title">cwd</span>)</span></span><br><span class="line"><span class="class">;<span class="title">umask</span>=022                     ; <span class="title">umask</span> <span class="title">for</span> <span class="title">process</span> (<span class="title">default</span> <span class="title">None</span>)</span></span><br><span class="line"><span class="class">;<span class="title">environment</span>=<span class="title">KEY</span>=<span class="title">value</span>       ; (<span class="title">key</span> <span class="title">value</span> <span class="title">pairs</span> <span class="title">to</span> <span class="title">add</span> <span class="title">to</span> <span class="title">environment</span>)</span></span><br><span class="line"><span class="class">;<span class="title">strip_ansi</span>=<span class="title">false</span>            ; (<span class="title">strip</span> <span class="title">ansi</span> <span class="title">escape</span> <span class="title">codes</span> <span class="title">in</span> <span class="title">logs</span>; <span class="title">def</span>. <span class="title">false</span>)</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">; <span class="title">the</span> <span class="title">below</span> <span class="title">section</span> <span class="title">must</span> <span class="title">remain</span> <span class="title">in</span> <span class="title">the</span> <span class="title">config</span> <span class="title">file</span> <span class="title">for</span> <span class="title">RPC</span></span></span><br><span class="line"><span class="class">; (<span class="title">supervisorctl</span>/<span class="title">web</span> <span class="title">interface</span>) <span class="title">to</span> <span class="title">work</span>, <span class="title">additional</span> <span class="title">interfaces</span> <span class="title">may</span> <span class="title">be</span></span></span><br><span class="line"><span class="class">; <span class="title">added</span> <span class="title">by</span> <span class="title">defining</span> <span class="title">them</span> <span class="title">in</span> <span class="title">separate</span> <span class="title">rpcinterface</span>: <span class="title">sections</span></span></span><br><span class="line"><span class="class">[<span class="title">rpcinterface</span>:<span class="title">supervisor</span>]</span></span><br><span class="line"><span class="class"><span class="title">supervisor</span>.<span class="title">rpcinterface_factory</span> = <span class="title">supervisor</span>.<span class="title">rpcinterface</span>:<span class="title">make_main_rpcinterface</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">[<span class="title">supervisorctl</span>]</span></span><br><span class="line"><span class="class"><span class="title">serverurl</span>=<span class="title">unix</span>:///<span class="title">run</span>/<span class="title">supervisor</span>/<span class="title">supervisor</span>.<span class="title">sock</span> ; <span class="title">use</span> <span class="title">a</span> <span class="title">unix</span>:// <span class="title">URL</span>  <span class="title">for</span> <span class="title">a</span> <span class="title">unix</span> <span class="title">socket</span></span></span><br><span class="line"><span class="class">;<span class="title">serverurl</span>=<span class="title">http</span>://127.0.0.1:9001 ; <span class="title">use</span> <span class="title">an</span> <span class="title">http</span>:// <span class="title">url</span> <span class="title">to</span> <span class="title">specify</span> <span class="title">an</span> <span class="title">inet</span> <span class="title">socket</span></span></span><br><span class="line"><span class="class">;<span class="title">username</span>=<span class="title">chris</span>              ; <span class="title">should</span> <span class="title">be</span> <span class="title">same</span> <span class="title">as</span> <span class="title">http_username</span> <span class="title">if</span> <span class="title">set</span></span></span><br><span class="line"><span class="class">;<span class="title">password</span>=123                ; <span class="title">should</span> <span class="title">be</span> <span class="title">same</span> <span class="title">as</span> <span class="title">http_password</span> <span class="title">if</span> <span class="title">set</span></span></span><br><span class="line"><span class="class">;<span class="title">prompt</span>=<span class="title">mysupervisor</span>         ; <span class="title">cmd</span> <span class="title">line</span> <span class="title">prompt</span> (<span class="title">default</span> &quot;<span class="title">supervisor</span>&quot;)</span></span><br><span class="line"><span class="class">;<span class="title">history_file</span>=~/.<span class="title">sc_history</span>  ; <span class="title">use</span> <span class="title">readline</span> <span class="title">history</span> <span class="title">if</span> <span class="title">available</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">; <span class="title">The</span> <span class="title">below</span> <span class="title">sample</span> <span class="title">program</span> <span class="title">section</span> <span class="title">shows</span> <span class="title">all</span> <span class="title">possible</span> <span class="title">program</span> <span class="title">subsection</span> <span class="title">values</span>,</span></span><br><span class="line"><span class="class">; <span class="title">create</span> <span class="title">one</span> <span class="title">or</span> <span class="title">more</span> &#x27;<span class="title">real</span>&#x27; <span class="title">program</span>: <span class="title">sections</span> <span class="title">to</span> <span class="title">be</span> <span class="title">able</span> <span class="title">to</span> <span class="title">control</span> <span class="title">them</span> <span class="title">under</span></span></span><br><span class="line"><span class="class">; <span class="title">supervisor</span>.</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">;[<span class="title">program</span>:<span class="title">theprogramname</span>]</span></span><br><span class="line"><span class="class">;<span class="title">command</span>=/<span class="title">bin</span>/<span class="title">cat</span>              ; <span class="title">the</span> <span class="title">program</span> (<span class="title">relative</span> <span class="title">uses</span> <span class="title">PATH</span>, <span class="title">can</span> <span class="title">take</span> <span class="title">args</span>)</span></span><br><span class="line"><span class="class">;<span class="title">process_name</span>=%(<span class="title">program_name</span>)<span class="title">s</span> ; <span class="title">process_name</span> <span class="title">expr</span> (<span class="title">default</span> %(<span class="title">program_name</span>)<span class="title">s</span>)</span></span><br><span class="line"><span class="class">;<span class="title">numprocs</span>=1                    ; <span class="title">number</span> <span class="title">of</span> <span class="title">processes</span> <span class="title">copies</span> <span class="title">to</span> <span class="title">start</span> (<span class="title">def</span> 1)</span></span><br><span class="line"><span class="class">;<span class="title">directory</span>=/<span class="title">tmp</span>                ; <span class="title">directory</span> <span class="title">to</span> <span class="title">cwd</span> <span class="title">to</span> <span class="title">before</span> <span class="title">exec</span> (<span class="title">def</span> <span class="title">no</span> <span class="title">cwd</span>)</span></span><br><span class="line"><span class="class">;<span class="title">umask</span>=022                     ; <span class="title">umask</span> <span class="title">for</span> <span class="title">process</span> (<span class="title">default</span> <span class="title">None</span>)</span></span><br><span class="line"><span class="class">;<span class="title">priority</span>=999                  ; <span class="title">the</span> <span class="title">relative</span> <span class="title">start</span> <span class="title">priority</span> (<span class="title">default</span> 999)</span></span><br><span class="line"><span class="class">;<span class="title">autostart</span>=<span class="title">true</span>                ; <span class="title">start</span> <span class="title">at</span> <span class="title">supervisord</span> <span class="title">start</span> (<span class="title">default</span>: <span class="title">true</span>)</span></span><br><span class="line"><span class="class">;<span class="title">autorestart</span>=<span class="title">true</span>              ; <span class="title">retstart</span> <span class="title">at</span> <span class="title">unexpected</span> <span class="title">quit</span> (<span class="title">default</span>: <span class="title">true</span>)</span></span><br><span class="line"><span class="class">;<span class="title">startsecs</span>=10                  ; <span class="title">number</span> <span class="title">of</span> <span class="title">secs</span> <span class="title">prog</span> <span class="title">must</span> <span class="title">stay</span> <span class="title">running</span> (<span class="title">def</span>. 1)</span></span><br><span class="line"><span class="class">;<span class="title">startretries</span>=3                ; <span class="title">max</span> # <span class="title">of</span> <span class="title">serial</span> <span class="title">start</span> <span class="title">failures</span> (<span class="title">default</span> 3)</span></span><br><span class="line"><span class="class">;<span class="title">exitcodes</span>=0,2                 ; &#x27;<span class="title">expected</span>&#x27; <span class="title">exit</span> <span class="title">codes</span> <span class="title">for</span> <span class="title">process</span> (<span class="title">default</span> 0,2)</span></span><br><span class="line"><span class="class">;<span class="title">stopsignal</span>=<span class="title">QUIT</span>               ; <span class="title">signal</span> <span class="title">used</span> <span class="title">to</span> <span class="title">kill</span> <span class="title">process</span> (<span class="title">default</span> <span class="title">TERM</span>)</span></span><br><span class="line"><span class="class">;<span class="title">stopwaitsecs</span>=10               ; <span class="title">max</span> <span class="title">num</span> <span class="title">secs</span> <span class="title">to</span> <span class="title">wait</span> <span class="title">b4</span> <span class="title">SIGKILL</span> (<span class="title">default</span> 10)</span></span><br><span class="line"><span class="class">;<span class="title">user</span>=<span class="title">chrism</span>                   ; <span class="title">setuid</span> <span class="title">to</span> <span class="title">this</span> <span class="title">UNIX</span> <span class="title">account</span> <span class="title">to</span> <span class="title">run</span> <span class="title">the</span> <span class="title">program</span></span></span><br><span class="line"><span class="class">;<span class="title">redirect_stderr</span>=<span class="title">true</span>          ; <span class="title">redirect</span> <span class="title">proc</span> <span class="title">stderr</span> <span class="title">to</span> <span class="title">stdout</span> (<span class="title">default</span> <span class="title">false</span>)</span></span><br><span class="line"><span class="class">;<span class="title">stdout_logfile</span>=/<span class="title">a</span>/<span class="title">path</span>        ; <span class="title">stdout</span> <span class="title">log</span> <span class="title">path</span>, <span class="title">NONE</span> <span class="title">for</span> <span class="title">none</span>; <span class="title">default</span> <span class="title">AUTO</span></span></span><br><span class="line"><span class="class">;<span class="title">stdout_logfile_maxbytes</span>=1<span class="title">MB</span>   ; <span class="title">max</span> # <span class="title">logfile</span> <span class="title">bytes</span> <span class="title">b4</span> <span class="title">rotation</span> (<span class="title">default</span> 50<span class="title">MB</span>)</span></span><br><span class="line"><span class="class">;<span class="title">stdout_logfile_backups</span>=10     ; # <span class="title">of</span> <span class="title">stdout</span> <span class="title">logfile</span> <span class="title">backups</span> (<span class="title">default</span> 10)</span></span><br><span class="line"><span class="class">;<span class="title">stdout_capture_maxbytes</span>=1<span class="title">MB</span>   ; <span class="title">number</span> <span class="title">of</span> <span class="title">bytes</span> <span class="title">in</span> &#x27;<span class="title">capturemode</span>&#x27; (<span class="title">default</span> 0)</span></span><br><span class="line"><span class="class">;<span class="title">stdout_events_enabled</span>=<span class="title">false</span>   ; <span class="title">emit</span> <span class="title">events</span> <span class="title">on</span> <span class="title">stdout</span> <span class="title">writes</span> (<span class="title">default</span> <span class="title">false</span>)</span></span><br><span class="line"><span class="class">;<span class="title">stderr_logfile</span>=/<span class="title">a</span>/<span class="title">path</span>        ; <span class="title">stderr</span> <span class="title">log</span> <span class="title">path</span>, <span class="title">NONE</span> <span class="title">for</span> <span class="title">none</span>; <span class="title">default</span> <span class="title">AUTO</span></span></span><br><span class="line"><span class="class">;<span class="title">stderr_logfile_maxbytes</span>=1<span class="title">MB</span>   ; <span class="title">max</span> # <span class="title">logfile</span> <span class="title">bytes</span> <span class="title">b4</span> <span class="title">rotation</span> (<span class="title">default</span> 50<span class="title">MB</span>)</span></span><br><span class="line"><span class="class">;<span class="title">stderr_logfile_backups</span>=10     ; # <span class="title">of</span> <span class="title">stderr</span> <span class="title">logfile</span> <span class="title">backups</span> (<span class="title">default</span> 10)</span></span><br><span class="line"><span class="class">;<span class="title">stderr_capture_maxbytes</span>=1<span class="title">MB</span>   ; <span class="title">number</span> <span class="title">of</span> <span class="title">bytes</span> <span class="title">in</span> &#x27;<span class="title">capturemode</span>&#x27; (<span class="title">default</span> 0)</span></span><br><span class="line"><span class="class">;<span class="title">stderr_events_enabled</span>=<span class="title">false</span>   ; <span class="title">emit</span> <span class="title">events</span> <span class="title">on</span> <span class="title">stderr</span> <span class="title">writes</span> (<span class="title">default</span> <span class="title">false</span>)</span></span><br><span class="line"><span class="class">;<span class="title">environment</span>=<span class="title">A</span>=1,<span class="title">B</span>=2           ; <span class="title">process</span> <span class="title">environment</span> <span class="title">additions</span> (<span class="title">def</span> <span class="title">no</span> <span class="title">adds</span>)</span></span><br><span class="line"><span class="class">;<span class="title">serverurl</span>=<span class="title">AUTO</span>                ; <span class="title">override</span> <span class="title">serverurl</span> <span class="title">computation</span> (<span class="title">childutils</span>)</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">; <span class="title">The</span> <span class="title">below</span> <span class="title">sample</span> <span class="title">eventlistener</span> <span class="title">section</span> <span class="title">shows</span> <span class="title">all</span> <span class="title">possible</span></span></span><br><span class="line"><span class="class">; <span class="title">eventlistener</span> <span class="title">subsection</span> <span class="title">values</span>, <span class="title">create</span> <span class="title">one</span> <span class="title">or</span> <span class="title">more</span> &#x27;<span class="title">real</span>&#x27;</span></span><br><span class="line"><span class="class">; <span class="title">eventlistener</span>: <span class="title">sections</span> <span class="title">to</span> <span class="title">be</span> <span class="title">able</span> <span class="title">to</span> <span class="title">handle</span> <span class="title">event</span> <span class="title">notifications</span></span></span><br><span class="line"><span class="class">; <span class="title">sent</span> <span class="title">by</span> <span class="title">supervisor</span>.</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">;[<span class="title">eventlistener</span>:<span class="title">theeventlistenername</span>]</span></span><br><span class="line"><span class="class">;<span class="title">command</span>=/<span class="title">bin</span>/<span class="title">eventlistener</span>    ; <span class="title">the</span> <span class="title">program</span> (<span class="title">relative</span> <span class="title">uses</span> <span class="title">PATH</span>, <span class="title">can</span> <span class="title">take</span> <span class="title">args</span>)</span></span><br><span class="line"><span class="class">;<span class="title">process_name</span>=%(<span class="title">program_name</span>)<span class="title">s</span> ; <span class="title">process_name</span> <span class="title">expr</span> (<span class="title">default</span> %(<span class="title">program_name</span>)<span class="title">s</span>)</span></span><br><span class="line"><span class="class">;<span class="title">numprocs</span>=1                    ; <span class="title">number</span> <span class="title">of</span> <span class="title">processes</span> <span class="title">copies</span> <span class="title">to</span> <span class="title">start</span> (<span class="title">def</span> 1)</span></span><br><span class="line"><span class="class">;<span class="title">events</span>=<span class="title">EVENT</span>                  ; <span class="title">event</span> <span class="title">notif</span>. <span class="title">types</span> <span class="title">to</span> <span class="title">subscribe</span> <span class="title">to</span> (<span class="title">req</span>&#x27;<span class="title">d</span>)</span></span><br><span class="line"><span class="class">;<span class="title">buffer_size</span>=10                ; <span class="title">event</span> <span class="title">buffer</span> <span class="title">queue</span> <span class="title">size</span> (<span class="title">default</span> 10)</span></span><br><span class="line"><span class="class">;<span class="title">directory</span>=/<span class="title">tmp</span>                ; <span class="title">directory</span> <span class="title">to</span> <span class="title">cwd</span> <span class="title">to</span> <span class="title">before</span> <span class="title">exec</span> (<span class="title">def</span> <span class="title">no</span> <span class="title">cwd</span>)</span></span><br><span class="line"><span class="class">;<span class="title">umask</span>=022                     ; <span class="title">umask</span> <span class="title">for</span> <span class="title">process</span> (<span class="title">default</span> <span class="title">None</span>)</span></span><br><span class="line"><span class="class">; <span class="title">Sample</span> <span class="title">supervisor</span> <span class="title">config</span> <span class="title">file</span>.</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">[<span class="title">unix_http_server</span>]</span></span><br><span class="line"><span class="class"><span class="title">file</span>=/<span class="title">run</span>/<span class="title">supervisor</span>/<span class="title">supervisor</span>.<span class="title">sock</span>   ; (<span class="title">the</span> <span class="title">path</span> <span class="title">to</span> <span class="title">the</span> <span class="title">socket</span> <span class="title">file</span>)</span></span><br><span class="line"><span class="class">;<span class="title">chmod</span>=0700                 ; <span class="title">sockef</span> <span class="title">file</span> <span class="title">mode</span> (<span class="title">default</span> 0700)</span></span><br><span class="line"><span class="class">;<span class="title">chown</span>=<span class="title">nobody</span>:<span class="title">nogroup</span>       ; <span class="title">socket</span> <span class="title">file</span> <span class="title">uid</span>:<span class="title">gid</span> <span class="title">owner</span></span></span><br><span class="line"><span class="class">;<span class="title">username</span>=<span class="title">user</span>              ; (<span class="title">default</span> <span class="title">is</span> <span class="title">no</span> <span class="title">username</span> (<span class="title">open</span> <span class="title">server</span>))</span></span><br><span class="line"><span class="class">;<span class="title">password</span>=123               ; (<span class="title">default</span> <span class="title">is</span> <span class="title">no</span> <span class="title">password</span> (<span class="title">open</span> <span class="title">server</span>))</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">;[<span class="title">inet_http_server</span>]         ; <span class="title">inet</span> (<span class="title">TCP</span>) <span class="title">server</span> <span class="title">disabled</span> <span class="title">by</span> <span class="title">default</span></span></span><br><span class="line"><span class="class">;<span class="title">port</span>=127.0.0.1:9001        ; (<span class="title">ip_address</span>:<span class="title">port</span> <span class="title">specifier</span>, *:<span class="title">port</span> <span class="title">for</span> <span class="title">all</span> <span class="title">iface</span>)</span></span><br><span class="line"><span class="class">;<span class="title">username</span>=<span class="title">user</span>              ; (<span class="title">default</span> <span class="title">is</span> <span class="title">no</span> <span class="title">username</span> (<span class="title">open</span> <span class="title">server</span>))</span></span><br><span class="line"><span class="class">;<span class="title">password</span>=123               ; (<span class="title">default</span> <span class="title">is</span> <span class="title">no</span> <span class="title">password</span> (<span class="title">open</span> <span class="title">server</span>))</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">[<span class="title">supervisord</span>]</span></span><br><span class="line"><span class="class"><span class="title">logfile</span>=/<span class="title">var</span>/<span class="title">log</span>/<span class="title">supervisor</span>/<span class="title">supervisord</span>.<span class="title">log</span>  ; (<span class="title">main</span> <span class="title">log</span> <span class="title">file</span>;<span class="title">default</span> $<span class="title">CWD</span>/<span class="title">supervisord</span>.<span class="title">log</span>)</span></span><br><span class="line"><span class="class"><span class="title">logfile_maxbytes</span>=50<span class="title">MB</span>       ; (<span class="title">max</span> <span class="title">main</span> <span class="title">logfile</span> <span class="title">bytes</span> <span class="title">b4</span> <span class="title">rotation</span>;<span class="title">default</span> 50<span class="title">MB</span>)</span></span><br><span class="line"><span class="class"><span class="title">logfile_backups</span>=10          ; (<span class="title">num</span> <span class="title">of</span> <span class="title">main</span> <span class="title">logfile</span> <span class="title">rotation</span> <span class="title">backups</span>;<span class="title">default</span> 10)</span></span><br><span class="line"><span class="class"><span class="title">loglevel</span>=<span class="title">info</span>               ; (<span class="title">log</span> <span class="title">level</span>;<span class="title">default</span> <span class="title">info</span>; <span class="title">others</span>: <span class="title">debug</span>,<span class="title">warn</span>,<span class="title">trace</span>)</span></span><br><span class="line"><span class="class"><span class="title">pidfile</span>=/<span class="title">run</span>/<span class="title">supervisord</span>.<span class="title">pid</span> ; (<span class="title">supervisord</span> <span class="title">pidfile</span>;<span class="title">default</span> <span class="title">supervisord</span>.<span class="title">pid</span>)</span></span><br><span class="line"><span class="class"><span class="title">nodaemon</span>=<span class="title">false</span>              ; (<span class="title">start</span> <span class="title">in</span> <span class="title">foreground</span> <span class="title">if</span> <span class="title">true</span>;<span class="title">default</span> <span class="title">false</span>)</span></span><br><span class="line"><span class="class"><span class="title">minfds</span>=1024                 ; (<span class="title">min</span>. <span class="title">avail</span> <span class="title">startup</span> <span class="title">file</span> <span class="title">descriptors</span>;<span class="title">default</span> 1024)</span></span><br><span class="line"><span class="class"><span class="title">minprocs</span>=200                ; (<span class="title">min</span>. <span class="title">avail</span> <span class="title">process</span> <span class="title">descriptors</span>;<span class="title">default</span> 200)</span></span><br><span class="line"><span class="class">;<span class="title">umask</span>=022                  ; (<span class="title">process</span> <span class="title">file</span> <span class="title">creation</span> <span class="title">umask</span>;<span class="title">default</span> 022)</span></span><br><span class="line"><span class="class">;<span class="title">user</span>=<span class="title">chrism</span>                 ; (<span class="title">default</span> <span class="title">is</span> <span class="title">current</span> <span class="title">user</span>, <span class="title">required</span> <span class="title">if</span> <span class="title">root</span>)</span></span><br><span class="line"><span class="class">;<span class="title">identifier</span>=<span class="title">supervisor</span>       ; (<span class="title">supervisord</span> <span class="title">identifier</span>, <span class="title">default</span> <span class="title">is</span> &#x27;<span class="title">supervisor</span>&#x27;)</span></span><br><span class="line"><span class="class">;<span class="title">directory</span>=/<span class="title">tmp</span>              ; (<span class="title">default</span> <span class="title">is</span> <span class="title">not</span> <span class="title">to</span> <span class="title">cd</span> <span class="title">during</span> <span class="title">start</span>)</span></span><br><span class="line"><span class="class">;<span class="title">nocleanup</span>=<span class="title">true</span>              ; (<span class="title">don</span>&#x27;<span class="title">t</span> <span class="title">clean</span> <span class="title">up</span> <span class="title">tempfiles</span> <span class="title">at</span> <span class="title">start</span>;<span class="title">default</span> <span class="title">false</span>)</span></span><br><span class="line"><span class="class">;<span class="title">childlogdir</span>=/<span class="title">tmp</span>            ; (&#x27;<span class="title">AUTO</span>&#x27; <span class="title">child</span> <span class="title">log</span> <span class="title">dir</span>, <span class="title">default</span> $<span class="title">TEMP</span>)</span></span><br><span class="line"><span class="class">;<span class="title">environment</span>=<span class="title">KEY</span>=<span class="title">value</span>       ; (<span class="title">key</span> <span class="title">value</span> <span class="title">pairs</span> <span class="title">to</span> <span class="title">add</span> <span class="title">to</span> <span class="title">environment</span>)</span></span><br><span class="line"><span class="class">;<span class="title">strip_ansi</span>=<span class="title">false</span>            ; (<span class="title">strip</span> <span class="title">ansi</span> <span class="title">escape</span> <span class="title">codes</span> <span class="title">in</span> <span class="title">logs</span>; <span class="title">def</span>. <span class="title">false</span>)</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">; <span class="title">the</span> <span class="title">below</span> <span class="title">section</span> <span class="title">must</span> <span class="title">remain</span> <span class="title">in</span> <span class="title">the</span> <span class="title">config</span> <span class="title">file</span> <span class="title">for</span> <span class="title">RPC</span></span></span><br><span class="line"><span class="class">; (<span class="title">supervisorctl</span>/<span class="title">web</span> <span class="title">interface</span>) <span class="title">to</span> <span class="title">work</span>, <span class="title">additional</span> <span class="title">interfaces</span> <span class="title">may</span> <span class="title">be</span></span></span><br><span class="line"><span class="class">; <span class="title">added</span> <span class="title">by</span> <span class="title">defining</span> <span class="title">them</span> <span class="title">in</span> <span class="title">separate</span> <span class="title">rpcinterface</span>: <span class="title">sections</span></span></span><br><span class="line"><span class="class">[<span class="title">rpcinterface</span>:<span class="title">supervisor</span>]</span></span><br><span class="line"><span class="class"><span class="title">supervisor</span>.<span class="title">rpcinterface_factory</span> = <span class="title">supervisor</span>.<span class="title">rpcinterface</span>:<span class="title">make_main_rpcinterface</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">[<span class="title">supervisorctl</span>]</span></span><br><span class="line"><span class="class"><span class="title">serverurl</span>=<span class="title">unix</span>:///<span class="title">run</span>/<span class="title">supervisor</span>/<span class="title">supervisor</span>.<span class="title">sock</span> ; <span class="title">use</span> <span class="title">a</span> <span class="title">unix</span>:// <span class="title">URL</span>  <span class="title">for</span> <span class="title">a</span> <span class="title">unix</span> <span class="title">socket</span></span></span><br><span class="line"><span class="class">;<span class="title">serverurl</span>=<span class="title">http</span>://127.0.0.1:9001 ; <span class="title">use</span> <span class="title">an</span> <span class="title">http</span>:// <span class="title">url</span> <span class="title">to</span> <span class="title">specify</span> <span class="title">an</span> <span class="title">inet</span> <span class="title">socket</span></span></span><br><span class="line"><span class="class">;<span class="title">username</span>=<span class="title">chris</span>              ; <span class="title">should</span> <span class="title">be</span> <span class="title">same</span> <span class="title">as</span> <span class="title">http_username</span> <span class="title">if</span> <span class="title">set</span></span></span><br><span class="line"><span class="class">;<span class="title">password</span>=123                ; <span class="title">should</span> <span class="title">be</span> <span class="title">same</span> <span class="title">as</span> <span class="title">http_password</span> <span class="title">if</span> <span class="title">set</span></span></span><br><span class="line"><span class="class">;<span class="title">prompt</span>=<span class="title">mysupervisor</span>         ; <span class="title">cmd</span> <span class="title">line</span> <span class="title">prompt</span> (<span class="title">default</span> &quot;<span class="title">supervisor</span>&quot;)</span></span><br><span class="line"><span class="class">;<span class="title">history_file</span>=~/.<span class="title">sc_history</span>  ; <span class="title">use</span> <span class="title">readline</span> <span class="title">history</span> <span class="title">if</span> <span class="title">available</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">; <span class="title">The</span> <span class="title">below</span> <span class="title">sample</span> <span class="title">program</span> <span class="title">section</span> <span class="title">shows</span> <span class="title">all</span> <span class="title">possible</span> <span class="title">program</span> <span class="title">subsection</span> <span class="title">values</span>,</span></span><br><span class="line"><span class="class">; <span class="title">create</span> <span class="title">one</span> <span class="title">or</span> <span class="title">more</span> &#x27;<span class="title">real</span>&#x27; <span class="title">program</span>: <span class="title">sections</span> <span class="title">to</span> <span class="title">be</span> <span class="title">able</span> <span class="title">to</span> <span class="title">control</span> <span class="title">them</span> <span class="title">under</span></span></span><br><span class="line"><span class="class">; <span class="title">supervisor</span>.</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">;[<span class="title">program</span>:<span class="title">theprogramname</span>]</span></span><br><span class="line"><span class="class">;<span class="title">command</span>=/<span class="title">bin</span>/<span class="title">cat</span>              ; <span class="title">the</span> <span class="title">program</span> (<span class="title">relative</span> <span class="title">uses</span> <span class="title">PATH</span>, <span class="title">can</span> <span class="title">take</span> <span class="title">args</span>)</span></span><br><span class="line"><span class="class">;<span class="title">process_name</span>=%(<span class="title">program_name</span>)<span class="title">s</span> ; <span class="title">process_name</span> <span class="title">expr</span> (<span class="title">default</span> %(<span class="title">program_name</span>)<span class="title">s</span>)</span></span><br><span class="line"><span class="class">;<span class="title">numprocs</span>=1                    ; <span class="title">number</span> <span class="title">of</span> <span class="title">processes</span> <span class="title">copies</span> <span class="title">to</span> <span class="title">start</span> (<span class="title">def</span> 1)</span></span><br><span class="line"><span class="class">;<span class="title">directory</span>=/<span class="title">tmp</span>                ; <span class="title">directory</span> <span class="title">to</span> <span class="title">cwd</span> <span class="title">to</span> <span class="title">before</span> <span class="title">exec</span> (<span class="title">def</span> <span class="title">no</span> <span class="title">cwd</span>)</span></span><br><span class="line"><span class="class">;<span class="title">umask</span>=022                     ; <span class="title">umask</span> <span class="title">for</span> <span class="title">process</span> (<span class="title">default</span> <span class="title">None</span>)</span></span><br><span class="line"><span class="class">;<span class="title">priority</span>=999                  ; <span class="title">the</span> <span class="title">relative</span> <span class="title">start</span> <span class="title">priority</span> (<span class="title">default</span> 999)</span></span><br><span class="line"><span class="class">;<span class="title">autostart</span>=<span class="title">true</span>                ; <span class="title">start</span> <span class="title">at</span> <span class="title">supervisord</span> <span class="title">start</span> (<span class="title">default</span>: <span class="title">true</span>)</span></span><br><span class="line"><span class="class">;<span class="title">autorestart</span>=<span class="title">true</span>              ; <span class="title">retstart</span> <span class="title">at</span> <span class="title">unexpected</span> <span class="title">quit</span> (<span class="title">default</span>: <span class="title">true</span>)</span></span><br><span class="line"><span class="class">;<span class="title">startsecs</span>=10                  ; <span class="title">number</span> <span class="title">of</span> <span class="title">secs</span> <span class="title">prog</span> <span class="title">must</span> <span class="title">stay</span> <span class="title">running</span> (<span class="title">def</span>. 1)</span></span><br><span class="line"><span class="class">;<span class="title">startretries</span>=3                ; <span class="title">max</span> # <span class="title">of</span> <span class="title">serial</span> <span class="title">start</span> <span class="title">failures</span> (<span class="title">default</span> 3)</span></span><br><span class="line"><span class="class">;<span class="title">exitcodes</span>=0,2                 ; &#x27;<span class="title">expected</span>&#x27; <span class="title">exit</span> <span class="title">codes</span> <span class="title">for</span> <span class="title">process</span> (<span class="title">default</span> 0,2)</span></span><br><span class="line"><span class="class">;<span class="title">stopsignal</span>=<span class="title">QUIT</span>               ; <span class="title">signal</span> <span class="title">used</span> <span class="title">to</span> <span class="title">kill</span> <span class="title">process</span> (<span class="title">default</span> <span class="title">TERM</span>)</span></span><br><span class="line"><span class="class">;<span class="title">stopwaitsecs</span>=10               ; <span class="title">max</span> <span class="title">num</span> <span class="title">secs</span> <span class="title">to</span> <span class="title">wait</span> <span class="title">b4</span> <span class="title">SIGKILL</span> (<span class="title">default</span> 10)</span></span><br><span class="line"><span class="class">;<span class="title">user</span>=<span class="title">chrism</span>                   ; <span class="title">setuid</span> <span class="title">to</span> <span class="title">this</span> <span class="title">UNIX</span> <span class="title">account</span> <span class="title">to</span> <span class="title">run</span> <span class="title">the</span> <span class="title">program</span></span></span><br><span class="line"><span class="class">;<span class="title">redirect_stderr</span>=<span class="title">true</span>          ; <span class="title">redirect</span> <span class="title">proc</span> <span class="title">stderr</span> <span class="title">to</span> <span class="title">stdout</span> (<span class="title">default</span> <span class="title">false</span>)</span></span><br><span class="line"><span class="class">;<span class="title">stdout_logfile</span>=/<span class="title">a</span>/<span class="title">path</span>        ; <span class="title">stdout</span> <span class="title">log</span> <span class="title">path</span>, <span class="title">NONE</span> <span class="title">for</span> <span class="title">none</span>; <span class="title">default</span> <span class="title">AUTO</span></span></span><br><span class="line"><span class="class">;<span class="title">stdout_logfile_maxbytes</span>=1<span class="title">MB</span>   ; <span class="title">max</span> # <span class="title">logfile</span> <span class="title">bytes</span> <span class="title">b4</span> <span class="title">rotation</span> (<span class="title">default</span> 50<span class="title">MB</span>)</span></span><br><span class="line"><span class="class">;<span class="title">stdout_logfile_backups</span>=10     ; # <span class="title">of</span> <span class="title">stdout</span> <span class="title">logfile</span> <span class="title">backups</span> (<span class="title">default</span> 10)</span></span><br><span class="line"><span class="class">;<span class="title">stdout_capture_maxbytes</span>=1<span class="title">MB</span>   ; <span class="title">number</span> <span class="title">of</span> <span class="title">bytes</span> <span class="title">in</span> &#x27;<span class="title">capturemode</span>&#x27; (<span class="title">default</span> 0)</span></span><br><span class="line"><span class="class">;<span class="title">stdout_events_enabled</span>=<span class="title">false</span>   ; <span class="title">emit</span> <span class="title">events</span> <span class="title">on</span> <span class="title">stdout</span> <span class="title">writes</span> (<span class="title">default</span> <span class="title">false</span>)</span></span><br><span class="line"><span class="class">;<span class="title">stderr_logfile</span>=/<span class="title">a</span>/<span class="title">path</span>        ; <span class="title">stderr</span> <span class="title">log</span> <span class="title">path</span>, <span class="title">NONE</span> <span class="title">for</span> <span class="title">none</span>; <span class="title">default</span> <span class="title">AUTO</span></span></span><br><span class="line"><span class="class">;<span class="title">stderr_logfile_maxbytes</span>=1<span class="title">MB</span>   ; <span class="title">max</span> # <span class="title">logfile</span> <span class="title">bytes</span> <span class="title">b4</span> <span class="title">rotation</span> (<span class="title">default</span> 50<span class="title">MB</span>)</span></span><br><span class="line"><span class="class">;<span class="title">stderr_logfile_backups</span>=10     ; # <span class="title">of</span> <span class="title">stderr</span> <span class="title">logfile</span> <span class="title">backups</span> (<span class="title">default</span> 10)</span></span><br><span class="line"><span class="class">;<span class="title">stderr_capture_maxbytes</span>=1<span class="title">MB</span>   ; <span class="title">number</span> <span class="title">of</span> <span class="title">bytes</span> <span class="title">in</span> &#x27;<span class="title">capturemode</span>&#x27; (<span class="title">default</span> 0)</span></span><br><span class="line"><span class="class">;<span class="title">stderr_events_enabled</span>=<span class="title">false</span>   ; <span class="title">emit</span> <span class="title">events</span> <span class="title">on</span> <span class="title">stderr</span> <span class="title">writes</span> (<span class="title">default</span> <span class="title">false</span>)</span></span><br><span class="line"><span class="class">;<span class="title">environment</span>=<span class="title">A</span>=1,<span class="title">B</span>=2           ; <span class="title">process</span> <span class="title">environment</span> <span class="title">additions</span> (<span class="title">def</span> <span class="title">no</span> <span class="title">adds</span>)</span></span><br><span class="line"><span class="class">;<span class="title">serverurl</span>=<span class="title">AUTO</span>                ; <span class="title">override</span> <span class="title">serverurl</span> <span class="title">computation</span> (<span class="title">childutils</span>)</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">; <span class="title">The</span> <span class="title">below</span> <span class="title">sample</span> <span class="title">eventlistener</span> <span class="title">section</span> <span class="title">shows</span> <span class="title">all</span> <span class="title">possible</span></span></span><br><span class="line"><span class="class">; <span class="title">eventlistener</span> <span class="title">subsection</span> <span class="title">values</span>, <span class="title">create</span> <span class="title">one</span> <span class="title">or</span> <span class="title">more</span> &#x27;<span class="title">real</span>&#x27;</span></span><br><span class="line"><span class="class">; <span class="title">eventlistener</span>: <span class="title">sections</span> <span class="title">to</span> <span class="title">be</span> <span class="title">able</span> <span class="title">to</span> <span class="title">handle</span> <span class="title">event</span> <span class="title">notifications</span></span></span><br><span class="line"><span class="class">; <span class="title">sent</span> <span class="title">by</span> <span class="title">supervisor</span>.</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">;[<span class="title">eventlistener</span>:<span class="title">theeventlistenername</span>]</span></span><br><span class="line"><span class="class">;<span class="title">command</span>=/<span class="title">bin</span>/<span class="title">eventlistener</span>    ; <span class="title">the</span> <span class="title">program</span> (<span class="title">relative</span> <span class="title">uses</span> <span class="title">PATH</span>, <span class="title">can</span> <span class="title">take</span> <span class="title">args</span>)</span></span><br><span class="line"><span class="class">;<span class="title">process_name</span>=%(<span class="title">program_name</span>)<span class="title">s</span> ; <span class="title">process_name</span> <span class="title">expr</span> (<span class="title">default</span> %(<span class="title">program_name</span>)<span class="title">s</span>)</span></span><br><span class="line"><span class="class">;<span class="title">numprocs</span>=1                    ; <span class="title">number</span> <span class="title">of</span> <span class="title">processes</span> <span class="title">copies</span> <span class="title">to</span> <span class="title">start</span> (<span class="title">def</span> 1)</span></span><br><span class="line"><span class="class">;<span class="title">events</span>=<span class="title">EVENT</span>                  ; <span class="title">event</span> <span class="title">notif</span>. <span class="title">types</span> <span class="title">to</span> <span class="title">subscribe</span> <span class="title">to</span> (<span class="title">req</span>&#x27;<span class="title">d</span>)</span></span><br><span class="line"><span class="class">;<span class="title">buffer_size</span>=10                ; <span class="title">event</span> <span class="title">buffer</span> <span class="title">queue</span> <span class="title">size</span> (<span class="title">default</span> 10)</span></span><br><span class="line"><span class="class">;<span class="title">directory</span>=/<span class="title">tmp</span>                ; <span class="title">directory</span> <span class="title">to</span> <span class="title">cwd</span> <span class="title">to</span> <span class="title">before</span> <span class="title">exec</span> (<span class="title">def</span> <span class="title">no</span> <span class="title">cwd</span>)</span></span><br><span class="line"><span class="class">;<span class="title">umask</span>=022                     ; <span class="title">umask</span> <span class="title">for</span> <span class="title">process</span> (<span class="title">default</span> <span class="title">None</span>)</span></span><br><span class="line"><span class="class">;<span class="title">priority</span>=-1                   ; <span class="title">the</span> <span class="title">relative</span> <span class="title">start</span> <span class="title">priority</span> (<span class="title">default</span> -1)</span></span><br><span class="line"><span class="class">;<span class="title">autostart</span>=<span class="title">true</span>                ; <span class="title">start</span> <span class="title">at</span> <span class="title">supervisord</span> <span class="title">start</span> (<span class="title">default</span>: <span class="title">true</span>)</span></span><br><span class="line"><span class="class">;<span class="title">autorestart</span>=<span class="title">unexpected</span>        ; <span class="title">restart</span> <span class="title">at</span> <span class="title">unexpected</span> <span class="title">quit</span> (<span class="title">default</span>: <span class="title">unexpected</span>)</span></span><br><span class="line"><span class="class">;<span class="title">startsecs</span>=10                  ; <span class="title">number</span> <span class="title">of</span> <span class="title">secs</span> <span class="title">prog</span> <span class="title">must</span> <span class="title">stay</span> <span class="title">running</span> (<span class="title">def</span>. 1)</span></span><br><span class="line"><span class="class">;<span class="title">startretries</span>=3                ; <span class="title">max</span> # <span class="title">of</span> <span class="title">serial</span> <span class="title">start</span> <span class="title">failures</span> (<span class="title">default</span> 3)</span></span><br><span class="line"><span class="class">;<span class="title">exitcodes</span>=0,2                 ; &#x27;<span class="title">expected</span>&#x27; <span class="title">exit</span> <span class="title">codes</span> <span class="title">for</span> <span class="title">process</span> (<span class="title">default</span> 0,2)</span></span><br><span class="line"><span class="class">;<span class="title">stopsignal</span>=<span class="title">QUIT</span>               ; <span class="title">signal</span> <span class="title">used</span> <span class="title">to</span> <span class="title">kill</span> <span class="title">process</span> (<span class="title">default</span> <span class="title">TERM</span>)</span></span><br><span class="line"><span class="class">;<span class="title">stopwaitsecs</span>=10               ; <span class="title">max</span> <span class="title">num</span> <span class="title">secs</span> <span class="title">to</span> <span class="title">wait</span> <span class="title">b4</span> <span class="title">SIGKILL</span> (<span class="title">default</span> 10)</span></span><br><span class="line"><span class="class">;<span class="title">user</span>=<span class="title">chrism</span>                   ; <span class="title">setuid</span> <span class="title">to</span> <span class="title">this</span> <span class="title">UNIX</span> <span class="title">account</span> <span class="title">to</span> <span class="title">run</span> <span class="title">the</span> <span class="title">program</span></span></span><br><span class="line"><span class="class">;<span class="title">redirect_stderr</span>=<span class="title">true</span>          ; <span class="title">redirect</span> <span class="title">proc</span> <span class="title">stderr</span> <span class="title">to</span> <span class="title">stdout</span> (<span class="title">default</span> <span class="title">false</span>)</span></span><br><span class="line"><span class="class">;<span class="title">stdout_logfile</span>=/<span class="title">a</span>/<span class="title">path</span>        ; <span class="title">stdout</span> <span class="title">log</span> <span class="title">path</span>, <span class="title">NONE</span> <span class="title">for</span> <span class="title">none</span>; <span class="title">default</span> <span class="title">AUTO</span></span></span><br><span class="line"><span class="class">;<span class="title">stdout_logfile_maxbytes</span>=1<span class="title">MB</span>   ; <span class="title">max</span> # <span class="title">logfile</span> <span class="title">bytes</span> <span class="title">b4</span> <span class="title">rotation</span> (<span class="title">default</span> 50<span class="title">MB</span>)</span></span><br><span class="line"><span class="class">;<span class="title">stdout_logfile_backups</span>=10     ; # <span class="title">of</span> <span class="title">stdout</span> <span class="title">logfile</span> <span class="title">backups</span> (<span class="title">default</span> 10)</span></span><br><span class="line"><span class="class">;<span class="title">stdout_events_enabled</span>=<span class="title">false</span>   ; <span class="title">emit</span> <span class="title">events</span> <span class="title">on</span> <span class="title">stdout</span> <span class="title">writes</span> (<span class="title">default</span> <span class="title">false</span>)</span></span><br><span class="line"><span class="class">;<span class="title">stderr_logfile</span>=/<span class="title">a</span>/<span class="title">path</span>        ; <span class="title">stderr</span> <span class="title">log</span> <span class="title">path</span>, <span class="title">NONE</span> <span class="title">for</span> <span class="title">none</span>; <span class="title">default</span> <span class="title">AUTO</span></span></span><br><span class="line"><span class="class">;<span class="title">stderr_logfile_maxbytes</span>=1<span class="title">MB</span>   ; <span class="title">max</span> # <span class="title">logfile</span> <span class="title">bytes</span> <span class="title">b4</span> <span class="title">rotation</span> (<span class="title">default</span> 50<span class="title">MB</span>)</span></span><br><span class="line"><span class="class">;<span class="title">stderr_logfile_backups</span>        ; # <span class="title">of</span> <span class="title">stderr</span> <span class="title">logfile</span> <span class="title">backups</span> (<span class="title">default</span> 10)</span></span><br><span class="line"><span class="class">;<span class="title">stderr_events_enabled</span>=<span class="title">false</span>   ; <span class="title">emit</span> <span class="title">events</span> <span class="title">on</span> <span class="title">stderr</span> <span class="title">writes</span> (<span class="title">default</span> <span class="title">false</span>)</span></span><br><span class="line"><span class="class">;<span class="title">environment</span>=<span class="title">A</span>=1,<span class="title">B</span>=2           ; <span class="title">process</span> <span class="title">environment</span> <span class="title">additions</span></span></span><br><span class="line"><span class="class">;<span class="title">serverurl</span>=<span class="title">AUTO</span>                ; <span class="title">override</span> <span class="title">serverurl</span> <span class="title">computation</span> (<span class="title">childutils</span>)</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">; <span class="title">The</span> <span class="title">below</span> <span class="title">sample</span> <span class="title">group</span> <span class="title">section</span> <span class="title">shows</span> <span class="title">all</span> <span class="title">possible</span> <span class="title">group</span> <span class="title">values</span>,</span></span><br><span class="line"><span class="class">; <span class="title">create</span> <span class="title">one</span> <span class="title">or</span> <span class="title">more</span> &#x27;<span class="title">real</span>&#x27; <span class="title">group</span>: <span class="title">sections</span> <span class="title">to</span> <span class="title">create</span> &quot;<span class="title">heterogeneous</span>&quot;</span></span><br><span class="line"><span class="class">; <span class="title">process</span> <span class="title">groups</span>.</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">;[<span class="title">group</span>:<span class="title">thegroupname</span>]</span></span><br><span class="line"><span class="class">;<span class="title">programs</span>=<span class="title">progname1</span>,<span class="title">progname2</span>  ; <span class="title">each</span> <span class="title">refers</span> <span class="title">to</span> &#x27;<span class="title">x</span>&#x27; <span class="title">in</span> [<span class="title">program</span>:<span class="title">x</span>] <span class="title">definitions</span></span></span><br><span class="line"><span class="class">;<span class="title">priority</span>=999                  ; <span class="title">the</span> <span class="title">relative</span> <span class="title">start</span> <span class="title">priority</span> (<span class="title">default</span> 999)</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">; <span class="title">The</span> [<span class="title">include</span>] <span class="title">section</span> <span class="title">can</span> <span class="title">just</span> <span class="title">contain</span> <span class="title">the</span> &quot;<span class="title">files</span>&quot; <span class="title">setting</span>.  <span class="title">This</span></span></span><br><span class="line"><span class="class">; <span class="title">setting</span> <span class="title">can</span> <span class="title">list</span> <span class="title">multiple</span> <span class="title">files</span> (<span class="title">separated</span> <span class="title">by</span> <span class="title">whitespace</span> <span class="title">or</span></span></span><br><span class="line"><span class="class">; <span class="title">newlines</span>).  <span class="title">It</span> <span class="title">can</span> <span class="title">also</span> <span class="title">contain</span> <span class="title">wildcards</span>.  <span class="title">The</span> <span class="title">filenames</span> <span class="title">are</span></span></span><br><span class="line"><span class="class">; <span class="title">interpreted</span> <span class="title">as</span> <span class="title">relative</span> <span class="title">to</span> <span class="title">this</span> <span class="title">file</span>.  <span class="title">Included</span> <span class="title">files</span> *<span class="title">cannot</span>*</span></span><br><span class="line"><span class="class">; <span class="title">include</span> <span class="title">files</span> <span class="title">themselves</span>.</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">[<span class="title">include</span>]</span></span><br><span class="line"><span class="class"><span class="title">files</span> = <span class="title">supervisord</span>.<span class="title">d</span>/*.<span class="title">ini</span></span></span><br></pre></td></tr></table></figure>

<h4 id="4、创建对应的配置文件夹"><a href="#4、创建对应的配置文件夹" class="headerlink" title="4、创建对应的配置文件夹"></a>4、创建对应的配置文件夹</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">touch /<span class="keyword">var</span>/run/supervisor.sock </span><br><span class="line">touch /<span class="keyword">var</span>/log/supervisord.log </span><br><span class="line">touch /<span class="keyword">var</span>/run<span class="comment">//supervisord.pid </span></span><br><span class="line">mkdir /etc/supervisor/conf.d </span><br><span class="line"></span><br><span class="line">添加权限 </span><br><span class="line">chmod <span class="number">777</span> /<span class="keyword">var</span>/run </span><br><span class="line">chmod <span class="number">777</span> /<span class="keyword">var</span>/log</span><br></pre></td></tr></table></figure>

<h4 id="5、验证supervisor是否安装成功"><a href="#5、验证supervisor是否安装成功" class="headerlink" title="5、验证supervisor是否安装成功"></a>5、验证supervisor是否安装成功</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">supervisorctl --help</span><br></pre></td></tr></table></figure>


<h3 id="编写子程序"><a href="#编写子程序" class="headerlink" title="编写子程序"></a>编写子程序</h3><p>1、编写位置，里面全部是子程序配置文件</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">/etc/supervisord.d</span><br></pre></td></tr></table></figure>

<p>2、配置解释</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">[program:test] </span><br><span class="line">process_name=%(program_name)s_%(process_num)<span class="number">02</span>d </span><br><span class="line">command= go run main.go         <span class="comment"># 运行命令 </span></span><br><span class="line">directory=/home/qb/              <span class="comment"># 运行文件目录 </span></span><br><span class="line">autostart=<span class="literal">true</span>                   <span class="comment"># 自动启动 </span></span><br><span class="line">autorestart=<span class="literal">true</span>                 <span class="comment"># 自动重新启动 </span></span><br><span class="line">user=root                       <span class="comment"># 哪一个用户执行 </span></span><br><span class="line">redirect_stderr=<span class="literal">true</span>             <span class="comment">#重定向错误</span></span><br></pre></td></tr></table></figure>

<p>3、配置实例</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">[program:voicebroadcastinput]</span><br><span class="line">directory=/home/wwwroot/voicebroadcastinput     ;</span><br><span class="line">command=/usr/local/php/bin/php /home/wwwroot/voicebroadcastinput/think queue:work --queue HandwrittenUserQueue</span><br><span class="line">process_name=user ;</span><br><span class="line">numprocs=<span class="number">1</span>      ;</span><br><span class="line">autostart=True  ;</span><br><span class="line">startsec=<span class="number">5</span>      ;</span><br><span class="line">autorestart=True        ;</span><br><span class="line">startretries=<span class="number">3</span>  ;</span><br><span class="line">user=root       ;</span><br><span class="line">redirect_stderr=True ;</span><br><span class="line">stdout_logfile_maxbytes=<span class="number">50</span>MB    ;</span><br><span class="line">stdout_logfile_backup =<span class="number">20</span>       ;</span><br><span class="line">stdout_logfile=/<span class="keyword">var</span>/supervisor/log/voicebroadcastinput_queue_user_v2.log      ;</span><br><span class="line">loglevel=info   ;</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：stdout_logfile 加载的日志文件需要手动去创建并赋予权限。</p>
<h3 id="常用服务操作命令"><a href="#常用服务操作命令" class="headerlink" title="常用服务操作命令"></a>常用服务操作命令</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">systemctl restart supervisord.service  <span class="comment">// 重启服务</span></span><br><span class="line">systemctl stop supervisord.service     <span class="comment">// 停止服务 </span></span><br><span class="line">systemctl start supervisord.service    <span class="comment">// 开始服务</span></span><br><span class="line">systemctl status supervisord.service   <span class="comment">// 查看服务状态</span></span><br></pre></td></tr></table></figure>

<h3 id="常用客户端操作命令"><a href="#常用客户端操作命令" class="headerlink" title="常用客户端操作命令"></a>常用客户端操作命令</h3><p>先由supervisorctl进入到客户端</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">supervisorctl</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">status   <span class="comment">// 查看子程序运行状态</span></span><br><span class="line">reload   <span class="comment">// 重新加载子程序</span></span><br><span class="line">stop [子程序名]    <span class="comment">// 停止某一个子程序</span></span><br><span class="line">start [子程序名]   <span class="comment">// 开始某一个子程序</span></span><br><span class="line">start all         <span class="comment">// 开始所有子程序</span></span><br><span class="line">stop all          <span class="comment">// 停止所有子程序</span></span><br><span class="line">tail -f [子程序名]  <span class="comment">// 查看某一个子程序下的日志</span></span><br><span class="line">update             <span class="comment">// 更新配置文件</span></span><br></pre></td></tr></table></figure>


]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>七牛云图床API接口指南</title>
    <url>/2018/03/06/%E4%B8%83%E7%89%9B%E4%BA%91%E5%9B%BE%E5%BA%8AAPI%E6%8E%A5%E5%8F%A3%E6%8C%87%E5%8D%97/</url>
    <content><![CDATA[<h3 id="登录到七牛云官网注册一个账号"><a href="#登录到七牛云官网注册一个账号" class="headerlink" title="登录到七牛云官网注册一个账号"></a>登录到七牛云官网注册一个账号</h3><p>地址：<a href="http://www.qiniu.com/">http://www.qiniu.com</a></p>
<h3 id="获取对应的七牛云秘钥"><a href="#获取对应的七牛云秘钥" class="headerlink" title="获取对应的七牛云秘钥"></a>获取对应的七牛云秘钥</h3><p>位置：个人面板-&gt;秘钥管理<br>获取一对 AccessKey&#x2F;SecretKey 秘钥</p>
<h3 id="建立存储空间"><a href="#建立存储空间" class="headerlink" title="建立存储空间"></a>建立存储空间</h3><p>位置：对象存储<br>对象存储中可以管理上传的文件、对空间的设置、域名绑定、样式分割符设置及图片样式设定。</p>
<span id="more"></span>

<h3 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h3><p>文档地址：<a href="http://developer.qiniu.com/code/v7/sdk/php.html#usage">http://developer.qiniu.com/code/v7/sdk/php.html#usage</a></p>
<h4 id="1、引入SDK"><a href="#1、引入SDK" class="headerlink" title="1、引入SDK"></a>1、引入SDK</h4><p>无论你是通过哪种方式安装的 SDK，只需要一句简单的 require 语句将安装好的SDK包含到你的项目中。请参考如下表格，找到适合你的安装方式，将SDK引入到你的项目中。请用你项目中的实际路径替换 path_to_sdk。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Composer 安装</span><br><span class="line"></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;path_to_sdk/vendor/autoload.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line">下载Composer安装包</span><br><span class="line"></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;path_to_sdk/vendor/autoload.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line">下载源码安装包</span><br><span class="line"></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;path_to_sdk/autoload.php&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h4 id="2、SDK结构"><a href="#2、SDK结构" class="headerlink" title="2、SDK结构"></a>2、SDK结构</h4><p>可以直接查看我们的SDK目录，即可大致了解我们SDK的结构。</p>
<ul>
<li>最外层包含：配置文件， 鉴权和一些公共的函数</li>
<li>HTTP 目录主要包含了一些对 http 进行封装的类，这块你可以不用关心。</li>
<li>Storage 目录主要包含两大块：Bucket 中文件的管理和文件的上传。</li>
<li>Processing 目录主要包含文件的处理，文件处理又包含两个方面：同步处理和异步处理。</li>
</ul>
<p>为了帮助您更好的了解和使用我们的sdk，我们还提供了各种使用示例。 如果使用中遇到问题，可以通过Github或者我们的工单进行反馈。下面我们对一些关键点进行简单的介绍，方便您快速入门。</p>
<h4 id="3、鉴权类"><a href="#3、鉴权类" class="headerlink" title="3、鉴权类"></a>3、鉴权类</h4><p>在使用七牛的SDK的过程中鉴权是很重要的一块，不管是上传鉴权，下载签权， 还是回调的签权。 PHP SDK 中的Auth类封装了所有的鉴权方式。 所以在使用 PHP SDK 时基本都会先对鉴权类进行初始化：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">require</span> <span class="string">&#x27;path_to_sdk/vendor/autoload.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">use</span> <span class="title">Qiniu</span>\<span class="title">Auth</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 用于签名的公钥和私钥 </span></span><br><span class="line">  <span class="variable">$accessKey</span> = <span class="string">&#x27;Access_Key&#x27;</span>;</span><br><span class="line">  <span class="variable">$secretKey</span> = <span class="string">&#x27;Secret_Key&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 初始化签权对象 </span></span><br><span class="line">  <span class="variable">$auth</span> = <span class="keyword">new</span> <span class="title class_">Auth</span>(<span class="variable">$accessKey</span>, <span class="variable">$secretKey</span>);</span><br></pre></td></tr></table></figure>
<p>初始化好Auth 类后，就可以调用相应的方法了，比如生成私有下载链接方法 privateDownloadUrl，获取上传Token方法 uploadToken，验证回调方法 verifyCallback等。</p>
<h3 id="上传流程"><a href="#上传流程" class="headerlink" title="上传流程"></a>上传流程</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">require_once</span> <span class="string">&#x27;path_to_sdk/vendor/autoload.php&#x27;</span>;                    <span class="comment">//引入类库文件 建议用composer方式</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 引入鉴权类   </span></span><br><span class="line">     <span class="keyword">use</span> <span class="title">Qiniu</span>\<span class="title">Auth</span>;                                                                   <span class="comment">//命名空间                               </span></span><br><span class="line">    <span class="comment">// 引入上传类   </span></span><br><span class="line">     <span class="keyword">use</span> <span class="title">Qiniu</span>\<span class="title">Storage</span>\<span class="title">UploadManager</span>;                                  <span class="comment">//命名空间</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 需要填写你的 Access Key 和 Secret Key                             //这里就用到了注册账户后用到的两个秘钥</span></span><br><span class="line">     <span class="variable">$accessKey</span> = <span class="string">&#x27;Access_Key&#x27;</span>;</span><br><span class="line">     <span class="variable">$secretKey</span> = <span class="string">&#x27;Secret_Key&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 构建鉴权对象   </span></span><br><span class="line">     <span class="variable">$auth</span> = <span class="keyword">new</span> <span class="title class_">Auth</span>(<span class="variable">$accessKey</span>, <span class="variable">$secretKey</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 要上传的空间   </span></span><br><span class="line">     <span class="variable">$bucket</span> = <span class="string">&#x27;Bucket_Name&#x27;</span>;                                          <span class="comment">//设定的上传空间名</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 生成上传 Token   </span></span><br><span class="line">     <span class="variable">$token</span> = <span class="variable">$auth</span>-&gt;<span class="title function_ invoke__">uploadToken</span>(<span class="variable">$bucket</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 要上传文件的本地路径   </span></span><br><span class="line">      <span class="variable">$filePath</span> = <span class="string">&#x27;./php-logo.png&#x27;</span>;                                     <span class="comment">//上传时候图片在本地的路径</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 上传到七牛后保存的文件名   </span></span><br><span class="line">      <span class="variable">$key</span> = <span class="string">&#x27;my-php-logo.png&#x27;</span>;                                         <span class="comment">//保存到七牛上面的命名</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 初始化 UploadManager 对象并进行文件的上传   </span></span><br><span class="line">     <span class="variable">$uploadMgr</span> = <span class="keyword">new</span> <span class="title class_">UploadManager</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 调用 UploadManager 的 putFile 方法进行文件的上传   </span></span><br><span class="line">     <span class="keyword">list</span>(<span class="variable">$ret</span>, <span class="variable">$err</span>) = <span class="variable">$uploadMgr</span>-&gt;<span class="title function_ invoke__">putFile</span>(<span class="variable">$token</span>, <span class="variable">$key</span>, <span class="variable">$filePath</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;\n====&gt; putFile result: \n&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$err</span> !== <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">var_dump</span>(<span class="variable">$err</span>);                                                 <span class="comment">//返回结果根据需要处理</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_ invoke__">var_dump</span>(<span class="variable">$ret</span>);                                 </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="文件下载"><a href="#文件下载" class="headerlink" title="文件下载"></a>文件下载</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">require</span> <span class="string">&#x27;path_to_sdk/vendor/autoload.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 引入鉴权类   </span></span><br><span class="line">      <span class="keyword">use</span> <span class="title">Qiniu</span>\<span class="title">Auth</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 需要填写你的 Access Key 和 Secret Key   </span></span><br><span class="line">     <span class="variable">$accessKey</span> = <span class="string">&#x27;Access_Key&#x27;</span>;</span><br><span class="line">     <span class="variable">$secretKey</span> = <span class="string">&#x27;Secret_Key&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 构建鉴权对象   </span></span><br><span class="line">     <span class="variable">$auth</span> = <span class="keyword">new</span> <span class="title class_">Auth</span>(<span class="variable">$accessKey</span>, <span class="variable">$secretKey</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//baseUrl构造成私有空间的域名/key的形式   </span></span><br><span class="line">     <span class="variable">$baseUrl</span> = <span class="string">&#x27;http://domain/key&#x27;</span>;                                                  <span class="comment">//空间名+文件名 的格式</span></span><br><span class="line">    <span class="variable">$authUrl</span> = <span class="variable">$auth</span>-&gt;<span class="title function_ invoke__">privateDownloadUrl</span>(<span class="variable">$baseUrl</span>);                      <span class="comment">//加密处理后再返回</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$authUrl</span>;<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="删除单个文件"><a href="#删除单个文件" class="headerlink" title="删除单个文件"></a>删除单个文件</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">require_once</span> <span class="string">&#x27;path_to_sdk/vendor/autoload.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">use</span> <span class="title">Qiniu</span>\<span class="title">Auth</span>;</span><br><span class="line">  <span class="keyword">use</span> <span class="title">Qiniu</span>\<span class="title">Storage</span>\<span class="title">BucketManager</span>;</span><br><span class="line"></span><br><span class="line">  <span class="variable">$accessKey</span> = <span class="string">&#x27;Access_Key&#x27;</span>;</span><br><span class="line">  <span class="variable">$secretKey</span> = <span class="string">&#x27;Secret_Key&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//初始化Auth状态 </span></span><br><span class="line">  <span class="variable">$auth</span> = <span class="keyword">new</span> <span class="title class_">Auth</span>(<span class="variable">$accessKey</span>, <span class="variable">$secretKey</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//初始化BucketManager </span></span><br><span class="line">  <span class="variable">$bucketMgr</span> = <span class="keyword">new</span> <span class="title class_">BucketManager</span>(<span class="variable">$auth</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//你要测试的空间， 并且这个key在你空间中存在 </span></span><br><span class="line">  <span class="variable">$bucket</span> = <span class="string">&#x27;Bucket_Name&#x27;</span>;</span><br><span class="line">  <span class="variable">$key</span> = <span class="string">&#x27;php-logo.png&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//删除$bucket 中的文件 $key </span></span><br><span class="line">  <span class="variable">$err</span> = <span class="variable">$bucketMgr</span>-&gt;<span class="title function_ invoke__">delete</span>(<span class="variable">$bucket</span>, <span class="variable">$key</span>);                       <span class="comment">//空间名  和  未加密的文件名</span></span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;\n====&gt; delete <span class="subst">$key</span> : \n&quot;</span>;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable">$err</span> !== <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="title function_ invoke__">var_dump</span>(<span class="variable">$err</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&quot;Success!&quot;</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>还有更多的操作请参考官方文档，地址：<a href="http://developer.qiniu.com/code/v7/sdk/php.html#install">http://developer.qiniu.com/code/v7/sdk/php.html#install</a></p>
<h3 id="实际案例（实战项目中的方法封装）"><a href="#实际案例（实战项目中的方法封装）" class="headerlink" title="实际案例（实战项目中的方法封装）"></a>实际案例（实战项目中的方法封装）</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//七牛云图片上传配置</span></span><br><span class="line"><span class="keyword">const</span>  ACCESS_KEY = <span class="string">&#x27;byJc-8owLt9G5ljXsNYbTsfOCKzQgTV4UTPu3sCG&#x27;</span> ;            <span class="comment">//私钥AK</span></span><br><span class="line"><span class="keyword">const</span>  SECRET_KEY = <span class="string">&#x27;6ybTxRxyDGndimpVMgK_k-6s1prGIPkGtB0Xolyb&#x27;</span> ;            <span class="comment">//私钥SK</span></span><br><span class="line"><span class="keyword">const</span>  QINIU_BUCKET = <span class="string">&#x27;op-zbj&#x27;</span> ;                                                        <span class="comment">//空间名（对象存储中）</span></span><br><span class="line"><span class="keyword">const</span>  BASE_URL  = <span class="string">&#x27;http://ohsllkayi.bkt.clouddn.com&#x27;</span> ;     </span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 上传图片到七牛云</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> $filePath 图片的本地路径</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> $fileName 图片名</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> mixed  array</span></span><br><span class="line"><span class="comment">* <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">UploadPicToQiNiu</span> (<span class="params"><span class="variable">$fileName</span> , <span class="variable">$filePath</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 初始化签权对象</span></span><br><span class="line">    <span class="variable">$auth</span> = <span class="keyword">new</span> <span class="title class_">Auth</span>(lib_<span class="title class_">Constant</span>:: ACCESS_KEY , lib_<span class="title class_">Constant</span>:: SECRET_KEY );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 生成上传 Token</span></span><br><span class="line">    <span class="variable">$token</span> = <span class="variable">$auth</span>-&gt; <span class="title function_ invoke__">uploadToken</span> (lib_<span class="title class_">Constant</span>:: QINIU_BUCKET) ;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 上传到七牛后保存的文件名</span></span><br><span class="line">    <span class="variable">$key</span> = <span class="string">&#x27;qiniu_&#x27;</span>.<span class="title function_ invoke__">md5</span>( <span class="variable">$fileName</span> .<span class="title function_ invoke__">rand</span>(<span class="number">100</span> , <span class="number">999</span>)) ;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 初始化 UploadManager 对象并进行文件的上传</span></span><br><span class="line">    <span class="variable">$uploadMgr</span> = <span class="keyword">new</span> <span class="title class_">UploadManager</span>() ;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 调用 UploadManager 的 putFile 方法进行文件的上传</span></span><br><span class="line">    <span class="keyword">list</span> ( <span class="variable">$ret</span>, <span class="variable">$err</span> ) = <span class="variable">$uploadMgr</span> -&gt; <span class="title function_ invoke__">putFile</span>( <span class="variable">$token</span> , <span class="variable">$key</span> , <span class="variable">$filePath</span>) ;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$err</span> !== <span class="literal">null</span>) &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="variable">$err</span> ;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$ret</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 从七牛云上获取图片到本地</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> $filePath  数据库中的图片地址</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">downloadPicToQiNiu</span> (<span class="params"><span class="variable">$filePath</span> </span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 构建鉴权对象</span></span><br><span class="line">    <span class="variable">$auth</span> = <span class="keyword">new</span> <span class="title class_">Auth</span>(lib_<span class="title class_">Constant</span>:: ACCESS_KEY , lib_<span class="title class_">Constant</span>:: SECRET_KEY );</span><br><span class="line">    <span class="comment">//baseUrl构造成私有空间的域名/key的形式</span></span><br><span class="line">    <span class="variable">$baseUrl</span> = lib_<span class="title class_">Constant</span>:: BASE_URL. <span class="string">&#x27;/&#x27;</span> .<span class="variable">$filePath</span> ;</span><br><span class="line">    <span class="variable">$authUrl</span> = <span class="variable">$auth</span>-&gt; <span class="title function_ invoke__">privateDownloadUrl</span> (<span class="variable">$baseUrl</span> ) ;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$authUrl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 批量获取七牛云上的图片</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> $filePathArray</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> array|bool</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">batchDownloadPicToQiNiu</span> (<span class="params"> <span class="variable">$filePathArray</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ( <span class="keyword">empty</span>( <span class="variable">$filePathArray</span> ))&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 构建鉴权对象</span></span><br><span class="line">    <span class="variable">$returnFullImagesPath</span> = [] ;</span><br><span class="line">    <span class="variable">$auth</span> = <span class="keyword">new</span> <span class="title class_">Auth</span>(lib_<span class="title class_">Constant</span>:: ACCESS_KEY , lib_<span class="title class_">Constant</span>:: SECRET_KEY );</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$filePathArray</span> <span class="keyword">as</span> <span class="variable">$filePath</span>)&#123;</span><br><span class="line">        <span class="comment">//baseUrl构造成私有空间的域名/key的形式</span></span><br><span class="line">        <span class="variable">$baseUrl</span> = lib_<span class="title class_">Constant</span>:: BASE_URL. <span class="string">&#x27;/&#x27;</span> .<span class="variable">$filePath</span> ;</span><br><span class="line">        <span class="variable">$returnFullImagesPath</span> [] = <span class="variable">$auth</span> -&gt;<span class="title function_ invoke__">privateDownloadUrl</span> ( <span class="variable">$baseUrl</span>) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$returnFullImagesPath</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 从七牛云上删除图片</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> $filePath</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> mixed</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">deleteToQiNiu</span> (<span class="params"><span class="variable">$filePath</span> </span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//初始化Auth状态</span></span><br><span class="line">    <span class="variable">$auth</span> = <span class="keyword">new</span> <span class="title class_">Auth</span>(lib_<span class="title class_">Constant</span>:: ACCESS_KEY , lib_<span class="title class_">Constant</span>:: SECRET_KEY );</span><br><span class="line">    <span class="comment">//初始化BucketManager</span></span><br><span class="line">    <span class="variable">$bucketMgr</span> = <span class="keyword">new</span> <span class="title class_">BucketManager</span>( <span class="variable">$auth</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">//删除$bucket 中的文件 $key</span></span><br><span class="line">    <span class="variable">$err</span> = <span class="variable">$bucketMgr</span> -&gt; <span class="title function_ invoke__">delete</span>(lib_<span class="title class_">Constant</span>:: QINIU_BUCKET ,<span class="variable">$filePath</span> ) ;</span><br><span class="line">   <span class="comment">// echo &quot;\n====&gt; delete $key : \n&quot;;</span></span><br><span class="line">    <span class="keyword">if</span> ( <span class="variable">$err</span> !== <span class="literal">null</span> ) &#123;</span><br><span class="line">        <span class="keyword">return</span> fasle ;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>php</category>
      </categories>
      <tags>
        <tag>php</tag>
      </tags>
  </entry>
  <entry>
    <title>两个重要函数（获取无限极菜单+批量排序）</title>
    <url>/2018/03/07/%E4%B8%A4%E4%B8%AA%E9%87%8D%E8%A6%81%E5%87%BD%E6%95%B0%EF%BC%88%E8%8E%B7%E5%8F%96%E6%97%A0%E9%99%90%E6%9E%81%E8%8F%9C%E5%8D%95-%E6%89%B9%E9%87%8F%E6%8E%92%E5%BA%8F%EF%BC%89/</url>
    <content><![CDATA[<p>以下两个函数是自己在接触PHP的时候学到的，这里做一下记录只是为了怀念那个时候对于行业的那种陌生感和探索欲望，这两个函数虽然不是很难，但是用的地方不少，比如获取目录树，可以用在对类目的管理、评论等无限级的地方都可以用，话不多说，请看代码。</p>
<span id="more"></span>
<h4 id="获取目录树"><a href="#获取目录树" class="headerlink" title="获取目录树"></a>获取目录树</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 得到菜单栏目树</span></span><br><span class="line"><span class="comment">* <span class="doctag">@author</span> xiexiang 2016-03-17</span></span><br><span class="line"><span class="comment">* <span class="doctag">@params</span> eg $map = &quot;name = &#x27;xiexiang&#x27;&quot;   //查询条件</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getMenu</span>(<span class="params"><span class="variable">$map</span> </span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//实例化数据表menu</span></span><br><span class="line">    <span class="variable">$menu</span> = <span class="keyword">new</span> <span class="title function_ invoke__">model_op_menu</span>() ;</span><br><span class="line">    <span class="variable">$order</span> = <span class="string">&quot;ORDER BY level ASC,sort DESC&quot;</span>;</span><br><span class="line">    <span class="variable">$menu_list</span> = <span class="variable">$menu</span>-&gt; <span class="title function_ invoke__">select</span>(<span class="variable">$map</span> , <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$order</span> , <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    <span class="variable">$mod_list</span> = <span class="variable">$menu_list</span>-&gt; items;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable">$mod_list</span> || <span class="keyword">empty</span>( <span class="variable">$mod_list</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$tmp</span> = <span class="keyword">array</span>() ;</span><br><span class="line">    <span class="variable">$address</span> = <span class="keyword">array</span>() ; <span class="comment">//父级地址</span></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$mod_list</span> <span class="keyword">as</span> <span class="variable">$k</span> =&gt; <span class="variable">$v</span>) &#123;</span><br><span class="line">        <span class="variable">$id</span> = <span class="variable">$v</span>[ <span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$v</span> [<span class="string">&#x27;level&#x27;</span>] &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="comment">//一级</span></span><br><span class="line">            <span class="variable">$tmp</span> [<span class="variable">$id</span>] = <span class="variable">$v</span>;</span><br><span class="line">            <span class="variable">$address</span> [<span class="variable">$id</span>] = &amp; <span class="variable">$tmp</span>[<span class="variable">$id</span> ];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//子集</span></span><br><span class="line">            <span class="variable">$pid</span> = <span class="variable">$v</span>[ <span class="string">&#x27;pid&#x27;</span>];</span><br><span class="line">            <span class="keyword">if</span> (!<span class="variable">$address</span>[ <span class="variable">$pid</span>][<span class="string">&#x27;child&#x27;</span> ]) &#123;</span><br><span class="line">                <span class="variable">$address</span>[ <span class="variable">$pid</span>][<span class="string">&#x27;child&#x27;</span> ] = <span class="keyword">array</span>() ;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$address</span> [<span class="variable">$pid</span>][ <span class="string">&#x27;child&#x27;</span>][<span class="variable">$id</span> ] = <span class="variable">$v</span>;</span><br><span class="line">            <span class="variable">$address</span> [<span class="variable">$id</span>] = &amp; <span class="variable">$address</span>[<span class="variable">$pid</span> ][<span class="string">&#x27;child&#x27;</span>][ <span class="variable">$id</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$tmp</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="批量排序"><a href="#批量排序" class="headerlink" title="批量排序"></a>批量排序</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 批量排序</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">pagesort</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//异常插入</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable">$sort</span> = lib_<span class="title class_">BaseUtils</span>::<span class="title function_ invoke__">getStr</span>( <span class="variable">$_GET</span>[<span class="string">&#x27;sort&#x27;</span> ]);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">empty</span>( <span class="variable">$sort</span>)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>( <span class="string">&#x27;请选择需要排序的数据！&#x27;</span> , <span class="number">0</span>) ;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> ( <span class="variable">$sort</span> <span class="keyword">as</span> <span class="variable">$k</span> =&gt; <span class="variable">$v</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="title function_ invoke__">is_numeric</span>( <span class="variable">$k</span>) || !<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$v</span> )) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$sql_bat_sort</span> .= <span class="string">&quot; WHEN &#123; <span class="subst">$k</span>&#125; THEN <span class="subst">&#123;$v&#125;</span> &quot;</span>;</span><br><span class="line">            <span class="variable">$sql_ids</span> .= <span class="string">&#x27;,&#x27;</span> . <span class="variable">$k</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$menu</span> = <span class="keyword">new</span> <span class="title function_ invoke__">model_op_menu</span>() ;</span><br><span class="line">        <span class="variable">$sql</span> = <span class="string">&quot;UPDATE op_menu SET sort= CASE id &quot;</span> . <span class="variable">$sql_bat_sort</span> . <span class="string">&quot; END WHERE id IN (&quot;</span> . <span class="title function_ invoke__">trim</span>(<span class="variable">$sql_ids</span> , <span class="string">&#x27;, &#x27;</span>) . <span class="string">&quot;)&quot;</span>;</span><br><span class="line">        <span class="variable">$menu</span> -&gt;<span class="title function_ invoke__">query</span>( <span class="variable">$sql</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&#x27;批量排序成功！&#x27;</span>, <span class="number">1</span> );</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (<span class="built_in">Exception</span> <span class="variable">$e</span> ) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span> -&gt;<span class="title function_ invoke__">printmsg</span>( <span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span> (), <span class="variable">$e</span> -&gt;<span class="title function_ invoke__">getCode</span>()) ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="巧办法"><a href="#巧办法" class="headerlink" title="巧办法"></a>巧办法</h4><p>上诉的获取目录树也可以用通过更加简单的办法来实现，在数据库设计合理的情况下，可以使用递归的方式来做。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * - 得到树形处理后的分类列表</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> int $pid</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> array $result</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> int $space</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getTree</span>(<span class="params"><span class="variable">$pid</span>=<span class="number">0</span>,&amp;<span class="variable">$result</span>=[],<span class="variable">$space</span>=<span class="number">0</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$space</span>+=<span class="number">2</span>;</span><br><span class="line">        <span class="variable">$parents</span> = <span class="title class_">Category</span>::<span class="title function_ invoke__">where</span>(<span class="string">&#x27;cate_pid&#x27;</span>,<span class="variable">$pid</span>)-&gt;<span class="title function_ invoke__">orderBy</span>(<span class="string">&#x27;cate_order&#x27;</span>,<span class="string">&#x27;DESC&#x27;</span>)-&gt;<span class="title function_ invoke__">get</span>();</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$parents</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$val</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$val</span>-&gt;cate_pid != <span class="number">0</span>)&#123;</span><br><span class="line">                <span class="variable">$val</span>[<span class="string">&#x27;cate_name&#x27;</span>] = <span class="title function_ invoke__">str_repeat</span>(<span class="string">&#x27;&amp;nbsp;&amp;nbsp;&amp;nbsp;&#x27;</span>,<span class="variable">$space</span>).<span class="string">&#x27;▲ &#x27;</span>.<span class="variable">$val</span>[<span class="string">&#x27;cate_name&#x27;</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$result</span>[] = <span class="variable">$val</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getTree</span>(<span class="variable">$val</span>-&gt;cate_id,<span class="variable">$result</span>,<span class="variable">$space</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>php</category>
      </categories>
      <tags>
        <tag>php</tag>
      </tags>
  </entry>
  <entry>
    <title>成功实施DevOps的七个有力工具</title>
    <url>/2018/05/18/%E6%88%90%E5%8A%9F%E5%AE%9E%E6%96%BDDevOps%E7%9A%84%E4%B8%83%E4%B8%AA%E6%9C%89%E5%8A%9B%E5%B7%A5%E5%85%B7/</url>
    <content><![CDATA[<blockquote>
<p>如今，每个软件企业都在谈论DevOps，他们希望从DevOps中获得好处。DevOps本身不是开发工具，而是开发文化的一次革新，为了能够成功地实施DevOps，需要借助一些工具。Pavan Belagatti列出了7个强有力的工具可以帮助企业成功地实施DevOps。</p>
</blockquote>
<h4 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h4><p>Docker是容器市场的领头羊。随着越来越多的软件企业采用了微服务架构，容器化也成为一个大趋势。在接下来的几年，Docker会变得越来越流行。我们已经在生产环境使用Docker部署了很多服务。Docker简化了配置管理，提升了可操控性，并让横向扩展变得简单。Docker还能让容器在不同的位置自由地移动。</p>
<span id="more"></span>
<h4 id="Git（GitHub）"><a href="#Git（GitHub）" class="headerlink" title="Git（GitHub）"></a>Git（GitHub）</h4><p>Git是一个免费的开源分布式版本控制系统，不管是小型应用还是大型应，它都能应付自如。Git创建于10年前，因为当时的Linux社区需要这么一个可以支持分布式系统的SCM（Source Control Management）软件。这个平台有助于开发者们在上面进行协作。它的那些主要特性，比如代码仓库、代码拉取等等，对开发人员来说很有吸引力。与GitHub的集成十分容易，几乎任何系统都可以连接到GitHub上，没有什么特殊限制。GitHub还可以作为一个网络社交平台，你可以在上面放置你的个人信息和项目相关的数据。GitHub优于其它SCM工具的地方在于，它支持本地分支、过度区域和多工作流。</p>
<h4 id="AWS"><a href="#AWS" class="headerlink" title="AWS"></a>AWS</h4><p>AWS为企业组织提供了灵活的服务，帮助企业高效地交付软件产品。相比敏捷，DevOps能够更快地交付产品，为了做到这一点，AWS为各个公司提供了强大的云计算服务。这些服务包括计算、存储、网络、数据库、数据分析、应用服务、部署、管理、移动、开发者工具以及IoT工具。</p>
<h4 id="JIRA"><a href="#JIRA" class="headerlink" title="JIRA"></a>JIRA</h4><p>JIRA是来自Altassian公司的一款很受欢迎的敏捷开发工具，它提供了众多功能，比如缺陷跟踪、问题跟踪，并在某种程度上为企业提供了项目管理功能。它还支持Scrum、看板、敏捷报告、组合计划、插件、移动应用，并提供了一组健壮的API。</p>
<h4 id="Ansible"><a href="#Ansible" class="headerlink" title="Ansible"></a>Ansible</h4><p>可以使用Ansible为DevOps打下牢固的根基。Ansible是一个简单但却十分强大的配置管理服务器，它帮助团队横向扩展IT自动化规模，管理复杂的部署，并提高生产力。它为团队乃至整个企业带来自动化。很多成功的公司都在使用Ansible来促进IT自动化，而且一旦用了Ansible就不会再考虑其它解决方案了。企业之所以喜欢Ansible，是因为它提供了一种完全不可变的服务器架构。不可变的服务器架构可以保证在添加、销毁或替换服务器时不会对服务造成任何影响。</p>
<h4 id="Slack"><a href="#Slack" class="headerlink" title="Slack"></a>Slack</h4><p>Slack是一个集成工具，任何想实践敏捷和DevOps的组织都可以使用它。它容易监控，还支持通知机制，是一个简单且强大的工具。Slack通过创建通信通道来自动化执行常见的任务，并用它来分发实时信息，缩短团队间的反馈延迟，加快团队的行动，提升团队的生产力。</p>
<h4 id="Shippable"><a href="#Shippable" class="headerlink" title="Shippable"></a>Shippable</h4><p>Shippable可以帮助软件企业加快创新进程。它是一个流水线式的持续部署平台，一般被作为托管服务或企业服务器来帮助软件企业走向现代化。它让编码、打包、部署、运行Docker容器变得更容易。Shippable通过它的CI和CD平台来支持自动化。它在不破坏安全性的前提下使用顺畅的部署来自动化执行那些重复的、机械化的任务。</p>
]]></content>
      <categories>
        <category>devops</category>
      </categories>
      <tags>
        <tag>devops</tag>
      </tags>
  </entry>
  <entry>
    <title>关于nodejs和npm版本不匹配的情况</title>
    <url>/2020/07/09/%E5%85%B3%E4%BA%8Enodejs%E5%92%8Cnpm%E7%89%88%E6%9C%AC%E4%B8%8D%E5%8C%B9%E9%85%8D%E7%9A%84%E6%83%85%E5%86%B5/</url>
    <content><![CDATA[<h3 id="方法一-根据node-修改npm版本号"><a href="#方法一-根据node-修改npm版本号" class="headerlink" title="方法一 根据node 修改npm版本号"></a>方法一 根据node 修改npm版本号</h3><p>今天在安装node.js后使用 npm安装 BtleJuice<br>遇到了如下情况</p>
<p>记录一下该情况看是否有相同问题的朋友就不用了走弯路<br><img src="/../img/js-01.png" alt="nodejs"></p>
<span id="more"></span>

<p>出现该情况说明node.js和npm版本不搭配<br>直接在终端输入</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">node -v</span><br></pre></td></tr></table></figure>

<p>查看node版本号</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">npm -v</span><br></pre></td></tr></table></figure>

<p>查看npm 的版本号<br>提供如下网站查看<br><a href="https://nodejs.org/zh-cn/download/releases/">https://nodejs.org/zh-cn/download/releases/</a></p>
<p><img src="/../img/js-02.png" alt="nodejs"></p>
<p>然后输入查找对应的版本号<br>例如我的node版本是 10.15.1 对应的npm版本号是6.4.1</p>
<p>我就在终端输入</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">npm install -g npm@<span class="number">6.4</span>.<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p><img src="/../img/js-03.png" alt="nodejs"></p>
<p>然后就成功匹配了。</p>
<p>若要升级到最新的npm</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">npm install -g npm</span><br></pre></td></tr></table></figure>

<h3 id="方法二：根据npm-修改node"><a href="#方法二：根据npm-修改node" class="headerlink" title="方法二：根据npm 修改node"></a>方法二：根据npm 修改node</h3><p>直接卸载node 然后在官网上重新下载<br>如果依旧不行 执行方法一</p>
]]></content>
      <categories>
        <category>nodejs</category>
      </categories>
      <tags>
        <tag>nodejs</tag>
      </tags>
  </entry>
  <entry>
    <title>抖音视频去水印接口分析附代码</title>
    <url>/2023/04/07/%E6%8A%96%E9%9F%B3%E8%A7%86%E9%A2%91%E5%8E%BB%E6%B0%B4%E5%8D%B0%E6%8E%A5%E5%8F%A3%E5%88%86%E6%9E%90%E9%99%84%E4%BB%A3%E7%A0%81/</url>
    <content><![CDATA[<blockquote>
<p>本文通过php代码通过抖音链接去获取抖音无水印视频，也可以批量获取下载抖音视频，禁止转载</p>
</blockquote>
<h3 id="请求过程分析"><a href="#请求过程分析" class="headerlink" title="请求过程分析"></a>请求过程分析</h3><p>我们还是先获取一个抖音链接</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">https:<span class="comment">//v.douyin.com/S2pF3G8/</span></span><br></pre></td></tr></table></figure>

<p>通过访问重定向</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">https:<span class="comment">//www.douyin.com/video/7190042191169883427</span></span><br></pre></td></tr></table></figure>

<p>然后提取到其中的视频ID</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="number">7190042191169883427</span></span><br></pre></td></tr></table></figure>

<h3 id="URL参数X-Bogus"><a href="#URL参数X-Bogus" class="headerlink" title="URL参数X-Bogus"></a>URL参数X-Bogus</h3><p>X-Bogus你可以理解为是一个根据视频ID及user-agent通过JS生成的用户信息参数，它可以用于校验，详细的一篇分析可以参考Freebuf上的《【JS 逆向百例】某音 X-Bogus 逆向分析，JSVMP 纯算法还原》</p>
<p>X-Bogus简单的理解就是通过js算法生成的一个秘钥，抖音通过这个秘钥能得到身份验证</p>
<p>文章后面会详细介绍X-Bogus的获取</p>
<span id="more"></span>

<p>去抖音获取视频的完整链接为：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">https:<span class="comment">//www.douyin.com/aweme/v1/web/aweme/detail/?aweme_id=7190049956269444386&amp;aid=1128&amp;version_name=23.5.0&amp;device_platform=android&amp;os_version=2333&amp;X-Bogus=DFSzswSLfwUANnEftaw7nt9WcBJN</span></span><br></pre></td></tr></table></figure>


<h3 id="Cookie参数"><a href="#Cookie参数" class="headerlink" title="Cookie参数"></a>Cookie参数</h3><p>完整的Cookie需要包含以下内容</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">msToken=uTa38b9QFHB6JtEDzH9S4np17qxpG6OrROHQ8at2cBpoKfUb0UWmTkjCSpf72EcUrJgWTIoN6UgAv5BTXtCbOAhJcIRKyZIT7TMYapeOSpf;odin_tt=<span class="number">324</span>fb4ea4a89c0c05827e18a1ed9cf9bf8a17f7705fcc793fec935b637867e2a5a9b8168c885554d029919117a18ba69; ttwid=<span class="number">1</span>%<span class="number">7</span>CWBuxH_bhbuTENNtACXoesI5QHV2Dt9-vkMGVHSRRbgY%<span class="number">7</span>C1677118712%<span class="number">7</span>C1d87ba1ea2cdf05d80204aea2e1036451dae638e7765b8a4d59d87fa05dd39ff; bd_ticket_guard_client_data=eyJiZC10aWNrZXQtZ3VhcmQtdmVyc2lvbiI6MiwiYmQtdGlja2V0LWd1YXJkLWNsaWVudC1jc3IiOiItLS0tLUJFR0lOIENFUlRJRklDQVRFIFJFUVVFU1QtLS0tLVxyXG5NSUlCRFRDQnRRSUJBREFuTVFzd0NRWURWUVFHRXdKRFRqRVlNQllHQTFVRUF3d1BZbVJmZEdsamEyVjBYMmQxXHJcbllYSmtNRmt3RXdZSEtvWkl6ajBDQVFZSUtvWkl6ajBEQVFjRFFnQUVKUDZzbjNLRlFBNUROSEcyK2F4bXAwNG5cclxud1hBSTZDU1IyZW1sVUE5QTZ4aGQzbVlPUlI4NVRLZ2tXd1FJSmp3Nyszdnc0Z2NNRG5iOTRoS3MvSjFJc3FBc1xyXG5NQ29HQ1NxR1NJYjNEUUVKRGpFZE1Cc3dHUVlEVlIwUkJCSXdFSUlPZDNkM0xtUnZkWGxwYmk1amIyMHdDZ1lJXHJcbktvWkl6ajBFQXdJRFJ3QXdSQUlnVmJkWTI0c0RYS0c0S2h3WlBmOHpxVDRBU0ROamNUb2FFRi9MQnd2QS8xSUNcclxuSURiVmZCUk1PQVB5cWJkcytld1QwSDZqdDg1czZZTVNVZEo5Z2dmOWlmeTBcclxuLS0tLS1FTkQgQ0VSVElGSUNBVEUgUkVRVUVTVC0tLS0tXHJcbiJ9</span><br></pre></td></tr></table></figure>

<p>准确来说就是四个参数</p>
<ul>
<li>msToken</li>
<li>odin_tt</li>
<li>ttwid</li>
<li>bd_ticket_guard_client_data</li>
</ul>
<h4 id="msToken"><a href="#msToken" class="headerlink" title="msToken"></a>msToken</h4><p>Cookie中需要包含msToken，该参数其实就是一个107位的随机数，由大小写英文字母、数字组成<br>php实现方式：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$msToken</span> = <span class="title function_ invoke__">substr</span>(<span class="title function_ invoke__">str_shuffle</span>(<span class="string">&#x27;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span>), <span class="number">0</span>, <span class="number">107</span>);</span><br></pre></td></tr></table></figure>

<h4 id="odin-tt"><a href="#odin-tt" class="headerlink" title="odin_tt"></a>odin_tt</h4><p>原则上这个字段是通过请求获得的，我们这里直接写死</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">odin_tt=<span class="number">324</span>fb4ea4a89c0c05827e18a1ed9cf9bf8a17f7705fcc793fec935b637867e2a5a9b8168c885554d029919117a18ba69; ttwid=<span class="number">1</span>%<span class="number">7</span>CWBuxH_bhbuTENNtACXoesI5QHV2Dt9-vkMGVHSRRbgY%<span class="number">7</span>C1677118712%<span class="number">7</span>C1d87ba1ea2cdf05d80204aea2e1036451dae638e7765b8a4d59d87fa05dd39ff; </span><br></pre></td></tr></table></figure>

<h4 id="ttwid"><a href="#ttwid" class="headerlink" title="ttwid"></a>ttwid</h4><p>ttwid直接写死就好</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">ttwid=<span class="number">1</span>%<span class="number">7</span>C7ZLJzwjjEw7NLeADTpVd-<span class="number">3</span>eId-ZEIg0jpCEzTV9p_2A%<span class="number">7</span>C1677681848%<span class="number">7</span>C4ff4f97328ddc18b6d46c259bc26a05d2e654b50e3f21b27b8f9e9e8f9fcec82; Path=/; Domain=bytedance.com; Max-Age=<span class="number">31536000</span>; HttpOnly; Secure</span><br></pre></td></tr></table></figure>

<h4 id="bd-ticket-guard-client-data"><a href="#bd-ticket-guard-client-data" class="headerlink" title="bd_ticket_guard_client_data"></a>bd_ticket_guard_client_data</h4><p>bd_ticket_guard_client_data直接写死就行了</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">bd_ticket_guard_client_data=eyJiZC10aWNrZXQtZ3VhcmQtdmVyc2lvbiI6MiwiYmQtdGlja2V0LWd1YXJkLWNsaWVudC1jc3IiOiItLS0tLUJFR0lOIENFUlRJRklDQVRFIFJFUVVFU1QtLS0tLVxyXG5NSUlCRFRDQnRRSUJBREFuTVFzd0NRWURWUVFHRXdKRFRqRVlNQllHQTFVRUF3d1BZbVJmZEdsamEyVjBYMmQxXHJcbllYSmtNRmt3RXdZSEtvWkl6ajBDQVFZSUtvWkl6ajBEQVFjRFFnQUVKUDZzbjNLRlFBNUROSEcyK2F4bXAwNG5cclxud1hBSTZDU1IyZW1sVUE5QTZ4aGQzbVlPUlI4NVRLZ2tXd1FJSmp3Nyszdnc0Z2NNRG5iOTRoS3MvSjFJc3FBc1xyXG5NQ29HQ1NxR1NJYjNEUUVKRGpFZE1Cc3dHUVlEVlIwUkJCSXdFSUlPZDNkM0xtUnZkWGxwYmk1amIyMHdDZ1lJXHJcbktvWkl6ajBFQXdJRFJ3QXdSQUlnVmJkWTI0c0RYS0c0S2h3WlBmOHpxVDRBU0ROamNUb2FFRi9MQnd2QS8xSUNcclxuSURiVmZCUk1PQVB5cWJkcytld1QwSDZqdDg1czZZTVNVZEo5Z2dmOWlmeTBcclxuLS0tLS1FTkQgQ0VSVElGSUNBVEUgUkVRVUVTVC0tLS0tXHJcbiJ9</span><br></pre></td></tr></table></figure>

<h4 id="请求头其他参数"><a href="#请求头其他参数" class="headerlink" title="请求头其他参数"></a>请求头其他参数</h4><p>除了Cookie之外，其他的你还可以携带以下内容</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">User-Agent : Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span>; Win64; x64) AppleWebKit/<span class="number">537.36</span> (KHTML, like Gecko) Chrome/<span class="number">109.0</span>.<span class="number">0.0</span> Safari/<span class="number">537.36</span></span><br><span class="line">Referer : https:<span class="comment">//www.douyin.com/</span></span><br></pre></td></tr></table></figure>

<h3 id="最终完整请求"><a href="#最终完整请求" class="headerlink" title="最终完整请求"></a>最终完整请求</h3><p>为了方便复现，我把curl命令也复制下来，方便各位改写自己的代码</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">curl --location --request GET <span class="string">&#x27;https://www.douyin.com/aweme/v1/web/aweme/detail/?aweme_id=7190042191169883427&amp;aid=1128&amp;version_name=23.5.0&amp;device_platform=android&amp;os_version=2333&amp;X-Bogus=DFSzswSLEjvANnEftawF309WcBjK&#x27;</span> \</span><br><span class="line">--header <span class="string">&#x27;User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/109.0.0.0 Safari/537.36&#x27;</span> \</span><br><span class="line">--header <span class="string">&#x27;Referer: https://www.douyin.com/&#x27;</span> \</span><br><span class="line">--header <span class="string">&#x27;Cookie: msToken=uTa38b9QFHB6JtEDzH9S4np17qxpG6OrROHQ8at2cBpoKfUb0UWmTkjCSpf72EcUrJgWTIoN6UgAv5BTXtCbOAhJcIRKyZIT7TMYapeOSpf;odin_tt=324fb4ea4a89c0c05827e18a1ed9cf9bf8a17f7705fcc793fec935b637867e2a5a9b8168c885554d029919117a18ba69; ttwid=1%7CWBuxH_bhbuTENNtACXoesI5QHV2Dt9-vkMGVHSRRbgY%7C1677118712%7C1d87ba1ea2cdf05d80204aea2e1036451dae638e7765b8a4d59d87fa05dd39ff; bd_ticket_guard_client_data=eyJiZC10aWNrZXQtZ3VhcmQtdmVyc2lvbiI6MiwiYmQtdGlja2V0LWd1YXJkLWNsaWVudC1jc3IiOiItLS0tLUJFR0lOIENFUlRJRklDQVRFIFJFUVVFU1QtLS0tLVxyXG5NSUlCRFRDQnRRSUJBREFuTVFzd0NRWURWUVFHRXdKRFRqRVlNQllHQTFVRUF3d1BZbVJmZEdsamEyVjBYMmQxXHJcbllYSmtNRmt3RXdZSEtvWkl6ajBDQVFZSUtvWkl6ajBEQVFjRFFnQUVKUDZzbjNLRlFBNUROSEcyK2F4bXAwNG5cclxud1hBSTZDU1IyZW1sVUE5QTZ4aGQzbVlPUlI4NVRLZ2tXd1FJSmp3Nyszdnc0Z2NNRG5iOTRoS3MvSjFJc3FBc1xyXG5NQ29HQ1NxR1NJYjNEUUVKRGpFZE1Cc3dHUVlEVlIwUkJCSXdFSUlPZDNkM0xtUnZkWGxwYmk1amIyMHdDZ1lJXHJcbktvWkl6ajBFQXdJRFJ3QXdSQUlnVmJkWTI0c0RYS0c0S2h3WlBmOHpxVDRBU0ROamNUb2FFRi9MQnd2QS8xSUNcclxuSURiVmZCUk1PQVB5cWJkcytld1QwSDZqdDg1czZZTVNVZEo5Z2dmOWlmeTBcclxuLS0tLS1FTkQgQ0VSVElGSUNBVEUgUkVRVUVTVC0tLS0tXHJcbiJ9&#x27;</span> \</span><br><span class="line">--header <span class="string">&#x27;Accept: */*&#x27;</span> \</span><br><span class="line">--header <span class="string">&#x27;Host: www.douyin.com&#x27;</span> \</span><br><span class="line">--header <span class="string">&#x27;Connection: keep-alive&#x27;</span></span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：通过这个完整的请求就能拿到抖音的视频链接地址，上面的完整请求里面，最重要的就是url后面携带的参数<strong>X-Bogus</strong>，有这个参数才能拿到视频地址。</p>
<h3 id="X-Bogus的获取"><a href="#X-Bogus的获取" class="headerlink" title="X-Bogus的获取"></a>X-Bogus的获取</h3><p>原理：X-Bogus参数的原理其实是通过python去执行js文件，得到这个参数，js里面具体是一个逻辑很复杂的一套算法在里面，通过这套算法就能拿到这个参数；<br>python执行文件和js文件请移步到这里下载：<a href="https://github.com/xiexiangnow/X-Bogus">https://github.com/xiexiangnow/X-Bogus</a></p>
<p>本文的案例是通过php去执行python脚本，再通过python脚本去执行js文件得到X-Bogus参数，<strong>python环境请使用2.7版本，python文件和js文件放在同一目录下</strong>。<br>python文件请使用如下案例：<br><strong>x-bogus.py</strong>:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># calc.py</span></span><br><span class="line">import sys</span><br><span class="line">import execjs</span><br><span class="line">import json</span><br><span class="line">import os</span><br><span class="line"><span class="keyword">from</span> urlparse import urlparse</span><br><span class="line"></span><br><span class="line">def <span class="title function_ invoke__">add</span>(url, user_agent):</span><br><span class="line">    query = <span class="title function_ invoke__">urlparse</span>(url).query</span><br><span class="line">    bogusJsPath = os.path.<span class="title function_ invoke__">abspath</span>(os.path.<span class="title function_ invoke__">dirname</span>( os.path.<span class="title function_ invoke__">abspath</span>(__file__)) + os.path.sep + <span class="string">&quot;X-Bogus.js&quot;</span>)</span><br><span class="line">    xbogus = execjs.<span class="title function_ invoke__">compile</span>(<span class="title function_ invoke__">open</span>(bogusJsPath, <span class="string">&#x27;r&#x27;</span>).<span class="title function_ invoke__">read</span>()).<span class="title function_ invoke__">call</span>(<span class="string">&#x27;sign&#x27;</span>, query, user_agent)</span><br><span class="line">    new_url = url + <span class="string">&quot;&amp;X-Bogus=&quot;</span> + xbogus</span><br><span class="line">    <span class="keyword">return</span> new_url</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        payload = sys.argv[<span class="number">1</span>]</span><br><span class="line">        params = json.<span class="title function_ invoke__">loads</span>(payload)</span><br><span class="line">        result = <span class="title function_ invoke__">add</span>(params[<span class="string">&#x27;url&#x27;</span>], params[<span class="string">&#x27;user_agent&#x27;</span>])</span><br><span class="line">        <span class="keyword">print</span>(result)</span><br><span class="line">    except <span class="string">&#x27;&#x27;</span>, e:</span><br><span class="line">        <span class="keyword">print</span>(e)</span><br></pre></td></tr></table></figure>

<p><strong>x-bogus.js</strong>到这里去下载：<a href="https://github.com/xiexiangnow/X-Bogus">https://github.com/xiexiangnow/X-Bogus</a></p>
<p>注意：python脚本执行完成，会返回一个全新的且带有X-Bogus参数的一个链接地址。</p>
<h3 id="php源码"><a href="#php源码" class="headerlink" title="php源码"></a>php源码</h3><p>请注意代码里面的注释位置，通过php去执行python脚本，python脚本去执行js脚本，在python脚本里面拼接好带有X-Bogus参数的链接地址并返回，再由php通过这个全新的链接去请求得到视频下载地址，并且已去除水印。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@notes</span>  下载抖音视频</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> $url   // 原始抖音视频链接地址</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> array|false</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">parseDouyinVideoLink</span>(<span class="params"><span class="variable">$url</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 获取重定向链接真实地址</span></span><br><span class="line">    <span class="variable">$headers</span> = <span class="title function_ invoke__">get_headers</span>(<span class="variable">$url</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="variable">$redirect_url</span> = <span class="variable">$headers</span>[<span class="string">&#x27;Location&#x27;</span>] ?? <span class="variable">$url</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$redirect_url</span>) &#123;</span><br><span class="line">        <span class="variable">$url</span> = <span class="variable">$redirect_url</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 获取视频id</span></span><br><span class="line">    <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/(\d+)/&#x27;</span>, <span class="variable">$url</span>, <span class="variable">$matches</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$matches</span>)) &#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;errorMsg = <span class="string">&#x27;视频id获取失败&#x27;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$matches</span>[<span class="number">1</span>];</span><br><span class="line">    <span class="comment">// 调用 Python 程序</span></span><br><span class="line">    <span class="variable">$output</span> = [];</span><br><span class="line">    <span class="variable">$params</span> = [</span><br><span class="line">        <span class="string">&#x27;url&#x27;</span> =&gt; <span class="string">&#x27;https://www.douyin.com/aweme/v1/web/aweme/detail/?aweme_id=&#x27;</span> . <span class="variable">$num</span> . <span class="string">&#x27;&amp;aid=1128&amp;version_name=23.5.0&amp;device_platform=android&amp;os_version=2333&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;user_agent&#x27;</span> =&gt; <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/109.0.0.0 Safari/537.36&#x27;</span></span><br><span class="line">    ];</span><br><span class="line">    <span class="comment">// 拼接python执行文件地址</span></span><br><span class="line">    <span class="variable">$pyExe</span> = <span class="title function_ invoke__">app_path</span>() . <span class="string">&#x27;bin&#x27;</span> . DIRECTORY_SEPARATOR . <span class="string">&#x27;x-bogus.py&#x27;</span>;</span><br><span class="line">    <span class="variable">$payload</span> = <span class="title function_ invoke__">json_encode</span>(<span class="variable">$params</span>);</span><br><span class="line">    <span class="comment">// 执行python文件,在url上拼接x-bogus参数</span></span><br><span class="line">    <span class="variable">$cmd</span> = <span class="string">&quot;python <span class="subst">&#123;$pyExe&#125;</span> &quot;</span> . <span class="title function_ invoke__">escapeshellarg</span>(<span class="variable">$payload</span>);   <span class="comment">// escapeshellarg:把字符串转码为可以在 shell 命令里使用的参数</span></span><br><span class="line">    <span class="comment">// 执行python文件获取执行结果</span></span><br><span class="line">    <span class="title function_ invoke__">exec</span>(<span class="variable">$cmd</span>, <span class="variable">$output</span>, <span class="variable">$returnVar</span>);</span><br><span class="line">    <span class="comment">// 输出计算结果php think collection --type downloaddouyinvideo --url https://v.douyin.com/AAYyxQh/</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$returnVar</span> != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;errorMsg = <span class="string">&#x27;计算X-Bogus出错！&#x27;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//echo &#x27;最新url：&#x27; . $output[0] . &quot;\n&quot;;   // 为最终带x-bogus的参数的url地址</span></span><br><span class="line">    <span class="variable">$realVideoLink</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">_parseDouyinVideoLink</span>(<span class="variable">$output</span>[<span class="number">0</span>]);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$realVideoLink</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取抖音视频资源，解析数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> $url // $url为带x-bogus的url地址</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> array|false</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">_parseDouyinVideoLink</span>(<span class="params"><span class="variable">$url</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$msToken</span> = <span class="title function_ invoke__">substr</span>(<span class="title function_ invoke__">str_shuffle</span>(<span class="string">&#x27;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span>), <span class="number">0</span>, <span class="number">107</span>);</span><br><span class="line">    <span class="variable">$curlHandle</span> = <span class="title function_ invoke__">curl_init</span>();</span><br><span class="line">    <span class="title function_ invoke__">curl_setopt_array</span>(<span class="variable">$curlHandle</span>, [</span><br><span class="line">        CURLOPT_URL =&gt; <span class="variable">$url</span>,</span><br><span class="line">        CURLOPT_RETURNTRANSFER =&gt; <span class="literal">true</span>,</span><br><span class="line">        CURLOPT_ENCODING =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        CURLOPT_MAXREDIRS =&gt; <span class="number">10</span>,</span><br><span class="line">        CURLOPT_TIMEOUT =&gt; <span class="number">0</span>,</span><br><span class="line">        CURLOPT_FOLLOWLOCATION =&gt; <span class="literal">true</span>,</span><br><span class="line">        CURLOPT_HTTP_VERSION =&gt; CURL_HTTP_VERSION_1_1,</span><br><span class="line">        CURLOPT_SSL_VERIFYPEER =&gt; <span class="literal">false</span>,</span><br><span class="line">        CURLOPT_CUSTOMREQUEST =&gt; <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">        CURLOPT_HTTPHEADER =&gt; [</span><br><span class="line">            <span class="string">&#x27;User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/109.0.0.0 Safari/537.36&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Referer: https://www.douyin.com/&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Cookie: msToken=&#x27;</span> . <span class="variable">$msToken</span> . <span class="string">&#x27;;odin_tt=324fb4ea4a89c0c05827e18a1ed9cf9bf8a17f7705fcc793fec935b637867e2a5a9b8168c885554d029919117a18ba69; ttwid=1%7CWBuxH_bhbuTENNtACXoesI5QHV2Dt9-vkMGVHSRRbgY%7C1677118712%7C1d87ba1ea2cdf05d80204aea2e1036451dae638e7765b8a4d59d87fa05dd39ff; bd_ticket_guard_client_data=eyJiZC10aWNrZXQtZ3VhcmQtdmVyc2lvbiI6MiwiYmQtdGlja2V0LWd1YXJkLWNsaWVudC1jc3IiOiItLS0tLUJFR0lOIENFUlRJRklDQVRFIFJFUVVFU1QtLS0tLVxyXG5NSUlCRFRDQnRRSUJBREFuTVFzd0NRWURWUVFHRXdKRFRqRVlNQllHQTFVRUF3d1BZbVJmZEdsamEyVjBYMmQxXHJcbllYSmtNRmt3RXdZSEtvWkl6ajBDQVFZSUtvWkl6ajBEQVFjRFFnQUVKUDZzbjNLRlFBNUROSEcyK2F4bXAwNG5cclxud1hBSTZDU1IyZW1sVUE5QTZ4aGQzbVlPUlI4NVRLZ2tXd1FJSmp3Nyszdnc0Z2NNRG5iOTRoS3MvSjFJc3FBc1xyXG5NQ29HQ1NxR1NJYjNEUUVKRGpFZE1Cc3dHUVlEVlIwUkJCSXdFSUlPZDNkM0xtUnZkWGxwYmk1amIyMHdDZ1lJXHJcbktvWkl6ajBFQXdJRFJ3QXdSQUlnVmJkWTI0c0RYS0c0S2h3WlBmOHpxVDRBU0ROamNUb2FFRi9MQnd2QS8xSUNcclxuSURiVmZCUk1PQVB5cWJkcytld1QwSDZqdDg1czZZTVNVZEo5Z2dmOWlmeTBcclxuLS0tLS1FTkQgQ0VSVElGSUNBVEUgUkVRVUVTVC0tLS0tXHJcbiJ9&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Accept: */*&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Host: www.douyin.com&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Connection: keep-alive&#x27;</span></span><br><span class="line">        ],</span><br><span class="line">    ]);</span><br><span class="line">    <span class="variable">$response</span> = <span class="title function_ invoke__">curl_exec</span>(<span class="variable">$curlHandle</span>);</span><br><span class="line">    <span class="comment">//返回结果</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable">$response</span>) &#123;</span><br><span class="line">        <span class="variable">$error</span> = <span class="title function_ invoke__">curl_errno</span>(<span class="variable">$curlHandle</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$url</span>.PHP_EOL;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;errorMsg = <span class="string">&#x27;网络错误:&#x27;</span> . <span class="variable">$error</span>;</span><br><span class="line">        <span class="title function_ invoke__">curl_close</span>(<span class="variable">$curlHandle</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">curl_close</span>(<span class="variable">$curlHandle</span>);</span><br><span class="line">    <span class="comment">// 再次发送请求，获得视频最终结果参数</span></span><br><span class="line">    <span class="variable">$arr</span> = <span class="title function_ invoke__">json_decode</span>(<span class="variable">$response</span>, <span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">json_last_error</span>() != JSON_ERROR_NONE) &#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;errorMsg = <span class="string">&#x27;json解析错误&#x27;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$arr</span>[<span class="string">&#x27;status_code&#x27;</span>] == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 重新组装需要的视频参数</span></span><br><span class="line">            <span class="variable">$data</span> = [</span><br><span class="line">                <span class="string">&#x27;code&#x27;</span>     =&gt; <span class="number">200</span>,</span><br><span class="line">                <span class="string">&#x27;msg&#x27;</span>      =&gt; <span class="string">&#x27;解析成功&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;author&#x27;</span>   =&gt; <span class="variable">$arr</span>[<span class="string">&#x27;aweme_detail&#x27;</span>][<span class="string">&#x27;author&#x27;</span>][<span class="string">&#x27;nickname&#x27;</span>],</span><br><span class="line">                <span class="string">&#x27;uid&#x27;</span>      =&gt; <span class="variable">$arr</span>[<span class="string">&#x27;aweme_detail&#x27;</span>][<span class="string">&#x27;author&#x27;</span>][<span class="string">&#x27;unique_id&#x27;</span>],</span><br><span class="line">                <span class="comment">//&#x27;avatar&#x27; =&gt; $arr[&#x27;aweme_detail&#x27;][&#x27;music&#x27;][&#x27;avatar_large&#x27;][&#x27;url_list&#x27;][0],</span></span><br><span class="line">                <span class="string">&#x27;like&#x27;</span>     =&gt; <span class="variable">$arr</span>[<span class="string">&#x27;aweme_detail&#x27;</span>][<span class="string">&#x27;statistics&#x27;</span>][<span class="string">&#x27;digg_count&#x27;</span>],</span><br><span class="line">                <span class="string">&#x27;time&#x27;</span>     =&gt; <span class="variable">$arr</span>[<span class="string">&#x27;aweme_detail&#x27;</span>][<span class="string">&quot;create_time&quot;</span>],</span><br><span class="line">                <span class="string">&#x27;title&#x27;</span>    =&gt; <span class="variable">$arr</span>[<span class="string">&#x27;aweme_detail&#x27;</span>][<span class="string">&#x27;desc&#x27;</span>],</span><br><span class="line">                <span class="string">&#x27;cover&#x27;</span>    =&gt; <span class="variable">$arr</span>[<span class="string">&#x27;aweme_detail&#x27;</span>][<span class="string">&#x27;video&#x27;</span>][<span class="string">&#x27;origin_cover&#x27;</span>][<span class="string">&#x27;url_list&#x27;</span>][<span class="number">0</span>],</span><br><span class="line">                <span class="string">&#x27;url&#x27;</span>      =&gt; <span class="variable">$arr</span>[<span class="string">&#x27;aweme_detail&#x27;</span>][<span class="string">&#x27;video&#x27;</span>][<span class="string">&#x27;play_addr&#x27;</span>][<span class="string">&#x27;url_list&#x27;</span>][<span class="number">0</span>],</span><br><span class="line">                <span class="string">&#x27;musicurl&#x27;</span> =&gt; <span class="variable">$arr</span>[<span class="string">&#x27;aweme_detail&#x27;</span>][<span class="string">&#x27;music&#x27;</span>][<span class="string">&#x27;play_url&#x27;</span>][<span class="string">&#x27;url_list&#x27;</span>][<span class="number">0</span>],</span><br><span class="line">                <span class="string">&#x27;music&#x27;</span>    =&gt; [</span><br><span class="line">                    <span class="string">&#x27;author&#x27;</span> =&gt; <span class="variable">$arr</span>[<span class="string">&#x27;aweme_detail&#x27;</span>][<span class="string">&#x27;music&#x27;</span>][<span class="string">&#x27;author&#x27;</span>],</span><br><span class="line">                    <span class="string">&#x27;avatar&#x27;</span> =&gt; <span class="variable">$arr</span>[<span class="string">&#x27;aweme_detail&#x27;</span>][<span class="string">&#x27;music&#x27;</span>][<span class="string">&#x27;cover_large&#x27;</span>][<span class="string">&#x27;url_list&#x27;</span>][<span class="number">0</span>],</span><br><span class="line">                    <span class="string">&#x27;url&#x27;</span>    =&gt; <span class="variable">$arr</span>[<span class="string">&#x27;aweme_detail&#x27;</span>][<span class="string">&#x27;music&#x27;</span>][<span class="string">&#x27;play_url&#x27;</span>][<span class="string">&#x27;url_list&#x27;</span>][<span class="number">0</span>],</span><br><span class="line">                ]</span><br><span class="line">            ];</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$data</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="built_in">Exception</span> <span class="variable">$exception</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">is_null</span>(<span class="variable">$arr</span>[<span class="string">&#x27;aweme_detail&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$arr</span>[<span class="string">&#x27;filter_detail&#x27;</span>][<span class="string">&#x27;detail_msg&#x27;</span>])) &#123;</span><br><span class="line">                <span class="variable">$errorMsg</span> = <span class="variable">$arr</span>[<span class="string">&#x27;filter_detail&#x27;</span>][<span class="string">&#x27;detail_msg&#x27;</span>];</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;errorReason = <span class="variable">$arr</span>[<span class="string">&#x27;filter_detail&#x27;</span>][<span class="string">&#x27;filter_reason&#x27;</span>];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$errorMsg</span> = <span class="variable">$exception</span>-&gt;<span class="title function_ invoke__">getMessage</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;errorMsg = <span class="variable">$errorMsg</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;errorMsg = <span class="string">&#x27;抖音数据返回错误&#x27;</span> . <span class="variable">$arr</span>[<span class="string">&#x27;status_code&#x27;</span>];</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面代码解析了部分重要的视频参数，请自由获取，url为视频链接地址，<strong>特别特别注意</strong>：视频链接地址是有时效的，我在做这个需求的时候是将视频下载下来后上传到了阿里云的OSS，再从OSS拿到的视频最新链接，你也可以上传到你所在的资源库里面，再获取视频链接地址。</p>
]]></content>
      <categories>
        <category>php</category>
      </categories>
      <tags>
        <tag>php</tag>
      </tags>
  </entry>
  <entry>
    <title>本田思域2018款 220TURBO CVT豪华版改装案例</title>
    <url>/2018/11/08/%E6%9C%AC%E7%94%B0%E6%80%9D%E5%9F%9F2016%E6%AC%BE-220TURBO-CVT%E8%B1%AA%E5%8D%8E%E7%89%88%E6%94%B9%E8%A3%85%E6%A1%88%E4%BE%8B/</url>
    <content><![CDATA[<p>2018年9月17日开回了人生中的第一台车–本田思域，回家的路上兢兢战战开了30多公里的高速花了快两小时才到家，虽然提车前有驾驶经验，但是坐上自己新提的爱车还是有几分谨慎；之后的中秋节、国庆节开车出行之后，觉得真的是越来越喜欢这辆车，不管从性能和外观都可以说是自己比较满意的车，当然也要感谢家人的支援与帮助，是他们成就了我人生阶段性的梦想，同时购车后的压力也是在警示着我作为这个阶段的年龄也应该承担的责任和压力感。</p>
<span id="more"></span>

<p>国庆之后就开始了改装之旅，思域这款车就原车而言并不能满足我内心的视觉体验，毕竟这个价位的车在很多的细节和体验上就应该是如此，参考了很多的改装案例，在提车之前网购的改装件也都陆续到家；当然，以下的一些改装相比专业而言，都是小打小闹，只是参照了网上案例对外观进行了视觉上的一些改装。</p>
<h3 id="基本加装件"><a href="#基本加装件" class="headerlink" title="基本加装件"></a>基本加装件</h3><table>
<thead>
<tr>
<th align="left">加装件名称</th>
<th align="left">数量</th>
<th align="left">价格</th>
</tr>
</thead>
<tbody><tr>
<td align="left">全车皮座椅</td>
<td align="left">1</td>
<td align="left">1000</td>
</tr>
<tr>
<td align="left">全车车窗膜</td>
<td align="left">1</td>
<td align="left">680</td>
</tr>
<tr>
<td align="left">行车记录仪</td>
<td align="left">1</td>
<td align="left">400</td>
</tr>
<tr>
<td align="left">全车脚垫</td>
<td align="left">1</td>
<td align="left">380</td>
</tr>
<tr>
<td align="left">防晒垫</td>
<td align="left">2</td>
<td align="left">45</td>
</tr>
<tr>
<td align="left">后视镜、车门防撞防擦胶条</td>
<td align="left">6</td>
<td align="left">24.2</td>
</tr>
<tr>
<td align="left">临时停车牌</td>
<td align="left">1</td>
<td align="left">9</td>
</tr>
</tbody></table>
<h3 id="改装件"><a href="#改装件" class="headerlink" title="改装件"></a>改装件</h3><table>
<thead>
<tr>
<th align="left">改装件名称</th>
<th align="left">数量</th>
<th align="left">价格</th>
</tr>
</thead>
<tbody><tr>
<td align="left">迎宾门槛条</td>
<td align="left">1组</td>
<td align="left">166</td>
</tr>
<tr>
<td align="left">前铲</td>
<td align="left">1</td>
<td align="left">188</td>
</tr>
<tr>
<td align="left">尾翼</td>
<td align="left">1</td>
<td align="left">288</td>
</tr>
<tr>
<td align="left">蜂窝钢琴黑中网</td>
<td align="left">1</td>
<td align="left">266</td>
</tr>
<tr>
<td align="left">车头引擎盖装饰亮片保护贴</td>
<td align="left">1</td>
<td align="left">85</td>
</tr>
<tr>
<td align="left">碳纤维后备箱门槛帖</td>
<td align="left">1</td>
<td align="left">26</td>
</tr>
<tr>
<td align="left">碳纤维外门把手</td>
<td align="left">1</td>
<td align="left">48</td>
</tr>
<tr>
<td align="left">全车贴纸</td>
<td align="left">5</td>
<td align="left">88</td>
</tr>
<tr>
<td align="left">MC款后扰流板</td>
<td align="left">1</td>
<td align="left">158</td>
</tr>
<tr>
<td align="left">双出尾喉排气</td>
<td align="left">1组</td>
<td align="left">538</td>
</tr>
<tr>
<td align="left">亚光黑后包护角</td>
<td align="left">1</td>
<td align="left">68</td>
</tr>
<tr>
<td align="left">全景天窗膜</td>
<td align="left">1</td>
<td align="left">268</td>
</tr>
<tr>
<td align="left">方向盘套</td>
<td align="left">1</td>
<td align="left">69</td>
</tr>
<tr>
<td align="left">中柱贴片镜面</td>
<td align="left">1</td>
<td align="left">57</td>
</tr>
</tbody></table>
<h3 id="改装效果"><a href="#改装效果" class="headerlink" title="改装效果"></a>改装效果</h3><p><img src="/../img/car02.png" alt="car"></p>
]]></content>
      <categories>
        <category>生活</category>
      </categories>
      <tags>
        <tag>生活</tag>
      </tags>
  </entry>
  <entry>
    <title>极简项目管理摘取</title>
    <url>/2021/02/01/%E6%9E%81%E7%AE%80%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86%E6%91%98%E5%8F%96/</url>
    <content><![CDATA[<h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><p>1、悦纳</p>
<p>2、你可以表达愤怒，但不可以愤怒的表达</p>
<p>3、你可以不成才，但必须要成人</p>
<p>4、说话必须要说中性词</p>
<p>5、故事：擦窗户需要30分钟，只有一块抹布；切菜需要30分钟，只有一把菜刀；拖地需要30分钟，但是也只有一个拖把；<br>请问：30分钟？45分钟？60分钟？90分钟？哪个答案更好？</p>
<p>别把自己认为的答案，去解决别人的需求</p>
<p>6、陈述性 -&gt; 程序性 这个过程需要联系7次 +- 2次<br>程序性 -&gt; 陈述性 这个过程需要十年</p>
<span id="more"></span>

<p>面对失败不要惧怕，需要多次尝试联系，距离成功只需要7次左右<br>问题：小孩的学习能力强还是大人的学习能力强？<br>分析：答案是大人的学习能力强；大人在学习东西的时候是一个网格状知识的结构，对于事务的学习有着系统的架构；<br>问题：那为什么小孩的记忆力那么好？<br>分析：并不是小孩的记忆力好，而且小孩容易去多次、重复的尝试与练习；</p>
<p>7、南极探险：<br>去南极探险，两个队的策略和策划天壤之别。<br>阿蒙森团队于1912年1月25日全部返回营地。这个日子和他三年前计划的归程一天不差。后来有人请阿蒙森分享经验，他说：最重要的因素是探险的准备如何，你必须要遇见可能出现的困难，遇到了该如何处理或者如何避免，总之，按照计划执行。<br>从斯科特团队的日志来看，他们是一个比较随心所欲的团队，天气好就走得非常猛烈，但天气不好就睡在帐篷里，吃东西、诅咒恶劣的天气和坏的运气，祈祷天气转好。</p>
<p>8、计划是用来改的；正因为计划没有变化快，才更需要做计划；<br>领导不应该直接管人管事，而应该管计划；<br>项目不应该被领导管着，而应该被计划管着；<br>员工不应该按领导的指示做事，而应该按计划的安排做事；</p>
<p>9、人生的五次选择：<br>1）读书<br>2）上大学选择一个好的专业<br>3）选择一个公司、行业<br>4）跟谁结婚<br>5）毕业五年是应该选择赚钱，还是能力的提升<br>综上，如果全部已经有所选择，请遵循第六项选择：爱我所选！</p>
<p>10、受过高等教育的我们：别放纵自己，有义务让社会更好！</p>
<p>11、人生的两大悲哀：结婚了不再恋爱；工作了不再读书；</p>
<p>12、王阳明 《传习录》</p>
<p>13、一个“精确”的项目时间<br>上司：“小张，你那项目需要多长时间才能完成？”<br>下属：“80天左右吧，王总”<br>上司：“别跟我说左右，准确一点，究竟多少天？”<br>下属：“那就80天”<br>上司：“80天太长了，给你50天吧”<br>下属：“50天实在太短了，王总”<br>上司：“那就65天吧。别再讨价还价了，就这么定了！”<br>下属：“好吧”</p>
<p>分析：先别看下面，是不是自己也遇到过类似的问题<br>1、王总对于下属的工作是不信任的；<br>2、下属对于项目的周期时间没有评估的依据 （项目中可以参见甘特图做类似说明）<br>14、不要做悲观主义者，要做一个积极的悲观主义者</p>
<p>15、不识庐山真面，只缘身在此山中<br>对于任何的事情需要脱离本身或者站在“远处”看问题，20几岁遇到的困难和问题在于50岁的人看来简直都不是事<br>纵观中国5000年历史，1982年前，整个5000年历史仅仅就只有200多年的幸福年代，这里所指幸福年代是没有战争、没有饥荒，从1982年开始到2020年将近40年的时光里面都是幸福的年代，现在年轻人面对自己的工作的压力和生活的压力，这又算什么呢。<br>在纵观全球各国生活幸福指数，中国的物价是全球比较低的，排前几位；中国人民生活幸福指数比较高对比与其他国家天天战乱温饱都是问题，随时面临的是死亡，你是否想过自己生活在多的么幸福的国度</p>
<p>16、 今天的组织需要的是由一群平凡的人，做出不平凡的事 – 彼得·德鲁克</p>
<p>17、多看历史书籍，放宽眼界<br>（历史的文明才是真正需要年轻人传承的，而不是说几个流行词语、错意词，就是潮流，这是郭老师教诲的）</p>
]]></content>
      <categories>
        <category>其他</category>
      </categories>
      <tags>
        <tag>其他</tag>
      </tags>
  </entry>
  <entry>
    <title>泸沽湖-女儿国之行</title>
    <url>/2018/05/14/%E6%B3%B8%E6%B2%BD%E6%B9%96-%E5%A5%B3%E5%84%BF%E5%9B%BD%E4%B9%8B%E8%A1%8C/</url>
    <content><![CDATA[<p>来到泸沽湖那真是我见过最美的地方，从丽江报团一起过来，得五个多小时的时间，一路上都是悬崖峭壁的，如若说遇到下雨天随时都有可能遇到悬崖滚石、山体滑坡的，有的转弯的地方大巴车是需要两次转向才可以过去的，刚刚到达泸沽湖还只能很远的地方看到的时候，让我觉得很美的就是那里的蓝天，很美、很清澈，很多年都没见过这样的天空。</p>
<h4 id="【观景台】"><a href="#【观景台】" class="headerlink" title="【观景台】"></a>【观景台】</h4><p><img src="/../img/liguhu-01.jpg" alt="泸沽湖"><br>第一站来到的是在泸沽湖入口的地方的一个全景观景台，这里看过去能远观到整个泸沽湖的全貌，天蓝水蓝，云朵清澈，真的是一种心旷神怡的感觉，这个地方拍照我们都没有用任何的美图软件，随便拍一张都是一幅天然的、优美的画面。</p>
<span id="more"></span>
<h4 id="【草海-走婚桥】"><a href="#【草海-走婚桥】" class="headerlink" title="【草海 | 走婚桥】"></a>【草海 | 走婚桥】</h4><p><img src="/../img/liguhu-02.jpg" alt="泸沽湖"></p>
<p>随着旅行团行程从观景台高处慢慢下来逐渐靠近湖面，我坐在大巴车上都能看到水下的水草，清澈见底，紧接着没有直接安排来湖边玩耍，先是到达的著名的草海和走婚桥，草海可能是因为季节的原因，还看不到长得很高的水草，草海岸边停靠着很多的猪槽船，这里不管是以前还是到未来，都会保留着这种古老的游湖方式，当地人对生态的保护确实是很重视的；草海的旁边就是有名的走婚桥，相传很久以前这里有一对小阿哥小阿妹在这里相爱，但是由于两家距离较远，家里人不同意他们在一起，于是他们就只能偷偷的在湖边约会，小阿哥是住在湖的对面，过来约会都得靠划着猪槽船来到这边，后来经过他们的努力，父母也同意他们在一起，于是他们就开始了走婚，有一天小阿哥来到这边走婚，却因为湖面风太大，掉进了湖里面就再也没有起来，小阿妹为了纪念小阿哥就在湖边亲自修了一座桥，同时也是为了后面的小阿哥小阿妹走婚方便，后人便将此桥命名为了走婚桥；走婚桥传言两个相爱的人需牵手一起走，中间不能有行人穿插，而且只能走一半，象征着爱情没有尽头。</p>
<h4 id="【亲爱的客栈】"><a href="#【亲爱的客栈】" class="headerlink" title="【亲爱的客栈】"></a>【亲爱的客栈】</h4><p><img src="/../img/liguhu-03.jpg" alt="泸沽湖"><br>紧接着来到了湖的另一边开始了我们的猪槽船之行，有当地的船夫给我们撑船，坐在船上手能接触到湖里的水，当时的气温差不多23度左右，水温大概在8-9度，水很凉而且很清澈，水下的水草一颗颗清晰可见，偶尔能看到水下的鱼，记不得品种的名字，听说湖里只有这一种鱼；随着船的前行慢慢来到了亲爱的客栈，这里对于我而言没有太多的观赏度，只是说这里前段时间刘涛、陈翔等明星来过此地拍节目因此有点名气，拍了几张照片就原路返回了。</p>
<h4 id="【情人滩】"><a href="#【情人滩】" class="headerlink" title="【情人滩】"></a>【情人滩】</h4><p><img src="/../img/liguhu-04.jpg" alt="泸沽湖"><br>顺着下午安排行程的最后一站是情人滩，这里可能在沿海地区的人来说算不上一个滩，在这里脚踏鹅卵石，牵着自己的爱人，也是一种美不胜收的感觉，走完情人滩差不多下午三点，一行人被带回了客栈休息。</p>
<h4 id="【走婚宴】"><a href="#【走婚宴】" class="headerlink" title="【走婚宴】"></a>【走婚宴】</h4><p><img src="/../img/liguhu-05.jpg" alt="泸沽湖"><br>来到泸沽湖可能最让人记住的就是当地的风俗、文化，到了晚上六点，我们先是来到了当地一家人的家里吃有名的走婚宴，桌上的菜很有当地的特色，对于我来说吃得还算合胃口，当然不得不说说有名的猪膘肉，是他们在重大节日的时候才会吃的一道菜，猪膘肉听说是当地有小孩出生的时候孩子的阿舅就会宰杀一头猪用来制作猪膘肉，猪膘肉的制作是将猪肚里的内脏和瘦肉全部取干净之后，将虫草、藏红花等当地名贵的中药满满的塞在清理干净的猪肚子里，然后风干1-13年不等的时间，然后在重大的节日吃；对了，也许你会问，这么多年不会腐烂吗，他们在猪肚子里塞中草药的时候同时会在里面放当地的贡银，这才是保证这么多年不会腐烂的真正的东西，当然只是听说，不知道真假。</p>
<h4 id="【摩梭人】"><a href="#【摩梭人】" class="headerlink" title="【摩梭人】"></a>【摩梭人】</h4><p>讲到这里不得不先讲一下摩梭人，摩梭人并不在五十六个少数民族里面，有人说她是当地纳西族的分支，其实也不是，摩梭人就是一个独立的分支，听当地的文化讲解员的说法，他们也在不断申请成为中国第五十七个少数民族，但是由于人口目前只有四万人左右，还有点困难，当然他们还在继续申请；还有一个有趣的说法，因为当地摩梭人男不娶，女不嫁，走婚本来就是一种偷偷摸摸的风俗，晚上偷偷进去，早上偷偷梭出来，这就是摩梭人名字的由来，关于走婚，也是当地很有意思的风俗。</p>
<h4 id="【走婚】"><a href="#【走婚】" class="headerlink" title="【走婚】"></a>【走婚】</h4><p><img src="/../img/liguhu-06.jpg" alt="泸沽湖"><br>晚上吃完走婚宴，就来到了当地一个举行篝火晚会的地方，这里像是一个四合院，差不多能容纳几百人，一进四合院门口就有人给我们献上了哈达，还留念拍了照，我们进去玩的那天也差不多有五百多人，围着中间的柴火一起唱歌、跳舞。为什么要在这里讲走婚呢，因为篝火晚会才是真正走婚的开始，走婚是当地摩梭人现在都还保留的风俗，男不聚，女不嫁，在篝火晚会的时候只要有你喜欢的小阿哥小阿妹，你就可以在跳舞的时候悄悄的扣对方的手心三下，如若对方也对你有意，然后他&#x2F;她也会回复你三下，篝火晚会结束后他们就回到湖边约会，到了晚上零点过后小阿哥就要带着猪膘肉、匕首、腰带、帽子、银梳来到小阿妹的家里。先说下为什么要带这几样东西呢，因为摩梭人每家每户都有养狗，小阿哥半夜来到小阿妹家，就得先搞定她们家的狗，所以要带上猪膘肉；匕首不是用来防身的，小阿妹一般都是住在自己家二楼的花楼里，小阿哥不能直接走大门，必须得从墙壁攀爬上去，当然不是水泥墙，他们的房屋都是用不粗不细的圆滚木垒起来的，所以用匕首就方便攀爬；腰带是小阿哥走婚完了之后栓在床头一直延伸到窗台方便第二次来走婚的时候攀爬的；帽子是当小阿哥来到花楼之后，就要在窗边挂一顶帽子，说明此时他们正在走婚，不允许有人再来走婚或者打扰；银梳不是必须要带的，银梳是小阿哥决定此生只跟这一个小阿妹走婚，那么早上五六点离开的时候他就会在小阿妹的床头留下一把银梳，完了小阿妹每天都会将银梳别在头发上，别的小阿哥看到银梳，也不再会跟她走婚。走婚也叫暗婚，因为小阿哥小阿妹只有在晚上他们才会交流，白天走在路上擦肩而过都不会打招呼的，连小阿妹到此生生命结束家里的人也不会知道她的小阿哥是谁，这里的小孩都是13就成年，只有13岁以后他们才会知道他们的父亲是谁，但是在这个东方女儿国里面，女人才是掌权的，生下的孩子男方是不需要抚养的，女人在外面干活，男人只需要在家缝补衣服、照顾姐妹的孩子、做饭、家务事等，男人在这个地方叫“赔钱货”，没有地位的，所以一个女人要是连生了三个男孩，那么这个女人此生将地位特别低贱，如若这个女人此生不孕不育那么她将会被削发为尼；这个风俗至今都还保留，听说将来也不会消亡，可能这些东西在我们汉人看来很难理解，但这就是每个民族的特色与传统。</p>
<h4 id="【摩梭人的生与死】"><a href="#【摩梭人的生与死】" class="headerlink" title="【摩梭人的生与死】"></a>【摩梭人的生与死】</h4><p>临走的这天早上，当地的文化讲解员带领我们走进了他们的家里参观，原始的摩梭人家的房子都是一个类似四合院的建筑，正对大门也就是正厅堂的那间房子叫做祖母屋，这间房子具有这个家庭绝对的权力和地位的，之前讲过这个都是女人掌权，祖母屋也就是住着整个家庭年龄最长的被上一任指认为祖母的女人；祖母屋的两边是自己的儿女住的地方，某一侧的二楼为年满13岁以上的女儿住的花楼；祖母屋没有主人的邀请是万万不可入内的，我们在文化讲解员的邀请下来到了他们家的祖母屋，先进的是我们旅游团的女同志们，跨门槛的时候必须是左脚进右脚出的，祖母屋的里面是一间大约15平米的房间，里面除了进门的这边，其余三边都是床，当然他们的床没有床头床尾，右手边地上是一个炉子，房间从中间隔开左边是一个比右边高出大约30公分的小平台，那里是家里聚会女人们坐的地方，下面才是家里男人们坐的地方；映入眼帘很显眼的地方就是房间的屋顶，上面都是一些手工雕花，据说都是家里的男人们刻出来的，正前方挂了很多的哈达，还有一些挂像，右手边的墙壁上是一块藏传佛教的祭拜台，上面有酥油灯，左手边的墙上有一扇很奇特的门，上了锁；中间是两根很粗的柱子，后来听讲解员说那时他们的小孩成人礼的时候用的，据说成人礼就是与狗互换年龄，所以他们从来不吃狗肉；讲解员带领我们坐下来，给我们介绍了当地的文化风俗以及当地的中医术，让我记得很清楚的还是他们当地的生与死；生，即出生，之前有讲过祖母屋的左手边有一扇门，那其实是一扇生死门，每一个摩梭人家里都有，这里的男人一辈子只能进去两次，那就是出生的时候和快最后一口气死亡的时候，女人除了出生和死亡，在生孩子的时候也是要在里面生的，她们生孩子没有手术台，没有剖腹产，只能靠阿舅（自己弟弟）去泸沽湖里面割一些芦苇回来编织成软软的垫子自己一个人在里面生，自己的小阿哥是不能来探望的，他们只会远远的隔着墙壁听听孩子的哭声，到了晚上小阿哥会给孩子送来一个银碗，象征着孩子以后衣食不愁，孩子出生基本都是由家里的男人们带大，直到成年。死，即死亡，摩梭人对逝去的人会有三种葬礼方式，一是天葬，二是火葬，再是土葬，三种方式按照顺序地位依次下降，土葬算是最卑微的方式了；天葬，即将死去的人分解成108块，然后供奉给老鹰、秃鹫动物吃掉，属于地位很高的；火葬，将死去的人架在火堆上火化成灰，然后将骨灰洒向大自然，所以我们来到这里几天，完全看不到一个墓碑、坟墓，他们的想法就是生不带来，死不带去，死后也不占用后人一点资源；然后就是土葬，执行这种葬礼的人是很卑微的，只有生前犯过大错的人才会执行，他们会在路边挖一个很深的坑，将死人埋在里面，上面填土与路面齐平，意喻受万人践踏，下十八层地狱。如果家里的祖母去世，将由下一任祖母背着走进生死门，然后在生死门里面由下一任祖母将去世的祖母洗浴干净，同时在尸体的嘴里、四肢、腹部放上银器，然后用白布包裹成一个婴儿的样子，象征着生不带来，死不带去，同时会在家里停放49天后再进行葬礼，最重要的是家里的父辈去世，家里的晚辈一个都不能伤心哭泣，因为他们寓意孝敬是在生前，而不是在去世之后；摩梭人对长辈是非常孝敬的，他们也要让子子孙孙看到他们的行为，让这种传统代代相传。</p>
<p>听到这些其实觉得他们真的很伟大，他们有自己的章法，保护大自然，遵循自然法则，让我觉得此行真的很值得，我觉得这才是真正旅行的意义。同时也很感叹，随着外界的接触和互联网等的影响，我不知道他们将来是否会原汁原味的保留现在的一切，很庆幸我们去的时候还能看到一些原始的东西，将来的他们不知道会怎么样。</p>
]]></content>
      <categories>
        <category>生活</category>
      </categories>
      <tags>
        <tag>生活</tag>
      </tags>
  </entry>
  <entry>
    <title>火山视频点播集成web上传SDK案例</title>
    <url>/2023/11/24/%E7%81%AB%E5%B1%B1%E8%A7%86%E9%A2%91%E7%82%B9%E6%92%ADweb%E4%B8%8A%E4%BC%A0%E6%A1%88%E4%BE%8B/</url>
    <content><![CDATA[<blockquote>
<p>火山视频点播集成web上传SDK是什么呢？是通过前端对接视频点播sdk直接上传视频到视频点播中</p>
</blockquote>
<blockquote>
<p>本文介绍的是火山视频点播集成web上传SDK案例，针对于这个板块应该使用的人不是很多，但是里面会遇到不同的坑，下面借助以下代码希望能帮助到更多的人提升该板块的代码编写速度；<br>下面的案例是实操之后的代码结果，根据不同的需求可以稍作调整，将代码直接复用。</p>
</blockquote>
<p>火山官方视频点播集成web上传SDK文档： <a href="https://www.volcengine.com/docs/4/66560#addfile-fileoption">https://www.volcengine.com/docs/4/66560#addfile-fileoption</a></p>
<p>在做这个操作之前需要注意几点：</p>
<p>1、是否开通了火山视频点播服务<br>2、不能将视频直接放在视频点播里面播放，会按照流量收费 （我的方案是转存到桶中）</p>
<span id="more"></span>
<h4 id="视频上传前端案例"><a href="#视频上传前端案例" class="headerlink" title="视频上传前端案例"></a>视频上传前端案例</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;style&gt;</span><br><span class="line">    .upload_con &#123;</span><br><span class="line">        border: <span class="comment">#ccc solid 1px;</span></span><br><span class="line">        padding: <span class="number">10</span>px;</span><br><span class="line">        margin-bottom: <span class="number">10</span>px;</span><br><span class="line">    &#125;</span><br><span class="line">    .upload_con p &#123;</span><br><span class="line">        color: <span class="comment">#ccc;</span></span><br><span class="line">    &#125;</span><br><span class="line">    .upload_title &#123;</span><br><span class="line">        color: red;</span><br><span class="line">        font-weight: bolder;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">layui</span>-<span class="title">card</span>-<span class="title">body</span> <span class="title">padding</span>-<span class="title">left</span>-40&quot;&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">block</span> <span class="title">relative</span>&quot;&gt;</span></span><br><span class="line"><span class="class">&lt;!--  &lt;<span class="title">b</span> <span class="title">class</span>=&quot;<span class="title">color</span>-<span class="title">green</span>&quot; <span class="title">style</span>=&quot;<span class="title">margin</span>-<span class="title">bottom</span>: 10<span class="title">px</span>&quot;&gt;上传对应视频资源&lt;/<span class="title">b</span>&gt;--&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">relative</span> <span class="title">block</span> <span class="title">label</span>-<span class="title">required</span>-<span class="title">null</span>&quot; &gt;</span></span><br><span class="line"><span class="class">            &lt;!--上传位--&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">p</span> <span class="title">class</span>=&quot;<span class="title">upload_title</span>&quot;&gt;[视频上传位]&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">upload_con</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">file</span>&quot; <span class="title">id</span>=&quot;<span class="title">upload_file</span>&quot; <span class="title">accept</span>=&quot;<span class="title">video</span>/<span class="title">mp4</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">br</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">br</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;!--上传按钮--&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">div</span>&gt;&lt;<span class="title">a</span> <span class="title">class</span>=&quot;<span class="title">layui</span>-<span class="title">btn</span> <span class="title">layui</span>-<span class="title">btn</span>-<span class="title">checked</span> <span class="title">layui</span>-<span class="title">btn</span>-<span class="title">sm</span>&quot; <span class="title">id</span>=&quot;<span class="title">uploader_btn</span>&quot;&gt;上传&lt;/<span class="title">a</span>&gt;&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">div</span> <span class="title">style</span>=&quot;<span class="title">margin</span>-<span class="title">top</span>:5<span class="title">px</span>&quot;&gt;&lt;<span class="title">a</span> <span class="title">class</span>=&quot;<span class="title">layui</span>-<span class="title">btn</span> <span class="title">layui</span>-<span class="title">btn</span>-<span class="title">danger</span> <span class="title">layui</span>-<span class="title">btn</span>-<span class="title">sm</span>&quot; <span class="title">id</span>=&quot;<span class="title">cancel_upload</span>&quot; <span class="title">style</span>=&quot;<span class="title">display</span>: <span class="title">none</span>&quot;&gt;取消上传&lt;/<span class="title">a</span>&gt;&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">                &lt;!--进度条--&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">div</span> <span class="title">id</span>=&quot;<span class="title">upload_display</span>&quot; <span class="title">style</span>=&quot;<span class="title">display</span>: <span class="title">none</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">p</span> <span class="title">style</span>=&quot;<span class="title">margin</span>-<span class="title">top</span>: 15<span class="title">px</span>&quot; &gt;上传进度：&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">margin</span>-<span class="title">top</span>-15 <span class="title">layui</span>-<span class="title">progress</span> <span class="title">layui</span>-<span class="title">progress</span>-<span class="title">big</span>&quot; <span class="title">lay</span>-<span class="title">showpercent</span>=&quot;<span class="title">yes</span>&quot; <span class="title">id</span>=&quot;<span class="title">precent</span>&quot; &gt;&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">br</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;!--结果输出--&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">div</span> <span class="title">id</span>=&quot;<span class="title">result</span>&quot; &gt;&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">hr</span>-<span class="title">line</span>-<span class="title">dashed</span>&quot;&gt;&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">p</span> <span class="title">style</span>=&quot;<span class="title">font</span>-<span class="title">size</span>: 14<span class="title">px</span>;<span class="title">color</span>: <span class="title">red</span>;<span class="title">font</span>-<span class="title">weight</span>: <span class="title">bolder</span>&quot;&gt;注意：&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">p</span>&gt;1、上传支持<span class="title">mp4</span>格式文件；&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">p</span> <span class="title">style</span>=&quot;<span class="title">color</span>: <span class="title">red</span>;&quot;&gt;2、上传为异步处理，上传成功后会有几分钟处理时间，待处理完成才能看到视频链接；&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">p</span>&gt;3、重新上传会替换视频链接；&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">br</span>/&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">p</span> <span class="title">style</span>=&quot;<span class="title">color</span>: #16<span class="title">baaa</span>;<span class="title">font</span>-<span class="title">size</span>: 16<span class="title">px</span>;<span class="title">font</span>-<span class="title">weight</span>: <span class="title">bolder</span>&quot;&gt;上传逻辑：&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">p</span> <span class="title">style</span>=&quot;<span class="title">font</span>-<span class="title">weight</span>: <span class="title">bolder</span>&quot;&gt;通过火山<span class="title">web</span>上传 ➽ 火山视频点播 ➽ 工作流：转化成不同格式的<span class="title">ts</span>文件、转存到火山对象储存（桶）中 ➽ 绑定<span class="title">vid</span>和动作<span class="title">id</span>关系 ➽ （异步）待火山视频处理完成，回写视频地址 （大约需要3-10分钟） &lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">br</span>&gt;</span></span><br><span class="line"><span class="class">    </span>&#123;notempty name=<span class="string">&#x27;vo.id&#x27;</span>&#125;&lt;input type=<span class="string">&#x27;hidden&#x27;</span> value=<span class="string">&#x27;&#123;$vo.id&#125;&#x27;</span> name=<span class="string">&#x27;id&#x27;</span>&gt;&#123;/notempty&#125;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">layui</span>-<span class="title">form</span>-<span class="title">item</span> <span class="title">text</span>-<span class="title">center</span>&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">button</span> <span class="title">class</span>=&quot;<span class="title">layui</span>-<span class="title">btn</span> <span class="title">layui</span>-<span class="title">btn</span>-<span class="title">danger</span>&quot; <span class="title">type</span>=&#x27;<span class="title">button</span>&#x27; <span class="title">data</span>-<span class="title">reload</span> <span class="title">data</span>-<span class="title">close</span>&gt;</span></span><br><span class="line"><span class="class">            关闭</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">button</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">hidden</span>&quot; <span class="title">name</span>=&quot;<span class="title">motion_id</span>&quot; <span class="title">value</span>=&quot;</span>&#123;<span class="variable">$motion_id</span>&#125;<span class="string">&quot; id=&quot;</span>motion_id<span class="string">&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input type=&quot;</span>hidden<span class="string">&quot; name=&quot;</span>volc_token<span class="string">&quot; value=&quot;</span>&#123;<span class="variable">$token</span>&#125;<span class="string">&quot; id=&quot;</span>volc_token<span class="string">&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input type=&quot;</span>hidden<span class="string">&quot; name=&quot;</span>appid<span class="string">&quot; value=&quot;</span>&#123;<span class="variable">$appid</span>&#125;<span class="string">&quot; id=&quot;</span>appid<span class="string">&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input type=&quot;</span>hidden<span class="string">&quot; name=&quot;</span>space_name<span class="string">&quot; value=&quot;</span>&#123;<span class="variable">$space_name</span>&#125;<span class="string">&quot; id=&quot;</span>space_name<span class="string">&quot;&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;!---视频上传---&gt;</span></span><br><span class="line"><span class="string">&lt;script&gt;</span></span><br><span class="line"><span class="string">    let motion_id = $(&quot;</span><span class="comment">#motion_id&quot;).val();</span></span><br><span class="line">    let token = $(<span class="string">&quot;#volc_token&quot;</span>).<span class="title function_ invoke__">val</span>();</span><br><span class="line">    let appid = $(<span class="string">&quot;#appid&quot;</span>).<span class="title function_ invoke__">val</span>();</span><br><span class="line">    let space_name = $(<span class="string">&quot;#space_name&quot;</span>).<span class="title function_ invoke__">val</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ** thinkadmin引入方式：在/static/admin.js加入对应关系，再在此引入使用并实例化</span></span><br><span class="line">    <span class="keyword">require</span>([<span class="string">&#x27;tt_uploader&#x27;</span>], <span class="function"><span class="keyword">function</span> (<span class="params">TTUploader</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 上传初始化</span></span><br><span class="line">        <span class="keyword">const</span> <span class="variable constant_">uploader</span> = <span class="keyword">new</span> <span class="title class_">TTUploader</span>(&#123;</span><br><span class="line">            userId: <span class="string">&quot;1&quot;</span>, <span class="comment">//建议设置能识别用户的唯一标识 ID，用于上传出错时排查问题，不要传入非 ASCII 编码</span></span><br><span class="line">            appId: appid, <span class="comment">//在视频点播-应用服务中创建的 AppID，视频点播的质量监控等都是以这个参数来区分业务方的，务必正确填写</span></span><br><span class="line">            <span class="comment">// 仅视频/普通文件上传时需要配置</span></span><br><span class="line">            videoConfig: &#123;</span><br><span class="line">                spaceName: space_name, <span class="comment">//在视频点播中申请的点播空间名</span></span><br><span class="line">                processAction : [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="string">&quot;Name&quot;</span>:<span class="string">&quot;GetMeta&quot;</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="comment">// 添加工作流模板，通过工作流转化成不同分辨率的ts文件格式</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="string">&quot;Name&quot;</span>:<span class="string">&quot;StartWorkflow&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;Input&quot;</span>: &#123;</span><br><span class="line">                            <span class="string">&quot;TemplateId&quot;</span>:<span class="string">&quot;6c7036757e04483489ee86549d547684&quot;</span>  <span class="comment">// 工作流id</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// =========================&gt; 视频上传 &lt;============================</span></span><br><span class="line">        <span class="comment">// 点击上传</span></span><br><span class="line">        $(<span class="string">&quot;#uploader_btn&quot;</span>).<span class="title function_ invoke__">click</span>(function () &#123;</span><br><span class="line">            document.<span class="title function_ invoke__">getElementById</span>(<span class="string">&quot;precent&quot;</span>).innerHTML = <span class="number">0</span></span><br><span class="line">            document.<span class="title function_ invoke__">getElementById</span>(<span class="string">&quot;result&quot;</span>).innerHTML = <span class="string">&quot;&quot;</span></span><br><span class="line">            let file_obj = document.<span class="title function_ invoke__">getElementById</span>(<span class="string">&quot;upload_file&quot;</span>).files[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">const</span> <span class="variable constant_">fileKey</span> = uploader.<span class="title function_ invoke__">addFile</span>(&#123;</span><br><span class="line">                <span class="attr">file</span>: file_obj,</span><br><span class="line">                <span class="attr">stsToken</span>: JSON.<span class="title function_ invoke__">parse</span>(token), //从服务端拿到的 token，见下方说明</span><br><span class="line">                type : <span class="string">&#x27;video&#x27;</span>, // 上传文件类型，四个可选值：<span class="title function_ invoke__">video</span>(视频或者音频，默认值)，<span class="title function_ invoke__">image</span>(图片)，<span class="keyword">object</span>（普通文件，例如字幕），media（素材文件）</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">if</span>(file_obj)&#123;</span><br><span class="line">                uploader.<span class="title function_ invoke__">start</span>(fileKey);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="title function_ invoke__">alert</span>(<span class="string">&quot;请先选择文件后再上传&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            $(<span class="string">&quot;#cancel_upload&quot;</span>).<span class="title function_ invoke__">show</span>(); <span class="comment">// 显示取消按钮</span></span><br><span class="line">            <span class="comment">// 动态获取进度百分比</span></span><br><span class="line">            uploader.<span class="title function_ invoke__">on</span>(<span class="string">&#x27;progress&#x27;</span>, (infor) =&gt; &#123;</span><br><span class="line">                $(<span class="string">&quot;#upload_display&quot;</span>).<span class="title function_ invoke__">show</span>();</span><br><span class="line">                console.<span class="title function_ invoke__">log</span>( infor.percent)</span><br><span class="line">                $(<span class="string">&quot;#precent&quot;</span>).<span class="title function_ invoke__">html</span>(<span class="string">&#x27;&lt;div class=&quot;layui-progress-bar transition layui-bg-green&quot; lay-percent=&quot;&#x27;</span>+infor.percent+<span class="string">&#x27;%&quot; style=&quot;width: &#x27;</span>+infor.percent+<span class="string">&#x27;%;&quot;&gt;&lt;span class=&quot;layui-progress-text&quot;&gt;&#x27;</span>+infor.percent+<span class="string">&#x27;%&lt;/span&gt;&lt;/div&gt;&#x27;</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">            uploader.<span class="title function_ invoke__">on</span>(<span class="string">&#x27;preUpload&#x27;</span>, (infor) =&gt; &#123;</span><br><span class="line">                console.<span class="title function_ invoke__">log</span>(<span class="string">&#x27;preUpload&#x27;</span>);</span><br><span class="line">                console.<span class="title function_ invoke__">log</span>(infor)</span><br><span class="line">            &#125;);</span><br><span class="line">            uploader.<span class="title function_ invoke__">on</span>(<span class="string">&#x27;initUploadID&#x27;</span>, function(data) &#123;</span><br><span class="line">                console.<span class="title function_ invoke__">log</span>(<span class="string">&#x27;initUploadID&#x27;</span>, data);</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="comment">// 完成</span></span><br><span class="line">            uploader.<span class="title function_ invoke__">on</span>(<span class="string">&#x27;complete&#x27;</span>, (infor) =&gt; &#123;</span><br><span class="line">                $(<span class="string">&quot;#upload_display&quot;</span>).<span class="title function_ invoke__">show</span>();</span><br><span class="line">                <span class="comment">// 设置进度条99%</span></span><br><span class="line">                $(<span class="string">&quot;#precent&quot;</span>).<span class="title function_ invoke__">html</span>(<span class="string">&#x27;&lt;div class=&quot;layui-progress-bar transition layui-bg-green&quot; lay-percent=&quot;99%&quot; style=&quot;width: 99%;&quot;&gt;&lt;span class=&quot;layui-progress-text&quot;&gt;99%&lt;/span&gt;&lt;/div&gt;&#x27;</span>);</span><br><span class="line">                console.<span class="title function_ invoke__">log</span>(<span class="string">&#x27;complete&#x27;</span>);</span><br><span class="line">                console.<span class="title function_ invoke__">log</span>(infor.uploadResult)</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 提交到后端进行数据处理与绑定</span></span><br><span class="line">                $.<span class="title function_ invoke__">ajax</span>(&#123;</span><br><span class="line">                    type    : <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">                    url     : <span class="string">&quot;/admin/app_motion/processVideo&quot;</span>,</span><br><span class="line">                    data    : &#123;<span class="string">&quot;vid&quot;</span> : infor.uploadResult.Vid, <span class="string">&quot;motion_id&quot;</span> : motion_id&#125;,</span><br><span class="line">                    <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">                    success : function(data)&#123;</span><br><span class="line">                        console.<span class="title function_ invoke__">log</span>(data)</span><br><span class="line">                        <span class="keyword">if</span> (data.code == <span class="number">200</span>) &#123;</span><br><span class="line">                            <span class="comment">// 进度条设置为100%</span></span><br><span class="line">                            $(<span class="string">&quot;#precent&quot;</span>).<span class="title function_ invoke__">html</span>(<span class="string">&#x27;&lt;div class=&quot;layui-progress-bar transition layui-bg-green&quot; lay-percent=&quot;100%&quot; style=&quot;width: 100%;&quot;&gt;&lt;span class=&quot;layui-progress-text&quot;&gt;100%&lt;/span&gt;&lt;/div&gt;&#x27;</span>);</span><br><span class="line">                            <span class="comment">// 结果显示</span></span><br><span class="line">                            document.<span class="title function_ invoke__">getElementById</span>(<span class="string">&quot;result&quot;</span>).innerHTML = <span class="string">&quot;上传完成: &lt;br /&gt;vid:  &quot;</span> + infor.uploadResult.Vid</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            document.<span class="title function_ invoke__">getElementById</span>(<span class="string">&quot;result&quot;</span>).innerHTML = <span class="string">&quot;上传失败: &lt;br /&gt;vid:  &quot;</span> + data.msg</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="comment">// 失败</span></span><br><span class="line">            uploader.<span class="title function_ invoke__">on</span>(<span class="string">&#x27;error&#x27;</span>, (infor) =&gt; &#123;</span><br><span class="line">                console.<span class="title function_ invoke__">log</span>(infor.extra);</span><br><span class="line">                document.<span class="title function_ invoke__">getElementById</span>(<span class="string">&quot;result&quot;</span>).innerHTML = <span class="string">&quot;上传失败 error为:  &quot;</span>  + infor.extra.error + <span class="string">&quot;|&quot;</span> + infor.extra.message</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 取消上传</span></span><br><span class="line">        $(<span class="string">&quot;#cancel_upload&quot;</span>).<span class="title function_ invoke__">click</span>(function () &#123;</span><br><span class="line">            uploader.<span class="title function_ invoke__">pause</span>();</span><br><span class="line">            uploader.<span class="title function_ invoke__">cancel</span>();</span><br><span class="line">            $(<span class="string">&quot;#upload_display&quot;</span>).<span class="title function_ invoke__">hide</span>();</span><br><span class="line">            $(<span class="string">&quot;#cancel_upload&quot;</span>).<span class="title function_ invoke__">hide</span>();</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="stsToken的获取"><a href="#stsToken的获取" class="headerlink" title="stsToken的获取"></a>stsToken的获取</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * - 火山引擎类 （视频点播sdk）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VolcSdkService</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">string</span> <span class="variable">$volc_ak</span> = <span class="string">&quot;xxxxxxx&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">string</span> <span class="variable">$volc_sk</span> = <span class="string">&quot;xxxxxxxx&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$client</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$client</span> = <span class="title class_">Vod</span>::<span class="title function_ invoke__">getInstance</span>();</span><br><span class="line">        <span class="variable">$client</span>-&gt;<span class="title function_ invoke__">setAccessKey</span>(<span class="variable">$this</span>-&gt;volc_ak);</span><br><span class="line">        <span class="variable">$client</span>-&gt;<span class="title function_ invoke__">setSecretKey</span>(<span class="variable">$this</span>-&gt;volc_sk);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;client = <span class="variable">$client</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> mixed|string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getUploadVideoAuth</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$expire</span> = <span class="number">3600</span> * <span class="number">8</span>; <span class="comment">// 请求的签名有效期</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;client-&gt;<span class="title function_ invoke__">getUploadVideoAuthWithExpiredTime</span>(<span class="variable">$expire</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (\<span class="built_in">Exception</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> **特别注意**</span><br><span class="line"> <span class="number">1</span>、获取到的token需要json_encode转一下</span><br><span class="line"> <span class="number">2</span>、php用到的composer依赖包为 volcengine/volc-sdk-php</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="上述参数描述"><a href="#上述参数描述" class="headerlink" title="上述参数描述"></a>上述参数描述</h4><ul>
<li>appid : 从火山视频点播后台获取，在视频点播-应用服务中创建的 AppID</li>
<li>space_name : 视频点播空间名</li>
<li>StartWorkflow.TemplateId : 在视频点播后台建议的处理工作流</li>
<li>stsToken : 服务端拿到的授权token</li>
</ul>
]]></content>
      <categories>
        <category>html</category>
      </categories>
      <tags>
        <tag>html</tag>
      </tags>
  </entry>
  <entry>
    <title>获取Bing每日背景图片</title>
    <url>/2018/04/07/%E8%8E%B7%E5%8F%96Bing%E6%AF%8F%E6%97%A5%E8%83%8C%E6%99%AF%E5%9B%BE%E7%89%87/</url>
    <content><![CDATA[<p>经过访问BING的网址最终发现，bing中文网一直在提供每日更新背景图片壁纸的json数据.<br>访问网址：<a href="http://cn.bing.com/HPImageArchive.aspx?format=js&idx=0&n=1">http://cn.bing.com/HPImageArchive.aspx?format=js&amp;idx=0&amp;n=1</a></p>
<h4 id="参数说明"><a href="#参数说明" class="headerlink" title="参数说明"></a>参数说明</h4><p>根据上面地址的结构，我暂时研究到就三项属性有效，他们分别是:</p>
<ul>
<li>format，非必要。我理解为输出格式，不存在或者不等于js，即为xml格式，等于js时，输出json格式；</li>
<li>idx，非必要。不存在或者等于0时，输出当天的图片，-1为已经预备用于明天显示的信息，1则为昨天的图片，idx最多获取到前16天的图片信息；*</li>
<li>n，必要。这是输出信息的数量，比如n&#x3D;1，即为1条，以此类推，至多输出8条；*<span id="more"></span>
*号注释：此处我们要注意的时，是否正常的输出信息，与n和idx有关，通过idx的值，我们就可以获得之前bing所使用的背景图片的信息了。</li>
</ul>
<p>提供一个我正在用json转php，调用图片地址的方法:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$str</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;http://cn.bing.com/HPImageArchive.aspx?format=js&amp;idx=0&amp;n=1&#x27;</span>);</span><br><span class="line">   <span class="variable">$array</span> = <span class="title function_ invoke__">json_decode</span>(<span class="variable">$str</span>);</span><br><span class="line">   <span class="variable">$imgurl</span> = <span class="variable">$array</span>-&gt;&#123;<span class="string">&quot;images&quot;</span>&#125;[<span class="number">0</span>]-&gt;&#123;<span class="string">&quot;url&quot;</span>&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 从bing上获取背景图片</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">model_op_bing</span> <span class="keyword">extends</span> <span class="title">components_basemodel</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">CACHE_BING_PIC</span> = <span class="string">&quot;op.bing.%s&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> Cache_MemCache</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$cache</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$pkid</span> = <span class="literal">false</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">parent</span>::<span class="title function_ invoke__">__construct</span>(<span class="variable">$pkid</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;cache = <span class="title class_">SCache</span>::<span class="title function_ invoke__">getCacheEngine</span>(<span class="string">&quot;Memcache&quot;</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;cache-&gt;<span class="title function_ invoke__">init</span>(<span class="keyword">array</span>(<span class="string">&#x27;servers&#x27;</span> =&gt; lib_<span class="title class_">Constant</span>::<span class="variable">$MEMCACHE_SERVERS</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getBackground</span>(<span class="params"><span class="variable">$isForce</span>=<span class="literal">false</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$cacheKey</span> = <span class="title function_ invoke__">sprintf</span>(<span class="built_in">self</span>::<span class="variable constant_">CACHE_BING_PIC</span>, <span class="title function_ invoke__">date</span>(<span class="string">&quot;Y_m_d&quot;</span>,<span class="title function_ invoke__">time</span>()));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ( <span class="variable language_">$this</span>-&gt;cache-&gt;<span class="title function_ invoke__">get</span>(<span class="variable">$cacheKey</span>) &amp;&amp; <span class="literal">false</span> == <span class="variable">$isForce</span> ) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;cache-&gt;<span class="title function_ invoke__">get</span>(<span class="variable">$cacheKey</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$picSuffix</span> = <span class="string">&#x27;http://cn.bing.com&#x27;</span>;</span><br><span class="line">        <span class="variable">$result</span> = <span class="title function_ invoke__">file_get_contents</span>(</span><br><span class="line">            <span class="title function_ invoke__">sprintf</span>(<span class="string">&#x27;%s%s&#x27;</span>, <span class="variable">$picSuffix</span>, <span class="string">&#x27;/HPImageArchive.aspx?format=js&amp;idx=0&amp;n=1&#x27;</span>)</span><br><span class="line">        );</span><br><span class="line">        <span class="variable">$bing</span> = <span class="title function_ invoke__">json_decode</span>(<span class="variable">$result</span>);</span><br><span class="line">        <span class="variable">$imgurl</span> = <span class="variable">$bing</span>-&gt;&#123;<span class="string">&quot;images&quot;</span>&#125;[<span class="number">0</span>]-&gt;&#123;<span class="string">&quot;url&quot;</span>&#125;;</span><br><span class="line">        <span class="variable">$imgurl</span> = <span class="literal">false</span> === <span class="title function_ invoke__">strpos</span>(<span class="variable">$picSuffix</span>, <span class="variable">$imgurl</span>)</span><br><span class="line">            ? <span class="title function_ invoke__">sprintf</span>(<span class="string">&#x27;%s%s&#x27;</span>, <span class="variable">$picSuffix</span>, <span class="variable">$imgurl</span>) : <span class="variable">$imgurl</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$type</span> = <span class="title function_ invoke__">pathinfo</span>(<span class="variable">$imgurl</span>, PATHINFO_EXTENSION);</span><br><span class="line">        <span class="variable">$data</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$imgurl</span>);</span><br><span class="line">        <span class="variable">$base64</span> = <span class="string">&#x27;data:image/&#x27;</span> . <span class="variable">$type</span> . <span class="string">&#x27;;base64,&#x27;</span> . <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$data</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;cache-&gt;<span class="title function_ invoke__">set</span>(<span class="variable">$cacheKey</span>, <span class="variable">$base64</span>, <span class="number">43200</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$base64</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>调用方：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$params</span>[<span class="string">&#x27;backgroundImg&#x27;</span>] = (<span class="title function_ invoke__">date</span>(<span class="string">&#x27;Ymd&#x27;</span>) == <span class="string">&#x27;20161208&#x27;</span> || <span class="title function_ invoke__">date</span>(<span class="string">&#x27;Ymd&#x27;</span>) == <span class="string">&#x27;20161209&#x27;</span>)</span><br><span class="line">            ? <span class="string">&quot;/assets/op/img/1208_index.jpg&quot;</span> : <span class="variable">$bingModel</span>-&gt;<span class="title function_ invoke__">getBackground</span>((!<span class="keyword">empty</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;update&#x27;</span>])) ? <span class="literal">true</span> : <span class="literal">false</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>php</category>
      </categories>
      <tags>
        <tag>php</tag>
      </tags>
  </entry>
  <entry>
    <title>远程即时修改微信公众号菜单</title>
    <url>/2018/01/06/%E8%BF%9C%E7%A8%8B%E5%8D%B3%E6%97%B6%E4%BF%AE%E6%94%B9%E5%BE%AE%E4%BF%A1%E8%8F%9C%E5%8D%95/</url>
    <content><![CDATA[<p>场景：</p>
<blockquote>
<p>某天程序员A加班加点完成了本次微信项目的迭代工作，在使用全身解数之后终于盼来了上线的等待，当然，后面也是成功上线了，但是项目经理在看过线上项目之后，才发现程序员A在微信后台修改的操作菜单并没有生效，当然程序员A也知道，这个生效要等一小时左右，但是项目经理急了，’我马上要给客户看，怎么能等待生效’。</p>
</blockquote>
<p>这是一个线上执行的单文件，如有需要拆分成各个板块形成方法，可以自行去改。<br>直接执行以下代码能即时修改微信菜单，比微信后台修改操作快很多。</p>
<span id="more"></span>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$appid</span> = <span class="string">&quot;xxxxxxx&quot;</span>;          <span class="comment">//微信appid</span></span><br><span class="line"><span class="variable">$appsecret</span> = <span class="string">&quot;xxxxxxxxxxx&quot;</span>;  <span class="comment">//微信secret_id</span></span><br><span class="line"><span class="variable">$url</span> = <span class="string">&quot;https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&amp;appid=<span class="subst">$appid</span>&amp;secret=<span class="subst">$appsecret</span>&quot;</span>;</span><br><span class="line"><span class="variable">$host</span> = <span class="string">&quot;http://xxxxxx.com&quot;</span>;  <span class="comment">//站点域名</span></span><br><span class="line"><span class="variable">$ch</span> = <span class="title function_ invoke__">curl_init</span>();</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_SSL_VERIFYPEER, <span class="literal">FALSE</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_SSL_VERIFYHOST, <span class="literal">FALSE</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line"><span class="variable">$output</span> = <span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="variable">$jsoninfo</span> = <span class="title function_ invoke__">json_decode</span>(<span class="variable">$output</span>, <span class="literal">true</span>);</span><br><span class="line"><span class="variable">$access_token</span> = <span class="variable">$jsoninfo</span>[<span class="string">&quot;access_token&quot;</span>];</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-type: text/html; charset=utf-8&quot;</span>);</span><br><span class="line"><span class="comment">//创建菜单</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createMenu</span>(<span class="params"><span class="variable">$data</span>, <span class="variable">$access_token</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$ch</span> = <span class="title function_ invoke__">curl_init</span>();</span><br><span class="line">    <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_URL, <span class="string">&quot;https://api.weixin.qq.com/cgi-bin/menu/create?access_token=&quot;</span>.<span class="variable">$access_token</span>);</span><br><span class="line">    <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_CUSTOMREQUEST, <span class="string">&quot;POST&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_SSL_VERIFYPEER, <span class="literal">FALSE</span>);</span><br><span class="line">    <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_SSL_VERIFYHOST, <span class="literal">FALSE</span>);</span><br><span class="line">    <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_USERAGENT, <span class="string">&#x27;Mozilla/5.0 (compatible; MSIE 5.01; Windows NT 5.0)&#x27;</span>);</span><br><span class="line">    <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_FOLLOWLOCATION, <span class="number">1</span>);</span><br><span class="line">    <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_AUTOREFERER, <span class="number">1</span>);</span><br><span class="line">    <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_POSTFIELDS, <span class="variable">$data</span>);</span><br><span class="line">    <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="literal">true</span>);</span><br><span class="line">    <span class="variable">$tmpInfo</span> = <span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">curl_errno</span>(<span class="variable">$ch</span>)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_ invoke__">curl_error</span>(<span class="variable">$ch</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$tmpInfo</span>;</span><br><span class="line">&#125;</span><br><span class="line"> <span class="comment">//获取菜单</span></span><br><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">getMenu</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;https://api.weixin.qq.com/cgi-bin/menu/get?access_token=&quot;</span>.ACCESS_TOKEN);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//删除菜单</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">deleteMenu</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;https://api.weixin.qq.com/cgi-bin/menu/delete?access_token=&quot;</span>.ACCESS_TOKEN);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="variable">$data</span> = <span class="keyword">array</span>(</span><br><span class="line">      <span class="string">&quot;button&quot;</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line">          <span class="keyword">array</span>(</span><br><span class="line">              <span class="string">&quot;name&quot;</span>=&gt;<span class="title function_ invoke__">urlencode</span>(<span class="string">&quot;推广赚钱&quot;</span>),</span><br><span class="line">              <span class="string">&quot;sub_button&quot;</span>=&gt;<span class="keyword">array</span>(</span><br><span class="line">                  <span class="keyword">array</span>(</span><br><span class="line">                      <span class="string">&quot;type&quot;</span>=&gt;<span class="string">&quot;view&quot;</span>,</span><br><span class="line">                      <span class="string">&quot;name&quot;</span>=&gt;<span class="title function_ invoke__">urlencode</span>(<span class="string">&quot;首页&quot;</span>),</span><br><span class="line">                      <span class="string">&quot;url&quot;</span>=&gt;<span class="variable">$host</span>.<span class="string">&quot;/default/index?needLogin=1&amp;agent_r=agent_wx&quot;</span></span><br><span class="line">                  ),</span><br><span class="line">                  <span class="keyword">array</span>(</span><br><span class="line">                      <span class="string">&quot;type&quot;</span>=&gt;<span class="string">&quot;view&quot;</span>,</span><br><span class="line">                      <span class="string">&quot;name&quot;</span>=&gt;<span class="title function_ invoke__">urlencode</span>(<span class="string">&quot;做任务&quot;</span>),</span><br><span class="line">                      <span class="string">&quot;url&quot;</span>=&gt;<span class="variable">$host</span>.<span class="string">&quot;/proxy/taskHall?agent_r=agent_wx&quot;</span></span><br><span class="line">                  ),</span><br><span class="line">                  <span class="keyword">array</span>(</span><br><span class="line">                      <span class="string">&quot;type&quot;</span>=&gt;<span class="string">&quot;view&quot;</span>,</span><br><span class="line">                      <span class="string">&quot;name&quot;</span>=&gt;<span class="title function_ invoke__">urlencode</span>(<span class="string">&quot;提商机&quot;</span>),</span><br><span class="line">                      <span class="string">&quot;url&quot;</span>=&gt;<span class="variable">$host</span>.<span class="string">&quot;/business/add?agent_r=agent_wx&quot;</span></span><br><span class="line">                  ),</span><br><span class="line">                  <span class="keyword">array</span>(</span><br><span class="line">                      <span class="string">&quot;type&quot;</span>=&gt;<span class="string">&quot;view&quot;</span>,</span><br><span class="line">                      <span class="string">&quot;name&quot;</span>=&gt;<span class="title function_ invoke__">urlencode</span>(<span class="string">&quot;推广爆品&quot;</span>),</span><br><span class="line">                      <span class="string">&quot;url&quot;</span>=&gt;<span class="variable">$host</span>.<span class="string">&quot;/proxy/home?agent_r=agent_wx&quot;</span></span><br><span class="line">                  ),<span class="keyword">array</span>(</span><br><span class="line">                      <span class="string">&quot;type&quot;</span>=&gt;<span class="string">&quot;view&quot;</span>,</span><br><span class="line">                      <span class="string">&quot;name&quot;</span>=&gt;<span class="title function_ invoke__">urlencode</span>(<span class="string">&quot;推广店铺&quot;</span>),</span><br><span class="line">                      <span class="string">&quot;url&quot;</span>=&gt;<span class="variable">$host</span>.<span class="string">&quot;/rebateshop/index?agent_r=agent_wx&quot;</span></span><br><span class="line">                  )</span><br><span class="line">              )</span><br><span class="line">          ),</span><br><span class="line">          <span class="keyword">array</span>(</span><br><span class="line">              <span class="string">&quot;name&quot;</span>=&gt;<span class="title function_ invoke__">urlencode</span>(<span class="string">&quot;发展下级&quot;</span>),</span><br><span class="line">              <span class="string">&quot;sub_button&quot;</span>=&gt;<span class="keyword">array</span>(</span><br><span class="line">                  <span class="keyword">array</span>(</span><br><span class="line">                      <span class="string">&quot;type&quot;</span>=&gt;<span class="string">&quot;view&quot;</span>,</span><br><span class="line">                      <span class="string">&quot;name&quot;</span>=&gt;<span class="title function_ invoke__">urlencode</span>(<span class="string">&quot;发展下级&quot;</span>),</span><br><span class="line">                      <span class="string">&quot;url&quot;</span>=&gt;<span class="variable">$host</span>.<span class="string">&quot;/invite/newinviteentershow?agent_r=agent_wx&quot;</span></span><br><span class="line">                  ),</span><br><span class="line">                  <span class="keyword">array</span>(</span><br><span class="line">                      <span class="string">&quot;type&quot;</span>=&gt;<span class="string">&quot;view&quot;</span>,</span><br><span class="line">                      <span class="string">&quot;name&quot;</span>=&gt;<span class="title function_ invoke__">urlencode</span>(<span class="string">&quot;管理下级&quot;</span>),</span><br><span class="line">                      <span class="string">&quot;url&quot;</span>=&gt;<span class="variable">$host</span>.<span class="string">&quot;/partner/mypartner?agent_r=agent_wx&quot;</span></span><br><span class="line">                  )</span><br><span class="line">              )</span><br><span class="line">          ),</span><br><span class="line">          <span class="keyword">array</span>(</span><br><span class="line">              <span class="string">&quot;name&quot;</span>=&gt;<span class="title function_ invoke__">urlencode</span>(<span class="string">&quot;我的&quot;</span>),</span><br><span class="line">              <span class="string">&quot;sub_button&quot;</span>=&gt;<span class="keyword">array</span>(</span><br><span class="line">                  <span class="keyword">array</span>(</span><br><span class="line">                      <span class="string">&quot;type&quot;</span>=&gt;<span class="string">&quot;view&quot;</span>,</span><br><span class="line">                      <span class="string">&quot;name&quot;</span>=&gt;<span class="title function_ invoke__">urlencode</span>(<span class="string">&quot;收益&quot;</span>),</span><br><span class="line">                      <span class="string">&quot;url&quot;</span>=&gt;<span class="variable">$host</span>.<span class="string">&quot;/earnings/BalanceCommission?agent_r=agent_wx&quot;</span></span><br><span class="line">                  ),</span><br><span class="line">                  <span class="keyword">array</span>(</span><br><span class="line">                      <span class="string">&quot;type&quot;</span>=&gt;<span class="string">&quot;view&quot;</span>,</span><br><span class="line">                      <span class="string">&quot;name&quot;</span>=&gt;<span class="title function_ invoke__">urlencode</span>(<span class="string">&quot;我的店铺&quot;</span>),</span><br><span class="line">                      <span class="string">&quot;url&quot;</span>=&gt;<span class="variable">$host</span>.<span class="string">&quot;/shop/detail?agent_r=agent_wx&quot;</span></span><br><span class="line">                  ),</span><br><span class="line">                  <span class="keyword">array</span>(</span><br><span class="line">                      <span class="string">&quot;type&quot;</span>=&gt;<span class="string">&quot;view&quot;</span>,</span><br><span class="line">                      <span class="string">&quot;name&quot;</span>=&gt;<span class="title function_ invoke__">urlencode</span>(<span class="string">&quot;个人中心&quot;</span>),</span><br><span class="line">                      <span class="string">&quot;url&quot;</span>=&gt;<span class="variable">$host</span>.<span class="string">&quot;/home/ucenter?agent_r=agent_wx&quot;</span></span><br><span class="line">                  )</span><br><span class="line"></span><br><span class="line">              )</span><br><span class="line">          )</span><br><span class="line">      )</span><br><span class="line">  );</span><br><span class="line">  <span class="comment">//转义汉字</span></span><br><span class="line">  <span class="variable">$data</span> = <span class="title function_ invoke__">json_encode</span>(<span class="variable">$data</span>);</span><br><span class="line">  <span class="variable">$data</span> = <span class="title function_ invoke__">urldecode</span>(<span class="variable">$data</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$data</span>;<span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">createMenu</span>(<span class="variable">$data</span>, <span class="variable">$access_token</span>);<span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>php</category>
      </categories>
      <tags>
        <tag>php</tag>
      </tags>
  </entry>
  <entry>
    <title>Centos7如何安装python3.10+</title>
    <url>/2025/03/19/Centos7%E5%A6%82%E4%BD%95%E5%AE%89%E8%A3%85python3-10/</url>
    <content><![CDATA[<p>在centos7里面安装python3.10+高版本的时候，会报错Centos7如何安装python3.10+,ImportError: Can’t connect to HTTPS URL because the SSL module is not available.<br>原因是centos7里面的openssl是1.0.1版本的，这对于python3以上的版本不再支持，需要我们对系统中的openssl进行升级后才进行安装</p>
<h3 id="一、OpenSSL版本要求"><a href="#一、OpenSSL版本要求" class="headerlink" title="一、OpenSSL版本要求"></a>一、OpenSSL版本要求</h3><p>Python 3.10需要‌OpenSSL 1.1.1或更高版本‌支持。CentOS 7默认安装的OpenSSL 1.0.2k不兼容，需手动升级‌</p>
<h3 id="二、升级OpenSSL详细步骤"><a href="#二、升级OpenSSL详细步骤" class="headerlink" title="二、升级OpenSSL详细步骤"></a>二、升级OpenSSL详细步骤</h3><h4 id="1-安装编译依赖"><a href="#1-安装编译依赖" class="headerlink" title="1. 安装编译依赖"></a>1. 安装编译依赖</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo yum install -y gcc make perl zlib-devel pcre-devel</span><br></pre></td></tr></table></figure>

<h4 id="2-下载并解压OpenSSL源码"><a href="#2-下载并解压OpenSSL源码" class="headerlink" title="2. 下载并解压OpenSSL源码"></a>2. 下载并解压OpenSSL源码</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /usr/src</span><br><span class="line">sudo wget https://www.openssl.org/source/openssl-1.1.1w.tar.gz  # 以最新版为例</span><br><span class="line">sudo tar xzf openssl-*.tar.gz &amp;&amp; cd openssl-*</span><br></pre></td></tr></table></figure>

<h4 id="3-编译安装OpenSSL"><a href="#3-编译安装OpenSSL" class="headerlink" title="3. 编译安装OpenSSL"></a>3. 编译安装OpenSSL</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo ./config --prefix=/usr/local/openssl --openssldir=/usr/local/openssl</span><br><span class="line">sudo make &amp;&amp; sudo make install</span><br></pre></td></tr></table></figure>

<h4 id="4-配置系统环境"><a href="#4-配置系统环境" class="headerlink" title="4. 配置系统环境"></a>4. 配置系统环境</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">备份旧版</span></span><br><span class="line">sudo mv /usr/bin/openssl /usr/bin/openssl.bak</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建软链接</span></span><br><span class="line">sudo ln -s /usr/local/openssl/bin/openssl /usr/bin/openssl</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">更新库路径</span></span><br><span class="line">echo &quot;/usr/local/openssl/lib&quot; | sudo tee /etc/ld.so.conf.d/openssl.conf</span><br><span class="line">sudo ldconfig</span><br></pre></td></tr></table></figure>

<h4 id="5-验证安装"><a href="#5-验证安装" class="headerlink" title="5. 验证安装"></a>5. 验证安装</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">openssl version  # 应显示OpenSSL 1.1.1w或更高版本</span><br></pre></td></tr></table></figure>

<p>说明‌：若仍显示旧版，检查PATH环境变量是否包含&#x2F;usr&#x2F;local&#x2F;openssl&#x2F;bin</p>
<h3 id="三、安装Python-3-10步骤"><a href="#三、安装Python-3-10步骤" class="headerlink" title="三、安装Python 3.10步骤"></a>三、安装Python 3.10步骤</h3><h4 id="1-安装编译依赖-1"><a href="#1-安装编译依赖-1" class="headerlink" title="1. 安装编译依赖"></a>1. 安装编译依赖</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo yum groupinstall &quot;Development Tools&quot;</span><br><span class="line">sudo yum install -y zlib-devel bzip2-devel ncurses-devel sqlite-devel readline-devel tk-devel libffi-devel</span><br></pre></td></tr></table></figure>

<h4 id="2-下载Python源码"><a href="#2-下载Python源码" class="headerlink" title="2. 下载Python源码"></a>2. 下载Python源码</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /usr/src</span><br><span class="line">sudo wget https://www.python.org/ftp/python/3.10.13/Python-3.10.13.tgz</span><br><span class="line">sudo tar xzf Python-3.10.13.tgz &amp;&amp; cd Python-3.10.13</span><br></pre></td></tr></table></figure>

<h4 id="3-配置并编译Python"><a href="#3-配置并编译Python" class="headerlink" title="3. 配置并编译Python"></a>3. 配置并编译Python</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">指定OpenSSL路径</span></span><br><span class="line">./configure --enable-optimizations --with-openssl=/usr/local/openssl</span><br><span class="line">sudo make &amp;&amp; sudo make install</span><br></pre></td></tr></table></figure>

<h4 id="4-验证安装"><a href="#4-验证安装" class="headerlink" title="4. 验证安装"></a>4. 验证安装</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python3.10 --version  # 应显示Python 3.10.13</span><br><span class="line">python3.10 -m ssl     # 检查SSL模块是否可用</span><br></pre></td></tr></table></figure>


<h3 id="四、注意事项"><a href="#四、注意事项" class="headerlink" title="四、注意事项"></a>四、注意事项</h3><ul>
<li>1、‌路径隔离‌：建议将Python 3.10安装到&#x2F;usr&#x2F;local目录，避免覆盖系统默认的Python 2.7</li>
<li>2、‌依赖冲突‌：若编译Python时提示ssl模块缺失，需确认–with-openssl参数指向正确的OpenSSL路径‌</li>
<li>3、环境变量‌：可通过alternatives工具或手动创建&#x2F;usr&#x2F;bin&#x2F;python3软链接管理多版本Python</li>
<li>4、pip3:在使用的时候需要配置源，才可能更顺利的拉取包</li>
</ul>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
</search>
